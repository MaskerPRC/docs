<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.nn.functional — PyTorch main documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/_modules/torch/nn/functional.html">
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css">
  <!-- <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/katex-math.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/sphinx-dropdown.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/panels-bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/css/jit.css" type="text/css">
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css">
    <link rel="index" title="Index" href="../../../genindex.html">
    <link rel="search" title="Search" href="../../../search.html">

<!--
  Search engines should not index the main version of documentation.
  Stable documentation are built without release == 'main'.
-->
<meta name="robots" content="noindex">


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head><body class="pytorch-body"><div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">学习</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/get-started">
                  <span class="dropdown-title">开始使用</span>
                  <p>在本地运行 PyTorch 或快速开始使用支持的云平台之一</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials">
                  <span class="dropdown-title">教程</span><p></p>
                  <p>PyTorch 教程中的新内容</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/basics/intro.html">
                  <span class="dropdown-title">学习基础知识</span><p></p>
                  <p>熟悉 PyTorch 的概念和模块</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/recipes/recipes_index.html">
                  <span class="dropdown-title">PyTorch 食谱</span><p></p>
                  <p>精简型、即用型 PyTorch 代码示例</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/introyt.html">
                  <span class="dropdown-title">PyTorch 入门 - YouTube 系列</span><p></p>
                  <p>通过我们引人入胜的 YouTube 教程系列掌握 PyTorch 基础知识</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">生态系统</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class="dropdown-title">工具</span><p></p>
                  <p>了解 PyTorch 生态系统中的工具和框架</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">社区</span>
                  <p>加入 PyTorch 开发者社区，贡献、学习并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">论坛</span>
                  <p>讨论 PyTorch 代码、问题、安装、研究的地方</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">开发者资源</span>
                  <p>查找资源并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem/contributor-awards-2024">
                  <span class="dropdown-title">贡献者奖项 - 2024</span><p></p>
                  <p>本年 PyTorch 会议揭晓获奖者</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">边缘</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/edge">
                  <span class="dropdown-title">关于 PyTorch Edge</span><p></p>
                  <p>为边缘设备构建创新且注重隐私的 AI 体验</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch-overview">
                  <span class="dropdown-title">ExecuTorch</span><p></p>
                  <p>针对移动和边缘设备实现端到端推理能力的解决方案</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch/stable/index.html">
                  <span class="dropdown-title">ExecuTorch 文档</span><p></p>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">文档</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span><p></p>
                  <p>查阅文档以获取全面指导，了解如何使用 PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/pytorch-domains">
                  <span class="dropdown-title">PyTorch 领域</span><p></p>
                  <p>阅读 PyTorch 领域的文档以了解更多关于特定领域的库</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">博客与新闻</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/blog/">
                  <span class="dropdown-title">PyTorch 博客</span><p></p>
                  <p>跟上最新的技术新闻和动态</p>
                </a>
                 <a class="nav-dropdown-item" href="https://pytorch.org/community-blog">
                  <span class="dropdown-title">社区博客</span><p></p>
                  <p>PyTorch 生态系统故事</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/videos">
                  <span class="dropdown-title">视频</span><p></p>
                  <p>了解最新的 PyTorch 教程、新内容等</p>
                </a><a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">社区故事</span><p></p>
                  <p>了解我们的社区如何使用 PyTorch 解决真实、日常的机器学习问题</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">活动</span><p></p>
                  <p>查找活动、网络研讨会和播客</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/newsletter">
                  <span class="dropdown-title">通讯</span><p></p>
                  <p>保持最新更新</p>
                </a>
            </div>
          </div></li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">关于</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch 基金会</span><p></p>
                  <p>了解更多关于 PyTorch 基金会的信息</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/governing-board">
                  <span class="dropdown-title">管理委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/credits">
                  <span class="dropdown-title">云信用计划</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tac">
                  <span class="dropdown-title">技术顾问委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/staff">
                  <span class="dropdown-title">员工</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/contact-us">
                  <span class="dropdown-title">联系我们</span><p></p>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="https://pytorch.org/join" data-cta="join">成为会员</a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>



   

    

    <div class="table-of-contents-link-wrapper">
      <span>目录</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="https://pytorch.org/docs/versions.html">主页 (2.7.0+cpu ) ▼</a>
    </div>
    <div id="searchBox">
    <div class="searchbox" id="googleSearchBox">
      <script async="" src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>
      <div class="gcse-search"></div>
    </div>
    <div id="sphinxSearchBox" style="display: none;">
      <div role="search">
        <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
          <input type="text" name="q" placeholder="Search Docs">
          <input type="hidden" name="check_keywords" value="yes">
          <input type="hidden" name="area" value="default">
        </form>
      </div>
    </div>
  </div>
  <form id="searchForm">
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="google" checked="">Google 搜索</label>
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="sphinx">经典搜索</label>
  </form>

  <script>
     document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('searchForm');
      const googleSearchBox = document.getElementById('googleSearchBox');
      const sphinxSearchBox = document.getElementById('sphinxSearchBox');
      // Function to toggle search box visibility
      function toggleSearchBox(searchType) {
        googleSearchBox.style.display = searchType === 'google' ? 'block' : 'none';
        sphinxSearchBox.style.display = searchType === 'sphinx' ? 'block' : 'none';
      }
      // Determine the default search type
      let defaultSearchType;
      const currentUrl = window.location.href;
      if (currentUrl.startsWith('https://pytorch.org/docs/stable')) {
        // For the stable documentation, default to Google
        defaultSearchType = localStorage.getItem('searchType') || 'google';
      } else {
        // For any other version, including docs-preview, default to Sphinx
        defaultSearchType = 'sphinx';
      }
      // Set the default search type
      document.querySelector(`input[name="searchType"][value="${defaultSearchType}"]`).checked = true;
      toggleSearchBox(defaultSearchType);
      // Event listener for changes in search type
      searchForm.addEventListener('change', function(event) {
        const selectedSearchType = event.target.value;
        localStorage.setItem('searchType', selectedSearchType);
        toggleSearchBox(selectedSearchType);
      });
      // Set placeholder text for Google search box
      window.onload = function() {
        var placeholderText = "Search Docs";
        var googleSearchboxText = document.querySelector("#gsc-i-id1");
        if (googleSearchboxText) {
          googleSearchboxText.placeholder = placeholderText;
          googleSearchboxText.style.fontFamily = 'FreightSans';
          googleSearchboxText.style.fontSize = "1.2rem";
          googleSearchboxText.style.color = '#262626';
        }
      };
    });
  </script>

          </div>

          

<div>
  <a style="color:#F05732" href="https://pytorch.org/docs/stable/_modules/torch/nn/functional.html">您正在查看不稳定开发者预览文档。请点击此处查看最新稳定版本的文档。</a>
</div>


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">社区</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../community/build_ci_governance.html">PyTorch 治理 | 构建 + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/contribution_guide.html">PyTorch 贡献指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/design.html">PyTorch 设计哲学</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/governance.html">PyTorch 治理 | 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/persons_of_interest.html">PyTorch 治理 | 维护者</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者笔记</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/amp_examples.html">自动混合精度示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/autograd.html">Autograd 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/broadcasting.html">广播语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/cpu_threading_torchscript_inference.html">CPU 多线程和 TorchScript 推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/cuda.html">CUDA 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/custom_operators.html">PyTorch 自定义算子页面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/ddp.html">分布式数据并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/extending.html">扩展 PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/extending.func.html">扩展 torch.func 与 autograd.Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/fsdp.html">FSDP 笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/get_start_xpu.html">在 Intel GPU 上入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/gradcheck.html">毕业审核机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/hip.html">HIP (ROCm) 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/large_scale_deployments.html">大规模部署功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/libtorch_stable_abi.html">LibTorch 稳定 ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/modules.html">模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/mps.html">MPS 后端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/multiprocessing.html">多进程最佳实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/numerical_accuracy.html">数值精度</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/randomness.html">可重复性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/serialization.html">序列化语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/windows.html">Windows 常见问题解答</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语言绑定</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensor_attributes.html">Tensor 属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensor_view.html">张量视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accelerator.html">torch 加速器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpu.html">torch.cpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch_cuda_memory.html">理解 CUDA 内存使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch_cuda_memory.html#generating-a-snapshot">生成快照</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch_cuda_memory.html#using-the-visualizer">使用可视化器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch_cuda_memory.html#snapshot-api-reference">快照 API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mps.html">torch.mps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../xpu.html">torch.xpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mtia.html">torch.mtia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mtia.memory.html">torch.mtia.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../meta.html">元设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../export.html">torch.export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.tensor.html">torch.distributed.tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.fsdp.fully_shard.html">torch.distributed.fsdp.fully_shard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.tensor.parallel.html">torch.distributed.tensor.parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.pipelining.html">torch.distributed.pipelining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributed.checkpoint.html">torch.distributed.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch.compiler.html">torch.compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../func.html">torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fx.experimental.html">torch.fx.experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../signal.html">torch.signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nn.attention.html">torch.nn.attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../complex_numbers.html">复数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ddp_comm_hooks.html">DDP 通信钩子</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quantization.html">量化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rpc.html">分布式 RPC 框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../masked.html">torch.masked</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../size.html">torch.Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils.html">torch.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deterministic.html">torch.utils.deterministic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jit_utils.html">torch.utils.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../module_tracker.html">torch.utils.module_tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../type_info.html">类型信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../named_tensor.html">命名张量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../name_inference.html">命名张量操作覆盖率</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config_mod.html">torch.__config__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../future_mod.html">torch.__future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../logging.html">torch._logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../torch_environment_variables.html">Torch 环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">库</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">火炬推荐</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/ao">torchao</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        文档 &gt;</li>

        
          <li>模块代码 &gt;</li>
        
          <li><a href="../../torch.html">torch</a> &gt;</li>
        
      <li>torch.nn.functional</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">快捷键</div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>torch.nn.functional 的源代码</font></font></font></h1><div class="highlight"><pre><span></span><span class="sd"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">功能接口。</span>

<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入库</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span>
<span class="kn">from</span> <span class="nn">打字</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</span>

<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">_VF</span><span class="p">,</span> <span class="n">sym_int</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="n">_sym_int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span>
<span class="kn">from</span> <span class="nn">torch._C</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">推断大小</span>
<span class="kn">from</span> <span class="nn">torch._jit_internal</span> <span class="kn">导入</span> <span class="p">(</span>
    <span class="n">超载_</span><span class="p">,</span>
    <span class="n">布尔分发</span><span class="p">,</span>
    <span class="n">广播列表 1</span><span class="p">,</span>
    <span class="n">广播列表 2</span><span class="p">,</span>
    <span class="n">广播列表 3</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">torch._torch_docs</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏支撑说明</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</span>  <span class="c1"># noqa: F401</span>
<span class="kn">from</span> <span class="nn">torch.nn 模块.utils</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">带默认值的列表</span><span class="p">,</span> <span class="n">_pair</span><span class="p">,</span> <span class="n">_single</span><span class="p">,</span> <span class="n">_triple</span>
<span class="kn">from</span> <span class="nn">torch.overrides</span> <span class="kn">导入</span> <span class="p">(</span>
    <span class="n">handle_torch_function</span><span class="p">,</span>
    <span class="n">有 torch 功能</span><span class="p">,</span>
    <span class="n">has_torch_function_unary</span><span class="p">,</span>
    <span class="n">has_torch_function_variadic</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">torch.types</span> <span class="kn">导入</font></font></font></span> <span class="n">_dtype</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># JIT 编译器不理解 Union，也不理解这里的 torch.dtype</span>
    <span class="n">数据类型</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span>

<span class="k">尝试</span><span class="p">:</span>
    <span class="kn">导入</font></font></font></span> <span class="nn">numpy</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="nn">np</span>
<span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块未找到错误</span><span class="p">:</span>
    <span class="n">np</span> <span class="o">=</span> <span class="kc">无</span>


<span class="n">conv1d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">卷积 1D</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv1d(input, weight, bias=None, stride=1, padding=0, dilation=1, groups=1) -&gt; 索引</span>

<span class="sd">对由多个输入平面组成的输入信号应用 1D 卷积。</span>
<span class="sd">请参阅 :class:`~torch.nn.Conv1d` 获取详细信息及输出形状。</span>

<span class="sd">{tf32_note}</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.Conv1d`。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>

<span class="sd">注意：</span>
<span class="sd">此运算符支持复杂数据类型，即 ``complex32, complex64, complex128``。</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</font></font></font></span><span class="si">{minibatch}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">， \text{in\_channels} ， iW}`</span>
<span class="s2">权重：形状为 :math:`(\text{out\_channels} ， \frac{\text{in\_channels}}{\text`</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kW)`</span>
<span class="s2">偏置：可选偏置，形状为 :math:`(out\_channels)`。默认：``None``</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或</span>
<span class="s2">一个元素的元组 `(sW,)`。默认值：1</span>
<span class="s2">填充：输入两侧的隐式填充。可以是字符串 {'valid', 'same'}</span>
<span class="s2">单个数字或一个元素的元组 `(padW,)`。默认值：0</span>
<span class="s2">``padding='valid'`` 与无填充相同。``padding='same'`` 进行填充</span>
<span class="s2">输入以保持输出与输入相同的形状。然而，此模式</span>
<span class="s2">不支持除 1 以外的任何步长值。</span>

<span class="s2">.. 警告::</span>
<span class="s2">对于`padding='same'`，如果`weight`长度为偶数且</span>
<span class="s2">任何维度上的`dilation`为奇数，则执行完整的 :func:`pad` 操作</span>
<span class="s2">可能需要内部使用。降低性能。</span>
<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个单元素元组 `(dW,)`。默认：1</span>
<span class="s2">分组：将输入分割成组，:math:`\text{in\_channels}` 应该是组数的倍数。</span>
<span class="s2">默认：1</span>

<span class="s2">示例::</span>

<span class="s2">    &gt;&gt;&gt; inputs = torch.randn(33, 16, 30)</span>
<span class="s2">    &gt;&gt;&gt; filters = torch.randn(20, 16, 5)</span>
<span class="s2">    &gt;&gt;&gt; F.conv1d(inputs, filters)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">conv2d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">卷积 2D</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv2d(input, weight, bias=None, stride=1, padding=0, dilation=1, groups=1) -&gt; Tensor</span>

<span class="sd">在输入图像上应用 2D 卷积，输入图像由多个输入组成</span>
<span class="sd">请参阅 :class:`~torch.nn.Conv1d` 获取详细信息及输出形状。</span>

<span class="sd">{tf32_note}</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.Conv2d`</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>

<span class="sd">注意：</span>
<span class="sd">此运算符支持复杂数据类型，即 ``complex32, complex64, complex128``。</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</font></font></font></span><span class="si">{minibatch}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">（\text{in\_channels} ， iH ， iW））</span>
<span class="s2">权重：形状为 :math:`(\text{out\_channels} ， \frac{\text{in\_channels}}{\text`</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kH , kW)`</span>
<span class="s2">偏置：可选的偏置张量，形状为 :math:`(out\_channels)`。默认：`None`</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或一个元组（sT, sH, sW）。默认：1</span>
<span class="s2">元组 `(sH, sW)`。默认：1</span>
<span class="s2">填充：输入两侧的隐式填充。可以是字符串 {'valid', 'same'}</span>
<span class="s2">单个数字或一个元组 `(padH, padW)`。默认：0</span>
<span class="s2">``padding='valid'`` 与无填充相同。``padding='same'`` 进行填充</span>
<span class="s2">输入以保持输出与输入相同的形状。然而，此模式</span>
<span class="s2">不支持除 1 以外的任何步长值。</span>

<span class="s2">.. 警告::</span>
<span class="s2">对于`padding='same'`，如果`weight`长度为偶数且</span>
<span class="s2">任何维度上的`dilation`为奇数，则执行完整的 :func:`pad` 操作</span>
<span class="s2">可能需要内部使用。降低性能。</span>

<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个元组 `(dH, dW)`。默认：1</span>
<span class="s2">组：将输入分割成组，包括 :math:`\text{in\_channels}` 和 :math:`\text{out\_channels}`</span>
<span class="s2">应该可以被组数整除。默认：1</span>

<span class="s2">示例::</span>

<span class="s2">&gt;&gt;&gt; # 使用方形核和相等步长</span>
<span class="s2">    &gt;&gt;&gt; filters = torch.randn(8, 4, 3, 3)</span>
<span class="s2">&gt;&gt;&gt; 输入 = torch.randn(1, 4, 5, 5)</span>
<span class="s2">    &gt;&gt;&gt; F.conv2d(inputs, filters, padding=1)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># noqa: E501</span>

<span class="n">conv3d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">卷积 3D</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv3d(input, weight, bias=None, stride=1, padding=0, dilation=1, groups=1) -&gt; Tensor</span>

<span class="sd">在由多个输入图像组成的输入上应用 3D 卷积</span>
<span class="sd">请参阅 :class:`~torch.nn.Conv1d` 获取详细信息及输出形状。</span>

<span class="sd">{tf32_note}</span>

<span class="sd">请参阅 :class:`~torch.nn.Conv3d` 以获取详细信息及输出形状。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>

<span class="sd">注意：</span>
<span class="sd">此运算符支持复杂数据类型，即 ``complex32, complex64, complex128``。</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</span><span class="si">{minibatch}</span><span class="s2"> , \text{in\_channels} , iT , iH , iW)`</span>
<span class="s2">权重：形状为 :math:`(\text{out\_channels} ， \frac{\text{in\_channels}}{\text`</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kT , kH , kW)`</span>
<span class="s2">bias: 可选的形状为 :math:`(\text{out\_channels})` 的偏置张量。默认：None</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或一个元组（sT, sH, sW）。默认：1</span>
<span class="s2">元组 `(sT, sH, sW)`。默认：1</span>
<span class="s2">填充：输入两侧的隐式填充。可以是字符串 {'valid', 'same'}</span>
<span class="s2">单个数字或一个元组 `(padT, padH, padW)`。默认：0</span>
<span class="s2">``padding='valid'`` 与无填充相同。``padding='same'`` 进行填充</span>
<span class="s2">输入以保持输出与输入相同的形状。然而，此模式</span>
<span class="s2">不支持除 1 以外的任何步长值。</span>

<span class="s2">.. 警告::</span>
<span class="s2">对于`padding='same'`，如果`weight`长度为偶数且</span>
<span class="s2">任何维度上的`dilation`为奇数，则执行完整的 :func:`pad` 操作</span>
<span class="s2">可能需要内部使用。降低性能。</span>

<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个元组 `(dT, dH, dW)`。默认：1</span>
<span class="s2">分组：将输入分割成组，:math:`\text{in\_channels}` 应该是组数的倍数。</span>
<span class="s2">默认：1</span>

<span class="s2">示例::</span>

<span class="s2">    &gt;&gt;&gt; filters = torch.randn(33, 16, 3, 3, 3)</span>
<span class="s2">    &gt;&gt;&gt; inputs = torch.randn(20, 16, 50, 10, 20)</span>
<span class="s2">    &gt;&gt;&gt; F.conv3d(inputs, filters)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># noqa: E501</span>

<span class="n">conv_transpose1d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">卷积转置 1D</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv_transpose1d(input, weight, bias=None, stride=1, padding=0, output_padding=0, groups=1, dilation=1) -&gt; Tensor</span>

<span class="sd">在输入信号上应用 1D 转置卷积算子</span>
<span class="sd">由几个输入平面组成，有时也称为“反卷积”。</span>

<span class="sd">{tf32_note}</span>

<span class="sd">请参阅 :class:`~torch.nn.ConvTranspose1d` 以获取详细信息及输出形状。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</font></font></font></span><span class="si">{minibatch}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">， \text{in\_channels} ， iW}`</span>
<span class="s2">weight: 形状为 :math:`(\text{in\_channels} , \frac{\text{out\_channels}}{\text</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kW)`</span>
<span class="s2">bias: 可选偏置，形状为 :math:`(\text{out\_channels})`. 默认: None</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或一个元组（sT, sH, sW）。默认：1</span>
<span class="s2">元组 `(sW,)`。默认：1</span>
<span class="s2">扩展：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">填充：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">（padW，）。默认：0</span>
<span class="s2">输出填充：在每个维度的一侧添加的额外大小</span>
<span class="s2">输出形状。可以是单个数字或元组（out_padW）。默认：0</span>
<span class="s2">分组：将输入拆分为组，:math:`\text{in\_channels}` 应该是组数的倍数。</span>
<span class="s2">组数。默认：1</span>
<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个元组（dW，）。默认值：1</span>

<span class="s2">示例::</span>

<span class="s2">&gt;&gt;&gt; 输入 = torch.randn(20, 16, 50)</span>
<span class="s2">&gt;&gt;&gt; 权重 = torch.randn(16, 33, 5)</span>
<span class="s2">    &gt;&gt;&gt; F.conv_transpose1d(inputs, weights)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">conv_transpose2d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">转置卷积 2D</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv_transpose2d(input, weight, bias=None, stride=1, padding=0, output_padding=0, groups=1, dilation=1) -&gt; Tensor</span>

<span class="sd">在输入图像上应用二维转置卷积算子</span>
<span class="sd">由几个输入平面组成，有时也称为“反卷积”。</span>

<span class="sd">{tf32_note}</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.ConvTranspose2d`。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</font></font></font></span><span class="si">{minibatch}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">（\text{in\_channels} ， iH ， iW））</span>
<span class="s2">weight: 形状为 :math:`(\text{in\_channels} , \frac{\text{out\_channels}}{\text</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kH , kW)`</span>
<span class="s2">bias: 可选偏置，形状为 :math:`(\text{out\_channels})`. 默认: None</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或一个元组（sT, sH, sW）。默认：1</span>
<span class="s2">元组 `(sH, sW)`。默认：1</span>
<span class="s2">扩展：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">填充：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">`(padH, padW)`。默认值：0</span>
<span class="s2">输出填充：在每个维度的一侧添加的额外大小</span>
<span class="s2">输出形状。可以是单个数字或一个元组（out_padH, out_padW）。</span>
<span class="s2">默认：0</span>
<span class="s2">分组：将输入拆分为组，:math:`\text{in\_channels}` 应该是组数的倍数。</span>
<span class="s2">组数。默认：1</span>
<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个元组（dH，dW）。默认：1</span>

<span class="s2">示例::</span>

<span class="s2">&gt;&gt;&gt; # 使用方形核和相等步长</span>
<span class="s2">&gt;&gt;&gt; 输入 = torch.randn(1, 4, 5, 5)</span>
<span class="s2">    &gt;&gt;&gt; weights = torch.randn(4, 8, 3, 3)</span>
<span class="s2">    &gt;&gt;&gt; F.conv_transpose2d(inputs, weights, padding=1)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># noqa: E501</span>

<span class="n">conv_transpose3d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">3D 转置卷积</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">conv_transpose3d(input, weight, bias=None, stride=1, padding=0, output_padding=0, groups=1, dilation=1) -&gt; Tensor</span>

<span class="sd">在输入图像上应用 3D 转置卷积算子</span>
<span class="sd">由多个输入平面组成，有时也称为“反卷积”</span>

<span class="sd">{tf32_note}</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.ConvTranspose3d`。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">tf32 说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>

<span class="s2">参数：</span>
<span class="s2">输入：输入张量，形状为 :math:`(\text`</span><span class="si">{minibatch}</span><span class="s2"> , \text{in\_channels} , iT , iH , iW)`</span>
<span class="s2">weight: 形状为 :math:`(\text{in\_channels} , \frac{\text{out\_channels}}{\text</font></font></font></span><span class="si"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{分组}</span><span class="s2">} , kT , kH , kW)`</span>
<span class="s2">bias: 可选偏置，形状为 :math:`(\text{out\_channels})`. 默认: None</span>
<span class="s2">步长：卷积核的步长。可以是单个数字或一个元组（sT, sH, sW）。默认：1</span>
<span class="s2">填充：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">扩展：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">填充：``dilation * (kernel_size - 1) - padding``。在输入的每个维度两侧将添加零填充。可以是单个数字或一个元组</span>
<span class="s2">``（padT, padH, padW）``。默认值：0</span>
<span class="s2">输出填充：在每个维度的一侧添加的额外大小</span>
<span class="s2">输出形状。可以是单个数字或一个元组</span>
<span class="s2">``（out_padT, out_padH, out_padW）``。默认值：0</span>
<span class="s2">分组：将输入拆分为组，:math:`\text{in\_channels}` 应该是组数的倍数。</span>
<span class="s2">组数。默认：1</span>
<span class="s2">扩展：卷积核元素之间的间隔。可以是单个数字或</span>
<span class="s2">一个元组 `(dT, dH, dW)`。默认：1</span>

<span class="s2">示例::</span>

<span class="s2">    &gt;&gt;&gt; inputs = torch.randn(20, 16, 50, 10, 20)</span>
<span class="s2">    &gt;&gt;&gt; weights = torch.randn(16, 33, 3, 3, 3)</span>
<span class="s2">    &gt;&gt;&gt; F.conv_transpose3d(inputs, weights)</span>
<span class="s2">"""</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># noqa: E501</span>

<span class="n">conv_tbc</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">卷积转置块</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">对输入序列应用一维序列卷积。</span>
<span class="sd">输入和输出维度为（时间，批，通道）- 因此为 TBC。</span>

<span class="sd">参数：</span>
<span class="sd">输入：形状为 :math:`(\text{序列长度} \times 批 \times \text{输入通道})` 的输入张量</span>
<span class="sd">重量：形状为(:math:`\text{kernel width} \times \text{in\_channels} \times \text{out\_channels}`)的滤波器</span>
<span class="sd">偏置：形状为(:math:`\text{out\_channels}`)的偏置</span>
<span class="sd">填充：需要填充的时间步数。默认：0</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># 池化</span>
<span class="n">avg_pool1d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">avg_pool1d</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">avg_pool1d(input, kernel_size, 步长=None, 填充=0, 向上取整模式=False, 计数包含填充=True) -&gt; Tensor</span>

<span class="sd">应用一维平均池化到由多个输入信号组成的输入信号上</span>
<span class="sd">输入平面。</span>

<span class="sd">查看 :class:`~torch.nn.AvgPool1d` 获取详细信息及输出形状。</span>

<span class="sd">参数：</span>
<span class="sd">输入张量形状为：(:math:`(minibatch, in\_channels, iW)`）</span>
<span class="sd">kernel_size：窗口大小。可以是单个数字或一个元组。</span>
<span class="sd">元组 `(kW,)`</span>
<span class="sd">步长：窗口的步长。可以是单个数字或一个元组</span>
<span class="sd">`(sW,)`. 默认: :attr:`核大小`</span>
<span class="sd">填充：输入两侧的隐式零填充。可以是</span>
<span class="sd">单个数字或一个元组 `(padW,)`。默认：0</span>
<span class="sd">ceil_mode: 当为 True 时，将使用`ceil`而不是`floor`进行计算</span>
<span class="sd">输出形状。默认：``False``</span>
<span class="sd">to compute the output shape. Default: ``False``</span>
<span class="sd">平均计算。默认：``True``</span>

<span class="sd">示例::</span>

<span class="sd">&gt;&gt;&gt; # 正方形窗口池化大小=3，步长=2</span>
<span class="sd">    &gt;&gt;&gt; input = torch.tensor([[[1, 2, 3, 4, 5, 6, 7]]], dtype=torch.float32)</span>
<span class="sd">    &gt;&gt;&gt; F.avg_pool1d(input, kernel_size=3, stride=2)</span>
<span class="sd">    tensor([[[ 2.,  4.,  6.]]])</span>

<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">avg_pool2d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">avg_pool2d</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">avg_pool2d(input, kernel_size, stride=None, padding=0, ceil_mode=False, count_include_pad=True, divisor_override=None) -&gt; 张量</span>

<span class="sd">在`:math:`kH \times kW`区域通过步长应用 2D 平均池化操作</span>
<span class="sd">`sH × sW` 步。输出特征的数量等于</span>
<span class="sd">输入平面。</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.AvgPool2d`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：输入张量 :math:`(\text{minibatch} , \text{in\_channels} , iH , iW)`。</span>
<span class="sd">核大小：池化区域的大小。可以是单个数字或一个序列。</span>
<span class="sd">元组 `(kH, kW)`</span>
<span class="sd">步长：池化操作的步长。可以是单个数字或一个</span>
<span class="sd">元组 `(sH, sW)`。默认值：:attr:`kernel_size`</span>
<span class="sd">填充：输入两侧的隐式零填充。可以是</span>
<span class="sd">单个数字或一个元组 `(padH, padW)`。默认：0</span>
<span class="sd">ceil_mode：当为 True 时，将使用 `ceil` 而不是 `floor` 在计算输出形状的公式中。默认：``False``</span>
<span class="sd">count_include_pad：当为 True 时，将包括零填充。默认：``False``</span>
<span class="sd">to compute the output shape. Default: ``False``</span>
<span class="sd">平均计算。默认：``True``</span>
<span class="sd">divisor_override：如果指定，则用作除数，否则</span>
<span class="sd">将使用池化区域的大小。默认：None</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">avg_pool3d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">avg_pool3d</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">avg_pool3d(input, kernel_size, stride=None, padding=0, ceil_mode=False, count_include_pad=True, divisor_override=None) -&gt; Tensor</span>

<span class="sd">在 :math:`kT \times kH \times kW` 区域内应用 3D 平均池化操作，步进</span>
<span class="sd">尺寸：`sT × sH × sW` 步。输出特征的数量等于</span>
<span class="sd">`⌊input planes / sT⌋`。</span>

<span class="sd">详细信息和输出形状请参阅：:class:`~torch.nn.AvgPool3d`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：输入张量 :math:`(minibatch, in\_channels, iT × iH, iW)`。</span>
<span class="sd">核大小：池化区域的大小。可以是单个数字或一个序列。</span>
<span class="sd">元组 `(kT, kH, kW)`。</span>
<span class="sd">步长：池化操作的步长。可以是单个数字或一个</span>
<span class="sd">元组 `(sT, sH, sW)`。默认值：:attr:`kernel_size`。</span>
<span class="sd">填充：输入两侧的隐式零填充。可以是</span>
<span class="sd">单个数字或一个元组（padT, padH, padW），默认：0</span>
<span class="sd">ceil_mode：当为 True 时，将使用 `ceil` 而不是 `floor` 在计算输出形状的公式中。默认：``False``</span>
<span class="sd">的公式</span>
<span class="sd">to compute the output shape. Default: ``False``</span>
<span class="sd">平均值计算</span>
<span class="sd">divisor_override：如果指定，则用作除数，否则</span>
<span class="sd">将使用池化区域的大小。默认：None</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 2d 带索引</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">输出比例</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">_随机样本</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">    fractional_max_pool2d(input, kernel_size, output_size=None, output_ratio=None, return_indices=False, _random_samples=None)</span>

<span class="sd">对由多个输入平面组成的输入信号应用二维分数最大池化。</span>

<span class="sd">分数最大池化在 Ben Graham 的论文《Fractional MaxPooling》中详细描述</span>

<span class="sd">最大池化操作在`:math:`kH \times kW`区域通过随机方式应用</span>
<span class="sd">步长由目标输出大小确定。</span>
<span class="sd">输出特征的数量等于输入平面的数量。</span>

<span class="sd">参数：</span>
<span class="sd">kernel_size：取最大值操作的窗口大小。</span>
<span class="sd">可以是一个单个数字 :math:`k`（表示 :math:`k \times k` 的正方形核）</span>
<span class="sd">或者是一个元组 `(kH, kW)`</span>
<span class="sd">output_size：图像的目标输出大小，形式为 :math:`oH \times oW`</span>
<span class="sd">可以是一个元组 `(oH, oW)` 或者一个单个数字 :math:`oH`，用于表示正方形图像 :math:`oH \times oH`</span>
<span class="sd">输出比例：如果想要将输出大小设置为输入大小的比例，则可以提供此选项。</span>
<span class="sd">这必须是一个在范围（0，1）内的数字或元组。</span>
<span class="sd">return_indices：如果为 True，则将返回索引和输出。</span>
<span class="sd">可用于传递给:func:`~torch.nn.functional.max_unpool2d`。</span>

<span class="sd">示例：</span>
<span class="sd">        &gt;&gt;&gt; input = torch.randn(20, 16, 50, 32)</span>
<span class="sd">&gt;&gt;&gt; # 使用大小为 3 的正方形窗口池化，目标输出大小为 13x12</span>
<span class="sd">        &gt;&gt;&gt; F.fractional_max_pool2d(input, 3, output_size=(13, 12))</span>
<span class="sd">&gt;&gt;&gt; # 正方形窗口池和目标输出大小为输入图像大小的一半</span>
<span class="sd">        &gt;&gt;&gt; F.fractional_max_pool2d(input, 3, output_ratio=(0.5, 0.5))</span>

<span class="sd">    .. _Fractional MaxPooling:</span>
<span class="sd">        http://arxiv.org/abs/1412.6071</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">分数最大池化 2d 带索引</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
            <span class="n">输出比例</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
            <span class="n">_随机样本</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"fractional_max_pool2d 函数需要指定输出大小或输出比例"</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"fractional_max_pool2d 函数要求 output_ratio 必须是单个整数或整数元组。"</span>
            <span class="p">)</span>
        <span class="n">_输出比率_</font></font></font></span> <span class="o">=</span> <span class="n">_pair</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">)</span>
        <span class="n">输出大小</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
            <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span><span class="p">[</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
        <span class="p">]</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">批次大小</font></font></font></span> <span class="o">=</span> <span class="mi">1</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">随机样本</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机</span><span class="p">(</span>
            <span class="n">批次大小</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 2d</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</span>
    <span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 2D</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">输出比例</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">_随机样本</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">分数最大池化 2d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
            <span class="n">输出比例</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
            <span class="n">_随机样本</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 2d 带索引</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</span>
    <span class="p">)</span><span class="mi">0</span><span class="p">]</span>


<span class="n">分数最大池化 2D</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">分数最大池化 2d 带索引</span><span class="p">,</span>
    <span class="n">如果为假</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 2D</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"分数最大池化 2D"</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 3d 带索引</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">输出比例</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">_随机样本</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">    fractional_max_pool3d(input, kernel_size, output_size=None, output_ratio=None, return_indices=False, _random_samples=None)</span>

<span class="sd">对由多个输入平面组成的输入信号应用 3D 分数最大池化。</span>

<span class="sd">分数最大池化在 Ben Graham 的论文《Fractional MaxPooling》中详细描述</span>

<span class="sd">最大池化操作通过随机方式应用于 :math:`kT \times kH \times kW` 区域</span>
<span class="sd">步长由目标输出大小确定。</span>
<span class="sd">输出特征的数量等于输入平面的数量。</span>

<span class="sd">参数：</span>
<span class="sd">kernel_size：取最大值操作的窗口大小。</span>
<span class="sd">可以是一个单个数字：数学公式`k`（表示一个：数学公式`k \times k \times k`的立方核）</span>
<span class="sd">或者是一个元组（kT，kH，kW）</span>
<span class="sd">输出大小：目标输出尺寸，形式为 :math:`oT \times oH \times oW`。</span>
<span class="sd">可以是一个元组 `(oT, oH, oW)`，或者是一个单独的数字 :math:`oH` 用于立方体输出。</span>
<span class="sd">\(oH \times oH \times oH\)</span>
<span class="sd">输出比例：如果想要将输出大小设置为输入大小的比例，则可以提供此选项。</span>
<span class="sd">这必须是一个在范围（0，1）内的数字或元组。</span>
<span class="sd">return_indices：如果为 True，则将返回索引和输出。</span>
<span class="sd">可用于传递给 :func:`~torch.nn.functional.max_unpool3d`。</span>

<span class="sd">形状：</span>
<span class="sd">- 输入：:math:`(N, C, T_{in}, H_{in}, W_{in})` 或 :math:`(C, T_{in}, H_{in}, W_{in})`。</span>
<span class="sd">输出：:math:`(N, C, T_{out}, H_{out}, W_{out})` 或 :math:`(C, T_{out}, H_{out}, W_{out})`，其中</span>
<span class="sd">math:`(T_{out}, H_{out}, W_{out})=\text{output\_size}` 或</span>
<span class="sd">math:`(T_{out}, H_{out}, W_{out})=\text{output\_ratio} \times (T_{in}, H_{in}, W_{in})`</span>

<span class="sd">示例：</span>
<span class="sd">        &gt;&gt;&gt; input = torch.randn(20, 16, 50, 32, 16)</span>
<span class="sd">&gt;&gt;&gt; # 立方体窗口大小为 3 的池化，目标输出大小为 13x12x11</span>
<span class="sd">        &gt;&gt;&gt; F.fractional_max_pool3d(input, 3, output_size=(13, 12, 11))</span>
<span class="sd">&gt;&gt;&gt; # 立方体窗口池化，目标输出大小为输入大小的一半</span>
<span class="sd">        &gt;&gt;&gt; F.fractional_max_pool3d(input, 3, output_ratio=(0.5, 0.5, 0.5))</span>

<span class="sd">    .. _Fractional MaxPooling:</span>
<span class="sd">        http://arxiv.org/abs/1412.6071</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">分数最大池化 3d 带索引</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
            <span class="n">输出比例</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
            <span class="n">_随机样本</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"fractional_max_pool3d 函数需要指定输出大小或输出比例"</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="n">_输出比率_</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_三倍_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">)</span>
        <span class="n">输出大小</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
            <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span><span class="p">[</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
            <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比率</font></font></font></span><span class="p">[</span><span class="mi">2</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
        <span class="p">]</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">批次大小</font></font></font></span> <span class="o">=</span> <span class="mi">1</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">随机样本</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机</span><span class="p">(</span>
            <span class="n">批次大小</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 3d</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</span>
    <span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 3D</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">输出比例</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">_随机样本</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">分数最大池化 3d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">output_size</span><span class="o">=</span><span class="n">output_size</span><span class="p">,</span>
            <span class="n">输出比例</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
            <span class="n">_随机样本</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_随机样本</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 3d 带索引</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出比例</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机样本</span>
    <span class="p">)</span><span class="mi">0</span><span class="p">]</span>


<span class="n">分数最大池化 3D</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">分数最大池化 3d 带索引</span><span class="p">,</span>
    <span class="n">如果为假</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分数最大池化 3D</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"分数最大池化 3D"</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">max_pool1d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">max_pool1d(input, 核大小, 步长=None, 填充=0, 扩展率=1, 向上取整模式=False, 返回索引=False)</span>

<span class="sd">应用在由多个输入组成的输入信号上的 1D 最大池化</span>
<span class="sd">飞机。</span>

<span class="sd">.. 注意::</span>
<span class="sd">`:attr:`ceil_mode` 和 :attr:`return_indices` 的顺序不同`</span>
<span class="sd">在 `:class:`~torch.nn.MaxPool1d` 中可见，未来版本中将会更改。</span>

<span class="sd">查看 :class:`~torch.nn.MaxPool1d` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入：形状为：math:`(\text{minibatch} , \text{in\_channels} , iW)` 的输入张量，minibatch 维可选。</span>
<span class="sd">kernel_size：窗口大小。可以是单个数字或一个元组。</span>
<span class="sd">元组 `(kW,)`</span>
<span class="sd">步长：窗口的步长。可以是单个数字或一个元组</span>
<span class="sd">`(sW,)`. 默认: :attr:`核大小`</span>
<span class="sd">填充：在两侧添加隐式负无穷填充，必须大于等于 0 且小于等于核大小的一半。</span>
<span class="sd">扩展率：滑动窗口内元素之间的步长，必须大于 0。</span>
<span class="sd">ceil_mode: 如果为 ``True``，将使用 `ceil` 而不是 `floor` 来计算输出形状。</span>
<span class="sd">确保输入张量中的每个元素都被滑动窗口覆盖。</span>
<span class="sd">如果为 ``True``，将返回 argmax 沿着最大值。</span>
<span class="sd">对后续的 :class:`torch.nn.functional.max_unpool1d` 有用。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">max_pool1d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">max_pool1d_with_indices</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span>
    <span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_池化 1d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">最大池化 1D</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大池化 1D</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">)</span>


<span class="n">max_pool1d</span> <span class="o">=</span> <span class="n">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">max_pool1d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_池化 1d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">池化 1d</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">max_pool2d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">max_pool2d(input, 核大小, 步长=None, 填充=0, 扩展率=1, 向上取整模式=False, 返回索引=False)</span>

<span class="sd">应用在由多个输入组成的输入信号上的 2D 最大池化</span>
<span class="sd">飞机。</span>

<span class="sd">.. 注意::</span>
<span class="sd">`:attr:`ceil_mode` 和 :attr:`return_indices` 的顺序不同`</span>
<span class="sd">在 `:class:`~torch.nn.MaxPool2d` 中可见，未来版本中将会更改。</span>

<span class="sd">查看 :class:`~torch.nn.MaxPool2d` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入张量：数学公式（批大小，输入通道，iH，iW），批大小维度可选。</span>
<span class="sd">核大小：池化区域的大小。可以是单个数字或一个序列。</span>
<span class="sd">元组 `(kH, kW)`</span>
<span class="sd">步长：池化操作的步长。可以是单个数字或一个</span>
<span class="sd">元组 `(sH, sW)`。默认值：:attr:`kernel_size`</span>
<span class="sd">填充：在两侧添加隐式负无穷填充，必须大于等于 0 且小于等于核大小的一半。</span>
<span class="sd">扩展率：滑动窗口内元素之间的步长，必须大于 0。</span>
<span class="sd">ceil_mode: 如果为 ``True``，将使用 `ceil` 而不是 `floor` 来计算输出形状。</span>
<span class="sd">确保输入张量中的每个元素都被滑动窗口覆盖。</span>
<span class="sd">如果为 ``True``，将返回 argmax 沿着最大值。</span>
<span class="sd">对 :class:`torch.nn.functional.max_unpool2d` 后很有用</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">max_pool2d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">max_pool2d_with_indices</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span>
    <span class="p">)</span>


<span class="k">定义</span> <span class="nf">_max_pool2d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">max_pool2d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">)</span>


<span class="n">max_pool2d</span> <span class="o">=</span> <span class="n">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">max_pool2d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</span><span class="o">=</span><span class="n">_max_pool2d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大池化 2d</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">max_pool3d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">max_pool3d(input, 核大小, 步长=None, 填充=0, 扩展率=1, 向上取整模式=False, 返回索引=False)</span>

<span class="sd">应用在由多个输入组成的输入信号上的 3D 最大池化</span>
<span class="sd">飞机。</span>

<span class="sd">.. 注意::</span>
<span class="sd">`:attr:`ceil_mode` 和 :attr:`return_indices` 的顺序不同`</span>
<span class="sd">在 `:class:`~torch.nn.MaxPool3d` 中可见，未来版本中将会更改。</span>

<span class="sd">查看 :class:`~torch.nn.MaxPool3d` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入张量：数学公式（批大小，输入通道，iD，iH，iW），批大小维度可选。</span>
<span class="sd">核大小：池化区域的大小。可以是单个数字或一个序列。</span>
<span class="sd">元组 `(kT, kH, kW)`。</span>
<span class="sd">步长：池化操作的步长。可以是单个数字或一个</span>
<span class="sd">元组 `(sT, sH, sW)`。默认值：:attr:`kernel_size`。</span>
<span class="sd">填充：在两侧添加隐式负无穷填充，必须大于等于 0 且小于等于核大小的一半。</span>
<span class="sd">扩展率：滑动窗口内元素之间的步长，必须大于 0。</span>
<span class="sd">ceil_mode: 如果为 ``True``，将使用 `ceil` 而不是 `floor` 来计算输出形状。</span>
<span class="sd">确保输入张量中的每个元素都被滑动窗口覆盖。</span>
<span class="sd">如果为 ``True``，将返回 argmax 沿着最大值。</span>
<span class="sd">对后续的 :class:`torch.nn.functional.max_unpool3d` 有用。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">max_pool3d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">max_pool3d_with_indices</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span>
    <span class="p">)</span>


<span class="k">定义</span> <span class="nf">_max_pool3d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">扩展率</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">向上取整模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">最大池化 3D</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">核心大小</span><span class="p">,</span>
            <span class="n">步长</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">,</span>
            <span class="n">填充</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">,</span>
            <span class="n">扩展率</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</span><span class="p">,</span>
            <span class="n">向上取整模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">步长</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大池化 3D</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展率</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向上取整模式</span><span class="p">)</span>


<span class="n">max_pool3d</span> <span class="o">=</span> <span class="n">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">max_pool3d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</span><span class="o">=</span><span class="n">_max_pool3d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</span><span class="o">=</span><span class="s2">"max_pool3d"</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">_unpool_output_size</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">核心大小</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">步长</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]],</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">]:</span>
    <span class="n">输入大小</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()</span>
    <span class="n">默认大小</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标注</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</span><span class="p">)):</span>
        <span class="n">默认大小</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">输入大小</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">核心大小</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">填充</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">返回</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">默认大小</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n">output_size</span><span class="p">)</span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="n">output_size</span><span class="p">[</span><span class="mi">2</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n">output_size</span><span class="p">)</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">输出大小应为包含 " 的序列</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</font></font></font></span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元素，但它长度为 '</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n">output_size</span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">核心大小</span><span class="p">)):</span>
            <span class="n">最小尺寸</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">默认大小</font></font></font></span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="n">max_size</span> <span class="o">=</span> <span class="n">默认大小</font></font></font></span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">步长</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小尺寸</font></font></font></span> <span class="o">&lt;</span> <span class="n">output_size</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大大小</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'无效的输出尺寸'</font></font></font></span><span class="si">{</span><span class="n">output_size</span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'（维度'</font></font></font></span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">必须介于</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小大小</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大大小</span><span class="si">}</span><span class="s1">)'</span>
                <span class="p">)</span>

        <span class="n">返回</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回</span>


<div class="viewcode-block" id="max_unpool1d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def max_unpool1d(
输入: Tensor,
索引: Tensor,
核大小: BroadcastingList1[int],
stride: 可选的[BroadcastingList1[int]] = None,
padding: BroadcastingList1[int] = 0,
output_size: Optional[BroadcastingList1[int]] = None,
) -&gt; Tensor:
计算一个 :class:`MaxPool1d` 的部分逆运算。

详细信息请参阅 :class:`~torch.nn.MaxUnpool1d`。
"""
如果存在 torch 函数一元运算符(input):
return handle_torch_function(
max_unpool1d,
(input,),
input,
索引,
核心大小,
步长=stride,
填充=padding,
output_size=output_size,
        )
kernel_size = _single(kernel_size)
如果 stride 不为 None:
`_stride = _single(stride)`
`else:`
`_stride = kernel_size`
`padding = _single(padding)`
output_size = _unpool_output_size(input, kernel_size, _stride, padding, output_size)
if isinstance(output_size, list):
output_size = output_size + [1]
else:
output_size = output_size + (1,)
return torch._C._nn.max_unpool2d(
input.unsqueeze(-1), indices.unsqueeze(-1), output_size
).squeeze(-1)</font></font></font></div>


<div class="viewcode-block" id="max_unpool2d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def max_unpool2d(
输入: Tensor,
索引: Tensor,
核大小: BroadcastingList2[int],
stride: 可选的[BroadcastingList2[int]] = None,
padding: BroadcastingList2[int] = 0,
output_size: Optional[BroadcastingList2[int]] = None,
) -&gt; Tensor:
计算一个 `MaxPool2d` 类的部分逆运算。

详细信息请参阅 :class:`~torch.nn.MaxUnpool2d`。
"""
如果存在 torch 函数一元运算符 `input`：
return handle_torch_function(
max_unpool2d,
(input,),
input,
索引,
核心大小,
步长=stride,
填充=padding,
output_size=output_size,
        )
kernel_size = _pair(kernel_size)
if stride is not None:
`_stride = _pair(stride)`
`else:`
`_stride = kernel_size`
`padding = _pair(padding)`
output_size = _unpool_output_size(input, kernel_size, _stride, padding, output_size)
return torch._C._nn.max_unpool2d(input, indices, output_size)</font></font></font></div>


<div class="viewcode-block" id="max_unpool3d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def max_unpool3d(
输入: Tensor,
索引: Tensor,
核大小: BroadcastingList3[int],
stride: 可选的[BroadcastingList3[int]] = None,
padding: BroadcastingList3[int] = 0,
output_size: Optional[BroadcastingList3[int]] = None,
) -&gt; Tensor:
计算一个 `MaxPool3d` 的部分逆运算。

详细信息请参阅 :class:`~torch.nn.MaxUnpool3d`。
"""
如果存在 torch 函数一元运算符 `input`：
return handle_torch_function(
max_unpool3d,
(input,),
input,
索引,
核心大小,
步长=stride,
填充=padding,
output_size=output_size,
        )
kernel_size = _triple(kernel_size)
if stride is not None:
`_stride = _triple(stride)`
`else:`
`_stride = kernel_size`
`padding = _triple(padding)`
output_size = _unpool_output_size(input, kernel_size, _stride, padding, output_size)
return torch._C._nn.max_unpool3d(input, indices, output_size, _stride, padding)</font></font></font></div>


<div class="viewcode-block" id="lp_pool3d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def lp_pool3d(
输入: Tensor,
规范类型: Union[int, float],
核大小: BroadcastingList3[int],
stride: 可选的[BroadcastingList3[int]] = None,
ceil_mode: 布尔型 = False,
) -&gt; Tensor:
r"""
对由多个输入平面组成的输入信号应用 3D 功率平均池化。

如果所有输入的`p`次幂之和为零，
则梯度也设置为 0。

详细信息请参阅：:class:`~torch.nn.LPPool3d`。
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(
lp_pool3d,
输入,
输入,
规范类型,
核心大小,
stride=stride,
ceil_mode=ceil_mode,
        )
kd, kw, kh = _triple(kernel_size)
如果步长不为空：
out = avg_pool3d(input.pow(norm_type), kernel_size, stride, 0, ceil_mode)
else:
out = avg_pool3d(
input.pow(norm_type), kernel_size, padding=0, ceil_mode=ceil_mode
        )

return (
(torch.sign(out) * relu(torch.abs(out))).mul(kd * kw * kh).pow(1.0 / norm_type)
    )</font></font></font></div>


<div class="viewcode-block" id="lp_pool2d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def lp_pool2d(
输入: Tensor,
规范类型: int 或 float 的联合类型,
核大小: BroadcastingList2[int],
stride: 可选[广播列表 2[int]] = None,
ceil_mode: 布尔型 = False,
) -&gt; Tensor:
r"""
对由多个输入平面组成的输入信号应用 2D 功率平均池化。

如果所有输入的`p`次幂之和为零，
则梯度也设置为 0。

详细信息请参阅：:class:`~torch.nn.LPPool2d`。
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(
lp_pool2d,
输入,
输入,
规范类型,
核心大小,
stride=stride,
ceil_mode=ceil_mode,
        )
kw, kh = _pair(kernel_size)
如果步长不为空：
out = avg_pool2d(input.pow(norm_type), kernel_size, stride, 0, ceil_mode)
else:
out = avg_pool2d(
input.pow(norm_type), kernel_size, padding=0, ceil_mode=ceil_mode
        )

return (torch.sign(out) * relu(torch.abs(out))).mul(kw * kh).pow(1.0 / norm_type)</font></font></font></div>


<div class="viewcode-block" id="lp_pool1d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def lp_pool1d(
输入: Tensor,
规范类型: int 或 float,
核大小: int,
stride: 可选的[BroadcastingList1[int]] = None,
ceil_mode: bool = False,
) -&gt; Tensor:
r"""对由多个输入平面组成的输入信号应用 1D 幂平均池化。

所有输入求和的 `p` 次幂为零时
梯度也将设置为零。

详细信息请参阅 :class:`~torch.nn.LPPool1d`。
"""
if has_torch_function_unary(input):
return handle_torch_function(
lp_pool1d,
(input,)
输入,
规范类型,
核大小,
步长=stride,
ceil_mode=ceil_mode,
        )
如果 stride 不为 None：
out = avg_pool1d(input.pow(norm_type), kernel_size, stride, 0, ceil_mode)
else:
out = avg_pool1d(
input.pow(norm_type), kernel_size, padding=0, ceil_mode=ceil_mode
        )

return (
(torch.sign(out) * relu(torch.abs(out))).mul(kernel_size).pow(1.0 / norm_type)
    )</font></font></font></div>


<span class="k">定义</span> <span class="nf">adaptive_max_pool1d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">    adaptive_max_pool1d(input, output_size, return_indices=False)</span>

<span class="sd">在由多个输入平面组成的输入信号上应用 1D 自适应最大池化。</span>
<span class="sd">几个输入平面。</span>

<span class="sd">请参阅 :class:`~torch.nn.AdaptiveMaxPool1d` 了解详细信息及输出形状。</span>

<span class="sd">参数：</span>
<span class="sd">输出大小：目标输出大小（单个整数）</span>
<span class="sd">返回索引：是否返回池化索引。默认：``False``</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool1d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">adaptive_max_pool1d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_自适应最大池化 1d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 1</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool1d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">adaptive_max_pool1d_with_indices</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)</span><span class="mi">0</span><span class="p">]</span>


<span class="n">adaptive_max_pool1d 自适应池化 1d</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">adaptive_max_pool1d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_自适应最大池化 1d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</span><span class="o">=</span><span class="s2">"adaptive_max_pool1d"</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">adaptive_max_pool2d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">adaptive_max_pool2d(input, output_size, return_indices=False) 自适应池化 2d(input, 输出大小, 返回索引=False)</span>

<span class="sd">应用在由输入信号组成的二维自适应最大池化</span>
<span class="sd">几个输入平面。</span>

<span class="sd">查看 :class:`~torch.nn.AdaptiveMaxPool2d` 获取详细信息及输出形状。</span>

<span class="sd">参数：</span>
<span class="sd">输出大小：目标输出大小（单个整数或）</span>
<span class="sd">双精度整数元组)</span>
<span class="sd">返回索引：是否返回池化索引。默认：``False``</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool2d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">带默认值的列表</font></font></font></span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">())</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">adaptive_max_pool2d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>


<span class="k">定义</span> <span class="nf">_adaptive_max_pool2d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 2</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool2d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">adaptive_max_pool2d_with_indices</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)</span><span class="mi">0</span><span class="p">]</span>


<span class="n">adaptive_max_pool2d</span> <span class="o">=</span> <span class="n">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">adaptive_max_pool2d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</span><span class="o">=</span><span class="n">_adaptive_max_pool2d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</span><span class="o">=</span><span class="s2">"adaptive_max_pool2d"</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">adaptive_max_pool3d_with_indices</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：D400</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">    adaptive_max_pool3d(input, output_size, return_indices=False)</span>

<span class="sd">应用在由输入信号组成的 3D 自适应最大池化</span>
<span class="sd">几个输入平面。</span>

<span class="sd">查看 :class:`~torch.nn.AdaptiveMaxPool3d` 获取详细信息及输出形状。</span>

<span class="sd">参数：</span>
<span class="sd">输出大小：目标输出大小（单个整数或）</span>
<span class="sd">三元整数元组)</span>
<span class="sd">返回索引：是否返回池化索引。默认：``False``</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool3d_with_indices</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">带默认值的列表</font></font></font></span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">())</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">adaptive_max_pool3d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>


<span class="k">定义</span> <span class="nf">_adaptive_max_pool3d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">output_size</span><span class="p">:</span> <span class="n">广播列表 3</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">返回索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">adaptive_max_pool3d</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">output_size</span><span class="p">,</span>
            <span class="n">返回索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">adaptive_max_pool3d_with_indices</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)</span><span class="mi">0</span><span class="p">]</span>


<span class="n">adaptive_max_pool3d</span> <span class="o">=</span> <span class="n">布尔分发</span><span class="p">(</span>
    <span class="n">参数名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"返回索引"</span><span class="p">,</span>
    <span class="n">索引参数</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">默认</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">if_true</span><span class="o">=</span><span class="n">adaptive_max_pool3d_with_indices</span><span class="p">,</span>
    <span class="n">如果为假</span><span class="o">=</span><span class="n">_adaptive_max_pool3d</span><span class="p">,</span>
    <span class="n">模块名称</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">函数名</span><span class="o">=</span><span class="s2">"adaptive_max_pool3d"</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">adaptive_avg_pool1d</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">adaptive_avg_pool1d</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">adaptive_avg_pool1d(input, output_size) -&gt; Tensor</span>

<span class="sd">对由多个输入平面组成的输入信号应用 1D 自适应平均池化。</span>
<span class="sd">请参阅 :class:`~torch.nn.AdaptiveAvgPool1d` 获取详细信息及输出形状。</span>

<span class="sd">详细信息和输出形状请参阅 :class:`~torch.nn.AdaptiveAvgPool1d`。</span>

<span class="sd">参数：</span>
<span class="sd">输出大小：目标输出大小（单个整数）</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="adaptive_avg_pool2d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def adaptive_avg_pool2d(input: Tensor, output_size: BroadcastingList2[int]) -&gt; Tensor:
r"""在由多个输入平面组成的输入信号上应用 2D 自适应平均池化。

详细信息和输出形状请参阅 :class:`~torch.nn.AdaptiveAvgPool2d`。

Args:
输出大小：目标输出大小（单个整数或
双整数元组）
"""
if has_torch_function_unary(input):
return handle_torch_function(adaptive_avg_pool2d, (input,), input, output_size)
_output_size = _list_with_default(output_size, input.size())
return torch._C._nn.adaptive_avg_pool2d(input, _output_size)</font></font></font></div>


<div class="viewcode-block" id="adaptive_avg_pool3d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[docs]def adaptive_avg_pool3d(input: Tensor, output_size: BroadcastingList3[int]) -&gt; Tensor:
应用在由多个输入平面组成的输入信号上的 3D 自适应平均池化。

详细信息和输出形状请参阅 :class:`~torch.nn.AdaptiveAvgPool3d`。

参数：
输出大小：目标输出大小（单个整数或
三整数元组）
"""
如果有 torch_function_unary(input):
return handle_torch_function(adaptive_avg_pool3d, (input,), input, output_size)
_output_size = _list_with_default(output_size, input.size())
return torch._C._nn.adaptive_avg_pool3d(input, _output_size)</font></font></font></div>


<span class="c1"># 激活函数</span>
<div class="viewcode-block" id="dropout"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def dropout(
输入: Tensor,
p: float = 0.5,
training: bool = True,
inplace: 布尔值 = False,
) -&gt; 张量:
在训练过程中，以概率 :attr:`p` 随机将输入张量的一些元素置为零。

使用伯努利分布的样本。

查看 :class:`~torch.nn.Dropout` 以获取详细信息。

参数：
p: 将元素置零的概率。默认值：0.5
training: 如果为 ``True`` 则应用 dropout。默认值：``True``
inplace: 如果设置为 ``True``，将在此处执行此操作。默认：``False``
"""
if has_torch_function_unary(input):
return handle_torch_function(
dropout, (输入,), 输入, p=p, 训练=training, 内置=inplace
        )
如果 p &lt; 0.0 或者 p &gt; 1.0:
抛出 ValueError 异常(f"dropout 概率必须在 0 和 1 之间，但得到了 {p}")
return (
_VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)
    )</font></font></font></div>


<div class="viewcode-block" id="alpha_dropout"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def alpha_dropout(
输入: Tensor,
p: float = 0.5,
training: bool = False,
inplace: 布尔值 = False,
) -&gt; 张量:
应用 alpha dropout 到输入。

详细信息请参阅 :class:`~torch.nn.AlphaDropout`。
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(
alpha_dropout, (input,), input, p=p, training=training, inplace=inplace
        )
如果 p &lt; 0.0 或者 p &gt; 1.0:
抛出 ValueError 异常(f"dropout 概率必须在 0 和 1 之间，但得到了 {p}")
return (
_VF.alpha_dropout_(输入, p, 是否训练)
如果就地
否则 _VF.alpha_dropout(输入, p, 是否训练)
    )</font></font></font></div>


<div class="viewcode-block" id="dropout1d"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def dropout1d(
输入：张量，
p: float = 0.5,
training: bool = True,
inplace: 布尔值 = False,
) -&gt; 张量:
随机将整个通道置零（通道是一维特征图）。

例如，第 :math:`j` 个样本的第 :math:`i` 个通道的
批量输入是一个 1D 张量：math:`\text{input}[i, j]`，它是输入张量。
每个通道将在每次前向调用时独立地使用概率：attr:`p`，从伯努利分布中抽取样本置零。
请参阅：class:`~torch.nn.Dropout1d` 以获取详细信息。

请参阅：class:`~torch.nn.Dropout1d` 以获取详细信息。

Args:
p: 频道归零的概率。默认值：0.5
training: 如果设置为 ``True``，则应用 dropout。默认值：``True``
inplace: 如果设置为 ``True``，将在此处执行此操作。默认值：``False``
"""
如果存在 torch 函数单例(input):
返回 handle_torch_function(
dropout1d, (input,), input, p=p, training=training, inplace=inplace
        )
如果 p &lt; 0.0 或者 p &gt; 1.0:
抛出 ValueError 异常(f"dropout 概率必须在 0 和 1 之间，但得到了 {p} ")
inp_dim = input.dim()
如果 inp_dim 不在 (2, 3) 的范围内：
raise RuntimeError(
f"dropout1d: 预期 2D 或 3D 输入，但收到一个 {inp_dim}D 输入。 "
"请注意，dropout1d 存在是为了在具有 1 "
空间维度、通道维度以及可选的批次维度
（即 2D 或 3D 输入）。
        )

is_batched = inp_dim == 3
如果不是批量处理：
input = input.unsqueeze_(0) if inplace else input.unsqueeze(0)

result = (
_VF.feature_dropout_(input, p, training)
如果就地
否则 _VF.feature_dropout(input, p, training)
    )

如果不是批处理
result = result.squeeze_(0) if inplace else result.squeeze(0)

return result</font></font></font></div>


<div class="viewcode-block" id="dropout2d"><a class="viewcode-back" href="../../../generated/torch.nn.functional.dropout2d.html#torch.nn.functional.dropout2d">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">dropout2d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">p</span><span class="p">:</span> <span class="nb">浮点数</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">训练</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">内置</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">随机将整个通道置零（通道是指二维特征图）。</span>

<span class="sd">例如，第 :math:`j` 个通道的第 :math:`i` 个样本在批处理输入中是一个 3D 张量 :math:`\text{input}[i, j]`。</span>
<span class="sd">每个通道将在每次前向调用时独立置零。</span>
<span class="sd">每个通道将在每次前向调用中独立地以概率 :attr:`p` 使用伯努利分布的样本置零。</span>
<span class="sd">使用伯努利分布的样本以概率 :attr:`p` 独立地置零每个通道。</span>

<span class="sd">详细信息请参阅：class:`~torch.nn.Dropout2d`</span>

<span class="sd">参数：</span>
<span class="sd">p：将通道置零的概率。默认：0.5</span>
<span class="sd">training：如果为 ``True`` 则应用 dropout。默认：``True``</span>
<span class="sd">inplace：如果设置为 ``True``，则将在此处进行原地操作。默认：``False``</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">dropout2d</span><span class="p">,</span> <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"dropout 概率必须在 0 和 1 之间，但得到了"</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">输入维度</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">警告信息</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">dropout2d: 收到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 输入到 dropout2d，已弃用</span>
            <span class="s2">并且将在未来的版本中导致错误。为了保留行为</span>
            <span class="s2">"请使用 dropout 来静默此警告。请注意，dropout2d"</span>
            <span class="s2">"存在是为了在具有 2 个空间维度的输入上提供通道丢弃，"</span>
            <span class="s2">"一个通道维度和一个可选的批次维度（即 3D 或 4D 输入）。"</span>
        <span class="p">)</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span>

    <span class="c1">目前不支持无批处理维度输入。现在这些输入不被支持；传递</span>
    <span class="c1"># 一个 3D 输入将执行 dropout1d 行为。这曾经是历史行为，现在这种行为仍然保持。</span>
    <span class="c1"># 目前保持这种行为。</span>
    <span class="c1"># 请参阅 https://github.com/pytorch/pytorch/issues/77081</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="s2">"dropout2d: 接收到 3D 输入并假设需要 1D dropout 行为 - 输入被解释为形状(N, C, L)，其中 C "</span>
            <span class="s2">"是通道维度。此行为将在未来的版本中更改，以解释为形状(N, C, L)，其中 C "</span>
            <span class="s2">"是通道维度。此行为将在未来的版本中更改，以解释为形状(N, C, L)，其中 C "</span>
            <span class="s2">"输入没有批处理维度，即形状为（C，H，W）。为了保持 1D "</span>
            <span class="s2">"通道级 dropout 行为，请切换到使用 dropout1d。"</span>
        <span class="p">)</span>

    <span class="n">结果</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">_VF</span><span class="o">.</span><span class="n">feature_dropout_</span><span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span>
        <span class="k">否则</font></font></font></span> <span class="n">_VF</span><span class="o">.</span><span class="n">feature_dropout</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span></div>


<div class="viewcode-block" id="dropout3d"><a class="viewcode-back" href="../../../generated/torch.nn.functional.dropout3d.html#torch.nn.functional.dropout3d">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">dropout3d</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">p</span><span class="p">:</span> <span class="nb">浮点数</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">训练</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">内置</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">"""随机将整个通道置零（通道是一个 3D 特征图）。"""</span>

<span class="sd">例如，第 :math:`j` 个通道的第 :math:`i` 个样本在批处理输入中是一个 3D 张量 :math:`\text{input}[i, j]`。</span>
<span class="sd">批处理输入是一个输入张量的 3D 张量 :math:`\text{input}[i, j]`。</span>
<span class="sd">每个通道将在每次前向调用中独立地以概率 :attr:`p` 使用伯努利分布的样本置零。</span>
<span class="sd">使用伯努利分布的样本以概率 :attr:`p` 独立地置零每个通道。</span>

<span class="sd">请参阅：class:`~torch.nn.Dropout3d` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">p：将通道置零的概率。默认：0.5</span>
<span class="sd">training：如果为 ``True`` 则应用 dropout。默认：``True``</span>
<span class="sd">inplace：如果设置为 ``True``，则将在此处进行原地操作。默认：``False``</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">dropout3d</span><span class="p">,</span> <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"dropout 概率必须在 0 和 1 之间，但得到了"</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">输入维度</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="n">警告信息</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">dropout3d：收到一个</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D dropout3d 的输入，已弃用</span>
            <span class="s2">并且将在未来的版本中导致错误。为了保留行为</span>
            <span class="s2">"请禁用此警告，建议使用 dropout。注意 dropout3d "</span>
            <span class="s2">"用于在具有 3 个空间维度的输入上提供通道级 dropout，"</span>
            <span class="s2">"一个通道维度，以及可选的批次维度（即 4D 或 5D 输入）。"</span>
        <span class="p">)</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span>

    <span class="n">批处理</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入维度</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span><span class="p">:</span>
        <span class="nb">输入</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">unsqueeze_ (未翻译，因为这不是一个完整的英文单词或短语)</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">结果</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">_VF</span><span class="o">.</span><span class="n">feature_dropout_</span><span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span>
        <span class="k">否则</font></font></font></span> <span class="n">_VF</span><span class="o">.</span><span class="n">feature_dropout</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span><span class="p">:</span>
        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">挤压_</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">挤压</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span></div>


<div class="viewcode-block" id="feature_alpha_dropout"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def feature_alpha_dropout(
输入: Tensor,
p: float = 0.5,
training: bool = False,
inplace: 布尔值 = False,
) -&gt; 张量:
随机屏蔽整个通道（通道是指特征图）。

例如，批输入中第 :math:`i` 个样本的第 :math:`j` 个通道
这是一个输入张量 :math:`\text{input}[i, j]` 的张量。与常规 Dropout 不同，激活值被设置为 SELU 激活函数的负饱和值。
每个元素将在每次前向调用时独立进行掩码，而不是将激活值设为零。
将激活值设置为 SELU 激活函数的负饱和值。

每个元素将在每次前向调用时独立进行掩码。
使用来自伯努利分布的样本计算概率：attr:`p`。
在每次前向调用时，要屏蔽的元素都会随机化，并按比例缩放和移动，以保持零均值和单位方差。
详细信息请参阅：class:`~torch.nn.FeatureAlphaDropout`。

请参阅：class:`~torch.nn.FeatureAlphaDropout`以获取详细信息。

Args:
p: 零化通道的 dropout 概率。默认：0.5
training: 如果为 ``True`` 则应用 dropout。默认：``True``
inplace: 如果设置为 ``True``，则将此操作就地执行。默认：``False``
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(
feature_alpha_dropout,
输入,
输入,
p=等式，
训练=训练，
inplace=inplace,
        )
如果 p 小于 0.0 或大于 1.0：
抛出 ValueError 异常(f"dropout 概率必须在 0 和 1 之间，但得到了 {p} ")
return (
_VF.feature_alpha_dropout_(input, p, training)
if inplace
else _VF.feature_alpha_dropout(input, p, training)
    )</font></font></font></div>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_阈值</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">阈值</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">值</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">内置</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">将阈值应用于输入张量的每个元素。</span>

<span class="sd">更多详情请参阅 :class:`~torch.nn.Threshold`。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">_阈值</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阈值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置</span><span class="p">:</span>
        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n">_VF</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阈值_</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阈值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n">_VF</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阈值</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阈值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span>


<span class="c1">我们将此函数定义为_threshold，因为它接受一个参数</span>
<span class="c1">命名参数 threshold，它覆盖了递归引用函数所需的__</span>
<span class="c1">__torch_function__支持</span>
<span class="n">阈值</span> <span class="o">=</span> <span class="n">_threshold</span>

<span class="n">阈值_</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">_VF</span><span class="o">.</span><span class="n">阈值_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">threshold_(input, threshold, value) -&gt; Tensor</span>

<span class="sd">func:`~threshold` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="relu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def relu(input: Tensor, inplace: bool = False) -&gt; Tensor:  # noqa: D400,D402
r"""relu(input, inplace=False) -&gt; Tensor"""

线性整流单元函数逐元素应用。详见
class:`~torch.nn.ReLU` 以获取更多详细信息。
"""
if has_torch_function_unary(input):
return handle_torch_function(relu, (input,), input, inplace=inplace)
if inplace:
result = torch.relu_(input)
else:
result = torch.relu(input)
return result</font></font></font></div>


<span class="n">relu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">relu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">relu_(输入) -&gt; 张量</span>

<span class="sd">func:`~relu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="glu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def glu(input: Tensor, dim: int = -1) -&gt; Tensor:  # noqa: D400,D402
r"""
glu(input, dim=-1) -&gt; Tensor

门控线性单元。计算：

数学公式
\text{GLU}(a, b) = a \otimes \sigma(b)

其中 `input` 沿 `dim` 分成两半形成 `a` 和 `b`，:math:`\sigma`
是 sigmoid 函数，:math:`\otimes` 是矩阵之间的逐元素乘积。

查看 `基于门控卷积网络的语料库建模 `_。

Args:
输入 (Tensor)：输入张量
dim (int)：分割输入的维度。默认：-1
"""
如果存在 torch 函数单例(input):
返回 handle_torch_function(glu, (input,), input, dim=dim)
如果 input 的维度为 0:
raise RuntimeError(
"glu 不支持标量，因为减半大小必须是偶数"
        )
return torch._C._nn.glu(input, dim)</font></font></font></div>


<div class="viewcode-block" id="hardtanh"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def hardtanh(
输入: Tensor,
最小值: float = -1.0,
最大值: float = 1.0,
inplace: 布尔值 = False,
) -&gt; Tensor:  # noqa: D400,D402
r"""
hardtanh(input, min_val=-1., max_val=1., inplace=False) -&gt; Tensor

应用 HardTanh 函数逐元素。请参阅 :class:`~torch.nn.Hardtanh` 获取更多详情。
详细信息。
"""
如果 has_torch_function_unary(input):
return handle_torch_function(
hardtanh, (input,), input, min_val=min_val, max_val=max_val, inplace=inplace
        )
if min_val &gt; max_val:
无法将 min_val 的值设置得大于 max_val
如果 inplace:
result = torch._C._nn.hardtanh_(input, min_val, max_val)
否则：
result = torch._C._nn.hardtanh(input, min_val, max_val)
return result</font></font></font></div>


<span class="n">hardtanh_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">hardtanh_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">hardtanh_(input, min_val=-1., max_val=1.) -&gt; Tensor</span>

<span class="sd">func:`~hardtanh` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="relu6"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[docs]def relu6(input: Tensor, inplace: bool = False) -&gt; Tensor:  # noqa: D400,D402
r"""relu6(input, inplace=False) -&gt; Tensor

应用逐元素函数 :math:`\text{ReLU6}(x) = \min(\max(0,x), 6)`.

更多详情请参阅 :class:`~torch.nn.ReLU6`。
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(relu6, (input,), input, inplace=inplace)
如果 inplace:
result = torch._C._nn.relu6_(input)
else:
result = torch._C._nn.relu6(input)
return result</font></font></font></div>


<div class="viewcode-block" id="elu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def elu(input: Tensor, alpha: float = 1.0, inplace: bool = False) -&gt; Tensor:
应用逐元素的指数线性单元（ELU）函数。

更多详情请参阅 :class:`~torch.nn.ELU`。
"""
if has_torch_function_unary(input):
return handle_torch_function(elu, (input,), input, alpha=alpha, inplace=inplace)
if inplace:
result = torch._C._nn.elu_(input, alpha)
else:
result = torch._C._nn.elu(input, alpha)
return result</font></font></font></div>


<span class="n">elu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">elu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">elu_(输入, alpha=1.) -&gt; 张量</span>

<span class="sd">func:`~elu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="selu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def selu(输入: 张量, inplace: bool = False) -&gt; 张量:  # noqa: D400,D402
r"""selu(输入, inplace=False) -&gt; 张量

元素级应用，
math:`\text{SELU}(x) = scale * (\max(0,x) + \min(0, \alpha * (\exp(x) - 1)))`，
其中 :math:`\alpha=1.6732632423543772848170429916717` 和
math:`scale=1.0507009873554804934193349852946`。

查看更多详情，请参阅：:class:`~torch.nn.SELU`
"""
如果有 torch_function_unary(input)：
返回 handle_torch_function(selu, (input,), input, inplace=inplace)
if inplace:
result = torch.selu_(input)
else:
result = torch.selu(input)
返回结果</font></font></font></div>


<span class="n">selu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">selu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">selu_(输入) -&gt; 张量</span>

<span class="sd">func:`~selu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="celu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def celu(
输入: Tensor,
alpha: float = 1.0,
inplace: bool = False,
) -&gt; 张量:  # noqa: D400,D402
r"""celu(input, alpha=1., inplace=False) -&gt; 张量

逐元素应用，
math:`\text{CELU}(x) = \max(0,x) + \min(0, \alpha * (\exp(x/\alpha) - 1))`。

查看更多详情，请参阅：:class:`~torch.nn.CELU`。
"""
如果有_torch_function_unary(input)：
返回 handle_torch_function(
celu, (输入,), 输入, alpha=alpha, inplace=inplace
        )
if inplace:
result = torch.celu_(输入, alpha)
else:
result = torch.celu(input, alpha)
return result</font></font></font></div>


<span class="n">celu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">celu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">celu_(input, alpha=1.) -&gt; 张量</span>

<span class="sd">func:`~celu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="leaky_relu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def leaky_relu(
输入：Tensor,
负斜率：float = 0.01,
内置：bool = False,
) -&gt; Tensor:  # noqa: D400,D402
r"""
leaky_relu(input, negative_slope=0.01, inplace=False) -&gt; Tensor

逐元素应用，
math:`\text{LeakyReLU}(x) = \max(0, x) + \text{negative\_slope} * \min(0, x)`

查看更多详情，请参阅：:class:`~torch.nn.LeakyReLU`。
"""
如果有 torch_function_unary(input)：
返回 handle_torch_function(
leaky_relu, (输入,), 输入, 负斜率=negative_slope, 放置 inplace
        )
if inplace:
result = torch._C._nn.leaky_relu_(输入, 负斜率)
else:
result = torch._C._nn.leaky_relu(input, negative_slope)
return result</font></font></font></div>


<span class="n">leaky_relu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">leaky_relu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">leaky_relu_(输入，负斜率=0.01) -&gt; 张量</span>

<span class="sd">func:`~leaky_relu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">prelu</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">预激活函数</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">prelu(input, weight) -&gt; Tensor</span>

<span class="sd">对元素执行函数</span>
<span class="sd">math:`\text{PReLU}(x) = \max(0,x) + \text{weight} * \min(0,x)` 其中 weight 是一个</span>
<span class="sd">可学习的参数。</span>

<span class="sd">.. 注意：</span>
<span class="sd">`weight` 预期为一个标量或一维张量。如果 `weight` 是一维的，</span>
<span class="sd">其大小必须与输入通道数匹配，该数由</span>
<span class="sd">当 `input.dim() &gt;= 2` 时，`input.size(1)` 为 1，否则为 1。</span>
<span class="sd">在一维情况下，请注意当`input`的维度大于 2 时，`weight`可以展开</span>
<span class="sd">以一种使用常规方法不可能的方式调整 `input` 的形状</span>
<span class="sd">参考：:ref:`广播语义`.</span>

<span class="sd">更多详情请参阅 :class:`~torch.nn.PReLU`。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="rrelu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def rrelu(
输入：张量，
下限：浮点数 = 1.0 / 8，
上限：浮点数 = 1.0 / 3，
训练：布尔值 = False，
inplace: 布尔值 = False,
) -&gt; Tensor:  # noqa: D400,D402
r"""rrelu(input, lower=1./8, upper=1./3, training=False, inplace=False) -&gt; Tensor

随机化泄漏 ReLU.

查看更多详情，请参阅：:class:`~torch.nn.RReLU`。
"""
如果有 torch_function_unary(input)：
返回 handle_torch_function(
rrelu,
(输入,),
输入,
lower=lower,
upper=大写,
training=训练,
inplace=原地,
        )
if inplace:
result = torch.rrelu_(input, lower, upper, training)
else:
result = torch.rrelu(input, lower, upper, training)
返回结果</font></font></font></div>


<span class="n">rrelu_</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">rrelu_</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">rrelu_(input, lower=1./8, upper=1./3, training=False) -&gt; Tensor</span>

<span class="sd">func:`~rrelu` 的就地版本。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logsigmoid</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">log_sigmoid</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">logsigmoid(input) -&gt; 张量</span>

<span class="sd">逐元素应用 :math:`\text{LogSigmoid}(x_i) = \log \left(\frac{1}{1 + \exp(-x_i)}\right)`</span>

<span class="sd">更多详情请参阅 :class:`~torch.nn.LogSigmoid`</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">gelu</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">gelu</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">gelu(input, approximate = 'none') -&gt; 张量</span>

<span class="sd">当 approximate 参数为'none'时，它将函数逐元素应用</span>
<span class="sd">math:`\text{GELU}(x) = x * \Phi(x)` 的中文翻译为：GELU(x) = x * Φ(x)</span>

<span class="sd">其中 :math:`\Phi(x)` 是高斯分布的累积分布函数。</span>

<span class="sd">当近似参数为 'tanh' 时，Gelu 的估计为</span>

<span class="sd">.. 数学表达式</span>
<span class="sd">    \text{GELU}(x) = 0.5 * x * (1 + \text{Tanh}(\sqrt{2 / \pi} * (x + 0.044715 * x^3)))</span>

<span class="sd">查看 `高斯误差线性单元 (GELUs) `_。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">hardshrink</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">硬收缩</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">hardshrink(input, lambd=0.5) -&gt; 张量</span>

<span class="sd">应用逐元素硬收缩函数</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.Hardshrink`。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="tanhshrink"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def tanhshrink(input):  # noqa: D400,D402
tanhshrink(input) -&gt; 张量

对元素应用，:math:`\text{Tanhshrink}(x) = x - \text{Tanh}(x)`

更多详情请参阅 :class:`~torch.nn.Tanhshrink`
"""
if has_torch_function_unary(input):
return handle_torch_function(tanhshrink, (input,), input)
return input - input.tanh()</font></font></font></div>


<div class="viewcode-block" id="softsign"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def softsign(input):  # noqa: D400,D402
softsign(input) -&gt; 张量

对元素执行逐个应用，函数 :math:`\text{SoftSign}(x) = \frac{x}{1 + |x|}`

更多详情请参阅 :class:`~torch.nn.Softsign`
"""
if has_torch_function_unary(input):
return handle_torch_function(softsign, (input,), input)
return input / (input.abs() + 1)</font></font></font></div>


<span class="n">softplus</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">软性加</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">softplus(input, beta=1, threshold=20) -&gt; Tensor</span>

<span class="sd">逐元素应用函数：:math:`\text{Softplus}(x) = \frac{1}{\beta} * \log(1 + \exp(\beta * x))`。</span>

<span class="sd">为了数值稳定性，实现会回退到线性函数。</span>
<span class="sd">当:math:`input \times \beta &gt; threshold`时。</span>

<span class="sd">更多详情请参阅：:class:`~torch.nn.Softplus`。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf">_get_softmax_dim</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">栈级别</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">整数</span><span class="p">:</span>
    <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">隐式维度选择已被弃用。</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
        <span class="s2">"请将调用方式修改为包含 dim=X 作为参数。"</span><span class="p">,</span>
        <span class="n">栈级别</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">栈级别</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</font></font></font></span> <span class="o">==</span> <span class="mi">0</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</font></font></font></span> <span class="o">==</span> <span class="mi">1</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">返回</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">返回</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回</span>


<div class="viewcode-block" id="softmin"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def softmin(
输入: Tensor,
dim: Optional[int] = None,
_stacklevel: int = 3,
dtype: Optional[DType] = None,
) -&gt; Tensor:
r"""应用软归一化函数。

注意：:math:`\text{Softmin}(x) = \text{Softmax}(-x)`。请参阅软归一化定义中的数学公式。

查看更多详情，请参阅：:class:`~torch.nn.Softmin`

参数：
输入 (Tensor): 输入
dim (int): softmin 将要计算的维度（因此每个切片
沿着 dim 求和将等于 1)。
dtype (:class:`torch.dtype`, optional): 返回张量的期望数据类型。
如果指定，则在执行操作之前将输入张量转换为 :attr:`dtype`。这有助于防止数据类型溢出。默认：None。
如果指定，则在执行操作之前将输入张量转换为 :attr:`dtype`。这有助于防止数据类型溢出。默认：None。
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(
softmin, (input,), input, dim=dim, _stacklevel=_stacklevel, dtype=dtype
        )
如果 dim 为 None：
dim = _get_softmax_dim("softmin", input.dim(), _stacklevel)
如果 dtype 为 None：
ret = (-input).softmax(dim)
else:
ret = (-input).softmax(dim, dtype=dtype)
return ret</font></font></font></div>


<div class="viewcode-block" id="softmax"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def softmax(
输入: Tensor,
dim: Optional[int] = None,
_stacklevel: int = 3,
dtype: Optional[DType] = None,
) -&gt; Tensor:
r"""应用 softmax 函数。

Softmax 定义为：

\text{Softmax}(x_{i}) = \frac{\exp(x_i)}{\sum_j \exp(x_j)}

它应用于沿 dim 的所有切片，并将它们重新缩放，使得元素
落在范围 `[0, 1]` 内，并且总和为 1。

更多详情请参阅 :class:`~torch.nn.Softmax`。

Args:
输入 (Tensor): 输入
dim (int): 软 max 将被计算的维度。
dtype (:class:`torch.dtype`, optional): 返回张量的期望数据类型。
如果指定，则在操作之前将输入张量转换为 :attr:`dtype`。这有助于防止数据类型溢出。默认值：None。
执行操作。这有助于防止数据类型溢出。默认：None。

.. 注意::
此函数不能直接与 NLLLoss 一起使用，
预期在 Softmax 和自身之间计算 Log。
使用 log_softmax 代替（它更快，并且具有更好的数值特性）。

"""
如果有 torch_function_unary(input)：
return handle_torch_function(
softmax, (input,), input, dim=dim, _stacklevel=_stacklevel, dtype=dtype
        )
if dim is None:
dim = _get_softmax_dim("softmax", input.dim(), _stacklevel)
if dtype is None:
ret = input.softmax(dim)
else:
ret = input.softmax(dim, dtype=dtype)
return ret</font></font></font></div>


<div class="viewcode-block" id="gumbel_softmax"><a class="viewcode-back" href="../../../generated/torch.nn.functional.gumbel_softmax.html#torch.nn.functional.gumbel_softmax">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Gumbel 软最大化</span><span class="p">(</span>
    <span class="n">logits</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">淘</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">硬</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">浮点数</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">,</span>
    <span class="n">暗</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">Gumbel-Softmax 分布的样本（`链接 1`_ `链接 2`_）以及可选的离散化。</span>

<span class="sd">参数：</span>
<span class="sd">logits: `[..., num_features]` 未归一化的对数概率</span>
<span class="sd">tau: 非负标量温度</span>
<span class="sd">hard: 如果为 ``True``，则返回的样本将被离散化为 one-hot 向量，</span>
<span class="sd">但将被区分，仿佛它是 autograd 中的软样本</span>
<span class="sd">dim（int）：softmax 将计算的维度。默认值：-1。</span>

<span class="sd">返回：</span>
<span class="sd">从 Gumbel-Softmax 分布中采样的与`logits`形状相同的张量。</span>
<span class="sd">如果`hard=True`，则返回的样本将是一维热编码，否则不是。</span>
<span class="sd">在 `dim` 上求和为 1 的概率分布。</span>

<span class="sd">.. 注意::</span>
<span class="sd">此函数出于历史原因存在，未来可能从 nn.Functional 中移除。</span>

<span class="sd">.. 注意::</span>
<span class="sd">`hard` 的主要技巧是执行 `y_hard - y_soft.detach() + y_soft`。</span>

<span class="sd">它实现了两个目标：</span>
<span class="sd">- 使输出值正好为 one-hot</span>
<span class="sd">- 由于我们添加然后减去 y_soft 值</span>
<span class="sd">- 使梯度等于 y_soft 梯度</span>
<span class="sd">- 由于我们移除所有其他梯度</span>

<span class="sd">示例：</span>
<span class="sd">        &gt;&gt;&gt; logits = torch.randn(20, 32)</span>
<span class="sd">        &gt;&gt;&gt; # Sample soft categorical using reparametrization trick:</span>
<span class="sd">        &gt;&gt;&gt; F.gumbel_softmax(logits, tau=1, hard=False)</span>
<span class="sd">        &gt;&gt;&gt; # Sample hard categorical using "Straight-through" trick:</span>
<span class="sd">        &gt;&gt;&gt; F.gumbel_softmax(logits, tau=1, hard=True)</span>

<span class="sd">.. _链接 1:</span>
<span class="sd">        https://arxiv.org/abs/1611.00712</span>
<span class="sd">.. _链接 2:</span>
<span class="sd">        https://arxiv.org/abs/1611.01144</span>
<span class="sd">"文档"</span>
    <span class="k">如果</span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="n">logits</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">Gumbel 软最大化</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="n">logits</span><span class="p">,),</span> <span class="n">logits</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">淘</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">淘</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">硬</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">硬</font></font></font></span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维度</span>
        <span class="p">)</span>
    <span class="k">如果</span> <span class="n">eps</span> <span class="o">!=</span> <span class="mf">1e-10</span><span class="p">:</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"`eps`参数已弃用，无任何效果。"</span><span class="p">)</span>

    <span class="n">古姆贝尔斯</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">空值类似</font></font></font></span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内存格式</font></font></font></span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">遗产连续格式</span><span class="p">)</span>
        <span class="o">.</span><span class="n">指数</span><span class="p">()</span>
        <span class="o">.</span><span class="n">日志</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># ~Gumbel(0,1)</span>
    <span class="n">古姆贝尔斯</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n">logits</span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">古姆贝尔斯</font></font></font></span><span class="p">)</span> <span class="o">/</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">塔乌</span>  <span class="c1"># ~Gumbel(logits,tau)</span>
    <span class="n">y_soft</span> <span class="o">=</span> <span class="n">古姆贝尔斯</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">软式最大化</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">硬</span><span class="p">:</span>
        <span class="c1"># 直通。</span>
        <span class="n">索引</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">软 y</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保持维度</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">难 y</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等于零的</span><span class="p">(</span>
            <span class="n">logits</span><span class="p">,</span> <span class="n">内存格式</font></font></font></span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧连续格式</span>
        <span class="p">)</span><span class="o">.</span><span class="n">散射_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">索引</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">返回</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">难 y</font></font></font></span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">软 y</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="o">+</span> <span class="n">y_soft</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">重参数化技巧。</span>
        <span class="n">返回</span> <span class="o">=</span> <span class="n">y_soft</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回</span></div>


<div class="viewcode-block" id="log_softmax"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def log_softmax(
输入：张量，
dim: 可选[int] = None,
_stacklevel: int = 3,
dtype: 可选[DType] = None,
) -&gt; Tensor:
应用 softmax 后跟对数。

虽然数学上等同于 log(softmax(x))，但分别执行这两个操作会更慢且数值上不稳定。此函数使用一种替代公式来正确计算输出和梯度。
这些操作分别进行会更慢且数值上不稳定。此函数使用一种替代公式来正确计算输出和梯度。
此函数使用一种替代公式来正确计算输出和梯度。

查看更多详情，请参阅：:class:`~torch.nn.LogSoftmax`。

参数：
输入（Tensor）：输入
dim（int）：log_softmax 将被计算的一个维度。
dtype (:class:`torch.dtype`, optional): 返回张量的期望数据类型。
如果指定，则在执行操作之前将输入张量转换为 :attr:`dtype`。这有助于防止数据类型溢出。默认值：None。
执行操作前，如果指定，则将输入张量转换为 :attr:`dtype`。这有助于防止数据类型溢出。默认：None。
"""
if has_torch_function_unary(input):
return handle_torch_function(
log_softmax, (input,), input, dim=dim, _stacklevel=_stacklevel, dtype=dtype
        )
如果 dim 为 None：
dim = _get_softmax_dim("log_softmax", input.dim(), _stacklevel)
如果 dtype 为 None：
ret = input.log_softmax(dim)
else:
ret = input.log_softmax(dim, dtype=dtype)
return ret</font></font></font></div>


<span class="n">softshrink</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">软性收缩</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">softshrink(input, lambd=0.5) -&gt; 张量</span>

<span class="sd">应用逐元素软收缩函数</span>

<span class="sd">更多详情请参阅 :class:`~torch.nn.Softshrink`。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="tanh"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def tanh(input):  # noqa: D400,D402
r"""tanh(input) -&gt; 张量

元素级应用，
\tanh(x) = \tanh(x) = \frac{\exp(x) - \exp(-x)}{\exp(x) + \exp(-x)}

更多详情请参阅 :class:`~torch.nn.Tanh`。
"""
return input.tanh()</font></font></font></div>


<div class="viewcode-block" id="sigmoid"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sigmoid(input):  # noqa: D400,D402
r"""sigmoid(input) -&gt; Tensor

应用逐元素函数 :math:`\text{Sigmoid}(x) = \frac{1}{1 + \exp(-x)}`

查看更多详情，请参阅：:class:`~torch.nn.Sigmoid`
"""
返回 input 的 sigmoid()</font></font></font></div>


<div class="viewcode-block" id="hardsigmoid"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def hardsigmoid(input: Tensor, inplace: bool = False) -&gt; Tensor:
应用元素-wise 的 Hardsigmoid 函数。

.. math::
\text{Hardsigmoid}(x) = \begin{cases}
0 &amp; \text{if~} x \le -3, \\
1 &amp; \text{如果} x \ge +3, \\
x / 6 + 1 / 2 &amp; \text{否则}
\end{cases}

参数:
如果设置为 ``True``，将在此处执行此操作。默认：``False``

更多详情请参阅 :class:`~torch.nn.Hardsigmoid`
"""
如果 has_torch_function_unary(input):
return handle_torch_function(hardsigmoid, (input,), input, inplace=inplace)
if inplace:
return torch._C._nn.hardsigmoid_(input)
return torch._C._nn.hardsigmoid(input)</font></font></font></div>


<span class="n">线性</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">线性</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">linear(input, weight, bias=None) -&gt; Tensor</span>

<span class="sd">对传入数据进行线性变换：:math:`y = xA^T + b`</span>

<span class="sd">此操作支持 2-D :attr:`weight` 使用 :ref:`稀疏布局`</span>

<span class="sd">{sparse_beta_warning}</span>

<span class="sd">此操作符支持：ref:`TensorFloat32`.</span>

<span class="sd">形状：</span>

<span class="sd">输入：:math:`(*, in\_features)` 其中 `*` 表示任意数量的维度，包括零维度</span>
<span class="sd">附加维度</span>
<span class="sd">权重：:math:`(out\_features, in\_features)` 或 :math:`(in\_features)`</span>
<span class="sd">- 偏差: :math:`(out\_features)` 或 :math:`()`</span>
<span class="sd">- 输出: :math:`(*, out\_features)` 或 :math:`(*)`，根据权重的形状</span>
<span class="sd">"""</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">稀疏支持注释</span>
    <span class="p">),</span>
<span class="p">)</span>


<span class="n">双线性</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">双线性</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">bilinear(input1, input2, weight, bias=None) -&gt; Tensor</span>

<span class="sd">对传入数据进行双线性变换：</span>
<span class="sd">\( y = x_1^T A x_2 + b \)</span>

<span class="sd">形状：</span>

<span class="sd">- input1: \( (N, *, H_{in1}) \) 其中 \( H_{in1}=\text{in1\_features} \)</span>
<span class="sd">并且 :math:`*` 表示任意数量的额外维度。</span>
<span class="sd">除了输入的最后维度外，所有维度都应该相同。</span>
<span class="sd">- input2: :math:`(N, *, H_{in2})` 其中 :math:`H_{in2}=\text{in2\_features}`</span>
<span class="sd">- weight: :math:`(\text{out\_features}, \text{in1\_features},`</span>
<span class="sd">`in2\_features)`</span>
<span class="sd">- 偏置: :math:`(\text{out\_features})`</span>
<span class="sd">- 输出: :math:`(N, *, H_{out})` 其中 :math:`H_{out}=\text{out\_features}`</span>
<span class="sd">并且除了最后一个维度外，其余维度都与输入相同。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="silu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def silu(input: Tensor, inplace: bool = False) -&gt; Tensor:
r"""应用逐元素的 Sigmoid 线性单元（SiLU）函数。

SiLU 函数也称为 swish 函数。

.. math::
\text{silu}(x) = x * \sigma(x)，其中 \sigma(x) 是逻辑 Sigmoid 函数。

.. 注意：
查看《高斯误差线性单元（GELUs）`_
SiLU（Sigmoid 线性单元）最初被提出的地方，并查看
sigmoid 加权线性单元用于神经网络函数逼近
强化学习  和 `Swish:
自门控激活函数
该处后来进行了 SiLU 的实验。

查看更多详情，请参阅：:class:`~torch.nn.SiLU`
"""
如果有 torch_function_unary(input)：
返回 handle_torch_function(silu, (input,), input, inplace=inplace)
if inplace:
return torch._C._nn.silu_(input)
return torch._C._nn.silu(input)</font></font></font></div>


<div class="viewcode-block" id="mish"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def mish(input: Tensor, inplace: bool = False) -&gt; Tensor:
r"""应用元素级的 Mish 函数。

Mish：一种自正则化的非单调神经网络激活函数。

.. math::
Mish(x) = x * Tanh(Softplus(x))

.. 注意::
查看 `Mish: 一种自正则化的非单调神经网络激活函数 `

更多详情请参阅 :class:`~torch.nn.Mish`
"""
如果存在 torch_function_unary(input):
返回 handle_torch_function(mish, (input,), input, inplace=inplace)
如果 inplace:
return torch._C._nn.mish_(input)
return torch._C._nn.mish(input)</font></font></font></div>


<div class="viewcode-block" id="hardswish"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def hardswish(input: Tensor, inplace: bool = False) -&gt; Tensor:
r"""应用元素级 hardswish 函数。"""

遵循论文中描述的实现：
《搜索 MobileNetV3》_。

.. math::
\text{Hardswish}(x) = \begin{cases}
0 &amp; \text{如果} x \le -3, \\
x &amp; \text{如果} x \ge +3, \\
x \cdot (x + 3) /6 &amp; \text{否则}
\end{cases}

查看更多详情，请参阅：:class:`~torch.nn.Hardswish`

.. _`搜索 MobileNetV3`:
        https://arxiv.org/abs/1905.02244
"""
if has_torch_function_unary(input):
return handle_torch_function(hardswish, (input,), input, inplace=inplace)
if inplace:
return torch._C._nn.hardswish_(input)
return torch._C._nn.hardswish(input)</font></font></font></div>


<span class="k">定义</span> <span class="nf">_no_grad_embedding_renorm_</span><span class="p">(</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">最大范数</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">归一化类型</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">]:</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">embedding_renorm_</span><span class="p">(</span><span class="n">重量</font></font></font></span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大范数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">归一化类型</span><span class="p">)</span>


<div class="viewcode-block" id="embedding"><a class="viewcode-back" href="../../../generated/torch.nn.functional.embedding.html#torch.nn.functional.embedding">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">填充索引</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">最大范数</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">归一化类型</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="n">按频率缩放梯度</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">稀疏</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">生成一个简单的查找表，用于在固定字典和大小中查找嵌入。</span>

<span class="sd">此模块常用于通过索引检索词嵌入。</span>
<span class="sd">模块的输入是一个索引列表和嵌入矩阵</span>
<span class="sd">输出对应词嵌入。</span>

<span class="sd">请参阅 :class:`torch.nn.Embedding` 获取更多详细信息。</span>

<span class="sd">.. 注意::</span>
<span class="sd">注意，此函数关于 :attr:`weight` 中指定行 :attr:`padding_idx` 的分析梯度与数值梯度可能不同。</span>
<span class="sd">预期此函数关于 :attr:`weight` 中指定行 :attr:`padding_idx` 的分析梯度与数值梯度可能不同。</span>
<span class="sd">分析梯度与数值梯度可能不同。</span>

<span class="sd">.. 注意::</span>
<span class="sd">注意 `:class:`torch.nn.Embedding` 与此函数不同，</span>
<span class="sd">它在构造时将 :attr:`weight` 的指定行 `:attr:`padding_idx` 初始化为零。</span>
<span class="sd">输入 (LongTensor)：包含嵌入矩阵索引的 Tensor。</span>

<span class="sd">参数：</span>
<span class="sd">输入 (LongTensor)：包含嵌入矩阵索引的 Tensor。</span>
<span class="sd">权重（张量）：行数等于最大可能索引 + 1 的嵌入矩阵</span>
<span class="sd">并且列数等于嵌入大小</span>
<span class="sd">padding_idx（int，可选）：如果指定，则：attr:`padding_idx`处的条目不参与梯度计算；</span>
<span class="sd">因此，在训练过程中，:attr:`padding_idx`处的嵌入向量不会被更新</span>
<span class="sd">即保持为固定的“填充”。</span>
<span class="sd">the starting index position of each bag (sequence) in :attr:`input`。</span>
<span class="sd">如果给定，则将范数大于 :attr:`max_norm` 的每个嵌入向量重新归一化，使其范数为 :attr:`max_norm`。</span>
<span class="sd">注意：这将就地修改：attr:`weight`。</span>
<span class="sd">norm_type (浮点数，可选): 用于计算 :attr:`max_norm` 选项的 p-norm 的 p 值。默认 ``2``。</span>
<span class="sd">scale_grad_by_freq (布尔值，可选): 如果提供，则将梯度按 mini-batch 中单词的频率的倒数进行缩放。默认 ``False``。</span>
<span class="sd">                                                the words in the mini-batch. Default ``False``.</span>
<span class="sd">sparse (布尔值，可选): 如果 ``True``，则相对于 :attr:`weight` 的梯度将是一个稀疏张量。参见下方的注释。</span>
<span class="sd">`torch.nn.Embedding` 用于更多关于稀疏梯度的细节。</span>

<span class="sd">形状：</span>
<span class="sd">输入：任意形状的 LongTensor，包含要提取的索引。</span>
<span class="sd">权重：形状为 `(V, embedding_dim)` 的浮点数嵌入矩阵，</span>
<span class="sd">其中 V = 最大索引 + 1 且 embedding_dim = 嵌入大小。</span>
<span class="sd">输出：`(*, embedding_dim)`，其中 `*` 是输入形状</span>

<span class="sd">示例：</span>

<span class="sd">&gt;&gt;&gt; # 两个样本的 4 个索引批次</span>
<span class="sd">        &gt;&gt;&gt; input = torch.tensor([[1, 2, 4, 5], [4, 3, 2, 9]])</span>
<span class="sd">&gt;&gt;&gt; # 包含 10 个大小为 3 的张量的嵌入矩阵</span>
<span class="sd">        &gt;&gt;&gt; embedding_matrix = torch.rand(10, 3)</span>
<span class="sd">&gt;&gt;&gt; # xdoctest: +IGNORE_WANT("非确定性")</span>
<span class="sd">        &gt;&gt;&gt; F.embedding(input, embedding_matrix)</span>
<span class="sd">        tensor([[[ 0.8490,  0.9625,  0.6753],</span>
<span class="sd">                 [ 0.9666,  0.7761,  0.6108],</span>
<span class="sd">[0.6246, 0.9751, 0.3618]</span>
<span class="sd">[0.4161, 0.2419, 0.7383]</span>

<span class="sd">[[0.6246, 0.9751, 0.3618]]</span>
<span class="sd">[0.0237, 0.7794, 0.0528]</span>
<span class="sd">                 [ 0.9666,  0.7761,  0.6108],</span>
<span class="sd">[[0.3385, 0.8612, 0.1867]]]</span>

<span class="sd">&gt;&gt;&gt; 示例中使用 padding_idx</span>
<span class="sd">&gt;&gt;&gt; 权重 = torch.rand(10, 3)</span>
<span class="sd">        &gt;&gt;&gt; weights[0, :].zero_()</span>
<span class="sd">&gt;&gt;&gt; 嵌入矩阵 = 权重</span>
<span class="sd">        &gt;&gt;&gt; input = torch.tensor([[0, 2, 0, 5]])</span>
<span class="sd">        &gt;&gt;&gt; F.embedding(input, embedding_matrix, padding_idx=0)</span>
<span class="sd">        tensor([[[ 0.0000,  0.0000,  0.0000],</span>
<span class="sd">                 [ 0.5609,  0.5384,  0.8720],</span>
<span class="sd">[0.0000, 0.0000, 0.0000]</span>
<span class="sd">[0.6262, 0.2438, 0.7471]</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">嵌入</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">重量</span><span class="p">,</span>
            <span class="n">填充索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充索引</span><span class="p">,</span>
            <span class="n">最大范数</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大范数</span><span class="p">,</span>
            <span class="n">归一化类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">归一化类型</span><span class="p">,</span>
            <span class="n">按频率缩放梯度</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">按频率缩放梯度</span><span class="p">,</span>
            <span class="n">稀疏</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">padding_idx</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">如果</span> <span class="n">padding_idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n">padding_idx</span> <span class="o">&lt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span>
                <span class="mi">0</span>
            <span class="p">),</span> <span class="s2">"Padding_idx 必须在 num_embeddings 范围内"</span>
        <span class="k">elif</span> <span class="n">padding_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n">padding_idx</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span>
                <span class="mi">0</span>
            <span class="p">),</span> <span class="s2">"Padding_idx 必须在 num_embeddings 范围内"</span>
            <span class="n">padding_idx</span> <span class="o">=</span> <span class="n">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding_idx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">padding_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">如果</font></font></font></span> <span class="n">max_norm</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="c1"># Note [embedding_renorm contiguous]</span>
        <span class="c1">`embedding_renorm_` 将无论如何在输入上调用 .contiguous()。</span>
        <span class="c1">在这里调用它并利用改进的局部性</span>
        <span class="c1">以下代码行中包含的 `embedding` 调用也适用。</span>
        <span class="nb">输入</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连续</span><span class="p">()</span>
        <span class="c1"># 注意 [embedding_renorm 设置梯度启用]</span>
        <span class="c1"># XXX: 相当于</span>
        <span class="c1"># 使用 torch.no_grad():</span>
        <span class="c1">#   torch.embedding_renorm_</span>
        <span class="c1"># 移除一旦脚本支持 set_grad_enabled</span>
        <span class="n">_no_grad_embedding_renorm_</span><span class="p">(</span><span class="n">重量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大范数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">归一化类型</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充索引</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">按频率缩放梯度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏</span><span class="p">)</span></div>


<div class="viewcode-block" id="embedding_bag"><a class="viewcode-back" href="../../../generated/torch.nn.functional.embedding_bag.html#torch.nn.functional.embedding_bag">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入包</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">偏移量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">最大范数</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">归一化类型</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">按频率缩放梯度</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">稀疏</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">每样本权重</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">include_last_offset</span><span class="p">:</span> <span class="nb">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">填充索引</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算嵌入体的总和、平均值或最大值。</span>

<span class="sd">计算过程中不实例化中间嵌入体。</span>
<span class="sd">更多详情请参阅 :class:`torch.nn.EmbeddingBag`。</span>

<span class="sd">注意：</span>
<span class="sd">        {backward_reproducibility_note}</span>

<span class="sd">参数：</span>
<span class="sd">输入（长张量）：包含嵌入矩阵索引袋的张量</span>
<span class="sd">权重（张量）：行数等于最大可能索引 + 1 的嵌入矩阵</span>
<span class="sd">并且列数等于嵌入大小</span>
<span class="sd">offsets (LongTensor，可选）：仅当 :attr:`input` 为 1D 时使用。:attr:`offsets` 确定每个包（序列）在 :attr:`input` 中的起始索引位置。</span>
<span class="sd">max_norm (浮点数，可选）：如果提供，则将范数大于 :attr:`max_norm` 的每个嵌入向量重新归一化，使其范数为 :attr:`max_norm`。</span>
<span class="sd">the starting index position of each bag (sequence) in :attr:`input`。</span>
<span class="sd">如果给定，则将范数大于 :attr:`max_norm` 的每个嵌入向量重新归一化，使其范数为 :attr:`max_norm`。</span>
<span class="sd">注意：这将就地修改：attr:`weight`。</span>
<span class="sd">norm_type (浮点数，可选): 用于计算 :attr:`max_norm` 选项的 ``p``-范数中的 ``p``。</span>
<span class="sd">默认 ``2``。</span>
<span class="sd">scale_grad_by_freq (布尔值，可选): 如果提供，这将通过梯度的频率的倒数来缩放梯度。</span>
<span class="sd">                                                the words in the mini-batch. Default ``False``.</span>
<span class="sd">注意：当 ``mode="max"`` 时，此选项不受支持。</span>
<span class="sd">mode (str, 可选): ``"sum"``, ``"mean"`` 或 ``"max"``。指定减少袋的方式。</span>
<span class="sd">默认: ``"mean"``</span>
<span class="sd">sparse (bool, 可选): 如果 ``True``，则相对于 :attr:`weight` 的梯度将是一个稀疏张量。参见注意事项。</span>
<span class="sd">`torch.nn.Embedding` 用于更多关于稀疏梯度的细节。</span>
<span class="sd">注意：当 ``mode="max"`` 时，此选项不受支持。</span>
<span class="sd">per_sample_weights（张量，可选）：一个浮点/双精度浮点权重张量，或 None</span>
<span class="sd">以指示所有权重都应取为 1。如果指定，:attr:`per_sample_weights`</span>
<span class="sd">必须与输入具有完全相同的形状，如果:attr:`offsets`不是 None，则被视为具有相同的</span>
<span class="sd">attr:`偏移量`</span>

<span class="sd">include_last_offset (bool, 可选): 如果为 ``True``，偏移量的大小等于包的数量 + 1。</span>
<span class="sd">最后一个元素是输入的大小，或者最后一个包（序列）的结束索引位置。</span>

<span class="sd">padding_idx (int, 可选): 如果指定，则 :attr:`padding_idx` 位置的条目不贡献梯度；因此，:attr:`padding_idx` 的嵌入向量不会更新。</span>
<span class="sd">padding_idx (int, 可选): 如果指定，则 :attr:`padding_idx` 位置的条目不贡献梯度；因此，:attr:`padding_idx` 的嵌入向量不会更新。</span>
<span class="sd">在训练过程中，即保持为固定的“填充”。请注意，在：attr:`padding_idx`处的嵌入向量被排除在缩减之外。</span>
<span class="sd">- :attr:`input`（长张量）和：attr:`offsets`（长张量，可选）</span>

<span class="sd">形状：</span>
<span class="sd">- 如果：attr:`input`是形状为`(B, N)`的 2D 张量，它将被视为`B`个袋子（序列）</span>

<span class="sd">- 如果：attr:`input`是形状为`(B, N)`的 2D 张量，它将被视为`B`个袋子（序列）</span>
<span class="sd">每个长度为“N”，这将返回以某种方式聚合的“B”个值</span>
<span class="sd">根据`:attr:`模式`. 在这种情况下，`:attr:`偏移量`被忽略，必须为`None`。</span>

<span class="sd">如果 :attr:`input` 是形状为 `(N)` 的 1D，它将被视为形状为 `(N)` 的连接</span>
<span class="sd">多个袋子（序列）。:attr:`offsets` 必须是一个包含 1D 张量的</span>
<span class="sd">每个包在 :attr:`input` 中的起始索引位置。因此，对于 :attr:`offsets`</span>
<span class="sd">的形状为 `(B)`，:attr:`input` 将被视为有 ``B`` 个包。</span>
<span class="sd">空包（即长度为 0 的包）将返回由零填充的向量。</span>

<span class="sd">- :attr:`weight`（张量）：该模块的可学习权重，形状为 `(num_embeddings, embedding_dim)`</span>

<span class="sd">- :attr:`per_sample_weights`（张量，可选）。与:attr:`input`具有相同的形状。</span>

<span class="sd">- :attr:`output`：形状为`(B, embedding_dim)`的聚合嵌入值。</span>

<span class="sd">示例：</span>

<span class="sd">&gt;&gt;&gt; # 包含 10 个大小为 3 的张量的嵌入模块</span>
<span class="sd">        &gt;&gt;&gt; embedding_matrix = torch.rand(10, 3)</span>
<span class="sd">&gt;&gt;&gt; # 两个样本的 4 个索引批次</span>
<span class="sd">        &gt;&gt;&gt; input = torch.tensor([1, 2, 4, 5, 4, 3, 2, 9])</span>
<span class="sd">        &gt;&gt;&gt; offsets = torch.tensor([0, 4])</span>
<span class="sd">&gt;&gt;&gt; # xdoctest: +IGNORE_WANT("非确定性")</span>
<span class="sd">        &gt;&gt;&gt; F.embedding_bag(input, embedding_matrix, offsets)</span>
<span class="sd">        tensor([[ 0.3397,  0.3552,  0.5545],</span>
<span class="sd">[[0.5893, 0.4386, 0.5882]])</span>

<span class="sd">&gt;&gt;&gt; 示例中使用 padding_idx</span>
<span class="sd">        &gt;&gt;&gt; embedding_matrix = torch.rand(10, 3)</span>
<span class="sd">        &gt;&gt;&gt; input = torch.tensor([2, 2, 2, 2, 4, 3, 2, 9])</span>
<span class="sd">        &gt;&gt;&gt; offsets = torch.tensor([0, 4])</span>
<span class="sd">        &gt;&gt;&gt; F.embedding_bag(input, embedding_matrix, offsets, padding_idx=2, mode='sum')</span>
<span class="sd">        tensor([[ 0.0000,  0.0000,  0.0000],</span>
<span class="sd">                [-0.7082,  3.2145, -2.6251]])</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">嵌入包</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">重量</span><span class="p">,</span>
            <span class="n">偏移量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</span><span class="p">,</span>
            <span class="n">最大范数</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大范数</span><span class="p">,</span>
            <span class="n">归一化类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">归一化类型</span><span class="p">,</span>
            <span class="n">按频率缩放梯度</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">按频率缩放梯度</span><span class="p">,</span>
            <span class="n">模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">,</span>
            <span class="n">稀疏</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏</span><span class="p">,</span>
            <span class="n">每样本权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</span><span class="p">,</span>
            <span class="n">include_last_offset</span><span class="o">=</span><span class="n">include_last_offset</span><span class="p">,</span>
            <span class="n">填充索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充索引</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1">检查向后兼容性。</span>
    <span class="c1">之前是 embedding_bag(weight, input, ...)。</span>
    <span class="c1">现在是 embedding_bag(input, weight, ...)。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">():</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="s2">nn.functional.embedding_bag 的参数顺序已更改。</span>
            <span class="s2">"使用 `embedding_bag(weight, input, ...)` 已弃用，"</span>
            <span class="s2">"现在应使用 `embedding_bag(input, weight, ...)`。"</span>
        <span class="p">)</span>
        <span class="n">重量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">嵌入包：如果 per_sample_weights （</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">) 不为空，"</span>
            <span class="sa">f</span><span class="s2">然后它必须与输入具有相同的形状（</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">)"</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">权重必须是一个二维张量，但得到的是维度</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是嵌套的</span><span class="p">:</span>
        <span class="n">包含最后一个偏移量</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
        <span class="n">偏移量</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</span><span class="p">()</span>
        <span class="nb">输入</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重塑</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是嵌套的</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"如果输入是嵌套的，则指定的每样本权重必须是嵌套的"</span>
                <span class="p">)</span>
            <span class="n">每样本权重</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重塑</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">类型字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"&lt;未知&gt;"</span>
            <span class="c1"># TODO: 一旦脚本支持 type()调用，请删除此行</span>
            <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
                <span class="n">类型字符串</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">如果输入是二维的，那么偏移量必须为 None</span>
                <span class="s2">", 作为输入被处理为一个迷你批次"</span>
                <span class="s2">固定长度序列。然而，发现</span>
                <span class="sa">f</span><span class="s2">类型偏移量</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型字符串</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="n">偏移量</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元素数量</font></font></font></span><span class="p">(),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</span>
        <span class="p">)</span>

        <span class="nb">输入</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重塑</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">每样本权重</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重塑</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">偏移量必须是一个一维张量，但得到了 None</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏移量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"偏移量必须是一个一维张量"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"输入必须是一维或二维张量，但得到了维度为的张量"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大</span><span class="p">:</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">按频率缩放梯度</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"最大模式不支持按频率缩放梯度"</span>
            <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"最大模式不支持稀疏权重"</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"模式必须是 sum、mean 或 max 之一"</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n">max_norm</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="c1"># XXX: 相当于</span>
        <span class="c1"># 使用 torch.no_grad():</span>
        <span class="c1">#   torch.nembedding_renorm_</span>
        <span class="c1"># 移除一旦脚本支持 set_grad_enabled</span>
        <span class="n">_no_grad_embedding_renorm_</span><span class="p">(</span><span class="n">重量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大范数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">归一化类型</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">每样本权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</span><span class="p">(</span>
            <span class="s2">"embedding_bag: per_sample_weights 不为 None。"</span>
            <span class="s2">"仅支持 mode='sum' 模式。"</span>
            <span class="sa">f</span><span class="s2">"(获取 mode='"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'). 请在 GitHub 上提交功能请求。'</span>
        <span class="p">)</span>

    <span class="n">返回</font></font></font></span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入包</span><span class="p">(</span>
        <span class="n">重量</span><span class="p">,</span>
        <span class="nb">输入</span><span class="p">,</span>
        <span class="n">偏移量</span><span class="p">,</span>
        <span class="n">按频率缩放梯度</span><span class="p">,</span>
        <span class="n">模式枚举</span><span class="p">,</span>
        <span class="n">稀疏</span><span class="p">,</span>
        <span class="n">每样本权重</span><span class="p">,</span>
        <span class="n">include_last_offset</span><span class="p">,</span>
        <span class="n">填充索引</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回</span></div>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入包</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">嵌入包</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入包</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</font></font></font></span><span class="p">(</span><span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_验证批次大小</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">])</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="kc">无</span><span class="p">:</span>
    <span class="c1"># XXX：JIT 脚本不支持 functools 中的 reduce 操作，并且 mul 操作是</span>
    <span class="c1"># 内置的，目前还不能用作函数的值，所以需要重写这个大小</span>
    <span class="c1"># 检查一个简单的等效循环</span>
    <span class="c1">#</span>
    <span class="c1"># TODO：当即时编译（JIT）准备好并具备缺失的功能时，像下面这样使用 reduce</span>
    <span class="c1"># 从运算符导入乘法</span>
    <span class="c1">导入 functools</span>
    <span class="c1">#</span>
    <span class="c1">如果 reduce(mul, size[2:], size[0]) 等于 1</span>
    <span class="n">产品尺寸</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">产品尺寸</font></font></font></span> <span class="o">*=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">产品尺寸</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"训练时每个通道预期超过 1 个值，但得到了输入大小"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>


<div class="viewcode-block" id="batch_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 批标准化(
输入: Tensor,
运行均值: Optional[Tensor],
运行方差: Optional[Tensor],
weight: 可选[Tensor] = None,
bias: 可选[Tensor] = None,
training: 布尔型 = False,
momentum: 浮点数 = 0.1,
eps: float = 1e-5,
) -&gt; Tensor:
应用批量归一化对数据批次中的每个通道进行处理。

查看 :class:`~torch.nn.BatchNorm1d`, :class:`~torch.nn.BatchNorm2d`,
`torch.nn.BatchNorm3d` 的详细信息请参阅。
"""
如果 has_torch_function_variadic(input, running_mean, running_var, weight, bias) 为真：
返回 handle_torch_function(
批标准化
(输入，运行均值，运行方差，权重，偏置)
输入
运行均值
运行变量,
weight=weight,
bias=bias,
training=training,
momentum=动量,
eps=epsilon,
        )
如果训练：
_verify_batch_size(input.size())

return torch.batch_norm(
input,
weight,
偏差,
运行均值,
运行方差,
训练,
动量,
eps,
torch.backends.cudnn.enabled,
    )</font></font></font></div>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">验证空间大小</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">])</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="kc">无</span><span class="p">:</span>
    <span class="c1"># 验证实例归一化计算时是否存在大于 1 的空间元素。</span>
    <span class="n">产品尺寸</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">)):</span>
        <span class="n">产品尺寸</font></font></font></span> <span class="o">*=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">产品尺寸</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"在训练时预期有超过 1 个空间元素，但得到了输入大小 "</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>


<div class="viewcode-block" id="instance_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def instance_norm(
输入: Tensor,
running_mean: Optional[Tensor] = None,
running_var: Optional[Tensor] = None,
weight: 可选[Tensor] = None,
bias: 可选[Tensor] = None,
use_input_stats: 布尔 = True,
momentum: 浮点数 = 0.1,
eps: float = 1e-5,
) -&gt; Tensor:
独立地对每个数据样本中的每个通道应用实例归一化。

查看 :class:`~torch.nn.InstanceNorm1d`, :class:`~torch.nn.InstanceNorm2d`,
`torch.nn.InstanceNorm3d` 的详细信息请参阅。
"""
如果 has_torch_function_variadic(input, running_mean, running_var, weight, bias) 为真：
返回 handle_torch_function(
instance_norm,
(输入，运行均值，运行方差，权重，偏置),
输入,
running_mean=running_mean,
running_var=running_var,
weight=weight,
bias=bias,
use_input_stats=use_input_stats,
momentum=动量,
eps=eps,
        )
如果使用输入统计:
_验证输入大小(input.size())
return torch.instance_norm(
input,
weight,
偏差,
运行均值,
运行方差,
使用输入统计信息,
动量,
eps,
torch.backends.cudnn.enabled,
    )</font></font></font></div>


<div class="viewcode-block" id="layer_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def layer_norm(
输入: Tensor,
标准化形状: list[int],
weight: Optional[Tensor] = None,
bias: Optional[Tensor] = None,
eps: float = 1e-5,
) -&gt; Tensor:
r"""应用层归一化于最后若干维度。

查看 :class:`~torch.nn.LayerNorm` 获取详细信息。
"""
如果 has_torch_function_variadic(input, weight, bias) 为真：
返回 handle_torch_function(
层归一化
(输入，权重，偏置)
输入
归一化形状
weight=权重,
bias=偏置,
eps=epsilon,
        )
return torch.layer_norm(
输入，归一化形状，权重，偏置，eps，torch.backends.cudnn.enabled
    )</font></font></font></div>


<div class="viewcode-block" id="rms_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def rms_norm(
输入: Tensor,
标准化形状: list[int],
weight: Optional[Tensor] = None,
eps: 可选的浮点数 = None,
) -&gt; 张量:
应用均方根层归一化。

详细信息请参阅 :class:`~torch.nn.RMSNorm`。
"""
如果具有 torch_function_variadic(input, weight):
返回 handle_torch_function(
rms_norm, (input, weight), input, normalized_shape, weight=weight, eps=eps
        )
返回 torch.rms_norm(input, normalized_shape, weight, eps)</font></font></font></div>


<div class="viewcode-block" id="group_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def group_norm(
输入: Tensor,
num_groups: int,
weight: Optional[Tensor] = None,
bias: Optional[Tensor] = None,
eps: float = 1e-5,
) -&gt; Tensor:
r"""应用组归一化于最后若干维度。

查看 :class:`~torch.nn.GroupNorm` 获取详细信息。
"""
如果 has_torch_function_variadic(input, weight, bias) 为真：
返回 handle_torch_function(
group_norm,
            (
input,
weight,
偏差,
            ),
输入,
组数,
weight=权重,
bias=偏置,
eps=epsilon,
        )
if input.dim() &lt; 2:
raise RuntimeError(
f"期望输入张量至少有 2 个维度，但实际接收到 {input.dim()}"
        )
_verify_batch_size(
[input.size(0) * input.size(1) // num_groups, num_groups]
+ list(input.size()[2:])
    )
return torch.group_norm(
input, num_groups, weight, bias, eps, torch.backends.cudnn.enabled
    )</font></font></font></div>


<div class="viewcode-block" id="local_response_norm"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def local_response_norm(
输入: Tensor,
大小: int,
alpha: float = 1e-4,
beta: 浮点数 = 0.75,
k: 浮点数 = 1.0,
) -&gt; 张量:
r"""在输入信号上应用局部响应归一化。

输入信号由多个输入平面组成，其中通道占据第二维。
在通道间应用归一化。

详细信息请参阅 :class:`~torch.nn.LocalResponseNorm`。
"""
if has_torch_function_unary(input):
return handle_torch_function(
local_response_norm, (input,), input, size, alpha=alpha, beta=beta, k=k
        )
dim = input.dim()
if dim &lt; 3:
raise ValueError(
f"期望 3D 或更高维度的输入（实际维度为{dim}）"
        )

if input.numel() == 0:
return input

div = input.mul(input)
if dim == 3:
div = div.unsqueeze(1)
div = pad(div, (0, 0, size // 2, (size - 1) // 2))
div = avg_pool2d(div, (size, 1), stride=1).squeeze(1)
else:
sizes = input.size()
div = div.view(sizes[0], 1, sizes[1], sizes[2], -1)
div = pad(div, (0, 0, 0, 0, size // 2, (size - 1) // 2))
div = avg_pool3d(div, (size, 1, 1), stride=1).squeeze(1)
div = div.view(sizes)
div = div.mul(alpha).add(k).pow(beta)
return input / div</font></font></font></div>


<span class="c1"># 损失</span>


<div class="viewcode-block" id="ctc_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.ctc_loss.html#torch.nn.functional.ctc_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">ctc_loss</span><span class="p">(</span>
    <span class="n">log_probs</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">input_lengths</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">目标长度</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">空白</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">零无穷</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">应用连接主义时序分类损失。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.CTCLoss`。</span>

<span class="sd">注意：</span>
<span class="sd">{cudnn_可复现性说明}</span>

<span class="sd">注意：</span>
<span class="sd">        {backward_reproducibility_note}</span>

<span class="sd">参数：</span>
<span class="sd">log_probs: (T, N, C) 或 (T, C) 其中 C = 字母表中的字符数（包括空格）</span>
<span class="sd">`T = 输入长度`，和 `N = 批处理大小`。</span>
<span class="sd">输出对数概率</span>
<span class="sd">例如，通过:func:`torch.nn.functional.log_softmax`获得。</span>
<span class="sd">目标：:math:`(N, S)` 或 `(sum(target_lengths))`</span>
<span class="sd">目标不能为空。在第二种形式中，假设目标已连接。</span>
<span class="sd">input_lengths: :math:`(N)` 或 :math:`()`</span>
<span class="sd">输入长度（必须每个都 ≤ T）</span>
<span class="sd">目标长度：:math:`(N)` 或 :math:`()`.</span>
<span class="sd">目标长度</span>
<span class="sd">空白（int，可选）：</span>
<span class="sd">空白标签。默认 :math:`0`.</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``: 输出的损失将除以目标长度，然后取批次的平均值，</span>
<span class="sd">``'sum'``: 输出将直接相加，</span>
<span class="sd">求和。默认值：``'mean'``</span>
<span class="sd">        zero_infinity (bool, optional):</span>
<span class="sd">是否将无穷大的损失及其关联的梯度置零。</span>
<span class="sd">默认：``False``</span>
<span class="sd">无穷大的损失主要发生在输入太短时。</span>
<span class="sd">与目标对齐。</span>

<span class="sd">示例::</span>

<span class="sd">        &gt;&gt;&gt; log_probs = torch.randn(50, 16, 20).log_softmax(2).detach().requires_grad_()</span>
<span class="sd">        &gt;&gt;&gt; targets = torch.randint(1, 20, (16, 30), dtype=torch.long)</span>
<span class="sd">        &gt;&gt;&gt; input_lengths = torch.full((16,), 50, dtype=torch.long)</span>
<span class="sd">        &gt;&gt;&gt; target_lengths = torch.randint(10, 30, (16,), dtype=torch.long)</span>
<span class="sd">&gt;&gt;&gt; 损失 = F.ctc_loss(log_probs, targets, input_lengths, target_lengths)</span>
<span class="sd">        &gt;&gt;&gt; loss.backward()</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="n">log_probs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标长度</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">ctc_loss</span><span class="p">,</span>
            <span class="p">(</span><span class="n">log_probs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">,</span> <span class="n">目标长度</span><span class="p">),</span>
            <span class="n">log_probs</span><span class="p">,</span>
            <span class="n">targets</span><span class="p">,</span>
            <span class="n">input_lengths</span><span class="p">,</span>
            <span class="n">目标长度</span><span class="p">,</span>
            <span class="n">空白</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">空白</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">零无穷</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">零无穷</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">ctc_loss</span><span class="p">(</span>
        <span class="n">log_probs</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">,</span>
        <span class="n">input_lengths</span><span class="p">,</span>
        <span class="n">目标长度</span><span class="p">,</span>
        <span class="n">空白</span><span class="p">,</span>
        <span class="n">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">),</span>
        <span class="n">零无穷</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">如果</span> <span class="n">ctc_loss</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">ctc_loss</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">ctc_loss</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">格式</font></font></font></span><span class="p">(</span><span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</span><span class="p">)</span>


<div class="viewcode-block" id="nll_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.nll_loss.html#torch.nn.functional.nll_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">nll_loss</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">忽略索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算负对数似然损失。</span>

<span class="sd">查看 :class:`~torch.nn.NLLLoss` 获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入: :math:`(N, C)` 其中 `C = 类别数量` 或 :math:`(N, C, H, W)`</span>
<span class="sd">在 2D 损失的情况下，或：数学公式`(N, C, d_1, d_2, ..., d_K)`其中`K ≥ 1`</span>
<span class="sd">在 K 维损失的情况下。`input` 应为对数概率。</span>
<span class="sd">目标：:math:`(N)` 其中每个值是 :math:`0 \leq \text{targets}[i] \leq C-1`，</span>
<span class="sd">或者 :math:`(N, d_1, d_2, ..., d_K)` 其中 :math:`K \geq 1`，</span>
<span class="sd">K 维损失。</span>
<span class="sd">权重（Tensor，可选）：为每个类别提供的手动缩放权重。如果提供，必须是一个大小为 `C` 的 Tensor。</span>
<span class="sd">类。如果提供，必须是大小为 `C` 的张量</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">忽略索引（int，可选）：指定一个要忽略的目标值</span>
<span class="sd">并且不贡献于输入梯度。当 :attr:`size_average` 为 ``True`` 时，</span>
<span class="sd">损失将在非忽略的目标上进行平均。默认：-100</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出总和将除以输出元素的数量，</span>
<span class="sd">``'sum'``：输出将进行求和。注意：:attr:`size_average`</span>
<span class="sd">和 :attr:`reduce` 正在弃用，在此期间，</span>
<span class="sd">指定这两个参数中的任何一个将覆盖 :attr:`reduction`。默认：``'mean'``</span>

<span class="sd">示例::</span>

<span class="sd">&gt;&gt;&gt; # 输入大小为 N x C = 3 x 5</span>
<span class="sd">        &gt;&gt;&gt; input = torch.randn(3, 5, requires_grad=True)</span>
<span class="sd">&gt;&gt;&gt; # 目标中的每个元素都必须满足 0 &lt;= value &lt; C</span>
<span class="sd">        &gt;&gt;&gt; target = torch.tensor([1, 0, 4])</span>
<span class="sd">        &gt;&gt;&gt; output = F.nll_loss(F.log_softmax(input, dim=1), target)</span>
<span class="sd">        &gt;&gt;&gt; output.backward()</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">nll_loss</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">忽略索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">忽略索引</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取字符串</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">nll_loss_nd</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">),</span> <span class="n">ignore_index</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="poisson_nll_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.poisson_nll_loss.html#torch.nn.functional.poisson_nll_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">泊松 NLL 损失</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">日志输入</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">full</span><span class="p">:</span> <span class="nb">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">浮点数</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">泊松负对数似然损失。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.PoissonNLLLoss`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：底层泊松分布的期望。</span>
<span class="sd">目标：随机样本 :math:`target \sim \text{Poisson}(input)`。</span>
<span class="sd">log_input: 如果为 ``True``，则损失计算为</span>
<span class="sd">math:`\exp(\text{input}) - \text{target} * \text{input}`，如果为 ``False``，则损失为</span>
<span class="sd">math:`\text{input} - \text{target} * \log(\text{input}+\text{eps})`。默认：``True``</span>
<span class="sd">full: 是否计算完整损失，即添加 Stirling</span>
<span class="sd">近似项。默认值：``False``</span>
<span class="sd">math:`\text{目标} * \log(\text{目标}) - \text{目标} + 0.5 * \log(2 * \pi * \text{目标})`</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">eps (float, 可选): 避免评估 :math:`\log(0)` 的小值</span>
<span class="sd">`log_input` = ``False``. 默认：1e-8</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出总和将除以输出元素的数量，</span>
<span class="sd">``'sum'``：输出将进行求和。注意：:attr:`size_average`</span>
<span class="sd">和 :attr:`reduce` 正在弃用，在此期间，</span>
<span class="sd">指定这两个参数中的任何一个将覆盖 :attr:`reduction`。默认：``'mean'``</span>

<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">泊松 NLL 损失</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">日志输入</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志输入</span><span class="p">,</span>
            <span class="n">full</span><span class="o">=</span><span class="n">full</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取字符串</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="n">返回</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">减少</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"不是有效的缩减值"</span><span class="p">)</span>

    <span class="n">返回</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">泊松 NLL 损失</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志输入</font></font></font></span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回</span></div>


<div class="viewcode-block" id="gaussian_nll_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.gaussian_nll_loss.html#torch.nn.functional.gaussian_nll_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">高斯负对数似然损失</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">变量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联盟</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="nb">float</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">full</span><span class="p">:</span> <span class="nb">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">浮点数</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">高斯负对数似然损失。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.GaussianNLLLoss`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：高斯分布的期望</span>
<span class="sd">目标：从高斯分布中抽取样本</span>
<span class="sd">var：正方差（s）的张量，每个期望一个（异方差），或一个（同方差）</span>
<span class="sd">在输入中（异方差），或一个（同方差）</span>
<span class="sd">或为所有期望使用的正标量值。</span>
<span class="sd">full (bool, 可选): 是否在损失计算中包含常数项。默认：``False``。</span>
<span class="sd">eps (float, 可选): 添加到 var 中的值，以增加稳定性。默认：1e-6。</span>
<span class="sd">reduction (str, 可选): 指定应用于输出的缩减方式：</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出为所有批次成员损失的均值，</span>
<span class="sd">``'sum'``：输出为所有批次成员损失的总和。</span>
<span class="sd">默认：``'mean'``。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">高斯负对数似然损失</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">变量</span><span class="p">,</span>
            <span class="n">full</span><span class="o">=</span><span class="n">full</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># var 的条目必须为非负</span>
    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"变量包含负数项"</span><span class="p">)</span>
        <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">喜欢的</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">torch</span><span class="o">.</span><span class="n">任何</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"变量包含负数项"</span><span class="p">)</span>

    <span class="c1"># 检查变量大小</span>
    <span class="c1"># 如果 var.size 等于 input.size，则情况为异方差性，无需进一步检查。</span>
    <span class="c1">否则：</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
        <span class="c1">如果变量比输入少一个维度，但其他维度大小匹配，则这是一个同方差情况。</span>
        <span class="c1">例如：输入.size = (10, 2, 3)，变量.size = (10, 2)</span>
        <span class="c1">-&gt; 将变量扩展，使变量.shape = (10, 2, 1)</span>
        <span class="c1">这样做是为了在损失计算中实现广播</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
            <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">这检查是否与最终维度匹配，并且 var 的最终维度大小为 1。</span>
        <span class="c1">这也是一个同方差的情况。</span>
        <span class="c1">例如，input.size = (10, 2, 3)，var.size = (10, 2, 1)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">):</span>  <span class="c1">异方差情况</span>
            <span class="k">通过</span>

        <span class="c1"># 如果以上都不符合，则变量 var 的大小不正确。</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"变量 var 的大小不正确"</span><span class="p">)</span>

    <span class="c1"># 检查缩减模式的有效性</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">减少</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"无效"</span><span class="p">)</span>

    <span class="c1"># 稳定性夹具</span>
    <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">克隆</span><span class="p">()</span>
    <span class="k">与</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不梯度</span><span class="p">():</span>
        <span class="n">变量</font></font></font></span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

    <span class="c1">计算损失</span>
    <span class="n">损失</font></font></font></span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">)</span>
    <span class="k">如果</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">损失</font></font></font></span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志</font></font></font></span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">π</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">均值</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</span></div>


<div class="viewcode-block" id="kl_div"><a class="viewcode-back" href="../../../generated/torch.nn.functional.kl_div.html#torch.nn.functional.kl_div">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">kl_div</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">日志目标</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算 KL 散度损失。</span>

<span class="sd">参考 - `Kullback-Leibler 散度损失`</span>
<span class="sd">[https://en.wikipedia.org/wiki/Kullback-Leibler_divergence](https://en.wikipedia.org/wiki/Kullback-Leibler_divergence)</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.KLDivLoss`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：任意形状的对数概率张量。</span>
<span class="sd">目标：与输入形状相同的张量。有关目标的解释，请参阅：attr:`log_target`。</span>
<span class="sd">目标的解释。</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'`` | ``'batchmean'`` | ``'sum'`` | ``'mean'``。</span>
<span class="sd">``'none'``：不应用降维</span>
<span class="sd">``'batchmean'``：输出之和将被除以批大小</span>
<span class="sd">``'sum'``: 输出将被求和</span>
<span class="sd">``'mean'``: 输出将被除以输出中的元素数量</span>
<span class="sd">默认: ``'mean'``</span>
<span class="sd">log_target (布尔值): 一个标志，表示是否在对数空间中传递 ``target``。</span>
<span class="sd">建议传递某些分布（如 `softmax`）</span>
<span class="sd">在对数空间中，以避免由显式 `log` 引起的数值问题。</span>
<span class="sd">默认：``False``</span>

<span class="sd">.. 注意::</span>
<span class="sd">`size_average` 和 `reduce` 正在弃用中，</span>
<span class="sd">同时，指定这两个参数中的任何一个都将覆盖 `reduction`。</span>

<span class="sd">.. 警告::</span>
<span class="sd">`:attr:`reduction` = ``'mean'`` 不返回真正的 KL 散度值，请使用</span>
<span class="sd">`:attr:`reduction` = ``'batchmean'`` 这与 KL 数学定义一致。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">kl_div</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">日志目标</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志目标</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
            <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
                <span class="s2">"reduction: 'mean' 将总损失除以批大小和支持大小。"</span>
                <span class="s2">"'batchmean' 只除以批大小，并与 KL 除法数学定义一致。"</span>
                <span class="s2">"在下一个主要版本中，'mean' 将改为与 'batchmean' 的行为相同。"</span>
            <span class="p">)</span>

        <span class="c1"># 批 mean 的特殊情况</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批量均值</span><span class="p">:</span>
            <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>

    <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">kl_div</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少枚举</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志目标</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">日志目标</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批均值</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">/</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span></div>


<div class="viewcode-block" id="cross_entropy"><a class="viewcode-back" href="../../../generated/torch.nn.functional.cross_entropy.html#torch.nn.functional.cross_entropy">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交叉熵</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">忽略索引</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">标签平滑</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算输入对数几率和目标之间的交叉熵损失。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.CrossEntropyLoss`。</span>

<span class="sd">参数：</span>
<span class="sd">输入 (Tensor) : 预测的非规范化对数几率；</span>
<span class="sd">查看下方的形状部分以了解支持的形状。</span>
<span class="sd">目标（张量）：真实类索引或类概率</span>
<span class="sd">查看下方的形状部分以了解支持的形状。</span>
<span class="sd">权重（Tensor，可选）：为每个类别提供的手动缩放权重。如果提供，必须是一个大小为 `C` 的 Tensor。</span>
<span class="sd">类。如果提供，必须是大小为 `C` 的张量</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">忽略索引（int，可选）：指定一个要忽略的目标值</span>
<span class="sd">并且不贡献于输入梯度。当 :attr:`size_average` 为 ``True`` 时，</span>
<span class="sd">“True”，损失是针对非忽略目标平均的。注意，</span>
<span class="sd">attr:`ignore_index` 仅在目标包含类别索引时适用。</span>
<span class="sd">默认：-100</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出总和将除以输出元素的数量，</span>
<span class="sd">``'sum'``：输出将进行求和。注意：:attr:`size_average`</span>
<span class="sd">和 :attr:`reduce` 正在弃用，在此期间，</span>
<span class="sd">指定这两个参数中的任何一个将覆盖 :attr:`reduction`。默认：``'mean'``</span>
<span class="sd">标签平滑（浮点数，可选）：一个位于[0.0, 1.0]之间的浮点数。指定平滑量</span>
<span class="sd">在计算损失时的平滑度，其中 0.0 表示无平滑。目标</span>
<span class="sd">原始真实值和如描述的均匀分布混合在一起</span>
<span class="sd">《重新思考计算机视觉的 Inception 架构 》。默认值：:math:`0.0`。</span>

<span class="sd">形状：</span>
<span class="sd">- 输入：形状 :math:`(C)`，:math:`(N, C)` 或 :math:`(N, C, d_1, d_2, ..., d_K)`，其中 :math:`K \geq 1`</span>
<span class="sd">在 `K` 维度损失的情况下。</span>
<span class="sd">- 目标：如果包含类别索引，形状为 :math:`()`, :math:`(N)` 或 :math:`(N, d_1, d_2, ..., d_K)`，其中</span>
<span class="sd">math:`K \geq 1` 在 K 维损失的情况下，每个值应在 :math:`[0, C)` 范围内。</span>
<span class="sd">如果包含类别概率，形状与输入相同，每个值应在 :math:`[0, 1]` 范围内。</span>

<span class="sd">其中：</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{aligned}</span>
<span class="sd">C ={} &amp; \text{类别数量} \\</span>
<span class="sd">N ={} &amp; \text{批量大小} \\</span>
<span class="sd">            \end{aligned}</span>

<span class="sd">示例：</span>

<span class="sd">&gt;&gt;&gt; # 示例：带有类别索引的目标</span>
<span class="sd">        &gt;&gt;&gt; input = torch.randn(3, 5, requires_grad=True)</span>
<span class="sd">        &gt;&gt;&gt; target = torch.randint(5, (3,), dtype=torch.int64)</span>
<span class="sd">        &gt;&gt;&gt; loss = F.cross_entropy(input, target)</span>
<span class="sd">        &gt;&gt;&gt; loss.backward()</span>
<span class="sd">...</span>
<span class="sd">&gt;&gt;&gt; # 示例：带有概率类的目标</span>
<span class="sd">        &gt;&gt;&gt; input = torch.randn(3, 5, requires_grad=True)</span>
<span class="sd">        &gt;&gt;&gt; target = torch.randn(3, 5).softmax(dim=1)</span>
<span class="sd">        &gt;&gt;&gt; loss = F.cross_entropy(input, target)</span>
<span class="sd">        &gt;&gt;&gt; loss.backward()</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">交叉熵</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">忽略索引</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">忽略索引</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">标签平滑</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">标签平滑</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取字符串</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交叉熵损失</span><span class="p">(</span>
        <span class="nb">输入</span><span class="p">,</span>
        <span class="n">目标</span><span class="p">,</span>
        <span class="n">重量</span><span class="p">,</span>
        <span class="n">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">),</span>
        <span class="n">忽略索引</span><span class="p">,</span>
        <span class="n">标签平滑</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="binary_cross_entropy"><a class="viewcode-back" href="../../../generated/torch.nn.functional.binary_cross_entropy.html#torch.nn.functional.binary_cross_entropy">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二元交叉熵</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">测量目标概率与输入概率之间的二进制交叉熵。</span>

<span class="sd">请参阅：class:`~torch.nn.BCELoss` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入：任意形状的张量作为概率。</span>
<span class="sd">目标：与输入形状相同的张量，其值介于 0 和 1 之间。</span>
<span class="sd">权重（张量，可选）：一个手动缩放权重</span>
<span class="sd">如果提供，则重复以匹配输入张量形状</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出总和将除以输出元素的数量，</span>
<span class="sd">``'sum'``：输出将进行求和。注意：:attr:`size_average`</span>
<span class="sd">和 :attr:`reduce` 正在弃用，在此期间，</span>
<span class="sd">指定这两个参数中的任何一个将覆盖 :attr:`reduction`。默认：``'mean'``</span>

<span class="sd">示例：</span>

<span class="sd">        &gt;&gt;&gt; input = torch.randn(3, 2, requires_grad=True)</span>
<span class="sd">        &gt;&gt;&gt; target = torch.rand(3, 2, requires_grad=False)</span>
<span class="sd">        &gt;&gt;&gt; loss = F.binary_cross_entropy(torch.sigmoid(input), target)</span>
<span class="sd">        &gt;&gt;&gt; loss.backward()</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">二元交叉熵</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">使用一个与输入大小不同的目标大小（</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）是 deprecated。</span>
            <span class="s2">"请确保它们具有相同的大小。"</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">新尺寸</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_推断大小</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">())</span>
        <span class="n">权重</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展开</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">新尺寸</span><span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二元交叉熵</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少枚举</span><span class="p">)</span></div>


<div class="viewcode-block" id="binary_cross_entropy_with_logits"><a class="viewcode-back" href="../../../generated/torch.nn.functional.binary_cross_entropy_with_logits.html#torch.nn.functional.binary_cross_entropy_with_logits">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二元交叉熵（对数）</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">正向权重</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算目标与输入 logits 之间的二元交叉熵。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.BCEWithLogitsLoss`。</span>

<span class="sd">参数：</span>
<span class="sd">输入：任意形状的张量，作为未归一化的分数（通常称为 logits）。</span>
<span class="sd">目标：与输入形状相同的张量，其值介于 0 和 1 之间。</span>
<span class="sd">权重（张量，可选）：一个手动缩放权重</span>
<span class="sd">如果提供，则重复以匹配输入张量形状</span>
<span class="sd">size_average（布尔值，可选）：已弃用（参见：attr:`reduction`）。默认情况下，</span>
<span class="sd">批量中的每个损失元素的平均值。注意，对于某些损失，每个样本可能有多个元素。如果将字段 :attr:`size_average` 设置为 ``False``，则损失将改为对每个小批量求和。当 reduce 为 ``False`` 时忽略。默认：``True``</span>
<span class="sd">一些损失，每个样本有多个元素。如果字段：attr:`size_average`</span>
<span class="sd">设置为“False”，损失将分别对每个小批量进行求和。忽略</span>
<span class="sd">当 reduce 为``False``。默认：``True``</span>
<span class="sd">减少（布尔值，可选）：已弃用（见：attr：`reduction`）。默认情况下，</span>
<span class="sd">损失在每个小批量上的观测值被平均或求和</span>
<span class="sd">在：attr:`size_average`。当：attr:`reduce`为``False``时，返回每个样本的损失</span>
<span class="sd">批量元素而不是，并忽略：attr:`size_average`。默认：``True``</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">``'none'``：不应用缩减，``'mean'``：应用平均值缩减，``'sum'``：应用总和缩减</span>
<span class="sd">``'mean'``：输出总和将除以输出元素的数量，</span>
<span class="sd">``'sum'``：输出将进行求和。注意：:attr:`size_average`</span>
<span class="sd">和 :attr:`reduce` 正在弃用，在此期间，</span>
<span class="sd">指定这两个参数中的任何一个将覆盖 :attr:`reduction`。默认：``'mean'``</span>
<span class="sd">pos_weight (Tensor，可选): 正例的权重，将广播与目标一起使用。</span>
<span class="sd">必须是一个与类别维度的类别数量相等的张量。</span>
<span class="sd">请密切关注 PyTorch 的广播语义，以实现所需的效果。</span>
<span class="sd">操作。对于大小为[B, C, H, W]的目标（其中 B 是批量大小），将根据大小[B, C, H, W]应用不同的 pos_weight 到批量的每个元素或</span>
<span class="sd">[C, H, W]在整个批次中应用相同的 pos_weight。对于 2D 多类目标[C, H, W]，要沿所有空间维度应用相同的正权重，请使用：[C, 1, 1]。</span>
<span class="sd">沿所有空间维度应用相同的正权重。对于 2D 多类目标[C, H, W]，要沿所有空间维度应用相同的正权重，请使用：[C, 1, 1]。</span>
<span class="sd">[C, 1, 1]。对于 2D 多类目标[C, H, W]，要沿所有空间维度应用相同的正权重，请使用：[C, 1, 1]。</span>
<span class="sd">默认：`None`</span>

<span class="sd">示例：</span>

<span class="sd">         &gt;&gt;&gt; input = torch.randn(3, requires_grad=True)</span>
<span class="sd">         &gt;&gt;&gt; target = torch.empty(3).random_(2)</span>
<span class="sd">         &gt;&gt;&gt; loss = F.binary_cross_entropy_with_logits(input, target)</span>
<span class="sd">         &gt;&gt;&gt; loss.backward()</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正向权重</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">二元交叉熵（对数）</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正向权重</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">正向权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正向权重</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">减法枚举</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"目标大小（"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）必须与输入大小（"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()</span><span class="si">}</span><span class="s2">)"</span>
        <span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二元交叉熵（对数）</span><span class="p">(</span>
        <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正向权重</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减法枚举</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="smooth_l1_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def smooth_l1_loss(
输入: Tensor,
目标: Tensor,
size_average: Optional[bool] = None,
reduce: Optional[bool] = None,
reduction: str = "mean",
beta: float = 1.0,
) -&gt; Tensor:
计算平滑 L1 损失。

函数在元素级误差低于 beta 时使用平方项，否则使用 L1 项。
详细信息请参阅 :class:`~torch.nn.SmoothL1Loss`。

有关详细信息，请参阅 :class:`~torch.nn.SmoothL1Loss`。
"""
如果具有 torch_function_variadic(input, target):
返回 handle_torch_function(
smooth_l1_loss,
输入，目标
输入
目标
size_average=size_average
reduce=reduce,
reduction=reduction,
beta=beta,
        )
如果目标大小（target.size()）不等于输入大小（input.size()）
警告：
f"使用目标大小 ({target.size()}) 与输入大小 ({input.size()}) 不一致。 "
这可能会由于广播导致结果不正确。
请确保它们具有相同的大小。
stacklevel=2,
        )
如果 size_average 不为 None 或 reduce 不为 None：
reduction = _Reduction.legacy_get_string(size_average, reduce)

expanded_input, expanded_target = torch.broadcast_tensors(input, target)

if beta == 0.0:
return torch._C._nn.l1_loss(
expanded_input, expanded_target, _Reduction.get_enum(reduction)
        )
else:
return torch._C._nn.smooth_l1_loss(
expanded_input, expanded_target, _Reduction.get_enum(reduction), beta
        )</font></font></font></div>


<div class="viewcode-block" id="huber_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.huber_loss.html#torch.nn.functional.huber_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">胡伯损失</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">Δ</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">huber_loss(input, target, reduction='mean', delta=1.0, weight=None) -&gt; Tensor</span>

<span class="sd">计算 Huber 损失，可选加权。</span>

<span class="sd">函数在元素级误差低于 delta 时使用平方项，否则使用 delta 缩放的 L1 项。</span>
<span class="sd">函数使用平方项如果元素级误差低于 delta，否则使用 delta 缩放的 L1 项。</span>

<span class="sd">当 delta 等于 1 时，此损失函数等同于 SmoothL1Loss。</span>
<span class="sd">通常情况下，Huber 损失与 SmoothL1Loss 的差别是一个 delta（也称为 Smooth L1 中的 beta）的系数。</span>

<span class="sd">参数：</span>
<span class="sd">input (Tensor): 预测值。</span>
<span class="sd">target (Tensor): 真实值。</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">'none' | 'mean' | 'sum'。'mean'：取输出平均值。</span>
<span class="sd">'求和：输出将被求和。无：不应用任何缩减。'</span>
<span class="sd">默认：'平均'。</span>
<span class="sd">delta (浮点数，可选): 在 delta-scaled L1 和 L2 损失之间切换的阈值。默认：1.0。</span>
<span class="sd">权重（张量，可选）：每个样本的权重。默认：None。</span>

<span class="sd">返回：</span>
<span class="sd">张量：Huber 损失（可选加权）。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">胡伯损失</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">Δ</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Δ</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()):</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">使用一个与输入大小不同的目标大小（</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)。"</span>
            <span class="s2">"这可能会因为广播而导致结果不正确。"</span>
            <span class="s2">"请确保它们具有相同的大小。"</span><span class="p">,</span>
            <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播张量</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="c1">使用优化的 C++后端进行标准 Huber 损失</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">胡伯损失</span><span class="p">(</span>
            <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">),</span> <span class="n">delta</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">权重和输入必须具有相同的大小。</span><span class="p">)</span>

        <span class="c1">首先计算未加权的损失</span>
        <span class="n">未加权损失</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">胡伯损失</span><span class="p">(</span>
            <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">),</span> <span class="n">delta</span>
        <span class="p">)</span>

        <span class="c1"># 将权重应用于未加权的损失</span>
        <span class="n">加权损失</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未加权损失</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权损失</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权损失</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权损失</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">均值</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"无效的减少模式："</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. 预期的是 'none'、'mean' 或 'sum' 之一。</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="l1_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.l1_loss.html#torch.nn.functional.l1_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">l1_loss：L1 损失</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>  <span class="c1"># noqa: D400,D402</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">l1_loss(input, target, size_average=None, reduce=None, reduction='mean') -&gt; Tensor</span>

<span class="sd">函数用于计算元素间平均的绝对值差。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.L1Loss`。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">l1_loss：L1 损失</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()):</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">使用一个与输入大小不同的目标大小（</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)。"</span>
            <span class="s2">"这可能会因为广播而导致结果不正确。"</span>
            <span class="s2">"请确保它们具有相同的大小。"</span><span class="p">,</span>
            <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取字符串</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>

    <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播张量</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">权重和输入必须具有相同的大小。</span><span class="p">)</span>

        <span class="n">绝对误差</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">绝对值</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展输入</font></font></font></span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</span><span class="p">)</span>
        <span class="n">加权绝对误差</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">绝对误差</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权绝对误差</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权绝对误差</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权绝对误差</font></font></font></span><span class="p">)</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"无效的减少模式："</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. 预期的是 'none'、'mean' 或 'sum' 之一。</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">l1_loss：L1 损失</span><span class="p">(</span>
            <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="mse_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.mse_loss.html#torch.nn.functional.mse_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">mse_loss</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">平均大小</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">减少</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
    <span class="n">重量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">mse_loss(input, target, size_average=None, reduce=None, reduction='mean', weight=None) -&gt; Tensor</span>

<span class="sd">测量元素级的均方误差，可选加权。</span>

<span class="sd">参数：</span>
<span class="sd">input (Tensor): 预测值。</span>
<span class="sd">target (Tensor): 真实值。</span>
<span class="sd">size_average (bool, 可选): 已废弃（使用 reduction）。</span>
<span class="sd">reduce (bool, 可选): 已废弃（使用 reduction）。</span>
<span class="sd">reduction（字符串，可选）：指定应用于输出的缩减</span>
<span class="sd">'none' | 'mean' | 'sum'。'mean'：取输出平均值。</span>
<span class="sd">'求和：输出将被求和。无：不应用任何缩减。'</span>
<span class="sd">默认：'平均'。</span>
<span class="sd">权重（张量，可选）：每个样本的权重。默认：None。</span>

<span class="sd">返回：</span>
<span class="sd">张量：均方误差损失（可选加权）。'</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">mse_loss</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">目标</span><span class="p">,</span>
            <span class="n">平均大小</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</span><span class="p">,</span>
            <span class="n">减少</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
            <span class="n">重量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">()):</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">使用一个与输入大小不同的目标大小（</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)。"</span>
            <span class="s2">"这可能会因为广播而导致结果不正确。"</span>
            <span class="s2">"请确保它们具有相同的大小。"</span><span class="p">,</span>
            <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n">size_average</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">reduce</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">减少</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧版获取字符串</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均大小</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</span><span class="p">)</span>

    <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">广播张量</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">权重和输入必须具有相同的大小。</span><span class="p">)</span>

        <span class="c1">手动执行加权均方误差损失</span>
        <span class="n">平方误差</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展输入</font></font></font></span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">加权平方误差</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平方误差</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">权重</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权平方误差</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权平方误差</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加权平方误差</font></font></font></span><span class="p">)</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重量</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"无效的减少模式："</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. 预期的是 'none'、'mean' 或 'sum' 之一。</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span>
            <span class="n">扩展输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">扩展目标</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_减少</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取枚举</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="margin_ranking_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def margin_ranking_loss(
输入 1: Tensor,
输入 2: Tensor,
目标: Tensor,
margin: 浮点数 = 0,
size_average: 可选[布尔] = None,
reduce: 可选[布尔] = None,
reduction: 字符串 = "mean",
) -&gt; 张量:  # noqa: D400,D402
r"""边缘排序损失(input1, input2, 目标, margin=0, size_average=None, reduce=None, reduction='mean') -&gt; 张量

详细信息请参阅 :class:`~torch.nn.MarginRankingLoss`
"""
if has_torch_function_variadic(input1, input2, target):
return handle_torch_function(
margin_ranking_loss,
(input1, input2, target),
输入 1,
输入 2,
目标，
边距=边距，
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为 None 或 reduce 不为 None：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
如果 input1 的维度不等于 input2 的维度，或者 input1 的维度不等于 target 的维度：
raise RuntimeError(
f"margin_ranking_loss : 所有输入张量应具有相同的维度，但得到了以下大小："
f"input1: {input1.size()}, input2: {input2.size()}, target: {target.size()} "
        )
返回 torch.margin_ranking_loss(input1, input2, target, margin, reduction_enum)</font></font></font></div>


<div class="viewcode-block" id="hinge_embedding_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def hinge_embedding_loss(
输入: Tensor,
目标: Tensor,
边距: float = 1.0,
size_average: 可选[bool] = None,
reduce: 可选[bool] = None,
reduction: str = "mean",
) -&gt; Tensor:  # noqa: D400,D402
r"""hinge_embedding_loss(input, target, margin=1.0, size_average=None, reduce=None, reduction='mean') -&gt; Tensor

查看详细信息请参阅 :class:`~torch.nn.HingeEmbeddingLoss`。
"""
if has_torch_function_variadic(input, target):
return handle_torch_function(
hinge_embedding_loss,
(input, target),
input,
target,
margin=margin,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为空或 reduce 不为空：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
return torch.hinge_embedding_loss(input, target, margin, reduction_enum)</font></font></font></div>


<div class="viewcode-block" id="multilabel_margin_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def multilabel_margin_loss(
输入: Tensor,
目标: Tensor,
size_average: Optional[bool] = None,
reduce: Optional[bool] = None,
reduction: str = "mean",
) -&gt; Tensor:  # noqa: D400,D402
r"""多标签边缘损失(input, target, size_average=None, reduce=None, reduction='mean') -&gt; Tensor

查看详细信息请参阅：:class:`~torch.nn.MultiLabelMarginLoss`
"""
如果 has_torch_function_variadic(input, target) 为真：
返回 handle_torch_function(
多标签边缘损失,
(输入，目标),
输入,
目标,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为 None 或 reduce 不为 None：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
return torch._C._nn.multilabel_margin_loss(input, target, reduction_enum)</font></font></font></div>


<div class="viewcode-block" id="soft_margin_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def soft_margin_loss(
输入: Tensor,
目标: Tensor,
size_average: Optional[bool] = None,
reduce: Optional[bool] = None,
reduction: str = "mean",
) -&gt; Tensor:  # noqa: D400,D402
r"""
soft_margin_loss(input, target, size_average=None, reduce=None, reduction='mean') -&gt; Tensor

详细信息请参阅 :class:`~torch.nn.SoftMarginLoss`。
"""
if has_torch_function_variadic(input, target):
return handle_torch_function(
soft_margin_loss,
(input, target),
input,
target,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为 None 或者 reduce 不为 None：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
否则：
reduction_enum = _Reduction.get_enum(reduction)
return torch._C._nn.soft_margin_loss(input, target, reduction_enum)</font></font></font></div>


<div class="viewcode-block" id="multilabel_soft_margin_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def multilabel_soft_margin_loss(
输入: Tensor,
目标: Tensor,
权重: Optional[Tensor] = None,
size_average: 可选[bool] = None,
reduce: 可选[bool] = None,
reduction: str = "mean",
) -&gt; Tensor:  # noqa: D400,D402
r"""多标签软边界损失(input, target, weight=None, size_average=None, reduce=None, reduction='mean') -&gt; Tensor"""

查看文档 :class:`~torch.nn.MultiLabelSoftMarginLoss` 获取详细信息。
"""
if has_torch_function_variadic(input, target, weight):
return handle_torch_function(
multilabel_soft_margin_loss,
(input, target, weight),
input,
target,
weight=weight,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为空或 reduce 不为空：
reduction = _Reduction.legacy_get_string(size_average, reduce)

loss = -(target * logsigmoid(input) + (1 - target) * logsigmoid(-input))

if weight is not None:
loss = loss * weight

class_dim = input.dim() - 1
C = 输入的大小(class_dim)
loss = loss.sum(dim=class_dim) / C  # 仅返回 N 个 loss 值

if reduction == "none":
ret = loss
elif reduction == "mean":
ret = loss.mean()
elif reduction == "sum":
ret = loss.sum()
else:
ret = input
raise ValueError(减少 + " 无效")
return ret</font></font></font></div>


<div class="viewcode-block" id="cosine_embedding_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 余弦嵌入损失(
输入 1: 张量,
输入 2: 张量,
目标: 张量,
margin: 浮点数 = 0,
size_average: 可选[布尔] = None,
reduce: 可选[布尔] = None,
reduction: 字符串 = "mean",
) -&gt; 张量:  # noqa: D400,D402
r"""余弦嵌入损失(input1, input2, 目标, margin=0, size_average=None, reduce=None, reduction='mean') -&gt; 张量

详细信息请参阅 :class:`~torch.nn.CosineEmbeddingLoss`。
"""
if has_torch_function_variadic(input1, input2, target):
return handle_torch_function(
余弦嵌入损失,
(input1, input2, target),
输入 1,
输入 2,
目标，
边距=边距，
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为 None 或 reduce 不为 None：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
返回 torch.cosine_embedding_loss(input1, input2, target, margin, reduction_enum)</font></font></font></div>


<div class="viewcode-block" id="multi_margin_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 多边损失(
输入: Tensor,
目标: Tensor,
p: int = 1,
margin: 浮点数 = 1.0,
weight: 可选[Tensor] = None,
size_average: 可选[布尔] = None,
reduce: 可选[布尔] = None,
reduction: str = "mean",
) -&gt; Tensor:  # noqa: D400,D402
r"""多边损失(input, target, p=1, margin=1, weight=None, size_average=None, reduce=None, reduction='mean') -&gt; Tensor

查看详情请见 :class:`~torch.nn.MultiMarginLoss`。
"""
如果具有 torch_function_variadic(input, target, weight):
返回 handle_torch_function(
multi_margin_loss,
(输入，目标，权重)
输入
目标
p=p
margin=margin,
weight=weight,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为空或 reduce 不为空：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
if p != 1 and p != 2:
raise ValueError("only p == 1 and p == 2 supported")
如果 weight 不为 None：
如果 weight.dim()不等于 1：
抛出 ValueError 异常("weight 必须是一维的")

return torch._C._nn.multi_margin_loss(
输入，目标，p，边距，权重，减少枚举
    )</font></font></font></div>


<span class="n">像素混淆</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">pixel_shuffle</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">像素混淆(input, upscale_factor) -&gt; 张量</span>

<span class="sd">重新排列形状为 :math:`(*, C \times r^2, H, W)` 的张量中的元素</span>
<span class="sd">张量形状为 :math:`(*, C, H \times r, W \times r)`，其中 r 是 :attr:`upscale_factor`。</span>

<span class="sd">查看 :class:`~torch.nn.PixelShuffle` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">upscale_factor (int): 用于增加空间分辨率的因子</span>

<span class="sd">示例::</span>

<span class="sd">    &gt;&gt;&gt; input = torch.randn(1, 9, 4, 4)</span>
<span class="sd">    &gt;&gt;&gt; output = torch.nn.functional.pixel_shuffle(input, 3)</span>
<span class="sd">&gt;&gt;&gt; 打印(output.size())</span>
<span class="sd">    torch.Size([1, 1, 12, 12])</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pixel_unshuffle</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">像素重排</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">pixel_unshuffle(input, downscale_factor) -&gt; Tensor</span>

<span class="sd">通过重新排列元素来反转 :class:`~torch.nn.PixelShuffle` 操作</span>
<span class="sd">将形状为 :math:`(*, C, H \times r, W \times r)` 的张量转换为形状为</span>
<span class="sd">math:`(*, C \times r^2, H, W)` 的张量，其中 r 是 :attr:`downscale_factor`</span>

<span class="sd">请参阅：class:`~torch.nn.PixelUnshuffle` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">downscale_factor（整数）：通过该因子增加空间分辨率</span>

<span class="sd">示例::</span>

<span class="sd">    &gt;&gt;&gt; input = torch.randn(1, 1, 12, 12)</span>
<span class="sd">    &gt;&gt;&gt; output = torch.nn.functional.pixel_unshuffle(input, 3)</span>
<span class="sd">&gt;&gt;&gt; 打印(output.size())</span>
<span class="sd">    torch.Size([1, 9, 4, 4])</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">channel_shuffle</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">频道洗牌</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">channel_shuffle(input, groups) -&gt; 索引张量</span>

<span class="sd">将形状为 :math:`(*, C , H, W)` 的张量中的通道进行划分</span>
<span class="sd">将文本分组为 g 组，并重新排列为：(*, C(g), g, H, W)</span>
<span class="sd">保持原始张量形状。</span>

<span class="sd">请参阅：class:`~torch.nn.ChannelShuffle` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">groups（整数）：将通道划分成多少组以及重新排列的数目。</span>

<span class="sd">示例::</span>

<span class="sd">    &gt;&gt;&gt; input = torch.randn(1, 4, 2, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(input)</span>
<span class="sd">    [[[[1, 2],</span>
<span class="sd">[3, 4]</span>
<span class="sd">[[5, 6]]</span>
<span class="sd">[7, 8]</span>
<span class="sd">[[9, 10]]</span>
<span class="sd">[11, 12]</span>
<span class="sd">[[13, 14]]</span>
<span class="sd">[15, 16]</span>
<span class="sd">     ]]</span>
<span class="sd">    &gt;&gt;&gt; output = torch.nn.functional.channel_shuffle(input, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(output)</span>
<span class="sd">    [[[[1, 2],</span>
<span class="sd">[3, 4]</span>
<span class="sd">[[9, 10]]</span>
<span class="sd">[11, 12]</span>
<span class="sd">[[5, 6]]</span>
<span class="sd">[7, 8]</span>
<span class="sd">[[13, 14]]</span>
<span class="sd">[15, 16]</span>
<span class="sd">     ]]</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">原生通道随机</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">本地频道随机打乱</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">native_channel_shuffle(input, groups) -&gt; 张量</span>

<span class="sd">`channel_shuffle`的原生内核级实现。</span>
<span class="sd">此函数可能在未来的版本中变为私有，请谨慎使用。</span>

<span class="sd">将形状为 :math:`(*, C , H, W)` 的张量中的通道进行划分</span>
<span class="sd">将文本分组为 g 组，并重新排列为：(*, C(g), g, H, W)</span>
<span class="sd">保持原始张量形状。</span>

<span class="sd">请参阅：class:`~torch.nn.ChannelShuffle` 以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">groups（整数）：将通道划分成多少组以及重新排列的数目。</span>

<span class="sd">示例::</span>

<span class="sd">    &gt;&gt;&gt; input = torch.randn(1, 4, 2, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(input)</span>
<span class="sd">    [[[[1, 2],</span>
<span class="sd">[3, 4]</span>
<span class="sd">[[5, 6]]</span>
<span class="sd">[7, 8]</span>
<span class="sd">[[9, 10]]</span>
<span class="sd">[11, 12]</span>
<span class="sd">[[13, 14]]</span>
<span class="sd">[15, 16]</span>
<span class="sd">     ]]</span>
<span class="sd">    &gt;&gt;&gt; output = torch.nn.functional.native_channel_shuffle(input, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(output)</span>
<span class="sd">    [[[[1, 2],</span>
<span class="sd">[3, 4]</span>
<span class="sd">[[9, 10]]</span>
<span class="sd">[11, 12]</span>
<span class="sd">[[5, 6]]</span>
<span class="sd">[7, 8]</span>
<span class="sd">[[13, 14]]</span>
<span class="sd">[15, 16]</span>
<span class="sd">     ]]</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
    <span class="k">通过</span>


<div class="viewcode-block" id="upsample"><a class="viewcode-back" href="../../../generated/torch.nn.functional.upsample.html#torch.nn.functional.upsample">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="o">=</span><span class="kc">无</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">上采样输入。</span>

<span class="sd">提供的张量被上采样到给定的 :attr:`size` 或给定的</span>
<span class="sd">使用哪种插值算法由 :attr:`mode` 决定。</span>

<span class="sd">.. 警告::</span>
<span class="sd">此函数已被弃用，推荐使用 :func:`torch.nn.functional.interpolate`。</span>
<span class="sd">这与 ``nn.functional.interpolate(...)`` 等效。</span>

<span class="sd">注意：</span>
<span class="sd">        {backward_reproducibility_note}</span>

<span class="sd">上采样所使用的算法由 :attr:`mode` 决定。</span>

<span class="sd">目前支持时间、空间和体积上采样，即</span>
<span class="sd">预期输入形状为 3-D、4-D 或 5-D。</span>

<span class="sd">输入维度以以下形式解释：</span>
<span class="sd">`批大小 x 通道 x [可选深度] x [可选高度] x 宽度`。</span>

<span class="sd">可用的上采样模式有：`最近邻`、`线性`（仅 3D）、</span>
<span class="sd">`双线性`、`双三次`（仅 4D）、`三线性`（仅 5D）</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">大小（int 或 Tuple[int]或 Tuple[int, int]或 Tuple[int, int, int]）：</span>
<span class="sd">输出空间大小。</span>
<span class="sd">scale_factor (浮点数或浮点数元组): 空间大小的乘数。如果是一个元组，必须与输入大小匹配。</span>
<span class="sd">mode (字符串): 用于上采样的算法：</span>
<span class="sd">            ``'nearest'`` | ``'linear'`` | ``'bilinear'`` | ``'bicubic'`` |</span>
<span class="sd">``'trilinear'``。默认值：``'nearest'``</span>
<span class="sd">align_corners (bool, 可选): 几何上，我们将输入和输出的像素视为正方形而不是点。</span>
<span class="sd">            input and output as squares rather than points.</span>
<span class="sd">如果设置为 ``True``，输入和输出张量将根据其角落像素的中心点对齐，保留角落像素的值。</span>
<span class="sd">如果设置为 ``True``，输入和输出张量将根据其角落像素的中心点对齐，保留角落像素的值。</span>
<span class="sd">如果设置为 ``False``，输入和输出张量将根据其角像素的角点对齐，并且插值使用边缘值填充。</span>
<span class="sd">如果设置为 ``False``，输入和输出张量将根据其角像素的角点对齐，并且插值使用边缘值填充。</span>
<span class="sd">对于超出边界值，使此操作与输入大小无关</span>
<span class="sd">当保持 :attr:`scale_factor` 不变时。这仅在 :attr:`mode`</span>
<span class="sd">是 ``'线性'``、``'双线性'``、``'双三次'`` 或 ``'三线性'``。</span>
<span class="sd">默认：``False``</span>

<span class="sd">.. 注意::</span>
<span class="sd">使用 ``mode='双三次'`` 可能会导致溢出，换句话说，它可能会产生</span>
<span class="sd">负值或大于 255 的值，对于图像。</span>
<span class="sd">如果您想减少溢出，请显式调用 ``result.clamp(min=0, max=255)``。</span>
<span class="sd">。</span>

<span class="sd">.. 警告::</span>
<span class="sd">使用 `align_corners = True` 时，线性插值模式（`linear`、`bilinear` 和 `trilinear`）不会按比例对齐输出和输入像素，因此输出值可能取决于输入大小。这些模式在此版本之前默认就是这样。</span>
<span class="sd">这意味着输出和输入像素的比例关系不匹配，因此输出值可能取决于输入大小。</span>
<span class="sd">这意味着输出和输入像素的比例关系不匹配，因此输出值可能取决于输入大小。</span>
<span class="sd">这意味着输出和输入像素的比例关系不匹配，因此输出值可能取决于输入大小。</span>
<span class="sd">0.3.1. 从那时起，默认行为是 `align_corners = False`。</span>
<span class="sd">请参阅 :class:`~torch.nn.Upsample` 以获取具体示例。</span>
<span class="sd">这会影响输出。</span>

<span class="sd">"文档"</span>
    <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
        <span class="s2">"`nn.functional.upsample` 已弃用。"</span>
        <span class="s2">"请使用 `nn.functional.interpolate` 代替。"</span><span class="p">,</span>
        <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">interpolate</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">)</span></div>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</font></font></font></span><span class="p">(</span><span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_是整数</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">布尔</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">检查输入数字是否为整数。</span>

<span class="sd">对于 int、SymInt、Numpy 整数和具有整数元素的 Tensors，将返回 True。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">SymInt</span><span class="p">)):</span>
        <span class="k">返回</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
    <span class="k">如果</font></font></font></span> <span class="n">np</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">numpy</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
    <span class="k">返回</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</span> <span class="n">x</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">()</span>


<span class="nd">@_overload</span>
<span class="k">定义</span> <span class="nf">interpolate</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">重新计算缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">抗锯齿</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</span> <span class="nf">interpolate</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">重新计算缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">抗锯齿</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</span> <span class="nf">interpolate</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">重新计算缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">抗锯齿</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</span> <span class="nf">interpolate</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">重新计算缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">抗锯齿</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<div class="viewcode-block" id="interpolate"><a class="viewcode-back" href="../../../generated/torch.nn.functional.interpolate.html#torch.nn.functional.interpolate">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">interpolate</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">重新计算缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">抗锯齿</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</font></font></font></span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 无需注意：B950</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">对输入进行下/上采样。</span>

<span class="sd">张量插值到给定的 :attr:`size` 或给定的 :attr:`scale_factor`。</span>
<span class="sd">使用哪种插值算法由 :attr:`mode` 决定。</span>

<span class="sd">算法用于插值的算法由 :attr:`mode` 决定。</span>

<span class="sd">目前支持时间、空间和体积采样，即</span>
<span class="sd">预期输入形状为 3-D、4-D 或 5-D。</span>

<span class="sd">输入维度以以下形式解释：</span>
<span class="sd">`批大小 x 通道 x [可选深度] x [可选高度] x 宽度`。</span>

<span class="sd">可用的缩放模式有：`最近邻`、`线性`（仅 3D）、</span>
<span class="sd">`双线性`、`双三次`（仅 4D）、`三线性`（仅 5D）、`区域`、`最近邻精确`</span>

<span class="sd">参数：</span>
<span class="sd">输入（张量）：输入张量</span>
<span class="sd">大小（int 或 Tuple[int]或 Tuple[int, int]或 Tuple[int, int, int]）：</span>
<span class="sd">输出空间大小。</span>
<span class="sd">scale_factor (浮点数或浮点数元组): 空间大小的乘数。如果 `scale_factor` 是元组，其长度必须与空间维度数匹配；`input.dim() - 2`。</span>
<span class="sd">其长度必须与空间维度数匹配；`input.dim() - 2`。</span>
<span class="sd">mode (字符串): 用于上采样的算法：</span>
<span class="sd">            ``'nearest'`` | ``'linear'`` | ``'bilinear'`` | ``'bicubic'`` |</span>
<span class="sd">``'trilinear'`` | ``'area'`` | ``'nearest-exact'``. 默认: ``'nearest'``</span>
<span class="sd">align_corners (bool, 可选): 几何上，我们将输入和输出的像素视为正方形而不是点。</span>
<span class="sd">            input and output as squares rather than points.</span>
<span class="sd">如果设置为 ``True``，输入和输出张量将根据其角落像素的中心点对齐，保留角落像素的值。</span>
<span class="sd">如果设置为 ``True``，输入和输出张量将根据其角落像素的中心点对齐，保留角落像素的值。</span>
<span class="sd">如果设置为 ``False``，输入和输出张量将根据其角像素的角点对齐，并且插值使用边缘值填充。</span>
<span class="sd">如果设置为 ``False``，输入和输出张量将根据其角像素的角点对齐，并且插值使用边缘值填充。</span>
<span class="sd">对于超出边界值，使此操作与输入大小无关</span>
<span class="sd">当保持 :attr:`scale_factor` 不变时。这仅在 :attr:`mode`</span>
<span class="sd">是 ``'线性'``、``'双线性'``、``'双三次'`` 或 ``'三线性'``。</span>
<span class="sd">默认：``False``</span>
<span class="sd">recompute_scale_factor (布尔值，可选)：重新计算 scale_factor 以用于</span>
<span class="sd">插值计算。如果 `recompute_scale_factor` 为 `True`，则</span>
<span class="sd">`scale_factor` 必须传入，并使用 `scale_factor` 来计算</span>
<span class="sd">输出 `size`。计算得到的输出 `size` 将用于推断插值的新尺度</span>
<span class="sd">注意，当 `scale_factor` 为浮点数时，它可能不同</span>
<span class="sd">由于四舍五入和精度问题，重新计算的 `scale_factor`。</span>
<span class="sd">如果 `recompute_scale_factor` 为 ``False``，则直接使用 `size` 或 `scale_factor` 进行插值。默认：``None``。</span>
<span class="sd">抗锯齿（bool，可选）：应用抗锯齿的标志。默认：``False``。使用抗锯齿</span>
<span class="sd">(bool, 可选): 应用抗锯齿的标志。默认：``False``。使用抗锯齿</span>
<span class="sd">与 `align_corners=False` 选项一起，插值结果将与 Pillow 相匹配</span>
<span class="sd">下采样操作的输出结果。支持的模式：`'bilinear'`、`'bicubic'`</span>

<span class="sd">.. 注意::</span>
<span class="sd">使用 ``mode='双三次'`` 可能会导致溢出，换句话说，它可能会产生</span>
<span class="sd">负值或大于 255 的值，对于图像。</span>
<span class="sd">如果您想减少溢出，请显式调用 ``result.clamp(min=0, max=255)``。</span>
<span class="sd">。</span>

<span class="sd">.. 注意::</span>
<span class="sd">模式 `mode='nearest-exact'` 与 Scikit-Image 和 PIL 的最近邻插值算法相匹配</span>
<span class="sd">并修复了 `mode='nearest'` 的已知问题。此模式被引入以保持</span>
<span class="sd">向后兼容。</span>
<span class="sd">模式 `mode='nearest'` 与有缺陷的 OpenCV 的 `INTER_NEAREST` 插值算法匹配。</span>

<span class="sd">.. 注意::</span>
<span class="sd">在 CUDA 上，对于 `float16` 数据类型的梯度在上采样操作中可能不准确。</span>
<span class="sd">当使用模式 `['linear', 'bilinear', 'bicubic', 'trilinear', 'area']` 时。</span>
<span class="sd">更多详情，请参阅讨论内容</span>
<span class="sd">issue#104157 _.</span>

<span class="sd">注意：</span>
<span class="sd">        {backward_reproducibility_note}</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">interpolate</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</span><span class="p">,),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">尺寸</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">,</span>
            <span class="n">缩放因子</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">,</span>
            <span class="n">模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">,</span>
            <span class="n">align_corners</span><span class="o">=</span><span class="n">align_corners</span><span class="p">,</span>
            <span class="n">重新计算缩放因子</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重新计算缩放因子</span><span class="p">,</span>
            <span class="n">抗锯齿</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">抗锯齿</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面积</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"最近邻精确"</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"“对齐角点”选项只能与以下内容一起设置"</span>
                <span class="s2">"插值模式：线性 | 双线性 | 双三次 | 三线性"</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">对齐角落</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

    <span class="n">维度</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 空间维度数量。</span>

    <span class="c1">处理大小和 scale_factor。验证是否恰好设置了一个。</span>
    <span class="c1">如果它是列表，则验证其长度；如果是标量，则扩展它。</span>
    <span class="c1">在此块之后，output_size 和 scale_factors 中恰好有一个非 None，并且它将是一个列表（或元组）。</span>
    <span class="c1">将非 None 值设为列表（或元组）。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"仅应定义大小或缩放因子之一"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="n">缩放系数</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">)):</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">)</span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"输入和输出必须具有相同的空间维度，但得到了 "</span>
                    <span class="sa">f</span><span class="s2">"具有空间维度的输入 "</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">并且输出大小为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. </span>
                    <span class="s2">"请提供输入张量，格式为 (N, C, d1, d2, ...,dK) "</span>
                    <span class="s2">"以(o1, o2, ...,oK)格式输出大小。"</span>
                <span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
                <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">所有</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_是整数</font></font></font></span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">类型错误</span><span class="p">(</span>
                        <span class="s2">"期望大小为 int 或 Tuple[int] 或 Tuple[int, int] 或 Tuple[int, int, int]，但得到的大小类型为"</span>
                        <span class="sa">f</span><span class="s2">"但得到的大小类型为"</font></font></font></span><span class="si">{</span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
            <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">大小</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">大小</font></font></font></span> <span class="k">for</span> <span class="n">_</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">缩放系数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="n">输出大小</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">)):</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="p">)</span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"输入和 scale_factor 必须具有相同的空间维度，但"</span>
                    <span class="sa">f</span><span class="s2">"得到了具有以下空间维度的输入"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</span>
                    <span class="sa">f</span><span class="s2">形状的 scale_factor</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. </span>
                    <span class="s2">"请提供输入张量，格式为 (N, C, d1, d2, ...,dK) "</span>
                    <span class="s2">"尺度因子格式为 (s1, s2, ...,sK) 。"</span>
                <span class="p">)</span>
            <span class="n">缩放系数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">缩放系数</font></font></font></span> <span class="o">=</span> <span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</font></font></font></span> <span class="k">for</span> <span class="n">_</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"大小或 scale_factor 必须定义"</span><span class="p">)</span>

    <span class="k">如果</span> <span class="p">(</span>
        <span class="n">recompute_scale_factor</span> <span class="ow">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="ow">和</span> <span class="n">recompute_scale_factor</span>
        <span class="ow">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"在显式大小的情况下，重新计算 scale_factor 没有意义。"</span>
        <span class="p">)</span>

    <span class="c1">"区域"模式始终需要显式的大小而不是缩放因子。</span>
    <span class="c1">重新使用 recompute_scale_factor 代码路径。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面积</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">recompute_scale_factor</span> <span class="o">=</span> <span class="kc">真实</span>

    <span class="k">如果</font></font></font></span> <span class="n">recompute_scale_factor</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重新计算缩放因子</span><span class="p">:</span>
        <span class="c1">我们在这里计算输出大小，然后取消设置缩放因子。</span>
        <span class="c1">C++代码将根据（整数）输出大小重新计算它。</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取追踪状态</span><span class="p">():</span>
            <span class="c1">在跟踪时将 scale_factor 转换为张量，以便常量不会烘焙进去</span>
            <span class="n">输出大小</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">torch</span><span class="o">.</span><span class="n">向下取整</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
                            <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">张量</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="p">[</span><span class="n">i</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">torch</span><span class="o">.</span><span class="n">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
            <span class="n">输出大小</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">整数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向下取整</font></font></font></span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">输出大小</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">_sym_int</span><span class="p">(</span><span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</font></font></font></span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">范围</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="n">缩放系数</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">抗锯齿</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双三次</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">抗锯齿选项仅限于双线性双三次模式，并需要 4 维张量作为输入</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">上采样最近邻 1D</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">upsample_nearest2d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻上采样 3D</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"最近邻精确"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">_upsample_nearest_exact1d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"最近邻精确"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_最近邻精确 2d 上采样</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"最近邻精确"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">_upsample_nearest_exact3d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面积</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">返回</font></font></font></span> <span class="n">adaptive_avg_pool1d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面积</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">返回</font></font></font></span> <span class="n">adaptive_avg_pool2d</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面积</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出大小</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自适应平均池化 3D</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">upsample_linear1d（线性 1D 上采样）</span><span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">抗锯齿</span><span class="p">:</span>
            <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">_upsample_bilinear2d_aa</span><span class="p">(</span>
                <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
            <span class="p">)</span>
        <span class="c1"># 两个级别是必要的，以防止 TorchScript 触及</span>
        <span class="c1"># are_deterministic_algorithms_enabled.</span>
        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否启用了确定性算法</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</span> <span class="p">(</span>
                <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n">is_cuda</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是_xpu</span>
            <span class="p">):</span>
                <span class="c1"># 使用慢速反编译，其反向操作将涉及 index_put</span>
                <span class="c1"># 需要 importlib，因为导入不能是顶层</span>
                <span class="c1"># （循环）且不能嵌套（TS 不支持）</span>
                <span class="k">返回</font></font></font></span> <span class="n">importlib</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入模块</span><span class="p">(</span>
                    <span class="s2">torch._decomp.分解</span>
                <span class="p">)</span><span class="o">.</span><span class="n">_上采样线性向量</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放因子</span><span class="p">)</span>
        <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">upsample_bilinear2d</span><span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三线性</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三线性上采样 3D</span><span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双三次</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">抗锯齿</span><span class="p">:</span>
            <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">_upsample_bicubic2d_aa</span><span class="p">(</span>
                <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
            <span class="p">)</span>
        <span class="k">返回</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">upsample_bicubic2d</span><span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩放系数</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"输入为 3D，但双线性模式需要 4D 输入"</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"收到 3D 输入，但三线性模式需要 5D 输入"</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"收到 4D 输入，但线性模式需要 3D 输入"</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"输入为 4D，但三线性模式需要 5D 输入"</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"输入为 5D，但线性模式需要 3D 输入"</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"输入为 5D，但双线性模式需要 4D 输入"</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">不支持的操作异常</span><span class="p">(</span>
        <span class="s2">"输入错误：仅支持 3D、4D 和 5D 输入张量"</span>
        <span class="sa">f</span><span class="s2">"（获取了"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">D）对于模式：最近邻 | 线性 | 双线性 | 双三次 | 三线性 | 面积 | 最近邻精确</span>
        <span class="sa">f</span><span class="s2">"（获取了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="si">}</span><span class="s2">)"</span>
    <span class="p">)</span></div>


<span class="k">如果</span> <span class="n">interpolate</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">interpolate</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">格式</font></font></font></span><span class="p">(</span><span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</span><span class="p">)</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<div class="viewcode-block" id="upsample_nearest"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def upsample_nearest(input, size=None, scale_factor=None):  # noqa: F811
r"""使用最近邻像素值上采样输入。"""

.. 警告::
此函数已被弃用，建议使用 :func:`torch.nn.functional.interpolate`。
这与 `nn.functional.interpolate(..., mode='nearest')` 等价。

目前支持空间和体积上采样（即输入应为 4 或 5 维）。
输入是 4 或 5 维）。

参数：
输入（张量）：输入
大小（int 或 Tuple[int, int] 或 Tuple[int, int, int]）：输出空间
大小。
scale_factor（int）：空间大小的乘数。必须是一个整数。

备注：
{向后可重现性备注}
"""
默认情况下忽略 DeprecationWarning 警告
warnings.warn(
"``nn.functional.upsample_nearest`` 已弃用。"
"请使用 ``nn.functional.interpolate`` 代替。"
stacklevel=2,
    )
返回 interpolate(input, size, scale_factor, mode="nearest")</font></font></font></div>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻上采样</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">最近邻上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</font></font></font></span><span class="p">(</span><span class="o">**</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可复现性说明</span><span class="p">)</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</span><span class="p">(</span>  <span class="c1"># noqa: F811</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">缩放因子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
    <span class="k">通过</span>


<div class="viewcode-block" id="upsample_bilinear"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def upsample_bilinear(input, size=None, scale_factor=None):  # noqa: F811
r"""对输入进行上采样，使用双线性上采样。

.. 警告::
该函数已被弃用，建议使用 :func:`torch.nn.functional.interpolate`。
这与等效
``nn.functional.interpolate(..., mode='bilinear', align_corners=True)``.

预期输入是空间（4 维）。使用 `upsample_trilinear` 对
体积（5 维）输入。

Args:
输入 (Tensor): 输入
大小 (int 或 Tuple[int, int]): 输出空间大小。
scale_factor (int 或 Tuple[int, int]): 空间大小的乘数

备注：
{向后可重现性备注}
"""
默认情况下忽略 DeprecationWarning 警告
warnings.warn(
"``nn.functional.upsample_bilinear`` 已弃用。"
"请使用 ``nn.functional.interpolate`` 代替。"
stacklevel=2,
    )
return interpolate(input, size, scale_factor, mode="bilinear", align_corners=True)</font></font></font></div>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">双线性上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性上采样</font></font></font></span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</span>
    <span class="p">)</span>

<span class="n">网格采样插值模式</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">双线性</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">最近邻</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">双三次</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">网格样本填充模式</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">零</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">边界</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">反射</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="grid_sample"><a class="viewcode-back" href="../../../generated/torch.nn.functional.grid_sample.html#torch.nn.functional.grid_sample">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">网格采样</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">网格</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</span><span class="p">,</span>
    <span class="n">填充模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">零</span><span class="p">,</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">计算网格样本。</span>

<span class="sd">给定一个 :attr:`输入` 和一个流场 :attr:`网格`，使用 :attr:`输入` 值和 :attr:`网格` 中的像素位置计算 ``输出``。</span>
<span class="sd">目前，仅支持空间（4-D）和体积（5-D）:attr:`输入`。</span>

<span class="sd">目前，仅支持空间（4-D）和体积（5-D）:attr:`输入`。</span>
<span class="sd">不支持。</span>

<span class="sd">在空间（4-D）情况下，对于形状为 :attr:`input` 的 :math:`(N, C, H_\text{in}, W_\text{in})` 和形状为 :attr:`grid` 的 :math:`(N, H_\text{out}, W_\text{out}, 2)`，输出将具有形状</span>
<span class="sd">math:`(N, H_\text{out}, W_\text{out})`。</span>
<span class="sd">math:`(N, C, H_\text{out}, W_\text{out})`。</span>
<span class="sd">math:`(N, C, H_\text{out}, W_\text{out})`。</span>

<span class="sd">对于每个输出位置 `output[n, :, h, w]`，大小为 2 的向量</span>
<span class="sd">`grid[n, h, w]` 指定了 :attr:`input` 像素位置 `x` 和 `y`，</span>
<span class="sd">这些位置用于插值输出值 `output[n, :, h, w]`。</span>
<span class="sd">对于 5D 输入，`grid[n, d, h, w]` 指定了</span>
<span class="sd">``x``、``y``、``z`` 像素位置用于插值</span>
<span class="sd">``output[n, :, d, h, w]``。:attr:`mode` 参数指定 ``nearest`` 或</span>
<span class="sd">``bilinear`` 插值方法来采样输入像素。</span>

<span class="sd">attr:`grid` 指定采样像素位置，按归一化处理</span>
<span class="sd">输入的：attr:`input` 空间维度。因此，它应该具有大多数值在</span>
<span class="sd">范围 ``[-1, 1]`` 内。例如，值 ``x = -1, y = -1`` 是：attr:`input` 的</span>
<span class="sd">左上像素，而值 ``x = 1, y = 1`` 是：attr:`input` 的</span>
<span class="sd">右下像素。</span>

<span class="sd">如果 :attr:`grid` 的值超出 ``[-1, 1]`` 范围</span>
<span class="sd">输出处理方式由 :attr:`padding_mode` 定义。选项有</span>

<span class="sd">* ``padding_mode="zeros"``: 使用 ``0`` 对越界网格位置进行填充</span>
<span class="sd">* ``padding_mode="border"``: 使用边界值处理超出网格范围的网格位置，</span>
<span class="sd">* ``padding_mode="reflection"``: 使用边界反射的值</span>
<span class="sd">边界外的网格位置。对于远离边界的位置，</span>
<span class="sd">它将不断反射，直到变为边界内，例如，（归一化）像素位置 ``x = -3.5`` 通过边界 ``-1`` 反射</span>
<span class="sd">，例如，（归一化）像素位置 ``x = -3.5`` 通过边界 ``-1`` 反射</span>
<span class="sd">然后通过边界“1”反射变为“x' = 1.5”</span>
<span class="sd">“x'' = -0.5”</span>

<span class="sd">注意：</span>
<span class="sd">此函数通常与：func:`affine_grid`一起使用</span>
<span class="sd">构建空间变换网络_。</span>

<span class="sd">注意：</span>
<span class="sd">使用 CUDA 后端时，此操作可能引起非确定性</span>
<span class="sd">行为在其反向传播中不易关闭。</span>
<span class="sd">请参阅：doc:`/notes/randomness` 中的笔记以获取背景信息。</span>

<span class="sd">注意：</span>
<span class="sd">在 :attr:`grid` 中的 NaN 值将被解释为 ``-1``。</span>

<span class="sd">参数：</span>
<span class="sd">输入 (Tensor)：形状为 :math:`(N, C, H_\text{in}, W_\text{in})` 的输入 (4-D 情况)</span>
<span class="sd">或 :math:`(N, C, D_\text{in}, H_\text{in}, W_\text{in})` (5-D 情况)</span>
<span class="sd">grid (Tensor)：形状为 :math:`(N, H_\text{out}, W_\text{out}, 2)` 的流场 (4-D 情况)</span>
<span class="sd">或 :math:`(N, D_\text{out}, H_\text{out}, W_\text{out}, 3)` (5-D 情况)</span>
<span class="sd">模式 (str)：计算输出值的插值模式</span>
<span class="sd">``'bilinear'`` | ``'nearest'`` | ``'bicubic'``. 默认: ``'bilinear'`</span>
<span class="sd">注意：``mode='bicubic'`` 只支持 4-D 输入。</span>
<span class="sd">当`mode='bilinear'`且输入为 5-D 时，插值模式</span>
<span class="sd">实际上在内部使用将是三线性。然而，当输入是 4-D 时，</span>
<span class="sd">插值模式将合法地是双线性。</span>
<span class="sd">padding_mode (str): 用于外部网格值的填充模式</span>
<span class="sd">``'zeros'`` | ``'border'`` | ``'reflection'``. 默认: ``'zeros'``</span>
<span class="sd">align_corners (bool, 可选): 几何上，我们将输入和输出的像素视为正方形而不是点。</span>
<span class="sd">input 作为正方形而不是点。</span>
<span class="sd">如果设置为 ``True``，则极值（``-1`` 和 ``1``）被视为引用</span>
<span class="sd">将其设置为 ``False`` 时，则被视为指向输入的角像素的角点。</span>
<span class="sd">否则，它们被视为指向输入的角像素的角点。</span>
<span class="sd">这样可以使采样更加分辨率无关。</span>
<span class="sd">此选项与 ``align_corners`` 选项相对应。</span>
<span class="sd">func:`interpolate`，因此这里使用哪个选项</span>
<span class="sd">应该在那里也使用它来在网格采样之前调整输入图像的大小。</span>
<span class="sd">默认：``False``</span>

<span class="sd">返回：</span>
<span class="sd">输出（张量）：输出张量</span>

<span class="sd">.. _`空间变换网络`:</span>
<span class="sd">        https://arxiv.org/abs/1506.02025</span>

<span class="sd">.. 警告::</span>
<span class="sd">当 ``align_corners = True`` 时，网格位置取决于像素</span>
<span class="sd">输入图像大小的相对大小，因此在不同分辨率下（即放大或缩小后）采样的位置将不同</span>
<span class="sd">func:`grid_sample` 的结果将因输入分辨率的不同而不同</span>
<span class="sd">（即，在放大或缩小后）。版本 1.2.0 之前的默认行为是 ``align_corners = True``。</span>
<span class="sd">版本 1.2.0 之前的默认行为是 ``align_corners = True``。</span>
<span class="sd">自那时起，默认行为已更改为 `align_corners = False`，</span>
<span class="sd">以使其与 :func:`interpolate` 的默认值保持一致。</span>

<span class="sd">.. 注意::</span>
<span class="sd">``mode='bicubic'`` 使用 `三次卷积算法`_，其中 :math:`\alpha=-0.75`。</span>
<span class="sd">常数 :math:`\alpha` 在不同的包中可能会有所不同。</span>
<span class="sd">例如，`PIL`_ 和 `OpenCV`_ 分别使用 -0.5 和 -0.75。</span>
<span class="sd">此算法可能会“超出”其插值值范围的限制。</span>
<span class="sd">例如，当对输入值[0, 255]进行插值时，可能会产生负值或大于 255 的值。</span>
<span class="sd">使用 :func:`torch.clamp` 函数对结果进行钳位，以确保它们在有效范围内。</span>
<span class="sd">.. _`三次卷积算法`: https://zh.wikipedia.org/wiki/Bicubic_interpolation</span>
<span class="sd">    .. _`PIL`: https://github.com/python-pillow/Pillow/blob/4634eafe3c695a014267eefdce830b4a825beed7/src/libImaging/Resample.c#L51</span>
<span class="sd">    .. _`OpenCV`: https://github.com/opencv/opencv/blob/f345ed564a06178670750bad59526cfa4033be55/modules/imgproc/src/resize.cpp#L908</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">网格</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">网格采样</span><span class="p">,</span>
            <span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">网格</span><span class="p">),</span>
            <span class="nb">输入</span><span class="p">,</span>
            <span class="n">网格</span><span class="p">,</span>
            <span class="n">模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">,</span>
            <span class="n">填充模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充模式</span><span class="p">,</span>
            <span class="n">align_corners</span><span class="o">=</span><span class="n">align_corners</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双三次</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">nn.functional.grid_sample()：期望模式为 'bilinear'、'nearest' 或 'bicubic'，但得到：'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
        <span class="p">)</span>
    <span class="k">如果</span> <span class="p">(</span>
        <span class="n">填充模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"零"</span>
        <span class="ow">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"边界"</span>
        <span class="ow">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">反射</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"nn.functional.grid_sample(): 预期填充模式 "</span>
            <span class="s2">"应为 'zeros'、'border' 或 'reflection'，"</span>
            <span class="sa">f</span><span class="s2">但是得到了: '</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充模式</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">双线性</span><span class="p">:</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最近邻</span><span class="p">:</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># mode == 'bicubic'</span>
        <span class="n">模式枚举</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">零</span><span class="p">:</span>
        <span class="n">填充模式枚举</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">填充模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">边界</span><span class="p">:</span>
        <span class="n">填充模式枚举</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># 填充模式 == '反射'</span>
        <span class="n">填充模式枚举</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="s2">"默认的 grid_sample 和 affine_grid 行为已更改"</span>
            <span class="s2">"自 1.3.0 版本起更改为 align_corners=False。请指定"</span>
            <span class="s2">"如果需要旧的行为，请指定 align_corners=True。"</span>
            <span class="s2">"查看 grid_sample 的文档以获取详细信息。"</span>
        <span class="p">)</span>
        <span class="n">对齐角落</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">网格采样器</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">网格</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式枚举</span><span class="p">,</span> <span class="n">padding_mode_enum</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">)</span></div>


<div class="viewcode-block" id="affine_grid"><a class="viewcode-back" href="../../../generated/torch.nn.functional.affine_grid.html#torch.nn.functional.affine_grid">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">affine_grid</span><span class="p">(</span>
    <span class="n">西塔</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">尺寸</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">align_corners</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">根据给定的仿射矩阵批处理：attr:`theta`，生成 2D 或 3D 流场（采样网格）。</span>

<span class="sd">.. 注意::</span>
<span class="sd">此函数通常与：func:`grid_sample`一起使用。</span>
<span class="sd">构建空间变换网络_。</span>

<span class="sd">参数：</span>
<span class="sd">theta (张量)：输入的仿射矩阵批次，形状为</span>
<span class="sd">(:math:`N \times 2 \times 3`) 用于 2D 或</span>
<span class="sd">(:math:`N \times 3 \times 4`) 用于 3D</span>
<span class="sd">size (torch.Size)：目标输出图像大小。</span>
<span class="sd">(:math:`N \times C \times H \times W` 对于 2D 或</span>
<span class="sd">math:`N \times C \times D \times H \times W` 对于 3D)</span>
<span class="sd">示例：torch.Size((32, 3, 24, 24))</span>
<span class="sd">align_corners (bool, 可选): 如果为 ``True``，则将 ``-1`` 和 ``1``</span>
<span class="sd">解释为角落像素的中心，而不是图像的角落。</span>
<span class="sd">请参阅 :func:`grid_sample` 获取更完整的描述。</span>
<span class="sd">由 :func:`affine_grid` 生成的网格应传递给 :func:`grid_sample`</span>
<span class="sd">使用相同的设置选项。</span>
<span class="sd">默认：``False``</span>

<span class="sd">返回：</span>
<span class="sd">输出（张量）：大小为 (:math:`N \times H \times W \times 2`) 的输出张量</span>

<span class="sd">.. _`空间变换网络`:</span>
<span class="sd">        https://arxiv.org/abs/1506.02025</span>

<span class="sd">.. 警告::</span>
<span class="sd">当 ``align_corners = True`` 时，网格位置取决于像素</span>
<span class="sd">输入图像大小的相对大小，因此在不同分辨率下（即放大或缩小后）采样的位置将不同</span>
<span class="sd">func:`grid_sample` 的结果将因输入分辨率的不同而不同</span>
<span class="sd">（即，在放大或缩小后）。版本 1.2.0 之前的默认行为是 ``align_corners = True``。</span>
<span class="sd">版本 1.2.0 之前的默认行为是 ``align_corners = True``。</span>
<span class="sd">自那时起，默认行为已更改为 `align_corners = False`，</span>
<span class="sd">以使其与 :func:`interpolate` 的默认值保持一致。</span>
<span class="sd">.. 警告::</span>
<span class="sd">当 `align_corners = True` 时，对 1D 数据进行 2D 仿射变换以及</span>
<span class="sd">对 2D 数据进行 3D 仿射变换（即当其中一个空间维度</span>
<span class="sd">维度具有单位大小）是不明确的，也不是预期的用例。</span>
<span class="sd">当 `align_corners = False` 时，这不是问题。</span>
<span class="sd">在版本 1.2.0 之前，单位维度上的所有网格点都被任意地认为是 `-1`。</span>
<span class="sd">被任意地认为是 `-1`。</span>
<span class="sd">从版本 1.3.0 开始，在`align_corners = True`的情况下，所有网格点</span>
<span class="sd">沿着单位维度被认为是“0”</span>
<span class="sd">(输入图像的中心)。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">affine_grid</span><span class="p">,</span> <span class="p">(</span><span class="n">西塔</font></font></font></span><span class="p">,),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="s2">"默认的 grid_sample 和 affine_grid 行为已更改"</span>
            <span class="s2">"自 1.3.0 版本起更改为 align_corners=False。请指定"</span>
            <span class="s2">"如果需要旧的行为，请指定 align_corners=True。"</span>
            <span class="s2">"查看 grid_sample 的文档以获取详细信息。"</span>
        <span class="p">)</span>
        <span class="n">对齐角落</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

    <span class="c1"># 在 theta 上强制使用浮点数据类型</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">预期 theta 为浮点类型，但得到了</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="c1"># 检查形状和大小是否匹配</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">预期一个形状为 Nx2x3 的 2D 仿射矩阵的批次大小</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.得到了</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
            <span class="p">)</span>
        <span class="n">空间大小</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 空间维度大小</span>
    <span class="k">elif</span> <span class="nb">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">预期一个形状为 Nx3x4 的 3D 仿射矩阵批次</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.得到了</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
            <span class="p">)</span>
        <span class="n">空间大小</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 空间维度大小</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</span><span class="p">(</span>
            <span class="s2">"仿射网格仅支持 4D 和 5D 大小，"</span>
            <span class="s2">"分别对应 2D 和 3D 仿射变换。"</span>
            <span class="sa">f</span><span class="s2">"获取大小"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
        <span class="p">)</span>
    <span class="c1"># 检查空跨度</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对齐角落</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小</span><span class="p">(</span><span class="n">spatial_size</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
            <span class="s2">"自版本 1.3.0 起，affine_grid 的行为已更改"</span>
            <span class="s2">"当 align_corners=True 时，对于单位大小的网格。"</span>
            <span class="s2">"这不是 affine_grid 的预期用途。"</span>
            <span class="s2">"请参阅 affine_grid 的文档以获取详细信息。"</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">最小</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≤</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"期望输出大小非零且为正。得到"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性网格生成器</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">西塔</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">,</span> <span class="n">align_corners</span><span class="p">)</span></div>


<div class="viewcode-block" id="pad"><a class="viewcode-back" href="../../../generated/torch.nn.functional.pad.html#torch.nn.functional.pad">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">(</span>
    <span class="nb">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">填充</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">常数</span><span class="p">,</span>
    <span class="n">值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">    pad(input, pad, mode="constant", value=None) -&gt; Tensor</span>

<span class="sd">填充张量。</span>

<span class="sd">填充大小：</span>
<span class="sd">通过填充大小来填充：attr:`input`的一些维度</span>
<span class="sd">从最后一个维度开始描述，向前移动。</span>
<span class="sd">math:`\left\lfloor\frac{\text{len(pad)}}{2}\right\rfloor` 维度</span>
<span class="sd">的 `input` 将会被填充。</span>
<span class="sd">例如，如果要只填充输入张量的最后一个维度，那么</span>
<span class="sd">`:attr:`pad` 的形式是`</span>
<span class="sd">`(:math:`(\text{padding\_left}, \text{padding\_right})`)`;`</span>
<span class="sd">为了填充输入张量的最后两个维度，然后使用`</span>
<span class="sd">`padding_left`, `padding_right`,`</span>
<span class="sd">`padding_top`, `padding_bottom`)`;</span>
<span class="sd">要填充最后三个维度，请使用</span>
<span class="sd">`padding_left`, `padding_right`,`</span>
<span class="sd">`padding_top`, `padding_bottom`</span>
<span class="sd">`padding_front, padding_back)`。</span>

<span class="sd">填充模式：</span>
<span class="sd">请参阅 :class:`torch.nn.CircularPad2d`, :class:`torch.nn.ConstantPad2d`,</span>
<span class="sd">class:`torch.nn.ReflectionPad2d`, 以及 :class:`torch.nn.ReplicationPad2d`</span>
<span class="sd">关于如何使用每种填充模式的具体示例。</span>
<span class="sd">填充适用于任意维度。环形、复制和反射填充用于填充最后三个维度。</span>
<span class="sd">反射填充被实现用于填充一个张量的最后三个维度。</span>
<span class="sd">4D 或 5D 输入张量，3D 或 4D 输入张量的最后 2 个维度</span>
<span class="sd">或 2D 或 3D 输入张量的最后一个维度。</span>

<span class="sd">注意：</span>
<span class="sd">使用 CUDA 后端时，此操作可能引起非确定性</span>
<span class="sd">行为在其反向传播中不易关闭。</span>
<span class="sd">请参阅：doc:`/notes/randomness` 中的笔记以获取背景信息。</span>

<span class="sd">参数：</span>
<span class="sd">输入（Tensor）：N 维张量</span>
<span class="sd">填充（元组）：m 个元素的元组，其中</span>
<span class="sd">$\frac{m}{2} \leq$ 输入维度且$m$为偶数。</span>
<span class="sd">模式：``'constant'``、``'reflect'``、``'replicate'`` 或 ``'circular'``。</span>
<span class="sd">默认：``'constant'``</span>
<span class="sd">value：用于 ``'constant'`` 填充的填充值。默认：``0``</span>

<span class="sd">示例：</span>

<span class="sd">        &gt;&gt;&gt; t4d = torch.empty(3, 3, 4, 2)</span>
<span class="sd">&gt;&gt;&gt; p1d = (1, 1) # 在最后一个维度两侧各填充 1</span>
<span class="sd">&gt;&gt;&gt; out = F.pad(t4d, p1d, "constant", 0)  # 实际上为零填充</span>
<span class="sd">        &gt;&gt;&gt; print(out.size())</span>
<span class="sd">        torch.Size([3, 3, 4, 4])</span>
<span class="sd">&gt;&gt;&gt; p2d = (1, 1, 2, 2) # 在最后一个维度上填充(1, 1)，在倒数第二个维度上填充(2, 2)</span>
<span class="sd">        &gt;&gt;&gt; out = F.pad(t4d, p2d, "constant", 0)</span>
<span class="sd">        &gt;&gt;&gt; print(out.size())</span>
<span class="sd">        torch.Size([3, 3, 8, 4])</span>
<span class="sd">        &gt;&gt;&gt; t4d = torch.empty(3, 3, 4, 2)</span>
<span class="sd">        &gt;&gt;&gt; p3d = (0, 1, 2, 1, 3, 3) # pad by (0, 1), (2, 1), and (3, 3)</span>
<span class="sd">        &gt;&gt;&gt; out = F.pad(t4d, p3d, "constant", 0)</span>
<span class="sd">        &gt;&gt;&gt; print(out.size())</span>
<span class="sd">        torch.Size([3, 9, 7, 3])</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_unary</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">神经网络</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">功能性</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,),</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
        <span class="k">如果</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否启用了确定性算法</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</span> <span class="p">(</span>
            <span class="nb">输入</font></font></font></span><span class="o">.</span><span class="n">is_cuda</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是_xpu</span>
        <span class="p">):</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制</span><span class="p">:</span>
                <span class="c1">使用慢速反编译，其反向操作将以 index_put 为基准。</span>
                <span class="c1"># 需要 importlib，因为导入不能是顶层</span>
                <span class="c1"># （循环）且不能嵌套（TS 不支持）</span>
                <span class="k">返回</font></font></font></span> <span class="n">importlib</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入模块</span><span class="p">(</span>
                    <span class="s2">torch._decomp.分解</span>
                <span class="p">)</span><span class="o">.</span><span class="n">复制垫</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span></div>


<span class="c1"># TODO: 通过 https://github.com/pytorch/pytorch/issues/75798 修复</span>
<span class="n">填充</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="s2">"torch.nn.functional"</span>

<span class="c1"># 距离</span>


<span class="n">对应距离</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">对距离</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">pairwise_distance(x1, x2, p=2.0, eps=1e-6, keepdim=False) -&gt; 张量</span>

<span class="sd">详细信息请参阅 :class:`torch.nn.PairwiseDistance`</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">pdist</span> <span class="o">=</span> <span class="n">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">pdist</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">计算输入之间的 p 范距离，p=2 时表示欧几里得距离。-&gt; 计算输入之间的 p 范距离，p=2 时表示欧几里得距离</span>

<span class="sd">计算输入中每一对行向量的 p 范数距离。</span>
<span class="sd">这与上三角部分（不包括对角线）相同。</span>
<span class="sd">`torch.norm(input[:, None] - input, dim=2, p=p)`。如果行是连续的，这个函数将会更快。</span>
<span class="sd">如果行是连续的，将会更快。</span>

<span class="sd">如果输入的形状为 :math:`N \times M`，则输出形状将为</span>
<span class="sd">1/2 N (N - 1)</span>

<span class="sd">此函数等同于 `scipy.spatial.distance.pdist(input,`)</span>
<span class="sd">minkowski 距离，p=p)`` 当 :math:`p \in (0, \infty)`。当 :math:`p = 0` 时，它是</span>
<span class="sd">等价于 `scipy.spatial.distance.pdist(input, 'hamming') * M`.</span>
<span class="sd">当 :math:`p = \infty` 时，最接近的 scipy 函数是</span>
<span class="sd">`scipy.spatial.distance.pdist(xn, lambda x, y: np.abs(x - y).max())`.</span>

<span class="sd">参数：</span>
<span class="sd">输入：形状为 :math:`N \times M` 的输入张量。</span>
<span class="sd">p：计算每个向量对之间的 p-范数距离的 p 值</span>
<span class="sd">math:`\in [0, \infty]`。</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">余弦相似度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">余弦相似度</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">cosine_similarity(x1, x2, dim=1, eps=1e-8) -&gt; Tensor</span>

<span class="sd">返回 `x1` 和 `x2` 之间的余弦相似度，沿 dim 计算。`x1` 和 `x2` 必须可广播到公共形状。</span>
<span class="sd">公共形状。`dim` 指的是这个公共形状中的维度。输出维度的 `dim` 被压缩（参见 :func:`torch.squeeze`），结果为</span>
<span class="sd">压缩（参见 :func:`torch.squeeze`），结果为</span>
<span class="sd">输出维度减少 1 的张量。</span>

<span class="sd">.. math ::</span>
<span class="sd">\text{相似度} = \dfrac{x_1 \cdot x_2}{\max(\Vert x_1 \Vert _2, \epsilon) \cdot \max(\Vert x_2 \Vert _2, \epsilon)}</span>

<span class="sd">支持 :ref:`类型提升 `.</span>

<span class="sd">参数：</span>
<span class="sd">x1（张量）：第一个输入。</span>
<span class="sd">x2（张量）：第二个输入。</span>
<span class="sd">dim（int，可选）：计算余弦相似度的维度。默认：1</span>
<span class="sd">eps（float，可选）：避免除以零的小值。</span>
<span class="sd">默认：1e-8</span>

<span class="sd">示例::</span>

<span class="sd">    &gt;&gt;&gt; input1 = torch.randn(100, 128)</span>
<span class="sd">    &gt;&gt;&gt; input2 = torch.randn(100, 128)</span>
<span class="sd">    &gt;&gt;&gt; output = F.cosine_similarity(input1, input2)</span>
<span class="sd">    &gt;&gt;&gt; print(output)</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">热编码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">one_hot</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>
<span class="sd">one_hot(tensor, num_classes=-1) -&gt; LongTensor</span>

<span class="sd">接受形状为 ``(*)`` 的 LongTensor 索引值并返回一个张量</span>
<span class="sd">形状为 ``(*, num_classes)`` 的张量，除最后一个维度的索引与输入张量中对应的值匹配外，其余位置均为零</span>
<span class="sd">其中最后一个维度的索引与输入张量中对应的值匹配</span>
<span class="sd">在这种情况下将是 1。</span>

<span class="sd">参见维基百科上的`One-hot`_ 。</span>

<span class="sd">.. _One-hot 在维基百科上：</span>
<span class="sd">    https://en.wikipedia.org/wiki/One-hot</span>

<span class="sd">参数：</span>
<span class="sd">张量（LongTensor）：任何形状的类别值。</span>
<span class="sd">num_classes (int, 可选): 总类别数。如果设置为 -1，则表示</span>
<span class="sd">类数将被推断为大于最大类数的一个数</span>
<span class="sd">输入张量中的值。默认：-1</span>

<span class="sd">返回：</span>
<span class="sd">长张量，比 1 值多一个维度</span>
<span class="sd">输入指示的最后一个维度索引，其他地方为 0</span>
<span class="sd">否则。</span>

<span class="sd">示例：</span>
<span class="sd">    &gt;&gt;&gt; F.one_hot(torch.arange(0, 5) % 3)</span>
<span class="sd">    tensor([[1, 0, 0],</span>
<span class="sd">[0, 1, 0]</span>
<span class="sd">[0, 0, 1]</span>
<span class="sd">[1, 0, 0]</span>
<span class="sd">[0, 1, 0]</span>
<span class="sd">    &gt;&gt;&gt; F.one_hot(torch.arange(0, 5) % 3, num_classes=5)</span>
<span class="sd">    tensor([[1, 0, 0, 0, 0],</span>
<span class="sd">            [0, 1, 0, 0, 0],</span>
<span class="sd">            [0, 0, 1, 0, 0],</span>
<span class="sd">            [1, 0, 0, 0, 0],</span>
<span class="sd">[[0, 1, 0, 0, 0]])</span>
<span class="sd">    &gt;&gt;&gt; F.one_hot(torch.arange(0, 6).view(3,2) % 3)</span>
<span class="sd">    tensor([[[1, 0, 0],</span>
<span class="sd">[0, 1, 0]]</span>
<span class="sd">[[0, 0, 1]]</span>
<span class="sd">[[1, 0, 0]]</span>
<span class="sd">[[0, 1, 0]]</span>
<span class="sd">[[0, 0, 1]]]]</span>
<span class="sd">"""</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="triplet_margin_loss"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def triplet_margin_loss(
锚点: Tensor,
正样本: Tensor,
负样本: Tensor,
margin: 浮点数 = 1.0,
p: 浮点数 = 2,
eps: 浮点数 = 1e-6,
swap: 布尔值 = False,
size_average: 可选[布尔] = None,
reduce: 可选[布尔] = None,
reduction: str = "mean",
) -&gt; Tensor:
计算给定输入张量之间的三元组损失，并设置一个大于 0 的边界。

详细信息请参阅 :class:`~torch.nn.TripletMarginLoss`。
""
如果有_torch_function_variadic(anchor, positive, negative):
return handle_torch_function(
triplet_margin_loss,
(anchor, positive, negative),
anchor,
正面,
负面,
margin=margin,
p=p,
eps=eps,
swap=swap,
size_average=size_average,
reduce=reduce,
reduction=reduction,
        )
如果 size_average 不为空或 reduce 不为空：
reduction_enum = _Reduction.legacy_get_enum(size_average, reduce)
else:
reduction_enum = _Reduction.get_enum(reduction)
if 毛利率 &lt;= 0:
raise ValueError(f"毛利率必须大于 0，获取到 {毛利率}")
return torch.triplet_margin_loss(
锚点，正样本，负样本，间隔，p，eps，交换，reduction_enum
    )</font></font></font></div>


<div class="viewcode-block" id="triplet_margin_with_distance_loss"><a class="viewcode-back" href="../../../generated/torch.nn.functional.triplet_margin_with_distance_loss.html#torch.nn.functional.triplet_margin_with_distance_loss">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三重边距与距离损失</span><span class="p">(</span>
    <span class="n">锚点</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">正的</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">负面</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">距离函数</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">边距</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点数</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">交换</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">缩减</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">张量</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">使用自定义距离函数计算输入张量的三元组损失。</span>

<span class="sd">详细信息请参阅 :class:`~torch.nn.TripletMarginWithDistanceLoss`。</span>
<span class="sd">"文档"</span>
    <span class="k">如果</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">不支持的操作异常</span><span class="p">(</span>
            <span class="s2">"F.triplet_margin_with_distance_loss 不支持 JIT 脚本："</span>
            <span class="s2">"需要 Callable 的函数无法进行脚本化。"</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n">has_torch_function_variadic</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">锚点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正的</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">负面</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">三重边距与距离损失</span><span class="p">,</span>
            <span class="p">(</span><span class="n">锚点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正的</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">负面</span><span class="p">),</span>
            <span class="n">锚点</span><span class="p">,</span>
            <span class="n">正的</span><span class="p">,</span>
            <span class="n">负面</span><span class="p">,</span>
            <span class="n">距离函数</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">距离函数</span><span class="p">,</span>
            <span class="n">边距</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">边距</span><span class="p">,</span>
            <span class="n">交换</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换</span><span class="p">,</span>
            <span class="n">缩减</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缩减</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># 检查缩减模式的有效性</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">缩减</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不是有效的缩减值</span><span class="p">)</span>

    <span class="c1">检查边距的有效性</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">边距</font></font></font></span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≤</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"边距必须大于 0，实际得到"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">边距</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1">检查尺寸</span>
    <span class="n">一个维度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">锚点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</span>
    <span class="n">p_dim</span> <span class="o">=</span> <span class="n">正的</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</span>
    <span class="n">n_维度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">负面</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">维数</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">一个维度</font></font></font></span> <span class="o">==</span> <span class="n">p_dim</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</span> <span class="n">p_dim</span> <span class="o">==</span> <span class="n">n_dim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">运行时错误</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"锚点、正张量和负张量应具有相同的维度，但得到的是：锚点"</span>
            <span class="sa">f</span><span class="s2">"维度数相同，但得到了：anchor"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">一個維度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">D，"</span>
            <span class="sa">f</span><span class="s2">"積極的</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">p 維度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">D，和负</font></font></font></span><span class="si">{</span><span class="n">n_dim</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">D 输入</span>
        <span class="p">)</span>

    <span class="c1">计算损失</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">距离函数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">距离函数</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对应距离</span>

    <span class="n">正距离</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">距离函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">锚点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正的</span><span class="p">)</span>
    <span class="n">dist_neg</span> <span class="o">=</span> <span class="n">距离函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">锚点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">负面</span><span class="p">)</span>
    <span class="c1"># 距离交换在论文《学习浅层卷积特征描述符的三元损失》中进行了描述，作者为 V. Balntas，E. Riba 等。如果为 True，并且正例更接近于</span>
    <span class="c1"># # 距离交换在论文《学习浅层卷积特征描述符的三元损失》中进行了描述，作者为 V. Balntas，E. Riba 等。如果为 True，并且正例更接近于</span>
    <span class="c1"># # 距离交换在论文《学习浅层卷积特征描述符的三元损失》中进行了描述，作者为 V. Balntas，E. Riba 等。如果为 True，并且正例更接近于</span>
    <span class="c1">与锚点相比，负例比正例更差，交换正例和锚点在损失计算中。</span>
    <span class="c1">锚点在损失计算中。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换</span><span class="p">:</span>
        <span class="n">距离交换</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">距离函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正的</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">负的</span><span class="p">)</span>
        <span class="n">dist_neg</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">最小</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分布式否定</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换距离</span><span class="p">)</span>
    <span class="n">损失</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小限制</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">边距</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正距离</font></font></font></span> <span class="o">-</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分布式否定</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">应用缩减</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"求和"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总和</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">减少</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均值</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">均值</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># reduction == "none"</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">损失</span></div>


<div class="viewcode-block" id="normalize"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def normalize(
输入: Tensor,
p: float = 2.0,
dim: int = 1,
eps: float = 1e-12,
out: Optional[Tensor] = None,
) -&gt; Tensor:
r"""执行输入在指定维度上的 :math:`L_p` 归一化。

对于一个大小为 :math:`(n_0, ..., n_{dim}, ..., n_k)` 的张量 :attr:`input`，每个
`n_dim` -元素向量 `v` 沿维度 `dim` 转换为

.. 数学表达式
v = v / max(∥v∥_p, ε)

使用默认参数时，它使用维度 :math:`1` 上的欧几里得范数进行归一化。

Args:
输入：任何形状的输入张量
p (浮点数)：范数公式中的指数值。默认：2
dim (int 或 int 元组的元组)：降维的维度。默认：1
eps (float): 避免除以零的小值。默认：1e-12
输出（Tensor，可选）：输出张量。如果使用：attr:`out`，则
操作不可微。
"""
如果具有 torch_function_variadic(input, out):
返回 handle_torch_function(
normalize, (input, out), input, p=p, dim=dim, eps=eps, out=out
        )
if out is None:
denom = input.norm(p, dim, keepdim=True).clamp_min(eps).expand_as(input)
return input / denom
else:
denom = input.norm(p, dim, keepdim=True).clamp_min_(eps).expand_as(input)
return torch.div(input, denom, out=out)</font></font></font></div>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">断言整型或对偶</font></font></font></span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="kc">无</span><span class="p">:</span>
    <span class="k">断言</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数名称</span><span class="p">)</span>


<div class="viewcode-block" id="unfold"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 展开(
输入: Tensor,
核大小: BroadcastingList2[int],
扩展率: BroadcastingList2[int] = 1,
padding: BroadcastingList2[int] = 0,
stride: BroadcastingList2[int] = 1,
) -&gt; Tensor:
r"""从批处理的输入张量中提取滑动局部块。"""

..警告::
目前仅支持 4-D 输入张量（批量的图像类张量）。
支持。

..警告::

展开的张量可能包含多个元素指向同一个内存位置。因此，原地操作（尤其是向量化的操作）可能会导致不正确的行为。如果您需要向张量写入，请先对其进行克隆。
作为结果，原地操作（尤其是向量化的操作）可能会导致不正确的行为。如果您需要向张量写入，请先对其进行克隆。
如果您需要向张量写入，请先对其进行克隆。
如果您需要向张量写入，请先对其进行克隆。


查看 :class:`torch.nn.Unfold` 获取详细信息
"""
如果 has_torch_function_unary(input):
返回 handle_torch_function(
展开,
(输入,),
输入,
核心大小,
dilation=dilation,
padding=padding,
stride=stride,
        )
return torch._C._nn.im2col(
输入，_pair(kernel_size)，_pair(dilation)，_pair(padding)，_pair(stride)
    )</font></font></font></div>


<div class="viewcode-block" id="fold"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def fold(
输入: Tensor,
输出大小: BroadcastingList2[int],
核大小: BroadcastingList2[int],
dilation: 广播列表 2[int] = 1,
padding: 广播列表 2[int] = 0,
stride: 广播列表 2[int] = 1,
) -&gt; 张量:
将一系列滑动局部块组合成一个大的包含张量。

.. 警告::
目前仅支持未批处理（3D）或批处理（4D）的图像类似输出张量。

详细信息请参阅 :class:`torch.nn.Fold`
"""
如果存在 torch 函数单例(input):
返回 handle_torch_function(
fold,
输入,
输入,
输出大小,
核大小,
dilation=dilation,
padding=padding,
stride=stride,
        )
return torch._C._nn.col2im(
输入
_pair(output_size)
_pair(kernel_size)
_pair(膨胀)
_pair(填充)
_pair(步长)
    )</font></font></font></div>


<span class="c1">#</span>
<span class="c1">多头注意力</span>
<span class="c1">#</span>


<span class="k">定义</span> <span class="nf">_in_projection_packed</span><span class="p">(</span>
    <span class="n">q</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">v</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">列表</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]：</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">执行注意力操作的投影步骤，使用打包的权重。</span>

<span class="sd">输出是一个包含查询、键和值投影张量的三元组。</span>

<span class="sd">参数：</span>
<span class="sd">q, k, v：查询、键和值张量将被投影。对于自注意力机制，</span>
<span class="sd">这些通常是相同的张量；对于编码器-解码器注意力机制，</span>
<span class="sd">k 和 v 通常是指同一个张量。 (我们利用这些</span>
<span class="sd">身份用于性能，如果存在的话。无论如何，q，k 和 v</span>
<span class="sd">必须共享一个共同的嵌入维度；否则它们的形状可能不同。</span>
<span class="sd">q, k 和 v 的投影权重，打包成一个张量。权重沿维度 0 打包，顺序为 q, k, v。</span>
<span class="sd">打包顺序为 q, k, v。</span>
<span class="sd">b：q, k 和 v 的可选投影偏置，打包成一个张量</span>
<span class="sd">，顺序为 q, k, v。</span>

<span class="sd">形状：</span>
<span class="sd">输入：</span>
<span class="sd">- q：:math:`(..., E)` 其中 E 是嵌入维度</span>
<span class="sd">- k：:math:`(..., E)` 其中 E 是嵌入维度</span>
<span class="sd">- v：:math:`(..., E)` 其中 E 是嵌入维度</span>
<span class="sd">- w: (E * 3, E) 其中 E 是嵌入维度</span>
<span class="sd">- b: E * 3 其中 E 是嵌入维度</span>

<span class="sd">输出：</span>
<span class="sd">- 在输出列表 [q', k', v'] 中，每个输出张量将具有</span>
<span class="sd">与相应的输入张量形状相同。</span>
<span class="sd">"文档"</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">尺寸</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">k</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="n">q</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="n">k</span><span class="p">:</span>
            <span class="c1"># 自注意力</span>
            <span class="n">项目</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="c1"># 调整形状为 3, E 和不是 E，3 是故意为之，以实现更好的内存归约并保持与 chunk()相同的顺序</span>
            <span class="n">项目</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">项目</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">E</span><span class="p">))</span>
                <span class="o">.</span><span class="n">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="o">.</span><span class="n">转置</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">挤压</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">连续</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span><span class="p">[</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">编码器-解码器注意力</span>
            <span class="n">w_q</span><span class="p">,</span> <span class="n">w_kv</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">分割</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span> <span class="o">*</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">如果</font></font></font></span> <span class="n">b</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="n">b_q</span> <span class="o">=</span> <span class="n">b_kv</span> <span class="o">=</span> <span class="kc">无</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b_q</span><span class="p">,</span> <span class="n">b_kv</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">分割</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</span><span class="n">E</span><span class="p">,</span> <span class="n">E</span> <span class="o">*</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">q_proj</span> <span class="o">=</span> <span class="n">线性</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">w_q</span><span class="p">,</span> <span class="n">b_q</span><span class="p">)</span>
            <span class="n">kv_proj</span> <span class="o">=</span> <span class="n">线性</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">w_kv</span><span class="p">,</span> <span class="n">b_kv</span><span class="p">)</span>
            <span class="c1"># 重新塑形为 2，E 和非 E，2 是故意的，为了更好的内存归约并保持与 chunk()相同的顺序</span>
            <span class="n">kv_proj</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">kv_proj</span><span class="o">.</span><span class="n">unflatten</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">E</span><span class="p">))</span>
                <span class="o">.</span><span class="n">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="o">.</span><span class="n">转置</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">挤压</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">.</span><span class="n">连续</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">返回</font></font></font></span> <span class="p">(</span><span class="n">q_proj</span><span class="p">,</span> <span class="n">kv_proj</span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span> <span class="n">kv_proj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w_q</span><span class="p">,</span> <span class="n">w_k</span><span class="p">,</span> <span class="n">w_v</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">数据块</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n">b</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">b_q</span> <span class="o">=</span> <span class="n">b_k</span> <span class="o">=</span> <span class="n">b_v</span> <span class="o">=</span> <span class="kc">无</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b_q</span><span class="p">,</span> <span class="n">b_k</span><span class="p">,</span> <span class="n">b_v</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">数据块</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</font></font></font></span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">w_q</span><span class="p">,</span> <span class="n">b_q</span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</font></font></font></span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">w_k</span><span class="p">,</span> <span class="n">b_k</span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w_v</span><span class="p">,</span> <span class="n">b_v</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">投影中</span><span class="p">(</span>
    <span class="n">q</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">v</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">w_q</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">w_k</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">w_v</span><span class="p">:</span> <span class="n">张量</span><span class="p">,</span>
    <span class="n">b_q</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">b_k</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">b_v</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">执行注意力操作的投影步骤。</span>

<span class="sd">这只是一个由线性投影组成的 triple，</span>
<span class="sd">权重上有形状约束，</span>
<span class="sd">确保投影输出中的嵌入维度一致性。</span>
<span class="sd">输出是一个包含查询、键和值投影张量的三元组。</span>

<span class="sd">参数：</span>
<span class="sd">q, k, v：要投影的查询、键和值张量。</span>
<span class="sd">w_q, w_k, w_v：q、k 和 v 的权重，分别对应。</span>
<span class="sd">b_q, b_k, b_v：q、k 和 v 的可选偏置，分别对应。</span>

<span class="sd">形状：</span>
<span class="sd">输入：</span>
<span class="sd">- q: (Qdims..., Eq) 其中 Eq 是查询嵌入维度，Qdims 是任意维度。</span>
<span class="sd">主导维度数量。</span>
<span class="sd">- k: (Kdims..., Ek) 其中 Ek 是键嵌入维度，Kdims 是任意维度。</span>
<span class="sd">主导维度数量。</span>
<span class="sd">- v: :math:`(Vdims..., Ev)` 其中 Ev 是值嵌入维度，Vdims 是任何</span>
<span class="sd">主导维度数量。</span>
<span class="sd">- w_q: (Eq, Eq)</span>
<span class="sd">- w_k: (Eq, Ek)</span>
<span class="sd">- w_v: (Eq, Ev)</span>
<span class="sd">- b_q: (方程式)</span>
<span class="sd">- b_k: (方程式)</span>
<span class="sd">- b_v: (方程式)</span>

<span class="sd">输出：在输出三元组(q', k', v')中，</span>
<span class="sd">         - q': :math:`[Qdims..., Eq]`</span>
<span class="sd">         - k': :math:`[Kdims..., Eq]`</span>
<span class="sd">         - v': :math:`[Vdims..., Eq]`</span>

<span class="sd">"文档"</span>
    <span class="n">等式</font></font></font></span><span class="p">,</span> <span class="n">Ek</span><span class="p">,</span> <span class="n">Ev</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">断言</font></font></font></span> <span class="n">w_q</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
        <span class="n">等式</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">预期查询权重形状为</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,</span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">w_q</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">断言</font></font></font></span> <span class="n">w_k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
        <span class="n">Ek</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">预期键权重形状为</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,</span><span class="w"> </span><span class="n">Ek</span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">w_k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">断言</font></font></font></span> <span class="n">w_v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
        <span class="n">欧文</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">预期值权重形状为</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,</span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">欧文</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">w_v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">断言</font></font></font></span> <span class="n">b_q</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">b_q</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">期待查询偏差形状</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">b_q</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">断言</font></font></font></span> <span class="n">b_k</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">b_k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">期待键偏置形状</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">b_k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">断言</font></font></font></span> <span class="n">b_v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">b_v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span> <span class="o">==</span> <span class="p">(</span>
        <span class="n">等式</span><span class="p">,</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">预期值偏差形状的</font></font></font></span><span class="si">{</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等式</font></font></font></span><span class="p">,)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n">b_v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</font></font></font></span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">w_q</span><span class="p">,</span> <span class="n">b_q</span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</font></font></font></span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">w_k</span><span class="p">,</span> <span class="n">b_k</span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w_v</span><span class="p">,</span> <span class="n">b_v</span><span class="p">)</span>


<span class="n">缩放点积注意力机制</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_添加文档字符串</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n">扩放点积注意力</span><span class="p">,</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">"""缩放点积注意力机制(query, key, value, attn_mask=None, dropout_p=0.0,</span>
<span class="sd">        is_causal=False, scale=None, enable_gqa=False) -&gt; Tensor:</span>

<span class="sd">计算查询、键和值张量上的缩放点积注意力，如果传递了可选的注意力掩码，</span>
<span class="sd">并应用大于 0.0 的概率的 dropout。可选的 scale 参数只能作为关键字参数指定。</span>
<span class="sd">。</span>

<span class="sd">.. 代码块 :: python</span>

<span class="sd"># 高效实现等价于以下代码：</span>
<span class="sd">        def scaled_dot_product_attention(query, key, value, attn_mask=None, dropout_p=0.0,</span>
<span class="sd">                is_causal=False, scale=None, enable_gqa=False) -&gt; torch.Tensor:</span>
<span class="sd">            L, S = query.size(-2), key.size(-2)</span>
<span class="sd">            scale_factor = 1 / math.sqrt(query.size(-1)) if scale is None else scale</span>
<span class="sd">            attn_bias = torch.zeros(L, S, dtype=query.dtype, device=query.device)</span>
<span class="sd">            if is_causal:</span>
<span class="sd">                assert attn_mask is None</span>
<span class="sd">                temp_mask = torch.ones(L, S, dtype=torch.bool).tril(diagonal=0)</span>
<span class="sd">                attn_bias.masked_fill_(temp_mask.logical_not(), float("-inf"))</span>
<span class="sd">将 attn_bias 转换为 query 的数据类型</span>

<span class="sd">如果 attn_mask 不为空：</span>
<span class="sd">如果 attn_mask 的数据类型为 torch.bool：</span>
<span class="sd">                    attn_bias.masked_fill_(attn_mask.logical_not(), float("-inf"))</span>
<span class="sd">否则:</span>
<span class="sd">                    attn_bias = attn_mask + attn_bias</span>

<span class="sd">            if enable_gqa:</span>
<span class="sd">                key = key.repeat_interleave(query.size(-3)//key.size(-3), -3)</span>
<span class="sd">                value = value.repeat_interleave(query.size(-3)//value.size(-3), -3)</span>

<span class="sd">            attn_weight = query @ key.transpose(-2, -1) * scale_factor</span>
<span class="sd">            attn_weight += attn_bias</span>
<span class="sd">            attn_weight = torch.softmax(attn_weight, dim=-1)</span>
<span class="sd">            attn_weight = torch.dropout(attn_weight, dropout_p, train=True)</span>
<span class="sd">            return attn_weight @ value</span>

<span class="sd">.. 警告::</span>
<span class="sd">此函数处于测试阶段，可能会发生变化。</span>

<span class="sd">.. 警告::</span>
<span class="sd">此函数始终根据指定的 `dropout_p` 参数应用 dropout。</span>
<span class="sd">要在评估期间禁用 dropout，请确保传递 `0.0` 的值，当模块的函数调用不在训练模式时。</span>
<span class="sd">使得函数调用不在训练模式。</span>

<span class="sd">例如：</span>

<span class="sd">.. 代码块 :: python</span>

<span class="sd">类 MyModel(nn.Module):</span>
<span class="sd">                def __init__(self, p=0.5):</span>
<span class="sd">                    super().__init__()</span>
<span class="sd">                    self.p = p</span>

<span class="sd">                def forward(self, ...):</span>
<span class="sd">                    return F.scaled_dot_product_attention(...,</span>
<span class="sd">                        dropout_p=(self.p if self.training else 0.0))</span>

<span class="sd">注意：</span>

<span class="sd">目前支持三种缩放点积注意力机制的实现：</span>

<span class="sd">- `FlashAttention-2：更快的注意力机制，更好的并行性和工作分区`</span>
<span class="sd">- `内存高效注意力机制`</span>
<span class="sd">- 使用 C++定义的与上述公式匹配的 PyTorch 实现</span>

<span class="sd">        The function may call optimized kernels for improved performance when using the CUDA backend.</span>
<span class="sd">对于所有其他后端，将使用 PyTorch 实现。</span>

<span class="sd">所有实现默认启用。缩放点积注意力尝试自动选择</span>
<span class="sd">基于输入的最优实现。为了提供更多细粒度的控制，以实现</span>
<span class="sd">用于启用和禁用实现的功能如下。</span>
<span class="sd">上下文管理器是首选机制：</span>

<span class="sd">- :func:`torch.nn.attention.sdpa_kernel`：用于启用或禁用任何实现的上下文管理器。</span>
<span class="sd">- :func:`torch.backends.cuda.enable_flash_sdp`: 全局启用或禁用 FlashAttention。</span>
<span class="sd">- :func:`torch.backends.cuda.enable_mem_efficient_sdp`: 全局启用或禁用内存高效注意力。</span>
<span class="sd">- :func:`torch.backends.cuda.enable_math_sdp`: 全局启用或禁用 PyTorch C++ 实现。</span>

<span class="sd">每个融合内核都有特定的输入限制。如果用户需要使用特定的融合实现，</span>
<span class="sd">使用 :func:`torch.nn.attention.sdpa_kernel` 禁用 PyTorch 的 C++ 实现。</span>
<span class="sd">如果没有可用的融合实现，将发出警告，说明融合实现无法运行的原因。</span>
<span class="sd">融合实现无法运行的原因。</span>

<span class="sd">由于融合浮点运算的特性，此函数的输出可能因所选后端内核而异。</span>
<span class="sd">取决于所选后端内核。</span>
<span class="sd">C++ 实现支持 torch.float64，当需要更高精度时可以使用。</span>
<span class="sd">对于数学后端，如果输入为 torch.half 或 torch.bfloat16，所有中间结果都保持在 torch.float。</span>
<span class="sd">欲了解更多信息，请参阅：doc:`/notes/numerical_accuracy`</span>

<span class="sd">分组查询注意力（GQA）是一个实验性功能。目前它仅适用于 Flash_attention</span>
<span class="sd">和 CUDA 张量上的数学内核，不支持嵌套张量。</span>
<span class="sd">GQA 的约束条件：</span>

<span class="sd">- 头数查询 % 头数键值 == 0 且，</span>
<span class="sd">- 头数键 == 头数值</span>

<span class="sd">注意：</span>

<span class="sd">{cudnn_可复现性说明}</span>
<span class="sd">    """</span><span class="o">.</span><span class="n">格式</span><span class="p">(</span>
        <span class="o">**</span><span class="n">可复现性说明</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="sa">r</span><span class="s2">""</span>
<span class="s2">参数：</span>
<span class="s2">查询（张量）：查询张量；形状：math:`(N, ..., Hq, L, E)`。</span>
<span class="s2">密钥（张量）：密钥张量；形状：math:`(N, ..., H, S, E)`。</span>
<span class="s2">值（张量）：值张量；形状：math:`(N, ..., H, S, Ev)`。</span>
<span class="s2">attn_mask（可选张量）：注意力掩码；形状必须可广播到注意力权重形状。</span>
<span class="s2">这是一个数学表达式：(N,..., L, S)。支持两种类型的掩码。</span>
<span class="s2">这是一个布尔掩码，其中 True 值表示该元素*应该*参与注意力。</span>
<span class="s2">这是一个与查询、键、值相同类型的浮点掩码，它被添加到注意力分数中。</span>
<span class="s2">dropout_p (浮点数): Dropout 概率；如果大于 0.0，则应用 dropout。</span>
<span class="s2">is_causal (布尔值): 如果设置为 true，当掩码是正方形矩阵时，注意力掩码是一个下三角矩阵。</span>
<span class="s2">正方形矩阵。当掩码是非正方形矩阵时，注意力掩码具有上左因果偏差的形式（参见 :class:`torch.nn.attention.bias.CausalBias`）。</span>
<span class="s2">如果同时设置了 attn_mask 和 is_causal，则会抛出错误。</span>
<span class="s2">如果同时设置了 attn_mask 和 is_causal，则会抛出错误。</span>
<span class="s2">缩放因子（可选浮点数，关键字参数）：在 softmax 之前应用的缩放因子。如果为 None，则设置默认值</span>
<span class="s2">到 :math:`\frac</font></font></font></span><span class="si">{1}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">{E}</span><span class="si">{E}</span><span class="s2">}`.</span>
<span class="s2">enable_gqa (布尔值): 如果设置为 True，则启用分组查询注意力（GQA），默认设置为 False。</span>

<span class="s2">返回：</span>
<span class="s2">output (张量): 注意力输出；形状 :math:`(N, ..., Hq, L, Ev)`。</span>

<span class="s2">形状说明：</span>
<span class="s2">- :math:`N: 批处理大小 ... : 其他批处理维度数量（可选）`</span>
<span class="s2">- S：源序列长度</span>
<span class="s2">- L：目标序列长度</span>
<span class="s2">- E：查询和键的嵌入维度</span>
<span class="s2">- Ev：值的嵌入维度</span>
<span class="s2">- :math:`Hq: \text{查询头数}`</span>
<span class="s2">- :math:`H: \text{键和值的头数}`</span>

<span class="s2">示例：</span>

<span class="s2">&gt;&gt;&gt; # 可选使用上下文管理器以确保运行融合内核之一</span>
<span class="s2">        &gt;&gt;&gt; query = torch.rand(32, 8, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; key = torch.rand(32, 8, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; value = torch.rand(32, 8, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; with sdpa_kernel(backends=[SDPBackend.FLASH_ATTENTION]):</span>
<span class="s2">        &gt;&gt;&gt;     F.scaled_dot_product_attention(query,key,value)</span>


<span class="s2">&gt;&gt;&gt; # GQA 样本用于 llama3</span>
<span class="s2">        &gt;&gt;&gt; query = torch.rand(32, 32, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; key = torch.rand(32, 8, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; value = torch.rand(32, 8, 128, 64, dtype=torch.float16, device="cuda")</span>
<span class="s2">        &gt;&gt;&gt; with sdpa_kernel(backends=[SDPBackend.MATH]):</span>
<span class="s2">        &gt;&gt;&gt;     F.scaled_dot_product_attention(query,key,value,enable_gqa=True)</span>


<span class="s2">.. _FlashAttention-2: 更快速的注意力机制，具有更好的并行性和工作分区</span>
<span class="s2">        https://arxiv.org/abs/2307.08691</span>
<span class="s2">.. _Memory-Efficient Attention: 内存高效注意力机制</span>
<span class="s2">        https://github.com/facebookresearch/xformers</span>
<span class="s2">    .. _Grouped-Query Attention:</span>
<span class="s2">        https://arxiv.org/pdf/2305.13245</span>
<span class="s2">    """</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">定义</span> <span class="nf">_mha_shape_check</span><span class="p">(</span>
    <span class="n">查询</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">键</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">关键填充掩码</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">注意掩码</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">头数</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># 验证 `query`、`key`、`value`、`key_padding_mask` 和 `attn_mask` 的预期形状</span>
    <span class="c1"># 并返回输入是否批处理</span>
    <span class="c1">如果 `query` 不是二维（非批量）或三维（批量）张量，则会引发错误。</span>

    <span class="c1">形状检查。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1">批量输入。</span>
        <span class="n">批处理</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">对于批处理（3-D）`查询`，期望`键`和`值`为 3-D</span>
            <span class="sa">f</span><span class="s2">"但找到了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 和</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 张量分别"</span>
        <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">"对于批量（3-D）`查询`，期望`key_padding_mask`为`None`或 2-D"</span>
                <span class="sa">f</span><span class="s2">"但找到了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 索引张量而不是</span>
            <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">"对于批处理（3-D）`查询`，期望`注意力掩码`为`None`，2-D 或 3-D"</span>
                <span class="sa">f</span><span class="s2">"但找到了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 索引张量而不是</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">未分批输入</span>
        <span class="n">批处理</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">对于未分批（2-D）的`query`，期望`key`和`value`为 2-D</span>
            <span class="sa">f</span><span class="s2">"但找到了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 和</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 张量分别"</span>
        <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">对于未分批（2-D）`query`，期望`key_padding_mask`为`None`或 1-D</span>
                <span class="sa">f</span><span class="s2">"但找到了"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 索引张量而不是</span>
            <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">对于未分批（2-D）的`query`，期望`attn_mask`为`None`，2-D 或 3-D</span>
                <span class="sa">f</span><span class="s2">但找到</font></font></font></span><span class="si">{</span><span class="n">attn_mask</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗淡</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“-D 张量而不是”</span>
            <span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n">attn_mask</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">预期形状</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">断言</span> <span class="p">(</span>
                    <span class="n">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期形状</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">预期 `attn_mask` 的形状为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">但是得到了</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">断言错误</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">查询应为未批处理的 2D 或批处理的 3D 张量，但收到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-D 查询张量</span>
        <span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_规范掩码</span><span class="p">(</span>
    <span class="n">面具</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">面具名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">,</span>
    <span class="n">其他类型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选的</font></font></font></span><span class="p">[</span><span class="n">DType</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">其他名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">,</span>
    <span class="n">目标类型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="p">,</span>
    <span class="n">检查其他</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">]:</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面具</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">_掩码数据类型</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面具</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">_mask 是否为浮点数</font></font></font></span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面具</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_掩码数据类型</font></font></font></span> <span class="o">!=</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_mask 是否为浮点数</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">断言错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"仅支持布尔型和浮点型"</font></font></font></span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">支持</span>
            <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查其他</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">并且</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他类型</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_掩码数据类型</font></font></font></span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他类型</span><span class="p">:</span>
                <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">支持不匹配</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">掩码名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他名称</span><span class="si">}</span><span class="s2"> "</span>
                    <span class="s2">已弃用。请使用相同类型代替。</span>
                <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_mask 是否为浮点数</span><span class="p">:</span>
            <span class="n">面具</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">与...相同形状的零</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面具</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标类型</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">遮蔽填充</span><span class="p">(</span>
                <span class="n">遮罩</font></font></font></span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">-无穷大</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">面具</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_无或数据类型</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">输入</font></font></font></span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">raise</span> <span class="ne">运行时错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_none_or_dtype()的输入必须是 None 或 torch.Tensor"</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查键填充掩码</span><span class="p">(</span>
    <span class="n">关键填充掩码</font></font></font></span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</font></font></font></span><span class="p">,</span> <span class="n">bsz</span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="kc">无</span><span class="p">:</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_check_with</span><span class="p">(</span>
        <span class="ne">断言错误</span><span class="p">,</span>
        <span class="n">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">bsz</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="sa">f</span><span class="s2">预期 key_padded_mask.shape[0] 的值</font></font></font></span><span class="si">{</span><span class="n">bsz</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">_check_with</span><span class="p">(</span>
        <span class="ne">断言错误</span><span class="p">,</span>
        <span class="n">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"期望 key_padded_mask.shape[1] 的值</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</span><span class="si">{</span><span class="n">key_padding_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">定义</span> <span class="nf">multi_head_attention_forward</span><span class="p">(</span>
    <span class="n">查询</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">键</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">验证嵌入维度</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">,</span>
    <span class="n">头数</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">,</span>
    <span class="n">输入投影权重</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">输入投影偏置</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">偏置_k</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">偏置_v</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">添加零注意力</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">,</span>
    <span class="n">dropout_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">输出投影权重</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">,</span>
    <span class="n">输出投影偏置</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">训练</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">关键填充掩码</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">需要的权重</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">注意掩码</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">使用独立项目权重</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="n">q_proj_weight</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">k_proj_weight</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">v_项目权重</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">静态_k</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">静态_v</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">平均注意力权重</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span><span class="p">,</span>
    <span class="n">因果</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
<span class="p">)</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本:
-&gt;

翻译:
-&gt;</font></font></font></span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]]</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">多头注意力方法的向前方法。</span>

<span class="sd">.. 注意::</span>
<span class="sd">请参阅此教程  了解 PyTorch 提供的用于构建自己的 Transformer 层的高效构建块深入讨论。</span>
<span class="sd">有关 PyTorch 提供的用于构建自己的 Transformer 层的高效构建块的深入讨论，请参阅。</span>
<span class="sd">Transformer 层。</span>

<span class="sd">请参阅：class:`torch.nn.MultiheadAttention`以获取详细信息。</span>

<span class="sd">参数：</span>
<span class="sd">查询、键、值：将查询和一组键值对映射到输出。</span>
<span class="sd">请参阅“Attention Is All You Need”以获取更多详细信息。</span>
<span class="sd">embed_dim_to_check：模型的总维度。</span>
<span class="sd">num_heads: 并行注意力头。</span>
<span class="sd">in_proj_weight, in_proj_bias: 输入投影权重和偏差。</span>
<span class="sd">bias_k, bias_v: 在 dim=0 处添加 key 和 value 序列的偏差。</span>
<span class="sd">add_zero_attn: 向 key 添加一个新的全零批次。</span>
<span class="sd">dim=1 的值序列。</span>
<span class="sd">dropout_p：将元素置零的概率。</span>
<span class="sd">out_proj_weight, out_proj_bias：输出投影权重和偏差。</span>
<span class="sd">training：如果为 True 则应用 dropout。</span>
<span class="sd">key_padding_mask：如果提供，指定键中的填充元素</span>
<span class="sd">被注意力忽略。这是一个二进制掩码。当值为真时，</span>
<span class="sd">相应的注意力层上的值将被填充为-inf。</span>
<span class="sd">需要权重：输出注意力输出权重。</span>
<span class="sd">默认：`True`</span>
<span class="sd">注意：`needs_weight` 默认为 `True`，但应设置为 `False`</span>
<span class="sd">当不需要注意力权重时，为了最佳性能。</span>
<span class="sd">*将 `needs_weights` 设置为 `True`</span>
<span class="sd">导致性能显著下降。</span>
<span class="sd">attn_mask：2D 或 3D 掩码，用于阻止对某些位置的注意力。2D 掩码将广播到所有</span>
<span class="sd">批处理时，3D 掩码允许为每个批次的条目指定不同的掩码。</span>
<span class="sd">is_causal: 如果指定，则应用因果掩码作为注意力掩码，并忽略</span>
<span class="sd">计算缩放点积注意力机制的 attn_mask。</span>
<span class="sd">默认：``False``。</span>
<span class="sd">.. 警告::</span>
<span class="sd">is_causal 提供了 attn_mask 是因果掩码的提示。</span>
<span class="sd">提供错误的提示可能导致执行错误，包括前向和反向传播。</span>
<span class="sd">包括前向和反向传播在内的执行错误。</span>
<span class="sd">兼容性。</span>
<span class="sd">use_separate_proj_weight: 该函数接受查询、键、</span>
<span class="sd">和值的不同形式的 proj.权重。如果为 false，则使用 in_proj_weight，它是</span>
<span class="sd">q_proj_weight、k_proj_weight、v_proj_weight 的组合。</span>
<span class="sd">q_proj_weight, k_proj_weight, v_proj_weight, in_proj_bias：输入投影权重和偏差。</span>
<span class="sd">static_k, static_v：用于注意力操作器的静态键和值。</span>
<span class="sd">average_attn_weights：如果为 true，表示返回的`attn_weights`应在头部之间平均。</span>
<span class="sd">否则，`attn_weights`将按头部分别提供。注意，此标志仅在此处有效</span>
<span class="sd">当 `need_weights=True`。默认：True</span>


<span class="sd">形状：</span>
<span class="sd">输入：</span>
<span class="sd">- 查询：:math:`(L, E)` 或 :math:`(L, N, E)`，其中 L 是目标序列长度，N 是批大小，E 是</span>
<span class="sd">嵌入维度。</span>
<span class="sd">- 键：:math:`(S, E)` 或 :math:`(S, N, E)`，其中 S 是源序列长度，N 是批大小，E 是</span>
<span class="sd">嵌入维度。</span>
<span class="sd">- value: (S, E) 或 (S, N, E) 其中 S 是源序列长度，N 是批量大小，E 是</span>
<span class="sd">嵌入维度。</span>
<span class="sd">key_padding_mask: :math:`(S)` 或 :math:`(N, S)` 其中 N 是批大小，S 是源序列长度。</span>
<span class="sd">如果提供一个 FloatTensor，它将直接添加到值中。</span>
<span class="sd">如果提供一个 BoolTensor，则值为 ``True`` 的位置将被忽略，而值为 ``False`` 的位置将保持不变。</span>
<span class="sd">值为 ``True`` 的位置将被忽略，而值为 ``False`` 的位置将保持不变。</span>
<span class="sd">- attn_mask：2D 掩码：math:`(L, S)`，其中 L 为目标序列长度，S 为源序列长度。</span>
<span class="sd">3D 掩码：math:`(N*num_heads, L, S)`，其中 N 为批大小，L 为目标序列长度，</span>
<span class="sd">S 为源序列长度。attn_mask 确保位置 i 可以关注未掩码的位置。</span>
<span class="sd">如果提供 BoolTensor，则位置与``True``相关。</span>
<span class="sd">在此情况下不允许参加，而 ``False`` 值将保持不变。如果提供一个浮点张量，</span>
<span class="sd">它将被添加到注意力权重中。</span>
<span class="sd">- static_k: :math:`(N*num_heads, S, E/num_heads)`，其中 S 是源序列长度，</span>
<span class="sd">N 是批大小，E 是嵌入维度。E/num_heads 是头维度。</span>
<span class="sd">- 静态_v: :math:`(N*num_heads, S, E/num_heads)`，其中 S 是源序列长度，</span>
<span class="sd">N 是批大小，E 是嵌入维度。E/num_heads 是头维度。</span>

<span class="sd">输出：</span>
<span class="sd">- attn_output: :math:`(L, E)` 或 :math:`(L, N, E)` 其中 L 是目标序列长度，N 是批大小，</span>
<span class="sd">E 是嵌入维度。</span>
<span class="sd">- 当`need_weights=True`时返回`attn_output_weights`。如果`average_attn_weights=True`，则返回</span>
<span class="sd">在输入未批处理时，头部的注意力权重平均值，形状为:math:`(L, S)`，</span>
<span class="sd">math:`(N, L, S)`，其中:N 是批处理大小，:math:`L`是目标序列长度，:math:`S`是序列长度，</span>
<span class="sd">`S` 是源序列长度。如果 `average_attn_weights=False`，则返回每个注意力头的注意力权重。</span>
<span class="sd">形状为 :math:`(num_heads, L, S)` 的注意力头，当输入未批处理时或形状为 :math:`(N, num_heads, L, S)`。</span>
<span class="sd">"文档"</span>
    <span class="n">线性代数操作</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">查询</span><span class="p">,</span>
        <span class="n">键</span><span class="p">,</span>
        <span class="n">值</span><span class="p">,</span>
        <span class="n">输入投影权重</span><span class="p">,</span>
        <span class="n">输入投影偏置</span><span class="p">,</span>
        <span class="n">偏置_k</span><span class="p">,</span>
        <span class="n">偏置_v</span><span class="p">,</span>
        <span class="n">输出投影权重</span><span class="p">,</span>
        <span class="n">输出投影偏置</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有 torch 功能</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性运算</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">handle_torch_function</span><span class="p">(</span>
            <span class="n">multi_head_attention_forward</span><span class="p">,</span>
            <span class="n">线性运算</span><span class="p">,</span>
            <span class="n">查询</span><span class="p">,</span>
            <span class="n">键</span><span class="p">,</span>
            <span class="n">值</span><span class="p">,</span>
            <span class="n">验证嵌入维度</span><span class="p">,</span>
            <span class="n">头数</span><span class="p">,</span>
            <span class="n">输入投影权重</span><span class="p">,</span>
            <span class="n">输入投影偏置</span><span class="p">,</span>
            <span class="n">偏置_k</span><span class="p">,</span>
            <span class="n">偏置_v</span><span class="p">,</span>
            <span class="n">添加零注意力</span><span class="p">,</span>
            <span class="n">dropout_p</span><span class="p">,</span>
            <span class="n">输出投影权重</span><span class="p">,</span>
            <span class="n">输出投影偏置</span><span class="p">,</span>
            <span class="n">训练</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">,</span>
            <span class="n">关键填充掩码</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</span><span class="p">,</span>
            <span class="n">需要的权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要的权重</span><span class="p">,</span>
            <span class="n">注意掩码</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</span><span class="p">,</span>
            <span class="n">因果</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">因果</span><span class="p">,</span>
            <span class="n">使用独立项目权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用独立项目权重</span><span class="p">,</span>
            <span class="n">q_proj_weight</span><span class="o">=</span><span class="n">q_proj_weight</span><span class="p">,</span>
            <span class="n">k_proj_weight</span><span class="o">=</span><span class="n">k_proj_weight</span><span class="p">,</span>
            <span class="n">v_项目权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">v_项目权重</span><span class="p">,</span>
            <span class="n">静态_k</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_k</span><span class="p">,</span>
            <span class="n">静态_v</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_v</span><span class="p">,</span>
            <span class="n">平均注意力权重</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均注意力权重</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">批处理</span> <span class="o">=</span> <span class="n">_mha_shape_check</span><span class="p">(</span>
        <span class="n">查询</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span>
    <span class="p">)</span>

    <span class="c1">对于未分批输入，我们在预期的批处理维度上取消展平，以假装输入</span>
    <span class="c1"># 批量处理，运行计算，然后返回之前挤压</span>
    <span class="c1"># 挤压批量维度，以便输出不携带这个临时的批量维度。</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span><span class="p">:</span>
        <span class="c1"># 如果输入未批量处理，则展开</span>
        <span class="n">查询</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">值</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">key_padding_mask</span> <span class="o">=</span> <span class="n">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># 设置形状变量</span>
    <span class="n">tgt_len</span><span class="p">,</span> <span class="n">bsz</span><span class="p">,</span> <span class="n">嵌入维度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span>
    <span class="n">源长度</font></font></font></span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span>

    <span class="n">key_padding_mask</span> <span class="o">=</span> <span class="n">_规范掩码</span><span class="p">(</span>
        <span class="n">面具</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</span><span class="p">,</span>
        <span class="n">掩码名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"关键填充掩码"</span><span class="p">,</span>
        <span class="n">其他类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_无或数据类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</span><span class="p">),</span>
        <span class="n">其他名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"注意力掩码"</span><span class="p">,</span>
        <span class="n">目标类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是因果的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">运行时错误</span><span class="p">(</span>
            <span class="s2">需要指定 is_causal 提示时，需要 attn_mask。</span>
            <span class="s2">您可以使用 Transformer 模块方法</span>
            <span class="s2">`generate_square_subsequent_mask` 用于创建此掩码。</span>
        <span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是因果的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要的权重</span><span class="p">:</span>
        <span class="c1"># 当我们有 kpm 或需要权重时，我们需要 attn_mask</span>
        <span class="c1"># 否则，我们使用 is_causal 提示直接作为 is_causal</span>
        <span class="c1">指示 SDPA</span>
        <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_规范掩码</span><span class="p">(</span>
            <span class="n">面具</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</span><span class="p">,</span>
            <span class="n">掩码名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"注意力掩码"</span><span class="p">,</span>
            <span class="n">其他类型</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
            <span class="n">其他名称</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</span><span class="p">,</span>
            <span class="n">目标类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查询</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="p">,</span>
            <span class="n">检查其他</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="c1">我们已经有了 attn_mask，并使用它来合并 kpm。</span>
            <span class="c1">关闭使用 is_causal 提示，因为合并后的掩码不再具有因果性。</span>
            <span class="c1"># 更新：由于合并后的掩码不再具有因果性，因此不再使用 is_causal 提示。</span>
            <span class="n">是因果的</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

    <span class="k">断言</span> <span class="p">(</span>
        <span class="n">嵌入维度</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度检查</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">期待嵌入维度为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">验证嵌入维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
        <span class="c1"># embed_dim 可以是一个张量，当进行 JIT 追踪时</span>
        <span class="n">头维度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">除法</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">四舍五入模式</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">截断</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">头维度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</font></font></font></span> <span class="o">//</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span>
    <span class="k">断言</span> <span class="p">(</span>
        <span class="n">头维度</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">嵌入维度</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不能被 num_heads 整除</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用独立项目权重</span><span class="p">:</span>
        <span class="c1">允许在单独使用投影权重时，MHA 具有不同的嵌入维度</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">"键的序列和批次维度"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">与值的维度不匹配</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">"关键形状"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值形状不匹配</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</span><span class="si">}</span><span class="s2">"</span>

    <span class="c1">#</span>
    <span class="c1"># 在投影中计算</span>
    <span class="c1">#</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用独立项目权重</span><span class="p">:</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">投影权重</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">),</span> <span class="s2">使用_separate_proj_weight 为 False 但_in_proj_weight 为 None</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">_in_projection_packed</span><span class="p">(</span><span class="n">查询</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入投影权重</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入投影偏置</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">q_proj_weight</span> <span class="ow">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">),</span> <span class="s2">"use_separate_proj_weight 为 True 但 q_proj_weight 为 None"</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">k_proj_weight</span> <span class="ow">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">),</span> <span class="s2">"use_separate_proj_weight 为 True 但 k_proj_weight 为 None"</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">v_proj_weight</span> <span class="ow">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">),</span> <span class="s2">"use_separate_proj_weight 为 True 但 v_proj_weight 为 None"</span>
        <span class="k">如果</font></font></font></span> <span class="n">in_proj_bias</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">b_q</span> <span class="o">=</span> <span class="n">b_k</span> <span class="o">=</span> <span class="n">b_v</span> <span class="o">=</span> <span class="kc">无</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b_q</span><span class="p">,</span> <span class="n">b_k</span><span class="p">,</span> <span class="n">b_v</span> <span class="o">=</span> <span class="n">输入投影偏置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据块</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">投影中</span><span class="p">(</span>
            <span class="n">查询</span><span class="p">,</span>
            <span class="n">键</span><span class="p">,</span>
            <span class="n">值</span><span class="p">,</span>
            <span class="n">q_proj_weight</span><span class="p">,</span>
            <span class="n">k_proj_weight</span><span class="p">,</span>
            <span class="n">v_项目权重</span><span class="p">,</span>
            <span class="n">b_q</span><span class="p">,</span>
            <span class="n">b_k</span><span class="p">,</span>
            <span class="n">b_v</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">预处理注意力掩码</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="c1">确保注意力掩码的维度为 3</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">确保二维尺寸正确</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正确的二维尺寸</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">运行时错误</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"2D attn_mask 的形状是</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">，但应该是</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正确的二维尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
                <span class="p">)</span>
            <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">正确的 3D 尺寸</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正确的 3D 尺寸</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">运行时错误</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">3D 注意力掩码的形状是</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">，但应该是</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">正确的 3D 尺寸</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">运行时错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">注意力掩码的维度</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不受支持"</span>
            <span class="p">)</span>

    <span class="c1"># 在批处理维度上添加偏差（目前是第二个）</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏差_k</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏置_v</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态键</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"偏差不能添加到静态键。"</span>
        <span class="k">断言</font></font></font></span> <span class="n">static_v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏差不能添加到静态值。</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">猫</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="n">k</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏置_k</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重复</font></font></font></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bsz</span><span class="p">,</span> <span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">猫</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="n">v</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏置_v</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重复</font></font></font></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bsz</span><span class="p">,</span> <span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]])</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">key_padding_mask</span> <span class="o">=</span> <span class="n">填充</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏差_k</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">偏置_v</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>

    <span class="c1">#</span>
    <span class="c1"># 重新排列 q、k、v 以进行多头注意力并使它们成为批处理优先</span>
    <span class="c1">#</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转置</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态键</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转置</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO 完成解耦控制流，这样在传递静态变量时就不会执行内投影</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">静态_k</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">预期 static_k.size(0) 的值</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_k</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">静态_k</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">预期 static_k.size() 为 2</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_k</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">静态键</span>
    <span class="k">如果</font></font></font></span> <span class="n">static_v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转置</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO 完成解耦控制流，这样在传递静态变量时就不会执行内投影</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">静态_v</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">预期 static_v.size(0) 的值</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_v</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">断言</span> <span class="p">(</span>
            <span class="n">静态_v</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">预期 static_v.size(2) 为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">, 但得到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">静态_v</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">static_v</span>

    <span class="c1">在批处理维度上添加零注意力（现在为第一个）</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加零注意力</span><span class="p">:</span>
        <span class="n">零注意力形状</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">猫</span><span class="p">(</span>
            <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">零值</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">zero_attn_shape
零注意力形状</font></font></font></span><span class="p">,</span> <span class="n">数据类型</font></font></font></span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]，</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">猫</span><span class="p">(</span>
            <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">零值</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">zero_attn_shape
零注意力形状</font></font></font></span><span class="p">,</span> <span class="n">数据类型</font></font></font></span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]，</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">填充</span><span class="p">(</span><span class="n">attn_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">key_padding_mask</span> <span class="o">=</span> <span class="n">填充</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># 更新调整后的源序列长度</span>
    <span class="n">源长度</font></font></font></span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">合并填充和注意力掩码键</span>
    <span class="k">如果</font></font></font></span> <span class="n">key_padding_mask</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否正在脚本化</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火把</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</span><span class="o">.</span><span class="n">is_tracing</span><span class="p">():</span>
            <span class="n">检查键填充掩码</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键填充掩码</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">,</span> <span class="n">bsz</span><span class="p">)</span>

        <span class="n">key_padding_mask</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">关键填充掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>
            <span class="o">.</span><span class="n">展开</font></font></font></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">重塑</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">注意力掩码</span> <span class="o">=</span> <span class="n">key_padding_mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</span> <span class="o">+</span> <span class="n">key_padding_mask</span>

    <span class="c1">调整 dropout 概率</span>
    <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">训练</span><span class="p">:</span>
        <span class="n">dropout 概率</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1">#</span>
    <span class="c1">（深呼吸）计算注意力与输出投影</span>
    <span class="c1">#</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要的权重</span><span class="p">:</span>
        <span class="n">_B</span><span class="p">,</span> <span class="n">_Nt</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">形状</span>
        <span class="n">q_scaled</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平方根</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>

        <span class="k">断言</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</span> <span class="p">(</span>
            <span class="n">是因果的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">),</span> <span class="s2">"FIXME：is_causal 对 need_weights 未实现"</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">抱歉，您提供的文本 "baddbmm" 似乎没有明确的意义或上下文，因此无法进行准确的翻译。请提供具有明确意义的文本以便翻译</span><span class="p">(</span>
                <span class="n">注意掩码</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">q 缩放</font></font></font></span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转置</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">q 缩放</font></font></font></span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转置</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">软式最大化</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力输出权重</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">dropout 概率</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">dropout</span><span class="p">(</span><span class="n">注意力输出权重</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">dropout_p</span><span class="p">)</span>

        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">注意力输出权重</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">attn_output</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">attn_output</span><span class="o">.</span><span class="n">转置</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连续</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">视图</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标长度</font></font></font></span> <span class="o">*</span> <span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">线性</font></font></font></span><span class="p">(</span><span class="n">attn_output</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出投影权重</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出投影偏置</span><span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">attn_output</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">tgt_len</span><span class="p">,</span> <span class="n">bsz</span><span class="p">,</span> <span class="n">attn_output</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># 可选地平均头注意力权重</span>
        <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">注意力输出权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平均注意力权重</span><span class="p">:</span>
            <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">注意力输出权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">均值</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span><span class="p">:</span>
            <span class="c1">如果输入未批处理，则压缩输出</span>
            <span class="n">attn_output</span> <span class="o">=</span> <span class="n">attn_output</span><span class="o">.</span><span class="n">挤压</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">注意力输出权重</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">挤压</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">返回</span> <span class="n">attn_output</span><span class="p">,</span> <span class="n">attn_output_weights</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># attn_mask 可以是(L,S)或者(N*num_heads, L, S)</span>
        <span class="c1"># 如果 attn_mask 的形状是(1, L, S)，我们需要将其展平为(1, 1, L, S)</span>
        <span class="c1"># 为了与输入的 SDPA 形状(N, num_heads, L, S)相匹配</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意力掩码</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注意掩码</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">attn_mask</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n">attn_mask</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">展平</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">注意力掩码</font></font></font></span> <span class="o">=</span> <span class="n">attn_mask</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">bsz</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">源长度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">头维度</span><span class="p">)</span>

        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">扩放点积注意力</span><span class="p">(</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">注意掩码</font></font></font></span><span class="p">,</span> <span class="n">dropout_p</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是因果的</span>
        <span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">attn_output</span><span class="o">.</span><span class="n">排列</font></font></font></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连续</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">视图</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批大小</font></font></font></span> <span class="o">*</span> <span class="n">tgt_len</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌入维度</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">线性</font></font></font></span><span class="p">(</span><span class="n">attn_output</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出投影权重</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出投影偏置</span><span class="p">)</span>
        <span class="n">attn_output</span> <span class="o">=</span> <span class="n">attn_output</span><span class="o">.</span><span class="n">视图</font></font></font></span><span class="p">(</span><span class="n">tgt_len</span><span class="p">,</span> <span class="n">bsz</span><span class="p">,</span> <span class="n">attn_output</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">如果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">批处理</span><span class="p">:</span>
            <span class="c1">如果输入未批处理，则压缩输出</span>
            <span class="n">attn_output</span> <span class="o">=</span> <span class="n">attn_output</span><span class="o">.</span><span class="n">挤压</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="n">attn_output</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>© 版权所有 PyTorch 贡献者。</p>
  </div>
    
      <div>使用 Sphinx 构建，并使用 Read the Docs 提供的主题。</div>
     

</footer>

          </div>
<script>

var match = window.location.href.match(/\/_[a-zA-Z0-9_]*.html|_dynamo/gi);
var url = window.location.href.lastIndexOf(match[match.length-1]);

if (url)
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-exclamation-circle" aria-hidden="true">&nbsp</i> This page describes an internal API which is not intended to be used outside of the PyTorch codebase and can be modified or removed without notice.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
         <script src="../../../_static/jquery.js"></script>
         <script src="../../../_static/underscore.js"></script>
         <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../_static/doctools.js"></script>
         <script src="../../../_static/clipboard.min.js"></script>
         <script src="../../../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script="" type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0">


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>文档</h2>
          <p>查看 PyTorch 的全面开发者文档</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">查看文档</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>教程</h2>
          <p>深入了解初学者和高级开发者的教程</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">查看教程</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>资源</h2>
          <p>查找开发资源，获取您的疑问解答</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">查看资源</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">开始使用</a></li>
            <li><a href="https://pytorch.org/features">功能</a></li>
            <li><a href="https://pytorch.org/ecosystem">生态系统</a></li>
            <li><a href="https://pytorch.org/blog/">博客</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">贡献</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">资源</a></li>
            <li><a href="https://pytorch.org/tutorials">教程</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">文档</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">讨论</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github 问题</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">品牌指南</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">保持更新</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">推特</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">领英</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch 播客</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">苹果</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">谷歌</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">亚马逊</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">条款</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">隐私</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© 版权所有 Linux 基金会。PyTorch 基金会是 Linux 基金会的一个项目。有关 PyTorch 基金会的网站使用条款、商标政策以及其他适用政策，请参阅 www.linuxfoundation.org/policies/。PyTorch 基金会支持 PyTorch 开源项目，该项目已被确立为 LF Projects, LLC 的 PyTorch 项目系列。有关适用于 PyTorch 项目系列 LF Projects, LLC 的政策，请参阅 www.lfprojects.org/policies/。</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">为了分析流量并优化您的体验，我们在本网站上使用 cookies。通过点击或导航，您同意允许我们使用 cookies。作为本网站的当前维护者，适用 Facebook 的 Cookies 政策。了解更多信息，包括关于可用控制的信息：Cookies 政策。</p>
    <img class="close-button" src="../../../_static/images/pytorch-x.svg" width="16" height="16">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>学习</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/get-started">开始使用</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials">教程</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/basics/intro.html">学习基础知识</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/recipes/recipes_index.html">PyTorch 食谱</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/introyt.html">PyTorch 入门 - YouTube 系列</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>生态系统</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/ecosystem">工具</a>
             </li>
             <li>
               <a href="https://pytorch.org/#community-module">社区</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">论坛</a>
             </li>
             <li>
               <a href="https://pytorch.org/resources">开发者资源</a>
             </li>
             <li>
               <a href="https://pytorch.org/ecosystem/contributor-awards-2023">贡献者奖项 - 2024</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>边缘</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/edge">关于 PyTorch Edge</a>
             </li>
             
             <li>
               <a href="https://pytorch.org/executorch-overview">ExecuTorch</a>
             </li>
             <li>
               <a href="https://pytorch.org/executorch/stable/index.html">ExecuTorch 文档</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>文档</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/pytorch-domains">PyTorch 领域</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>博客 &amp; 新闻</a>
          </li>
            
           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/blog/">PyTorch 博客</a>
            </li>
            <li>
              <a href="https://pytorch.org/community-blog">社区博客</a>
            </li>

            <li>
              <a href="https://pytorch.org/videos">视频</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">社区故事</a>
            </li>
            <li>
              <a href="https://pytorch.org/events">活动</a>
            </li>
            <li>
               <a href="https://pytorch.org/newsletter">通讯</a>
             </li>
          </ul>
          
          <li class="resources-mobile-menu-title">
            <a>关于</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/foundation">PyTorch 基金会</a>
            </li>
            <li>
              <a href="https://pytorch.org/governing-board">管理委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/credits">云信用计划</a>
            </li>
            <li>
               <a href="https://pytorch.org/tac">技术咨询委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/staff">员工</a>
            </li>
            <li>
               <a href="https://pytorch.org/contact-us">联系我们</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

</body></html>