<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch.nn.modules.module — PyTorch main documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/_modules/torch/nn/modules/module.html">
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css">
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/katex-math.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/sphinx-dropdown.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/panels-bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/css/jit.css" type="text/css">
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css">
    <link rel="index" title="Index" href="../../../../genindex.html">
    <link rel="search" title="Search" href="../../../../search.html">

<!--
  Search engines should not index the main version of documentation.
  Stable documentation are built without release == 'main'.
-->
<meta name="robots" content="noindex">


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head><body class="pytorch-body"><div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">学习</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/get-started">
                  <span class="dropdown-title">开始使用</span>
                  <p>在本地运行 PyTorch 或快速开始使用支持的云平台之一</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials">
                  <span class="dropdown-title">教程</span><p></p>
                  <p>PyTorch 教程中有什么新内容</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/basics/intro.html">
                  <span class="dropdown-title">学习基础知识</span><p></p>
                  <p>熟悉 PyTorch 的概念和模块</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/recipes/recipes_index.html">
                  <span class="dropdown-title">PyTorch 食谱</span><p></p>
                  <p>小而全，即用即部署的 PyTorch 代码示例</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/introyt.html">
                  <span class="dropdown-title">PyTorch 入门 - YouTube 系列教程</span><p></p>
                  <p>通过我们引人入胜的 YouTube 教程系列掌握 PyTorch 基础知识</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">生态系统</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class="dropdown-title">工具</span><p></p>
                  <p>了解 PyTorch 生态系统中的工具和框架</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">社区</span>
                  <p>加入 PyTorch 开发者社区，贡献、学习并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">论坛</span>
                  <p>讨论 PyTorch 代码、问题、安装、研究的地方</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">开发者资源</span>
                  <p>查找资源并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem/contributor-awards-2024">
                  <span class="dropdown-title">贡献者奖项 - 2024</span><p></p>
                  <p>本年 PyTorch 会议揭晓获奖者</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">边缘</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/edge">
                  <span class="dropdown-title">关于 PyTorch Edge</span><p></p>
                  <p>为边缘设备构建创新且注重隐私的 AI 体验</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch-overview">
                  <span class="dropdown-title">ExecuTorch</span><p></p>
                  <p>针对移动和边缘设备实现端到端推理能力的解决方案</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch/stable/index.html">
                  <span class="dropdown-title">ExecuTorch 文档</span><p></p>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">文档</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span><p></p>
                  <p>查阅文档以获取全面指导，了解如何使用 PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/pytorch-domains">
                  <span class="dropdown-title">PyTorch 领域</span><p></p>
                  <p>阅读 PyTorch 领域文档，了解更多关于特定领域库的信息</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">博客与新闻</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/blog/">
                  <span class="dropdown-title">PyTorch 博客</span><p></p>
                  <p>跟上最新的技术新闻和动态</p>
                </a>
                 <a class="nav-dropdown-item" href="https://pytorch.org/community-blog">
                  <span class="dropdown-title">社区博客</span><p></p>
                  <p>PyTorch 生态系统中的故事</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/videos">
                  <span class="dropdown-title">视频</span><p></p>
                  <p>了解最新的 PyTorch 教程、新内容等</p>
                </a><a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">社区故事</span><p></p>
                  <p>了解我们的社区如何使用 PyTorch 解决真实、日常的机器学习问题</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">活动</span><p></p>
                  <p>查找活动、网络研讨会和播客</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/newsletter">
                  <span class="dropdown-title">通讯</span><p></p>
                  <p>跟踪最新更新</p>
                </a>
            </div>
          </div></li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">关于</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch 基金会</span><p></p>
                  <p>了解更多关于 PyTorch 基金会的信息</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/governing-board">
                  <span class="dropdown-title">管理委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/credits">
                  <span class="dropdown-title">云信用计划</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tac">
                  <span class="dropdown-title">技术顾问委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/staff">
                  <span class="dropdown-title">员工</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/contact-us">
                  <span class="dropdown-title">联系我们</span><p></p>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="https://pytorch.org/join" data-cta="join">成为会员</a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>



   

    

    <div class="table-of-contents-link-wrapper">
      <span>目录</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="https://pytorch.org/docs/versions.html">主页 (2.7.0+cpu ) ▼</a>
    </div>
    <div id="searchBox">
    <div class="searchbox" id="googleSearchBox">
      <script async="" src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>
      <div class="gcse-search"></div>
    </div>
    <div id="sphinxSearchBox" style="display: none;">
      <div role="search">
        <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
          <input type="text" name="q" placeholder="Search Docs">
          <input type="hidden" name="check_keywords" value="yes">
          <input type="hidden" name="area" value="default">
        </form>
      </div>
    </div>
  </div>
  <form id="searchForm">
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="google" checked="">Google 搜索</label>
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="sphinx">经典搜索</label>
  </form>

  <script>
     document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('searchForm');
      const googleSearchBox = document.getElementById('googleSearchBox');
      const sphinxSearchBox = document.getElementById('sphinxSearchBox');
      // Function to toggle search box visibility
      function toggleSearchBox(searchType) {
        googleSearchBox.style.display = searchType === 'google' ? 'block' : 'none';
        sphinxSearchBox.style.display = searchType === 'sphinx' ? 'block' : 'none';
      }
      // Determine the default search type
      let defaultSearchType;
      const currentUrl = window.location.href;
      if (currentUrl.startsWith('https://pytorch.org/docs/stable')) {
        // For the stable documentation, default to Google
        defaultSearchType = localStorage.getItem('searchType') || 'google';
      } else {
        // For any other version, including docs-preview, default to Sphinx
        defaultSearchType = 'sphinx';
      }
      // Set the default search type
      document.querySelector(`input[name="searchType"][value="${defaultSearchType}"]`).checked = true;
      toggleSearchBox(defaultSearchType);
      // Event listener for changes in search type
      searchForm.addEventListener('change', function(event) {
        const selectedSearchType = event.target.value;
        localStorage.setItem('searchType', selectedSearchType);
        toggleSearchBox(selectedSearchType);
      });
      // Set placeholder text for Google search box
      window.onload = function() {
        var placeholderText = "Search Docs";
        var googleSearchboxText = document.querySelector("#gsc-i-id1");
        if (googleSearchboxText) {
          googleSearchboxText.placeholder = placeholderText;
          googleSearchboxText.style.fontFamily = 'FreightSans';
          googleSearchboxText.style.fontSize = "1.2rem";
          googleSearchboxText.style.color = '#262626';
        }
      };
    });
  </script>

          </div>

          

<div>
  <a style="color:#F05732" href="https://pytorch.org/docs/stable/_modules/torch/nn/modules/module.html">您正在查看不稳定开发者预览文档。请点击此处查看最新稳定版本的文档。</a>
</div>


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">社区</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/build_ci_governance.html">PyTorch 治理 | 构建 + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contribution_guide.html">PyTorch 贡献指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/design.html">PyTorch 设计哲学</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/governance.html">PyTorch 治理 | 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/persons_of_interest.html">PyTorch 治理 | 维护者</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者笔记</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/amp_examples.html">自动混合精度示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/autograd.html">Autograd 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/broadcasting.html">广播语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/cpu_threading_torchscript_inference.html">CPU 多线程和 TorchScript 推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/cuda.html">CUDA 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/custom_operators.html">PyTorch 自定义算子页面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/ddp.html">分布式数据并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/extending.html">扩展 PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/extending.func.html">使用 autograd.Function 扩展 torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/faq.html">常见问题解答</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/fsdp.html">FSDP 笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/get_start_xpu.html">在 Intel GPU 上入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/gradcheck.html">Gradcheck 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/hip.html">HIP (ROCm)语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/large_scale_deployments.html">大规模部署功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/libtorch_stable_abi.html">LibTorch 稳定 ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/modules.html">模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/mps.html">MPS 后端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/multiprocessing.html">多进程最佳实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/numerical_accuracy.html">数值精度</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/randomness.html">可重复性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/serialization.html">序列化语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notes/windows.html">Windows 常见问题解答</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语言绑定</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensor_attributes.html">索引属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensor_view.html">张量视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accelerator.html">torch.accelerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpu.html">torch.cpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch_cuda_memory.html">理解 CUDA 内存使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch_cuda_memory.html#generating-a-snapshot">生成快照</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch_cuda_memory.html#using-the-visualizer">使用可视化工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch_cuda_memory.html#snapshot-api-reference">摄像头 API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mps.html">torch.mps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../xpu.html">torch.xpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtia.html">torch.mtia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mtia.memory.html">torch.mtia.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../meta.html">元设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../export.html">torch.export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.tensor.html">torch.distributed.tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.fsdp.fully_shard.html">torch.distributed.fsdp.fully_shard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.tensor.parallel.html">torch.distributed.tensor.parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.pipelining.html">torch.distributed.pipelining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed.checkpoint.html">torch.distributed.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.compiler.html">torch.compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../func.html">torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fx.experimental.html">torch.fx.experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../signal.html">torch.signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.attention.html">torch.nn.attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../complex_numbers.html">复数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ddp_comm_hooks.html">DDP 通信钩子</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quantization.html">量化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rpc.html">分布式 RPC 框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../masked.html">torch.masked</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../size.html">torch.Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils.html">torch.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deterministic.html">torch.utils.deterministic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jit_utils.html">torch.utils.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../module_tracker.html">torch.utils.module_tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../type_info.html">类型信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../named_tensor.html">命名张量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../name_inference.html">命名张量操作覆盖率</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../config_mod.html">torch.__config__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../future_mod.html">torch.__future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logging.html">torch._logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch_environment_variables.html">Torch 环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">库</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">火炬推荐</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/ao">torchao</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        文档 &gt;</li>

        
          <li>模块代码 &gt;</li>
        
          <li><a href="../../../torch.html">torch</a> &gt;</li>
        
      <li>torch.nn.modules 下的 module 模块</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">快捷键</div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>torch.nn.modules.module 的源代码</font></font></font></h1><div class="highlight"><pre><span></span><span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># mypy: 允许未类型化定义</span>

<span class="kn">导入</span> <span class="nn">functools</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查</span>
<span class="kn">导入</span> <span class="nn">itertools</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弱引用</span>
<span class="kn">来自</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">命名元组</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">来自</font></font></font></span> <span class="nn">collections.abc</span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">迭代器</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">映射</span>
<span class="kn">来自</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">打字</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">过载</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型变量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</span>
<span class="kn">来自</font></font></font></span> <span class="nn">typing_extensions</span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自身</span>

<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</span>
<span class="kn">来自</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span>
<span class="kn">来自</font></font></font></span> <span class="nn">torch._prims_common</span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">DeviceLikeType</span>
<span class="kn">来自</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch.nn 参数</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span>
<span class="kn">来自</font></font></font></span> <span class="nn">torch.utils._python_dispatch</span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可追踪包装子类</span>
<span class="kn">来自</font></font></font></span> <span class="nn">torch.utils.hooks</span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向后钩</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可移除句柄</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">注册模块前向预处理钩子</span><span class="p">,</span>
    <span class="s2">注册模块前向钩子</span><span class="p">,</span>
    <span class="s2">"注册模块完整反向钩子"</span><span class="p">,</span>
    <span class="s2">"注册模块反向钩子"</span><span class="p">,</span>
    <span class="s2">"注册模块完整反向钩子"</span><span class="p">,</span>
    <span class="s2">"注册模块缓冲区注册钩子"</span><span class="p">,</span>
    <span class="s2">"注册模块模块注册钩子"</span><span class="p">,</span>
    <span class="s2">"注册模块参数注册钩子"</span><span class="p">,</span>
    <span class="s2">"模块"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">_grad_t</span> <span class="o">=</span> <span class="n">联盟</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">]</span>
<span class="c1"># 请参阅 https://mypy.readthedocs.io/en/latest/generics.html#generic-methods-and-generic-self 了解用法</span>
<span class="c1">要注解`self`的`T`的数量。许多`Module`的方法返回`self`，我们希望那些返回值是</span>
<span class="c1">子类的类型，而不是`Module`的更宽松类型。</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">类型变量</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">绑定</font></font></font></span><span class="o">=</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</span><span class="p">)</span>


<span class="k">类</font></font></font></span> <span class="nc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_不兼容键</span><span class="p">(</span>
    <span class="n">命名元组</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"不兼容的键"</font></font></font></span><span class="p">,</span> <span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"缺少的键"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"意外的键"</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
<span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少键</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期之外的键</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"&lt;所有键匹配成功&gt;"</span>
        <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">超级</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="fm">__repr__</span>


<span class="k">def</span> <span class="nf">_addindent</span><span class="p">(</span><span class="n">s_</span><span class="p">,</span> <span class="n">numSpaces</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s_</span><span class="o">.</span><span class="n">分割</font></font></font></span><span class="p">(</span><span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1">#不要对单行内容进行操作</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">返回</span> <span class="n">s_</span>
    <span class="n">第一</font></font></font></span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弹出</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</font></font></font></span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">空格数量</font></font></font></span> <span class="o">*</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本为空，请提供需要翻译的文本</font></font></font></span><span class="p">)</span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">行</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">行</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">s</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">"</span><span class="se">输入文本翻译为简体中文为：\n</font></font></font></span><span class="s2">"</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">第一</font></font></font></span> <span class="o">+</span> <span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</span><span class="s2">"</span> <span class="o">+</span> <span class="n">s</span>
    <span class="k">返回</span> <span class="n">s</span>


<span class="sa">r</span><span class="sd">"""这跟踪所有模块在执行前立即执行的常见钩子</span>
<span class="sd">注册缓冲区/模块/参数"""</span>
<span class="n">全局缓冲区注册钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">全局模块注册钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">全局参数注册钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>


<span class="k">类</font></font></font></span> <span class="nc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">包装钩子</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">初始化</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">:</span> <span class="n">可调用</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">更新包装器</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">使用模块</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">模块</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弱引用</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参考类型</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弱引用</font></font></font></span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">with_module</span> <span class="o">=</span> <span class="kc">真实</span>

    <span class="k">def</span> <span class="fm">__调用__</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用模块</span><span class="p">:</span>
            <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">()</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"你正在尝试调用已死亡模块的钩子！"</span><span class="p">)</span>
            <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">字典</span><span class="p">:</span>
        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="p">{</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">with_module</font></font></font></span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用模块</span><span class="p">}</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用模块</span><span class="p">:</span>
            <span class="n">结果</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">()</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">状态</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">钩子</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_module</span> <span class="o">=</span> <span class="n">状态</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">with_module</span><span class="p">]</span>

        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用模块</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">]</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                    <span class="s2">"您正在尝试复活已死亡的模块的钩子！"</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弱引用</font></font></font></span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">])</span>


<span class="sa">r</span><span class="sd">"这跟踪了所有模块共有的钩子，这些钩子在模块执行前后被调用。"</span>
<span class="sd">这些是用于调试/性能分析的全局状态。</span>
<span class="sd">目的</span>
<span class="n">_全局反向前钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">_全局反向钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">_全局是否完全反向钩子</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
<span class="n">_全局前置钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">_全局正向钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">_全局前进钩子始终被调用</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
<span class="n">_global_forward_hooks_with_kwargs</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>

<span class="n">_EXTRA_STATE_KEY_SUFFIX</span> <span class="o">=</span> <span class="s2">"_extra_state"</span>


<div class="viewcode-block" id="register_module_buffer_registration_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 注册模块缓冲区注册钩子(
钩子: 可调用[...None],
) -&gt; RemovableHandle:
注册所有模块通用的缓冲区注册钩子。

.. 警告 ::

这将为 `nn.Module` 模块添加全局状态

每次调用 :func:`register_buffer` 时都会调用此钩子。
它应该具有以下签名::

钩子可以修改输入或返回单个修改后的值。

钩子可以修改输入或返回单个修改后的值。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()
"""
handle = RemovableHandle(_global_buffer_registration_hooks)
_global_buffer_registration_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_module_registration_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_module_registration_hook(
钩子: Callable[..., None],
) -&gt; RemovableHandle:
r"""注册一个对所有模块都通用的模块注册钩子。

..警告::

这将为`nn.Module`模块添加全局状态

每次调用`:func:`register_module`时都会调用此钩子。
它应该具有以下签名::

hook(module, name, submodule) -&gt; None 或新子模块

钩子可以修改输入或返回单个修改后的值

返回：
class:`torch.utils.hooks.RemovableHandle`:
可以用来通过调用 handle.remove()移除已添加的钩子的句柄
``handle.remove()``
"""
handle = RemovableHandle(_global_module_registration_hooks)
_global_module_registration_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_parameter_registration_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_parameter_registration_hook(
hook: Callable[..., None],
) -&gt; RemovableHandle:
注册所有模块通用的参数注册钩子。

.. 警告 ::

这将为 `nn.Module` 模块添加全局状态

每次调用 :func:`register_parameter` 时都会调用此钩子。
它应该具有以下签名::

钩子(module, name, param) -&gt; None 或新的参数

钩子可以修改输入或返回单个修改后的值。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()
"""
handle = RemovableHandle(_global_parameter_registration_hooks)
_global_parameter_registration_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_forward_pre_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_forward_pre_hook(hook: Callable[..., None]) -&gt; RemovableHandle:
r"""注册所有模块通用的前向钩子。

.. 警告 ::

这将为 `nn.module` 模块添加全局状态
仅用于调试/性能分析目的。

钩子将在每次调用 :func:`forward` 之前被调用。
它应该具有以下签名：

hook(模块, 输入) -&gt; 无或修改后的输入

输入仅包含传递给模块的位置参数。
关键字参数不会传递给钩子，只传递给 `forward`。
钩子可以修改输入。用户可以返回一个元组或一个
钩子中单个修改的值。我们将值包装成一个元组
如果返回单个值（除非该值已经是元组）。

此钩子优先于已注册到特定模块的钩子。
``register_forward_pre_hook``。

返回：
`torch.utils.hooks.RemovableHandle`:
可以用来通过调用 `handle.remove()` 移除已添加的钩子的句柄
``handle.remove()``
"""
handle = RemovableHandle(_global_forward_pre_hooks)
_global_forward_pre_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_forward_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_forward_hook(
hook: 可调用函数[...None],
    *,
with_kwargs: 布尔型 = False,
always_call: 布尔型 = False,
) -&gt; RemovableHandle:
注册全局前向钩子，适用于所有模块。

.. 警告 ::

这将为 `nn.module` 模块添加全局状态
仅用于调试/性能分析目的。

钩子将在每个 :func:`forward` 计算输出之后被调用。
它应该具有以下签名：

hook(模块, 输入, 输出) -&gt; 无或修改后的输出

输入仅包含传递给模块的位置参数。
关键字参数不会传递给钩子，只会传递给 `forward`。
您可以选择性地通过返回新值来修改模块的输出。
该值将替换来自 :func:`forward` 函数的输出。

参数：
钩子（Callable）：用户定义的注册钩子。
总是调用（布尔值）：如果为 ``True``，则无论何种情况都会运行 ``hook``
是否在调用模块时引发异常。
默认：``False``
返回：
class:`torch.utils.hooks.RemovableHandle`:
可以通过调用来移除已添加的钩子的句柄
``handle.remove()``

此钩子将在注册特定模块钩子之前执行
``register_forward_hook``.
"""
handle = RemovableHandle(
_global_forward_hooks, extra_dict=_global_forward_hooks_always_called
    )
_global_forward_hooks[handle.id] = hook
如果使用 with_kwargs:
_global_forward_hooks_with_kwargs[handle.id] = True
如果总是调用:
_global_forward_hooks_always_called[handle.id] = True
返回处理</font></font></font></div>


<div class="viewcode-block" id="register_module_backward_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 注册模块反向钩子(
钩子: Callable[["模块", _grad_t, _grad_t], Union[None, _grad_t]],
) -&gt; 可移除句柄:
注册对所有模块通用的反向钩子。

此函数已被弃用，推荐使用
func:`torch.nn.modules.module.register_module_full_backward_hook`
，并且此函数的行为将在未来的版本中发生变化。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()

"""
global _global_is_full_backward_hook
如果 _global_is_full_backward_hook 为 True：
抛出 RuntimeError(
"不能同时使用常规反向钩子和完整反向钩子作为全局模块钩子。请只使用其中一个。"
"全局模块钩子。请只使用其中一个。"
        )

_global_is_full_backward_hook = False

handle = RemovableHandle(_global_backward_hooks)
_global_backward_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_full_backward_pre_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_full_backward_pre_hook(
hook: Callable[["模块", _grad_t], Union[None, _grad_t]],
) -&gt; RemovableHandle:
r"""注册所有模块通用的反向前钩子。

..警告::
这将为`nn.module`模块添加全局状态
并且仅适用于调试/性能分析目的。

使用此函数注册的钩子行为与那些
通过 :meth:`torch.nn.Module.register_full_backward_pre_hook` 注册。
更多详情请参阅其文档。

使用此函数注册的钩子将在使用 :meth:`torch.nn.Module.register_full_backward_pre_hook` 注册的钩子之前被调用。
使用 :meth:`torch.nn.Module.register_full_backward_pre_hook` 注册的钩子之前被调用。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()

"""
handle = RemovableHandle(_global_backward_pre_hooks)
_global_backward_pre_hooks[handle.id] = hook
return handle</font></font></font></div>


<div class="viewcode-block" id="register_module_full_backward_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def register_module_full_backward_hook(
hook: Callable[["模块", _grad_t, _grad_t], Union[None, _grad_t]],
) -&gt; RemovableHandle:
r"""注册适用于所有模块的通用反向钩子。

..警告::
这将为`nn.module`模块添加全局状态
并且仅适用于调试/性能分析目的。

使用此函数注册的钩子行为与那些
通过 :meth:`torch.nn.Module.register_full_backward_hook` 注册。
更多详情请参阅其文档。

使用此函数注册的钩子将在使用 :meth:`torch.nn.Module.register_full_backward_hook` 注册的钩子之前调用。
使用 :meth:`torch.nn.Module.register_full_backward_hook` 注册的钩子。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()

"""
global _global_is_full_backward_hook
如果 _global_is_full_backward_hook 为 False：
抛出 RuntimeError(
"不能同时使用常规反向钩子和完整反向钩子作为全局模块钩子。请只使用其中一个。"
"全局模块钩子。请只使用其中一个。"
        )

_global_is_full_backward_hook = True

handle = RemovableHandle(_global_backward_hooks)
_global_backward_hooks[handle.id] = hook
return handle</font></font></font></div>


<span class="c1"># 欺骗 mypy 不应用逆变规则到输入，通过定义</span>
<span class="c1"># 将值作为函数，而不是函数。另请参阅</span>
<span class="c1"># https://github.com/python/mypy/issues/8795</span>
<span class="k">def</span> <span class="nf">_未实现的前向</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">"""定义每次调用时执行的计算。</span>

<span class="sd">应被所有子类覆盖。</span>

<span class="sd">.. 注意::</span>
<span class="sd">尽管前向传播的算法需要在内部定义</span>
<span class="sd">此函数之后应调用 :class:`Module` 实例</span>
<span class="sd">而不是这个，因为前者负责运行</span>
<span class="sd">注册的钩子，而后者则静默忽略它们。</span>
<span class="sd">"源代码"</span>
    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不支持的操作异常</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">模块[</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少所需的 "forward" 函数</span>
    <span class="p">)</span>


<div class="viewcode-block" id="Module"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</font></font></font></span> <span class="nc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">神经网络模块的基类。</span>

<span class="sd">您的模型也应该继承这个类。</span>

<span class="sd">模块还可以包含其他模块，允许它们以嵌套形式存在。</span>
<span class="sd">您可以将子模块作为常规属性分配，形成树状结构。</span>

<span class="sd">导入 torch.nn 作为 nn</span>
<span class="sd">导入 torch.nn.functional 作为 F</span>

<span class="sd">        class Model(nn.Module):</span>
<span class="sd">            def __init__(self) -&gt; None:</span>
<span class="sd">                super().__init__()</span>
<span class="sd">                self.conv1 = nn.Conv2d(1, 20, 5)</span>
<span class="sd">                self.conv2 = nn.Conv2d(20, 20, 5)</span>

<span class="sd">            def forward(self, x):</span>
<span class="sd">                x = F.relu(self.conv1(x))</span>
<span class="sd">返回 F.relu(self.conv2(x))</span>

<span class="sd">这种方式分配的子模块将被注册，并且也将被注册</span>
<span class="sd">参数在调用 :meth:`to` 等时被转换。</span>

<span class="sd">.. 注意::</span>
<span class="sd">根据上述示例，对父类进行 `__init__()` 调用</span>
<span class="sd">必须在分配给子对象之前进行。</span>

<span class="sd">ivar training: 布尔值表示此模块是否处于训练或</span>
<span class="sd">评估模式。</span>
<span class="sd">vartype training: bool</span>
<span class="sd">"源代码"</span>

    <span class="n">导出补丁</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

    <span class="n">_版本</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整型</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">这允许对 :meth:`load_state_dict` 的更好向后兼容性支持。</span>
<span class="sd">:meth:`state_dict`, 版本号将保存为属性中</span>
<span class="sd">返回状态字典的 `_metadata`，因此被序列化。`_metadata` 是</span>
<span class="sd">字典的键遵循 state dict 的命名约定。</span>
<span class="sd">从状态字典加载的用法说明。</span>

<span class="sd">如果从模块中添加/删除新参数/缓冲区，此数值应</span>
<span class="sd">被更新，并且模块的 `_load_from_state_dict` 方法可以比较</span>
<span class="sd">版本号，如果状态字典来自之前，则进行适当的更改</span>
<span class="sd">"变化。”</span>

    <span class="n">训练</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</span>
    <span class="n">参数</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">]]</span>
    <span class="n">_缓冲区</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">]]</span>
    <span class="n">_非持久缓冲区集合</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">]</span>
    <span class="n">_backward_pre_hooks</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">_backward_hooks</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">_is_full_backward_hook</span><span class="p">:</span> <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">]</span>
    <span class="n">_前向钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="c1">标记相应的前向钩子是否接受 kwargs</span>
    <span class="c1">由于 JIT 不支持 set[int]，因此此字典用作集合，其中所有</span>
    <span class="c1">此字典中的钩子接受 kwargs 参数。</span>
    <span class="n">_forward_hooks_with_kwargs</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">]</span>
    <span class="c1">即使抛出异常也应始终调用的前向钩子</span>
    <span class="n">_forward_hooks_always_called</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">]</span>
    <span class="n">_前向预处理钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="c1">标记相应的前向钩子是否接受 kwargs</span>
    <span class="c1">由于 JIT 不支持 set[int]，因此此字典用作集合，其中所有</span>
    <span class="c1">此字典中的钩子接受 kwargs 参数。</span>
    <span class="n">_forward_pre_hooks_with_kwargs</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">]</span>
    <span class="n">状态字典钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">_load_state_dict_pre_hooks</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">_state_dict_pre_hooks</span><span class="p">:</span> <span class="nb">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">加载状态字典后钩子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span>
    <span class="n">模块</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</span><span class="p">]]</span>
    <span class="n">调用父类初始化方法</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>
    <span class="n">_编译调用实现</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>

    <span class="k">def</span> <span class="fm">初始化</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
<span class="w">        </span><span class="sd">初始化内部模块状态，由 nn.Module 和 ScriptModule 共享。</span>
        <span class="n">火炬</font></font></font></span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_log_api_usage_once</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">python.nn_module</span><span class="p">)</span>

        <span class="c1">向后兼容：当 call_super_init=False 时，不允许使用参数。</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">调用父类的 init 方法</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">类型</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'__init__' 方法收到一个意外的关键字参数 '</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">下一</font></font></font></span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">迭代</font></font></font></span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
                <span class="s2">请提供需要翻译的文本</span>
            <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">调用父类的 init 方法</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">类型</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`.__init__()` 函数接收 1 个位置参数但</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">被</span>
                <span class="s2">"赋予"</span>
            <span class="p">)</span>

<span class="w">        </span><span class="sd">""</span>
<span class="sd">调用 super().__setattr__('a', a) 而不是典型的 self.a = a</span>
<span class="sd">为了避免 Module.__setattr__ 的开销。Module 的 __setattr__ 有特殊</span>
<span class="sd">处理参数、子模块和缓冲区，但仅调用</span>
<span class="sd">super().__setattr__用于所有其他属性。</span>
<span class="sd">"源代码"</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"训练"</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_参数</span><span class="p">,</span> <span class="p">{})</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">,</span> <span class="p">{})</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非持久缓冲区设置</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向后预处理钩子</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_backward_hooks"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_is_full_backward_hook"</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">)</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_forward_hooks"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_forward_hooks_with_kwargs"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_forward_hooks_always_called"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_forward_pre_hooks"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_forward_pre_hooks_with_kwargs"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_状态字典挂钩"</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_state_dict_pre_hooks"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_加载状态字典前挂钩"</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">"_load_state_dict_post_hooks"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">())</span>
        <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_模块</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">调用父类初始化方法</span><span class="p">:</span>
            <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">初始化</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">前向</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_未实现的功能</span>

<div class="viewcode-block" id="Module.register_buffer"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.register_buffer">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册缓冲区</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久性</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">无</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">在模块中添加一个缓冲区。</span>

<span class="sd">这通常用于注册不应被视为模型参数的缓冲区。例如，BatchNorm 的`running_mean`</span>
<span class="sd">通常是用于注册不应被视为模型参数的缓冲区。例如，BatchNorm 的`running_mean`</span>
<span class="sd">不是参数，而是模块状态的一部分。缓冲区默认情况下是持久的，将与参数一起保存。此行为可以通过将：attr:`persistent` 设置为 ``False`` 来更改。持久缓冲区与非持久缓冲区之间的唯一区别</span>
<span class="sd">默认情况下，是持久的，将与参数一起保存。此行为可以通过将：attr:`persistent` 设置为 ``False`` 来更改。持久缓冲区与非持久缓冲区之间的唯一区别</span>
<span class="sd">的行为可以通过将：attr:`persistent` 设置为 ``False`` 来更改。持久缓冲区与非持久缓冲区之间的唯一区别</span>
<span class="sd">的唯一区别在于持久缓冲区和非持久缓冲区</span>
<span class="sd">这后者将不会是本模块的一部分</span>
<span class="sd">attr:`状态字典`。</span>

<span class="sd">缓冲区可以通过给定的名称作为属性进行访问。</span>

<span class="sd">        Args:</span>
<span class="sd">名称（str）：缓冲区的名称。缓冲区可以通过名称访问</span>
<span class="sd">使用给定的名称从该模块中</span>
<span class="sd">张量（Tensor 或 None）：要注册的缓冲区。如果为 ``None``，则忽略在缓冲区上运行的运算，例如 :attr:`cuda`。</span>
<span class="sd">如果为 ``None``，则该缓冲区 **不会** 包含在模块的 :attr:`state_dict` 中。</span>
<span class="sd">该缓冲区 **不会** 包含在模块的 :attr:`state_dict` 中。</span>
<span class="sd">持久化（布尔值）：缓冲区是否属于此模块的一部分</span>
<span class="sd">attr:`状态字典`。</span>

<span class="sd">示例::</span>

<span class="sd">            &gt;&gt;&gt; # xdoctest: +SKIP("undefined vars")</span>
<span class="sd">            &gt;&gt;&gt; self.register_buffer('running_mean', torch.zeros(num_features))</span>

<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">脚本模块</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">ScriptModule 不支持非持久化缓冲区</span><span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_缓冲区"</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"在调用 Module.__init__() 之前不能分配缓冲区"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">名称</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"缓冲区名称应该是字符串。得到"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="s2">"."</span> <span class="ow">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键错误</font></font></font></span><span class="p">(</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区名称可以</font></font></font></span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">‘</font></font></font></span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">t contain “.”</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">名称</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键错误</font></font></font></span><span class="p">(</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区名称可以</font></font></font></span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">‘</font></font></font></span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">t 可以为空字符串 ""</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">有属性</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"属性 '</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">已存在</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">张量</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"无法分配"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象到缓冲区</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">' "</span>
                <span class="s2">"需要(torch Tensor 或 None)"</span>
            <span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局缓冲区注册钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
                <span class="n">输出</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">)</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="n">张量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_缓冲区</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久性</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_非持久缓冲区集合</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">丢弃</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_非持久缓冲区集合</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span></div>

<div class="viewcode-block" id="Module.register_parameter"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_parameter(self, name: str, param: Optional[Parameter]) -&gt; None:
r"""添加模块参数。

可以使用给定的名称将该参数作为属性访问。

参数：
参数名称（str）：参数的名称。可以访问
从本模块使用给定名称
参数（参数或 None）：要添加到模块的参数。如果
``None``，然后运行在参数上的操作，例如：:attr:`cuda`
忽略。如果为 ``None``，则 **不** 包含该参数。
模块的 :attr:`state_dict`。
"""
如果 "_parameters" 不在 self.__dict__ 中：
raise AttributeError(
"无法在调用 Module.__init__() 之前分配参数"
            )

elif not isinstance(name, str):
raise TypeError(
f"参数名称应该是一个字符串。获取 {torch.typename(name)}"
            )
elif "." in name:
抛出 KeyError('参数名称不能包含 "."')
elif name == ""
抛出 KeyError('参数名称不能为空字符串 ""')
elif hasattr(self, name) and name not in self._parameters:
"引发 KeyError(f"属性 '{name}' 已存在")

如果 param 为 None：
self._parameters[name] = None
elif not isinstance(param, Parameter):
raise TypeError(
无法将 '{torch.typename(param)}' 对象分配给参数 '{name}' 
"(需要 torch.nn.Parameter 或 None)"
            )
elif param.grad_fn:
raise ValueError(
f"无法将非叶 Tensor 分配给参数'{name}'。模型 "
f"参数必须显式创建。要表示'{name}' "
作为另一个张量的函数，计算其值
forward() 方法。
            )
else:
for hook in _global_parameter_registration_hooks.values():
output = hook(self, name, param)
if output is not None:
param = output
self._参数[name] = param</font></font></font></div>

<div class="viewcode-block" id="Module.add_module"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def add_module(self, name: str, module: Optional["Module"]) -&gt; None:
r"""添加当前模块的子模块。

可以使用给定的名称将该模块作为属性访问。

参数:
name (str): 子模块名称。子模块可以通过给定的名称从本模块访问。
使用该名称从本模块访问子模块
module (Module): 要添加到模块中的子模块。
"""
如果不是 module 是 Module 的子类且 module 不为 None：
raise TypeError(f"{torch.typename(module)} 不是一个 Module 子类")
elif not isinstance(name, str):
raise TypeError(
模块名称应该是一个字符串。获取 {torch.typename(name)}
            )
如果 hasattr(self, name) 且 name 不在 self._modules 中：
引发 KeyError(f'属性 '{name}' 已存在')
elif "." in name:
raise KeyError(f'module name can\'t contain ".", got: {name}')
elif name == "":
raise KeyError('module name can\'t be empty string ""')
for hook in _global_module_registration_hooks.values():
output = hook(self, name, module)
if output is not None:
module = output
self._modules[name] = 模块</font></font></font></div>

<div class="viewcode-block" id="Module.register_module"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_module(self, name: str, module: Optional["Module"]) -&gt; None:
r"""别名：:func:`add_module`"""
self.add_module(name, module)</font></font></font></div>

<div class="viewcode-block" id="Module.get_submodule"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.get_submodule">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取子模块</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"如果存在，则返回由 `target` 指定的子模块，否则抛出错误。"</span>

<span class="sd">例如，假设你有一个 `nn.Module` 类型的 `A` 模块，</span>
<span class="sd">看起来像这样：</span>

<span class="sd">.. 代码块:: text</span>

<span class="sd">            A(</span>
<span class="sd">(net_b): 模块(</span>
<span class="sd">(net_c): 模块(</span>
<span class="sd">(conv): 卷积层 2d(16, 33, 核大小=(3, 3), 步长=(2, 2))</span>
<span class="sd">                    )</span>
<span class="sd">(线性): 线性(in_features=100, out_features=200, bias=True)</span>
<span class="sd">                )</span>
<span class="sd">            )</span>

<span class="sd">(图示一个名为 ``nn.Module`` 的 ``A`` 模块。``A`` 模块包含一个嵌套的</span>
<span class="sd">子模块 ``net_b``，该子模块本身又包含两个子模块 ``net_c``</span>
<span class="sd">和 ``linear``。然后 ``net_c`` 模块包含一个子模块 ``conv``。)</span>

<span class="sd">检查我们是否有“linear”子模块</span>
<span class="sd">将 `get_submodule("net_b.linear")` 调用。为了检查</span>
<span class="sd">我们有 `conv` 子模块，我们会调用</span>
<span class="sd">获取子模块("net_b.net_c.conv")。</span>

<span class="sd">``get_submodule`` 的运行时间受 ``target`` 中模块嵌套程度的限制</span>
<span class="sd">对 ``target`` 的查询</span>
<span class="sd">`named_modules` 实现了相同的结果，但它是 O(N) 的</span>
<span class="sd">传递模数的数量。因此，为了进行简单的检查，</span>
<span class="sd">如果某些子模块存在，`get_submodule` 应始终</span>
<span class="sd">已使用。</span>

<span class="sd">        Args:</span>
<span class="sd">目标：子模块的完全限定字符串名称</span>
<span class="sd">寻找。 (参见上方示例了解如何指定完全限定的字符串。)</span>
<span class="sd">模块：设置子模块的模块。</span>

<span class="sd">返回：</span>
<span class="sd">torch.nn.Module：由 `target` 引用的子模块</span>

<span class="sd">抛出异常：</span>
<span class="sd">AttributeError：如果在由路径导致的任何点，路径解析到一个不存在的属性名或不是`nn.Module`的实例。</span>
<span class="sd">目标字符串的（子）路径解析到一个不存在的</span>
<span class="sd">如果属性名不存在或不是`nn.Module`的实例。</span>
<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="k">返回</span> <span class="bp">self</span>

        <span class="n">原子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“点”</span><span class="p">)</span>
        <span class="n">模块</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">):</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</span><span class="p">(</span>
                    <span class="n">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取名称</font></font></font></span><span class="p">()</span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"没有属性“”</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`</span>
                <span class="p">)</span>

            <span class="n">修饰</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">)</span>

            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"“”不是一个 nn.Module"</span><span class="p">)</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span></div>

<div class="viewcode-block" id="Module.set_submodule"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.set_submodule">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置子模块</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">目标</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">:</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">严格的</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">无</span><span class="p">:</span>
<span class="w">        </span><span class="sd">""</span>
<span class="sd">如果存在，设置由`target`指定的子模块，否则抛出错误。</span>

<span class="sd">.. 注意::</span>
<span class="sd">如果`strict`设置为`False`（默认），则该方法将替换现有的子模块</span>
<span class="sd">或者如果父模块存在，则创建一个新的子模块。如果将 `strict` 设置为 `True`，</span>
<span class="sd">该方法将仅尝试替换现有的子模块，如果子模块不存在，则抛出错误。</span>
<span class="sd">例如，假设你有一个 `nn.Module` 类型的 `A` 模块，</span>

<span class="sd">例如，假设你有一个 `nn.Module` 类型的 `A` 模块，</span>
<span class="sd">看起来像这样：</span>

<span class="sd">.. 代码块:: text</span>

<span class="sd">            A(</span>
<span class="sd">(net_b): 模块(</span>
<span class="sd">(net_c): 模块(</span>
<span class="sd">                        (conv): Conv2d(3, 3, 3)</span>
<span class="sd">                    )</span>
<span class="sd">                    (linear): Linear(3, 3)</span>
<span class="sd">                )</span>
<span class="sd">            )</span>

<span class="sd">(图示为 ``nn.Module`` 的 ``A``。``A`` 包含一个嵌套的</span>
<span class="sd">子模块 ``net_b``，该子模块本身又包含两个子模块 ``net_c``</span>
<span class="sd">和 ``linear``。然后 ``net_c`` 模块包含一个子模块 ``conv``。)</span>

<span class="sd">要用新的子模块 `Linear` 覆盖 `Conv2d`，</span>
<span class="sd">可以调用 `set_submodule("net_b.net_c.conv", nn.Linear(1, 1))`</span>
<span class="sd">其中 `strict` 可以是 `True` 或 `False`</span>

<span class="sd">要将新的子模块 `Conv2d` 添加到现有的 `net_b` 模块中，</span>
<span class="sd">你将调用 `set_submodule("net_b.conv", nn.Conv2d(1, 1, 1))`。</span>

<span class="sd">在上面的代码中，如果你将 `strict=True` 设置为 True 并调用</span>
<span class="sd">`set_submodule("net_b.conv", nn.Conv2d(1, 1, 1), strict=True)`，将会引发一个 AttributeError 异常，</span>
<span class="sd">因为 `net_b` 没有名为 `conv` 的子模块。</span>

<span class="sd">        Args:</span>
<span class="sd">目标：子模块的完全限定字符串名称</span>
<span class="sd">寻找。 (参见上方示例了解如何指定完全限定的字符串。)</span>
<span class="sd">模块：设置子模块的模块。</span>
<span class="sd">模块：设置子模块的模块。</span>
<span class="sd">严格：如果 `False`，该方法将替换现有的子模块</span>
<span class="sd">或如果父模块存在，则创建一个新的子模块。如果 ``True``，</span>
<span class="sd">该方法将仅尝试替换现有子模块并抛出错误</span>
<span class="sd">如果子模块已经存在。</span>

<span class="sd">抛出异常：</span>
<span class="sd">ValueError：如果`target`字符串为空或者`module`不是`nn.Module`的实例。</span>
<span class="sd">AttributeError：如果在由路径导致的任何点，路径解析到一个不存在的属性名或不是`nn.Module`的实例。</span>
<span class="sd">在`target`字符串中，如果（子）路径解析到一个不存在的属性名或不是`nn.Module`的实例。</span>
<span class="sd">如果属性名不存在或不是`nn.Module`的实例。</span>
<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无法设置没有目标名称的子模块！</span><span class="p">)</span>

        <span class="n">原子</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目标</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“点”</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
            <span class="k">提升</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">`</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span> <span class="o">+</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`不是 nn.Module，找到</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">父节点</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">父键</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“点”</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">父级</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取子模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">父键</span><span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">严格的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow">not</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">父节点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</span><span class="p">(</span>
                <span class="n">父节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取名称</font></font></font></span><span class="p">()</span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"没有属性“”</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`</span>
            <span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">父节点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
            <span class="n">修饰</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">父节点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">`</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"“”不是一个 nn.Module"</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">父节点</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">原子</font></font></font></span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span></div>

<div class="viewcode-block" id="Module.get_parameter"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def get_parameter(self, target: str) -&gt; "参数":
返回由 `target` 给定的参数（如果存在），否则抛出错误。

查看`get_submodule`的文档字符串以获取更详细的信息
本方法功能说明以及如何使用
正确指定 ``target``。

Args:
target: 要查找的参数的完全限定字符串名称
（有关如何指定，请参阅 ``get_submodule``）。
完全限定的字符串。)

返回：
torch.nn.Parameter：由 ``target`` 引用的参数

引发：
属性错误：如果目标字符串引用了无效的路径或解析为不是
的 ``nn.Parameter``
的内容
"""
module_path, _, param_name = target.rpartition(".")

mod: torch.nn.Module = self.get_submodule(module_path)

if not hasattr(mod, param_name):
raise AttributeError(
mod._get_name() 没有属性 `" + param_name + "`"
            )

param: torch.nn.Parameter = getattr(mod, param_name)

如果 param 不是 torch.nn.Parameter 类型：
抛出 AttributeError("`" + param_name + "` 不是一个 nn.Parameter")

返回 param</font></font></font></div>

<div class="viewcode-block" id="Module.get_buffer"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def get_buffer(self, target: str) -&gt; "Tensor":
返回由 ``target`` 给定的缓冲区，如果存在，否则抛出错误。

查看文档字符串以获取 ``get_submodule`` 的更详细说明，以及此方法的功能以及如何正确指定 ``target``。
以及如何正确指定 ``target`` 的说明。
Args:

参数：
目标：缓冲区的完全限定字符串名称
查找。（有关如何指定，请参阅 ``get_submodule``）
完全限定的字符串。

返回：
torch.Tensor：由“target”引用的缓冲区

引发异常：
属性错误：如果目标字符串引用无效
路径或解析为不是
缓冲区
"""
模块路径， _, 缓冲区名称 = target.rpartition(".")

mod: torch.nn.Module = self.get_submodule(模块路径)

如果 mod 对象没有名为 buffer_name 的属性：
则抛出 AttributeError 异常(
mod._get_name()方法返回的字符串 + " 没有属性 `" + buffer_name + "`"
            )

buffer: torch.Tensor = getattr(mod, buffer_name)

if buffer_name not in mod._buffers:
raise AttributeError("`" + buffer_name + "` is not a buffer")

return buffer</font></font></font></div>

<div class="viewcode-block" id="Module.get_extra_state"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def get_extra_state(self) -&gt; 任意:
返回任何需要包含在模块的状态字典中的额外状态。

实现此功能以及为您的模块对应的 :func:`set_extra_state` 方法
如果您需要存储额外的状态。此函数在构建时被调用。
模块的 `state_dict()`。

注意额外的状态应该是可序列化的，以确保状态字典的序列化工作正常。
我们只为序列化张量提供向后兼容性保证。
其他对象可能会破坏向后兼容性，如果
他们的序列化 pickle 形式会改变。

返回：
object：存储在模块的状态字典中的任何额外状态
"""
raise RuntimeError(
"在 Module.get_extra_state()中到达了一个不应该被调用的代码路径。"
"请在此处提交一个问题：https://github.com/pytorch/pytorch/issues/new?template=bug-report.yml"
"以报告此错误。"
        )</font></font></font></div>

<div class="viewcode-block" id="Module.set_extra_state"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def set_extra_state(self, state: Any) -&gt; None:
"""设置加载的 `state_dict` 中包含的额外状态。

此函数从 :func:`load_state_dict` 调用，用于处理任何额外状态
在`state_dict`中找到。实现此函数以及相应的
func:`get_extra_state`函数，如果你的模块需要在其`state_dict`中存储额外的状态
`state_dict`。

参数：
state（字典）：来自 `state_dict` 的额外状态
"""
raise RuntimeError(
"在 Module.set_extra_state() 中达到了一个不应该被调用的代码路径。"
"请在此处提交问题：https://github.com/pytorch/pytorch/issues/new?template=bug-report.yml"
"以报告此错误。"
        )</font></font></font></div>

    <span class="k">def</span> <span class="nf">应用</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">递归</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">递归</span><span class="p">:</span>
            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">儿童</span><span class="p">():</span>
                <span class="n">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">compute 应该使用 set_data</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量应用</span><span class="p">):</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">具有兼容的浅拷贝类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量应用</span><span class="p">):</span>
                <span class="c1"># 如果新张量与现有张量具有兼容的张量类型，</span>
                <span class="c1">当前行为是使用 `.data=` 在原地更改张量。</span>
                <span class="c1"># 和未来的行为是覆盖现有的张量。</span>
                <span class="c1">修改当前行为是一个向后不兼容的变更，我们希望它</span>
                <span class="c1">将在未来版本中实现。所以目前我们引入了</span>
                <span class="c1">`torch.__future__.get_overwrite_module_params_on_conversion()`</span>
                <span class="c1">全局标志，允许用户控制他们是否想要未来的</span>
                <span class="c1"># 是否覆盖现有张量的行为。</span>
                <span class="k">返回</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未来</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取转换时的覆盖模块参数</span><span class="p">()</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="k">返回</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>

        <span class="n">应使用交换张量</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未来</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在转换时获取交换模块参数</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">继续</span>
            <span class="c1">模块中存储的张量是图叶子节点，我们不希望</span>
            <span class="c1">跟踪 `param_applied` 的 autograd 历史，因此我们必须使用</span>
            <span class="c1">`with torch.no_grad():`</span>
            <span class="k">与</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不梯度</span><span class="p">():</span>
                <span class="n">应用参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span>
            <span class="n">应该使用 set_data</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">compute 应该使用 set_data</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用参数</span><span class="p">)</span>

            <span class="c1">子类可能有多个子张量，因此我们需要使用 swap_tensors</span>
            <span class="n">应该使用交换张量</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">应使用交换张量</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可追踪包装子类</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用参数</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">参数梯度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应该使用 swap_tensors</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                        <span class="c1">访问 param.grad 会使它的 at::Tensor 的使用计数变为 2，这将防止交换。</span>
                        <span class="c1">将梯度使用计数减至 None</span>
                        <span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
                    <span class="n">应用参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">(</span>
                        <span class="n">应用参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="o">.</span><span class="n">requires_grad</span>
                    <span class="p">)</span>
                    <span class="n">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">工具</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换张量</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用参数</span><span class="p">)</span>
                <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                        <span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</span>
                    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"_apply()：无法交换"</font></font></font></span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取名称</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span> <span class="kn">来自</span> <span class="nn">e</span>
                <span class="n">输出参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span>
            <span class="k">elif</span> <span class="n">应使用设置数据</span><span class="p">:</span>
                <span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用参数</span>
                <span class="n">输出参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="k">断言</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span>
                <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">叶子节点</span>
                <span class="n">输出参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">参数</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出参数</span>

            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">与</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不梯度</span><span class="p">():</span>
                    <span class="n">应用梯度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</span><span class="p">)</span>
                <span class="n">应该使用设置数据</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">compute 应该使用 set_data</span><span class="p">(</span>
                    <span class="n">参数梯度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用梯度</span>
                <span class="p">)</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应该使用 swap_tensors</span><span class="p">:</span>
                    <span class="n">应用梯度</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">工具</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换张量</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用梯度</span><span class="p">)</span>
                    <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"_apply()：无法交换"</font></font></font></span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取名称</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="si">}</span><span class="s2">.grad"</span>
                        <span class="p">)</span> <span class="kn">来自</span> <span class="nn">e</span>
                    <span class="n">输出参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</span>
                <span class="k">elif</span> <span class="n">g 是否使用 setData</span><span class="p">:</span>
                    <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
                    <span class="n">输出参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">研究生</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用梯度</span>
                <span class="k">否则</span><span class="p">:</span>
                    <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数梯度</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">叶子节点</span>
                    <span class="n">输出参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用梯度</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度_</span><span class="p">(</span>
                        <span class="n">参数梯度</span><span class="o">.</span><span class="n">requires_grad</span>
                    <span class="p">)</span>

        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_缓冲区</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</span><span class="p">)</span>

        <span class="k">返回</span> <span class="bp">self</span>

<div class="viewcode-block" id="Module.apply"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def apply(self: T, fn: Callable[["模块"], None]) -&gt; T:
r"""递归地对每个子模块（由 ``.children()`` 返回）以及自身应用 ``fn``。

常规用法包括初始化模型的参数
（另见 :ref:`nn-init-doc`）。

Args:
fn (:class:`模块` -&gt; None): 对每个子模块应用的功能

Returns:
模块: self

示例::

&gt;&gt;&gt; @torch.no_grad()
&gt;&gt;&gt; def 初始化权重(m):
&gt;&gt;&gt;     打印(m)
&gt;&gt;&gt; 如果类型为 nn.Linear:
&gt;&gt;&gt; m.weight.fill_(1.0)
&gt;&gt;&gt; 打印(m.weight)
&gt;&gt;&gt; net = nn.Sequential(nn.Linear(2, 2), nn.Linear(2, 2))
&gt;&gt;&gt; net.apply(init_weights)
Linear(in_features=2, out_features=2, bias=True)
包含参数：
tensor([[1., 1.],
[1., 1.], requires_grad=True)
Linear(in_features=2, out_features=2, bias=True)
包含参数的
tensor([[1., 1.],
[[1., 1.]], requires_grad=True)
Sequential(
(0): 线性层(in_features=2, out_features=2, bias=True)
(1): 线性层(in_features=2, out_features=2, bias=True)
            )

"""
for module in self.children():
module.apply(fn)
fn(self)
return self</font></font></font></div>

<div class="viewcode-block" id="Module.cuda"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def cuda(self: T, device: Optional[Union[int, device]] = None) -&gt; T:
r"""将所有模型参数和缓冲区移动到 GPU 上。

这也使得相关的参数和缓冲区成为不同的对象。因此
应在模块在 GPU 上优化时调用之前进行。
当模块在优化时存在于 GPU 上，应该先调用它。

.. 注意::
此方法会就地修改模块。

参数：
设备（int，可选）：如果指定，所有参数都将
复制到该设备

返回值：
模块：self
"""
返回 self._apply(lambda t: t.cuda(device))</font></font></font></div>

<div class="viewcode-block" id="Module.ipu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def ipu(self: T, device: Optional[Union[int, device]] = None) -&gt; T:
r"""将所有模型参数和缓冲区移动到 IPU。

这也将使相关的参数和缓冲区成为不同的对象。因此
它应该在构建优化器之前调用，如果模块将
在优化过程中实时运行。

.. 注意::
此方法会就地修改模块。

参数：
设备（int，可选）：如果指定，所有参数将复制到该设备
复制到该设备

返回：
模块：self
"""
"""
return self._apply(lambda t: t.ipu(device))</font></font></font></div>

<div class="viewcode-block" id="Module.xpu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def xpu(self: T, device: Optional[Union[int, device]] = None) -&gt; T:
r"""将所有模型参数和缓冲区移动到 XPU。

这也将使相关的参数和缓冲区成为不同的对象。因此
它应该在构建优化器之前调用，如果模块将
在优化过程中实时运行于 XPU。

.. 注意::
此方法会就地修改模块。

参数：
设备（int，可选）：如果指定，所有参数将复制到该设备
复制到该设备

返回：
模块：self
"""
返回将 self._apply 应用到 t.xpu(device) 的结果</font></font></font></div>

<div class="viewcode-block" id="Module.mtia"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def mtia(self: T, device: Optional[Union[int, device]] = None) -&gt; T:
r"""将所有模型参数和缓冲区移动到 MTIA。

这也使得相关的参数和缓冲区成为不同的对象。
应在构建优化器之前调用
在优化过程中持续运行 MTIA。

.. 注意：
此方法会就地修改模块。

参数：
device（int，可选）：如果指定，所有参数都将
复制到该设备

返回值：
模块：self
"""
return self._apply(lambda t: t.mtia(device))</font></font></font></div>

<div class="viewcode-block" id="Module.cpu"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def cpu(self: T) -&gt; T:
r"""将所有模型参数和缓冲区移动到 CPU。

.. note::
此方法会就地修改模块。

返回值：
模块：self
"""
return self._apply(lambda t: t.cpu())</font></font></font></div>

<div class="viewcode-block" id="Module.type"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def type(self: T, dst_type: 联合[dtype, str]) -&gt; T:
r"""将所有参数和缓冲区转换为 :attr:`dst_type`。

.. note::
此方法会就地修改模块。

Args:
dst_type (类型或字符串): 所需类型

Returns:
模块: self
"""
返回 self._apply(lambda t: t.type(dst_type))</font></font></font></div>

<div class="viewcode-block" id="Module.float"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def float(self: T) -&gt; T:
r"""将所有浮点参数和缓冲区转换为 ``float`` 数据类型。

.. 注意::
此方法会就地修改模块。

返回：
模块：self
"""
返回 self._apply(lambda t: t.float() if t.is_floating_point() else t)</font></font></font></div>

<div class="viewcode-block" id="Module.double"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def double(self: T) -&gt; T:
r"""将所有浮点参数和缓冲区转换为 ``double`` 数据类型。

.. 注意::
此方法会就地修改模块。

返回：
模块：self
"""
返回 self._apply(lambda t: t.double() if t.is_floating_point() else t)</font></font></font></div>

<div class="viewcode-block" id="Module.half"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def half(self: T) -&gt; T:
r"""将所有浮点参数和缓冲区转换为 ``half`` 数据类型。

.. 注意::
此方法会就地修改模块。

返回：
模块：self
"""
返回 self._apply(lambda t: t.half() if t.is_floating_point() else t)</font></font></font></div>

<div class="viewcode-block" id="Module.bfloat16"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def bfloat16(self: T) -&gt; T:
r"""将所有浮点参数和缓冲区转换为 ``bfloat16`` 数据类型。

.. 注意::
此方法会就地修改模块。

返回：
模块：self
"""
返回 self._apply(lambda t: t.bfloat16() if t.is_floating_point() else t)</font></font></font></div>

<div class="viewcode-block" id="Module.to_empty"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def to_empty(
self: T, *, device: Optional[DeviceLikeType], recurse: bool = True
-&gt; T:
将参数和缓冲区移动到指定的设备，而不复制存储。

参数：
设备 (:class:`torch.device`): 参数期望的设备
和此模块中的缓冲区。
递归（布尔值）：是否应递归地将子模块的参数和缓冲区移动到指定设备。
将递归地移动到指定的设备。

返回值：
模块：self
"""
return self._apply(
lambda t: torch.empty_like(t, device=device), recurse=recurse
        )</font></font></font></div>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">到</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">设备</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="n">数据类型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="n">非阻塞</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">自身</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">到</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非阻塞</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自身</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">到</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非阻塞</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自身</span><span class="p">:</span>
        <span class="o">...</span>

<div class="viewcode-block" id="Module.to"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.to">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">到</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">移动和/或设置参数和缓冲区。</span>

<span class="sd">这可以调用为</span>

<span class="sd">.. 函数:: to(device=None, dtype=None, non_blocking=False)</span>
<span class="sd">noindex:</span>

<span class="sd">.. 函数:: to(数据类型, non_blocking=False)</span>
<span class="sd">noindex:</span>

<span class="sd">.. 函数:: to(张量, non_blocking=False)</span>
<span class="sd">noindex:</span>

<span class="sd">.. 函数:: to(memory_format=torch.channels_last)</span>
<span class="sd">noindex:</span>

<span class="sd">其签名与 :meth:`torch.Tensor.to` 类似，但仅接受</span>
<span class="sd">浮点或复数 :attr:`dtype`。此外，此方法将</span>
<span class="sd">仅将浮点数或复数参数和缓冲区转换为 :attr:`dtype`</span>
<span class="sd">(如果给定)。积分参数和缓冲区将被移动</span>
<span class="sd">:attr:`device`，如果提供了，但数据类型不变。当</span>
<span class="sd">:attr:`non_blocking` 被设置，它尝试异步转换/移动</span>
<span class="sd">关于主机，如果可能的话，例如，移动 CPU 张量</span>
<span class="sd">固定内存到 CUDA 设备。</span>

<span class="sd">见下文示例。</span>

<span class="sd">.. 注意::</span>
<span class="sd">此方法就地修改模块。</span>

<span class="sd">        Args:</span>
<span class="sd">设备(:class:`torch.device`): 参数和在此模块中的缓冲区所期望的设备。可选。</span>
<span class="sd">此模块中的缓冲区</span>
<span class="sd">dtype (:class:`torch.dtype`): 所需的浮点数或复数数据类型</span>
<span class="sd">此模块中的参数和缓冲区</span>
<span class="sd">tensor (torch.Tensor): 具有所需数据类型和设备的张量</span>
<span class="sd">该模块中所有参数和缓冲区的数据类型和设备</span>
<span class="sd">内存格式（:class:`torch.memory_format`）：期望的内存格式</span>
<span class="sd">该模块中 4D 参数和缓冲区的格式（关键字参数）</span>
<span class="sd">（仅关键字参数）</span>

<span class="sd">返回：</span>
<span class="sd">模块：self</span>

<span class="sd">示例：</span>

<span class="sd">&gt;&gt;&gt; # xdoctest: +IGNORE_WANT("非确定性")</span>
<span class="sd">&gt;&gt;&gt; 线性 = nn.Linear(2, 2)</span>
<span class="sd">&gt;&gt;&gt; 线性权重</span>
<span class="sd">包含参数：</span>
<span class="sd">矩阵([[ 0.1913, -0.3420],</span>
<span class="sd">                    [-0.5113, -0.2325]])</span>
<span class="sd">&gt;&gt;&gt; 线性.to(torch.double)</span>
<span class="sd">            Linear(in_features=2, out_features=2, bias=True)</span>
<span class="sd">&gt;&gt;&gt; 线性权重</span>
<span class="sd">包含参数：</span>
<span class="sd">矩阵([[ 0.1913, -0.3420],</span>
<span class="sd">[-0.5113, -0.2325]], 索引类型=torch.float64)</span>
<span class="sd">            &gt;&gt;&gt; # xdoctest: +REQUIRES(env:TORCH_DOCTEST_CUDA1)</span>
<span class="sd">            &gt;&gt;&gt; gpu1 = torch.device("cuda:1")</span>
<span class="sd">            &gt;&gt;&gt; linear.to(gpu1, dtype=torch.half, non_blocking=True)</span>
<span class="sd">            Linear(in_features=2, out_features=2, bias=True)</span>
<span class="sd">&gt;&gt;&gt; 线性权重</span>
<span class="sd">包含参数：</span>
<span class="sd">            tensor([[ 0.1914, -0.3420],</span>
<span class="sd">                    [-0.5112, -0.2324]], dtype=torch.float16, device='cuda:1')</span>
<span class="sd">            &gt;&gt;&gt; cpu = torch.device("cpu")</span>
<span class="sd">            &gt;&gt;&gt; linear.to(cpu)</span>
<span class="sd">            Linear(in_features=2, out_features=2, bias=True)</span>
<span class="sd">&gt;&gt;&gt; 线性权重</span>
<span class="sd">包含参数：</span>
<span class="sd">            tensor([[ 0.1914, -0.3420],</span>
<span class="sd">                    [-0.5112, -0.2324]], dtype=torch.float16)</span>

<span class="sd">&gt;&gt;&gt; 线性层 = nn.Linear(2, 2, bias=None).to(torch.cdouble)</span>
<span class="sd">&gt;&gt;&gt; 线性权重</span>
<span class="sd">包含参数：</span>
<span class="sd">矩阵([[ 0.3741+0.j,  0.2382+0.j],</span>
<span class="sd">                    [ 0.5593+0.j, -0.4443+0.j]], dtype=torch.complex128)</span>
<span class="sd">            &gt;&gt;&gt; linear(torch.ones(3, 2, dtype=torch.cdouble))</span>
<span class="sd">            tensor([[0.6122+0.j, 0.1150+0.j],</span>
<span class="sd">                    [0.6122+0.j, 0.1150+0.j],</span>
<span class="sd">                    [0.6122+0.j, 0.1150+0.j]], dtype=torch.complex128)</span>

<span class="sd">"源代码"</span>
        <span class="n">设备</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非阻塞</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换为格式</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">_nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">解析到</span><span class="p">(</span>
            <span class="o">*</span><span class="n">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n">dtype</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否为浮点数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是复杂的</span><span class="p">):</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                    <span class="s2">"nn.Module.to 只接受浮点数或复数类型，但得到了期望的数据类型="</span>
                    <span class="sa">f</span><span class="s2">"复数模块是正在积极开发中的新功能，其设计可能会改变，"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是复杂的</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                    <span class="s2">"复杂模块是正在积极开发中的新特性，其设计可能会发生变化，"</span>
                    <span class="s2">"当使用复杂的张量作为参数或缓冲区时，某些模块可能无法按预期工作。"</span>
                    <span class="s2">"请在此处提交问题：https://github.com/pytorch/pytorch/issues/new?template=bug-report.yml"</span>
                    <span class="s2">"如果复杂模块无法按预期工作。"</span>
                <span class="p">)</span>

        <span class="k">def</span> <span class="nf">转换</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换为格式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">暗淡</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                    <span class="k">返回</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">到</span><span class="p">(</span>
                        <span class="n">设备</span><span class="p">,</span>
                        <span class="n">dtype</span> <span class="k">如果</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是复杂的</font></font></font></span><span class="p">()</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
                        <span class="n">非阻塞</span><span class="p">,</span>
                        <span class="n">内存格式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换为格式</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">返回</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">到</span><span class="p">(</span>
                    <span class="n">设备</span><span class="p">,</span>
                    <span class="n">dtype</span> <span class="k">如果</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n">is_floating_point</span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n">t</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是复杂的</font></font></font></span><span class="p">()</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
                    <span class="n">非阻塞</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未实现异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"无法从元张量中复制；没有数据！"</span><span class="p">:</span>
                    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不支持的操作异常</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">请使用 torch.nn.Module.to_empty()代替 torch.nn.Module.to()</span>
                        <span class="sa">f</span><span class="s2">"当将模块从元移动到不同的设备时。"</span>
                    <span class="p">)</span> <span class="kn">来自</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
                <span class="k">否则</span><span class="p">:</span>
                    <span class="k">提升</span>

        <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换</span><span class="p">)</span></div>

<div class="viewcode-block" id="Module.register_full_backward_pre_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_full_backward_pre_hook(
self,
hook: Callable[["模块", _grad_t], Union[None, _grad_t]],
prepend: bool = False,
) -&gt; RemovableHandle:
注册模块的向后预钩子。

每当计算模块的梯度时，都会调用此钩子。
钩子应具有以下签名::

hook(module, grad_output) -&gt; 元组[Tensor] 或 None

`:attr:`grad_output` 是一个元组。钩子应该
不修改其参数，但可以可选地返回一个新的梯度
关于将用于替代：attr:`grad_output` 的输出
随后的计算。:attr:`grad_output` 中的条目对于所有非-Tensor 参数将为 ``None``。
由于技术原因，当此钩子应用于一个模块时，其前向函数将接收传递给模块的每个张量的视图。同样，调用者将接收一个视图

对于技术原因，当此钩子应用于一个模块时，其前向函数将
接收传递给模块的每个张量的视图。同样，调用者将接收一个视图
每个由模块的 forward 函数返回的 Tensor 的每个元素。

..警告::
使用反向钩子时，不允许就地修改输入，否则将引发错误。
将引发错误。

Args:
hook (Callable): 用户定义的钩子，用于注册。
prepend (bool): 如果为 true，提供的 ``hook`` 将在
所有现有的 ``backward_pre`` 钩子之前触发
`:class:`torch.nn.Module`. 否则，提供的
`hook`将在所有现有的`backward_pre` `hook`触发后执行
在这：class:`torch.nn.Module`。注意全局
backward_pre 钩子已注册
`register_module_full_backward_pre_hook` 函数将在
此方法注册的所有钩子之前触发。

返回值：
class:`torch.utils.hooks.RemovableHandle`:
可以用来通过调用 handle.remove()移除已添加的钩子的句柄
``handle.remove()``

"""
handle = RemovableHandle(self._backward_pre_hooks)
self._backward_pre_hooks[handle.id] = hook
if prepend:
self._backward_pre_hooks.move_to_end(handle.id, last=False)  # type: ignore[attr-defined]
return handle</font></font></font></div>

<div class="viewcode-block" id="Module.register_backward_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_backward_hook(
self, hook: Callable[["模块", _grad_t, _grad_t], Union[None, _grad_t]]
) -&gt; RemovableHandle:
r"""在模块上注册反向钩子。

此函数已被弃用，推荐使用 :meth:`~torch.nn.Module.register_full_backward_hook` 和
此函数的行为将在未来版本中更改。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
可以用来通过调用移除已添加的钩子的句柄
``handle.remove()``

"""
如果 self._is_full_backward_hook 为 True：
引发 RuntimeError(
无法同时使用常规反向钩子和完整反向钩子
单个模块。请只使用其中一个。
            )

self._is_full_backward_hook = False

handle = RemovableHandle(self._backward_hooks)
self._backward_hooks[handle.id] = hook
return handle</font></font></font></div>

<div class="viewcode-block" id="Module.register_full_backward_hook"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.register_full_backward_hook">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册完整反向钩子</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hook</span><span class="p">:</span> <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span><span class="p">,</span> <span class="n">_grad_t</span><span class="p">,</span> <span class="n">_grad_t</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联盟</font></font></font></span><span class="p">[</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span> <span class="n">_grad_t</span><span class="p">]],</span>
        <span class="n">预先添加</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">可移除句柄</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">注册模块的回退钩子。</span>

<span class="sd">钩子将在每次调用与模块相关的梯度时被调用</span>
<span class="sd">计算，即只有当梯度与</span>
<span class="sd">关于模块输出的计算。钩子应具有以下</span>
<span class="sd">签名::</span>

<span class="sd">            hook(module, grad_input, grad_output) -&gt; tuple(Tensor) or None</span>

<span class="sd">attr:`grad_input` 和 :attr:`grad_output` 是包含梯度的元组</span>
<span class="sd">关于输入和输出分别。钩子应该</span>
<span class="sd">不修改其参数，但可以可选地返回一个新的梯度</span>
<span class="sd">关于将用于替代：attr:`grad_input` 的输入</span>
<span class="sd">后续计算。:attr:`grad_input` 仅对应于提供的输入</span>
<span class="sd">作为位置参数和所有关键字参数将被忽略。条目</span>
<span class="sd">在 :attr:`grad_input` 和 :attr:`grad_output` 中，对于所有非-Tensor，将都是 ``None``。</span>
<span class="sd">参数。</span>

<span class="sd">由于技术原因，当此钩子应用于一个模块时，其前向函数将</span>
<span class="sd">接收传递给模块的每个张量的视图。同样，调用者将接收到一个视图</span>
<span class="sd">每个由模块的 forward 函数返回的 Tensor。</span>

<span class="sd">..警告::</span>
<span class="sd">当使用反向钩子时，不允许就地修改输入或输出。</span>
<span class="sd">将引发错误。</span>

<span class="sd">        Args:</span>
<span class="sd">钩子（Callable）：要注册的用户定义钩子。</span>
<span class="sd">prepend（布尔值）：如果为 true，提供的 ``hook`` 将在</span>
<span class="sd">所有现有的 ``backward`` 钩子之前触发</span>
<span class="sd">class:`torch.nn.Module`。否则，提供的 ``hook`` 将在</span>
<span class="sd">所有现有的 ``backward`` 钩子之后触发</span>
<span class="sd">这个 :class:`torch.nn.Module`。注意全局</span>
<span class="sd">使用 ``backward`` 注册的钩子</span>
<span class="sd">func:`register_module_full_backward_hook` 将在</span>
<span class="sd">此方法注册的所有钩子之前触发。</span>

<span class="sd">返回：</span>
<span class="sd">`:class:`torch.utils.hooks.可移除句柄`:</span>
<span class="sd">一个可以通过调用来移除已添加钩子的句柄</span>
<span class="sd">处理.remove()</span>

<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_full_backward_hook</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                <span class="s2">"不能同时使用常规反向钩子和完整反向钩子在一个 "</span>
                <span class="s2">"单个模块上。请只使用其中之一。"</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_full_backward_hook</span> <span class="o">=</span> <span class="kc">真实</span>

        <span class="n">handle</span> <span class="o">=</span> <span class="n">可移除句柄</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span><span class="p">[</span><span class="n">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预先添加</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span><span class="o">.</span><span class="n">移动到末尾</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最后</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</font></font></font></span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型: 忽略[attr-defined]</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</span></div>

    <span class="k">def</span> <span class="nf">_获取反向钩子</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">返回用于调用函数的回退钩子。</span>

<span class="sd">它返回两个列表，一个包含完整的回退钩子，另一个包含非完整的回退钩子。</span>
<span class="sd">非完整回退钩子。</span>
<span class="sd">"源代码"</span>
        <span class="n">全向后钩</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局是否为完整反向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">全局反向钩子</font></font></font></span> <span class="o">+=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局反向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_full_backward_hook</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">全局反向钩子</font></font></font></span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">()</span>

        <span class="n">non_full_backward_hooks</span><span class="p">:</span> <span class="nb">列表</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局是否为完整反向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
            <span class="n">非全局反向钩子</font></font></font></span> <span class="o">+=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局反向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_full_backward_hook</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
            <span class="n">非全局反向钩子</font></font></font></span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">()</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全向后钩</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非全局反向钩子</span>

    <span class="k">def</span> <span class="nf">_get_backward_pre_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">向后预处理钩</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">backward_pre_hooks</span> <span class="o">+=</span> <span class="n">_全局反向前钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">()</span>
        <span class="n">backward_pre_hooks</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span><span class="o">.</span><span class="n">值</span><span class="p">()</span>

        <span class="k">返回</span> <span class="n">backward_pre_hooks</span>

    <span class="k">def</span> <span class="nf">_maybe_warn_non_full_backward_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">,</span> <span class="n">grad_fn</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
            <span class="k">如果</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">结果</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">)</span>
                <span class="ow">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">所有</font></font></font></span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">r</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                    <span class="s2">使用非完整回退钩子在未返回的模块上</span>
                    <span class="s2">单个张量或张量元组已被弃用，并将被移除</span>
                    <span class="s2">在未来的版本中。这个钩子将缺少一些 grad_output。</span>
                    <span class="s2">请使用 register_full_backward_hook 以获取文档化的行为。</span><span class="p">,</span>
                    <span class="ne">未来警告</span><span class="p">,</span>
                    <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">返回</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">,)</span>

        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
            <span class="k">如果</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">输入</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">)</span>
                <span class="ow">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">所有</font></font></font></span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">i</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                    <span class="s2">使用非全向后钩子在未以“</span>
                    <span class="s2">单个张量或张量元组已被弃用，并将被移除</span>
                    <span class="s2">在未来的版本中。这个钩子将缺少一些 grad_input。</span>
                    <span class="s2">请使用 register_full_backward_hook 以获取文档化的行为。</span><span class="p">,</span>
                    <span class="ne">未来警告</span><span class="p">,</span>
                    <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">返回</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">输入</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,)</span>

        <span class="c1">我们确定输入和结果都是张量元组</span>
        <span class="n">out_grad_fn</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="o">.</span><span class="n">grad_fn</span> <span class="k">为</font></font></font></span> <span class="n">r</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n">r</span><span class="o">.</span><span class="n">grad_fn</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">}</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n">out_grad_fn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</span> <span class="p">(</span>
            <span class="nb">长度</font></font></font></span><span class="p">(</span><span class="n">out_grad_fn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">grad_fn</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">out_grad_fn</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                <span class="s2">"在使用输出嵌套在 Python 数据结构时使用非完整反向钩子"</span>
                <span class="s2">已弃用，将在未来版本中删除。此钩子将缺失</span>
                <span class="s2">"一些 grad_output。"</span><span class="p">,</span>
                <span class="ne">未来警告</span><span class="p">,</span>
                <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">长度</span><span class="p">(</span><span class="n">out_grad_fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                <span class="s2">"当输出由不同的 autograd 节点生成时使用非完整反向钩子"</span>
                <span class="s2">已弃用，将在未来版本中删除。此钩子将缺失</span>
                <span class="s2">"一些 grad_output。请使用 register_full_backward_hook 以获取文档化的行为。"</span><span class="p">,</span>
                <span class="ne">未来警告</span><span class="p">,</span>
                <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="c1">在这一点上，hook 的 grad_output 部分很可能正确</span>
            <span class="n">输入梯度函数</font></font></font></span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">grad_fn</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">i</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n">i</span><span class="o">.</span><span class="n">grad_fn</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">}</span>

            <span class="n">下一个函数</font></font></font></span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">n</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n">grad_fn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">下一个函数</span><span class="p">}</span>

            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入梯度函数</font></font></font></span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">下一个函数</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                    <span class="s2">使用前向包含多个 autograd 节点时，非全向后钩子</span>
                    <span class="s2">已弃用，将在未来版本中删除。此钩子将缺失</span>
                    <span class="s2">一些 grad_input。请使用 register_full_backward_hook 来获取文档化的</span>
                    <span class="s2">行为。</span><span class="p">,</span>
                    <span class="ne">未来警告</span><span class="p">,</span>
                    <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>

<div class="viewcode-block" id="Module.register_forward_pre_hook"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.register_forward_pre_hook">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册前向钩子</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hook</span><span class="p">:</span> <span class="n">联盟</span><span class="p">[</span>
            <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">]],</span>
            <span class="n">可调用</span><span class="p">[</span>
                <span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">]],</span>
                <span class="n">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]]，</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">预先添加</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
        <span class="n">with_kwargs</span><span class="p">:</span> <span class="nb">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">可移除句柄</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">在模块上注册一个前置钩子。</span>

<span class="sd">每次调用 :func:`forward` 之前都会调用此钩子。</span>


<span class="sd">如果 `with_kwargs` 为 false 或未指定，则输入只包含</span>
<span class="sd">模块接收到的位置参数。关键字参数不会</span>
<span class="sd">传递给钩子，仅传递给 `forward`。钩子可以修改</span>
<span class="sd">输入. 用户可以返回一个元组或单个修改后的值</span>
<span class="sd">hook. 如果返回单个值，我们将将其包装成一个元组</span>
<span class="sd">除非该值已经是元组。钩子应该有</span>
<span class="sd">以下签名：</span>

<span class="sd">hook(module, args) -&gt; None 或修改后的输入</span>

<span class="sd">如果 `with_kwargs` 为 true，则前向预钩子将传递给前向函数的 kwargs。如果钩子修改了输入，</span>
<span class="sd">则将传递给前向函数的 kwargs。如果钩子修改了输入，</span>
<span class="sd">输入，应返回参数和关键字参数。钩子应具有以下签名：</span>
<span class="sd">签名如下：</span>

<span class="sd">hook(module, args, kwargs) -&gt; None 或修改后的输入和关键字参数的元组</span>

<span class="sd">        Args:</span>
<span class="sd">hook (Callable)：用户定义的钩子，用于注册。</span>
<span class="sd">prepend（布尔值）：如果为 true，提供的 ``hook`` 将在</span>
<span class="sd">所有现有的 ``forward_pre`` 钩子之前触发</span>
<span class="sd">class:`torch.nn.Module`。否则，提供的 ``hook`` 将在</span>
<span class="sd">所有现有的 ``forward_pre`` 钩子之后触发</span>
<span class="sd">在这个 :class:`torch.nn.Module` 上。注意全局</span>
<span class="sd">``forward_pre`` 注册的钩子</span>
<span class="sd">func:`register_module_forward_pre_hook` 将在所有</span>
<span class="sd">该方法注册的钩子之前触发。</span>
<span class="sd">默认：``False``</span>
<span class="sd">with_kwargs (bool): 如果为真，则将传递给 forward 函数的 kwargs 参数传递给 hook</span>
<span class="sd">给定。</span>
<span class="sd">默认：``False``</span>

<span class="sd">返回：</span>
<span class="sd">`:class:`torch.utils.hooks.可移除句柄`:</span>
<span class="sd">一个可以通过调用来移除已添加钩子的句柄</span>
<span class="sd">处理.remove()</span>
<span class="sd">"源代码"</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">可移除句柄</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_前向预处理钩子</span><span class="p">,</span> <span class="n">extra_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks_with_kwargs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_前向预处理钩子</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span>
        <span class="k">如果</span> <span class="n">with_kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks_with_kwargs</span><span class="p">[</span><span class="n">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预先添加</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_前向预处理钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">移动到末尾</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最后</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</font></font></font></span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型: 忽略[attr-defined]</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</span></div>

<div class="viewcode-block" id="Module.register_forward_hook"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.register_forward_hook">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册前向钩子</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hook</span><span class="p">:</span> <span class="n">联盟</span><span class="p">[</span>
            <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">]],</span>
            <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">]],</span>
        <span class="p">]</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">预先添加</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
        <span class="n">with_kwargs</span><span class="p">:</span> <span class="nb">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
        <span class="n">总是呼叫</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">可移除句柄</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">在模块上注册一个前向钩子。</span>

<span class="sd">该钩子将在每次调用 :func:`forward` 计算输出后执行。</span>

<span class="sd">如果 `with_kwargs` 为 `False` 或未指定，则输入只包含</span>
<span class="sd">模块接收到的位置参数。关键字参数不会</span>
<span class="sd">传递给钩子，仅传递给 `forward`。钩子可以修改</span>
<span class="sd">不会对 forward 产生影响，因为这是在调用 :func:`forward` 之后调用的。钩子</span>
<span class="sd">不会对 forward 产生影响，因为这是在调用 :func:`forward` 之后调用的。</span>
<span class="sd">应具有以下签名：</span>

<span class="sd">hook(module, args, output) -&gt; None 或修改后的输出</span>

<span class="sd">如果 `with_kwargs` 为 `True`，则前向钩子将传递给前向函数的 `kwargs`，并期望返回</span>
<span class="sd">``kwargs`` 给前向函数，并期望返回</span>
<span class="sd">输出可能被修改。钩子应具有以下签名：</span>

<span class="sd">hook(module, args, kwargs, output) -&gt; None 或修改后的输出</span>

<span class="sd">        Args:</span>
<span class="sd">hook (Callable)：用户定义的钩子，用于注册。</span>
<span class="sd">prepend (bool)：如果为 ``True``，则提供的 ``hook`` 将被触发</span>
<span class="sd">在此之前的所有现有 ``forward`` 钩子</span>
<span class="sd">class:`torch.nn.Module`。否则，提供的 ``hook`` 将在</span>
<span class="sd">``hook`` 将在所有现有 ``forward`` 钩子之后触发</span>
<span class="sd">这个 :class:`torch.nn.Module`。注意全局</span>
<span class="sd">已注册的 `forward` 钩子</span>
<span class="sd">`:func:`register_module_forward_hook`将在所有钩子之前触发</span>
<span class="sd">由该方法注册的钩子。</span>
<span class="sd">默认：``False``</span>
<span class="sd">with_kwargs (bool): 如果为 ``True``，则 ``hook`` 将传递给前向函数的</span>
<span class="sd">kwargs 参数。</span>
<span class="sd">默认：``False``</span>
<span class="sd">always_call (布尔值): 如果为 ``True``，则无论在调用模块时是否引发异常，都会运行 ``hook``。</span>
<span class="sd">是否在调用模块时引发异常。</span>
<span class="sd">默认：``False``</span>

<span class="sd">返回：</span>
<span class="sd">`:class:`torch.utils.hooks.可移除句柄`:</span>
<span class="sd">一个可以通过调用来移除已添加钩子的句柄</span>
<span class="sd">处理.remove()</span>
<span class="sd">"源代码"</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">可移除句柄</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_前向钩子</span><span class="p">,</span>
            <span class="n">extra_dict</span><span class="o">=</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_with_kwargs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_always_called</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_前向钩子</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span>
        <span class="k">如果</span> <span class="n">with_kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_with_kwargs</span><span class="p">[</span><span class="n">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总是呼叫</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_always_called</span><span class="p">[</span><span class="n">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预先添加</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_前向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">移动到末尾</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最后</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</font></font></font></span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型: 忽略[attr-defined]</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</span></div>

    <span class="k">def</span> <span class="nf">_慢速快进</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">跟踪状态</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取追踪状态</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪状态</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">脚本方法</span><span class="p">):</span>
            <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">录制范围</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪模块映射</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">录制范围</span><span class="p">:</span>
            <span class="c1"># 类型忽略被添加，因为此时已知</span>
            <span class="c1"># torch.jit._trace._trace_module_map 不是 Optional，并且具有类型 Dict[Any, Any]</span>
            <span class="n">名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪</font></font></font></span><span class="o">.</span><span class="n">_trace_module_map</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="bp">self</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">跟踪模块映射</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># type: 忽略[index, operator] # 无编号：B950</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">:</span>
                <span class="n">跟踪状态</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">推送作用域</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="n">录制范围</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">最后</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">录制范围</span><span class="p">:</span>
                <span class="n">跟踪状态</span><span class="o">.</span><span class="n">pop_scope</span><span class="p">()</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span>

    <span class="k">def</span> <span class="nf">_wrapped_call_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled_call_impl</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_编译调用实现</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型：忽略[杂项]</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_impl</span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># torchrec 测试代码的一致性，与以下代码</span>
    <span class="c1"># fmt: off</span>
    <span class="k">def</span> <span class="nf">_call_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">forward_call</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slow_forward</span> <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取追踪状态</font></font></font></span><span class="p">()</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向</span><span class="p">)</span>
        <span class="c1"># 如果没有钩子，我们希望跳过其余的逻辑</span>
        <span class="c1">这个函数，然后直接调用前进。</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span>
                <span class="ow">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局反向前钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局反向钩子</span>
                <span class="ow">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局转发钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局前置钩子</span><span class="p">):</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向调用</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="n">总是调用/总是调用的钩子</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">内部</span><span class="p">():</span>
            <span class="k">非局部</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="n">kwargs</span>

            <span class="n">全向后钩</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非全局反向钩子</font></font></font></span> <span class="o">=</span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</span> <span class="p">[]</span>
            <span class="n">backward_pre_hooks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局反向前钩子</span><span class="p">:</span>
                <span class="n">backward_pre_hooks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_backward_pre_hooks</span><span class="p">()</span>

            <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局反向钩子</span><span class="p">:</span>
                <span class="n">全向后钩</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非全局反向钩子</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取反向钩子</span><span class="p">()</span>

            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局正向预处理钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_前向预处理钩子</span><span class="p">:</span>
                <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子 ID</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span>
                    <span class="o">*</span><span class="n">_全局前置钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">(),</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_前向预处理钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">(),</span>
                <span class="p">):</span>
                    <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks_with_kwargs</span><span class="p">:</span>
                        <span class="n">参数、关键字参数和结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型：忽略[杂项]</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数、关键字参数和结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                            <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args_kwargs_result</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</span><span class="p">(</span><span class="n">args_kwargs_result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">参数</font></font></font></span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数、关键字参数和结果</span>
                            <span class="k">否则</span><span class="p">:</span>
                                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                                    <span class="s2">"前向钩子必须返回 None 或一个元组"</span>
                                    <span class="sa">f</span><span class="s2">"但得到了（new_args, new_kwargs）,"</font></font></font></span><span class="si">{</span><span class="n">args_kwargs_result</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
                                <span class="p">)</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">参数结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数结果</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">):</span>
                                <span class="n">参数结果</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数结果</span><span class="p">,)</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">参数结果</span>

            <span class="n">bw_hook</span> <span class="o">=</span> <span class="kc">无</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局反向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向后预处理钩</span><span class="p">:</span>
                <span class="n">bw_hook</span> <span class="o">=</span> <span class="n">向后钩</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全向后钩</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向后预处理钩</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">bw 钩</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置输入钩子</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span>

            <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前向调用</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局转发钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_前向钩子</span><span class="p">:</span>
                <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子 ID</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="p">(</span>
                    <span class="o">*</span><span class="n">_全局正向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">(),</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_前向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">(),</span>
                <span class="p">):</span>
                    <span class="c1">标记始终调用的钩子将被执行</span>
                    <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">始终调用的前向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局前进钩子始终被调用</span><span class="p">:</span>
                        <span class="n">总是调用的钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子 ID</span><span class="p">)</span>

                    <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_with_kwargs</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">_global_forward_hooks_with_kwargs</span><span class="p">:</span>
                        <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>

                    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                        <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</span>

            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bw 钩</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</span><span class="p">)):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">警告</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"为了调用向后钩子，"</span>
                                  <span class="s2">"模块输出应为 Tensor 或 Tensor 的元组"</span>
                                  <span class="sa">f</span><span class="s2">"但接收到了"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bw 钩</font></font></font></span><span class="o">.</span><span class="n">setup_output_hook</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>

            <span class="c1"># 处理非完整向后钩子</span>
            <span class="k">如果</span> <span class="n">non_full_backward_hooks</span><span class="p">:</span>
                <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">变量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
                    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">):</span>
                        <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">下一</font></font></font></span><span class="p">(</span><span class="n">v</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">()</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">))</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">变量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">变量</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">grad_fn</span> <span class="o">=</span> <span class="n">变量</span><span class="o">.</span><span class="n">grad_fn</span>
                <span class="k">如果</font></font></font></span> <span class="n">grad_fn</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">non_full_backward_hooks</span><span class="p">:</span>
                        <span class="n">grad_fn</span><span class="o">.</span><span class="n">注册钩子</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">包装钩子</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_warn_non_full_backward_hook</span><span class="p">(</span><span class="n">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">,</span> <span class="n">grad_fn</span><span class="p">)</span>

            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span>

        <span class="c1"># 在编译时这实际上并不等同于行为，但它是</span>
        <span class="c1">几乎不可能支持在神经网络中抛出异常</span>
        <span class="c1">然后在模块中捕获它，然后在这里再次捕获，然后</span>
        <span class="c1">再次捕获，并期望生成的帧被编译。</span>
        <span class="c1">这里的重新抛出只是使我们的异常处理变得一团糟，没有任何好处</span>
        <span class="c1"># 原因。不要在发生异常的情况下尝试运行始终调用的钩子</span>
        <span class="c1"># 异常。</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器</span><span class="o">.</span><span class="n">is_compiling</span><span class="p">():</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内部</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内部</span><span class="p">()</span>
        <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</span><span class="p">:</span>
            <span class="c1"># 如果尚未运行，则运行始终调用的钩子</span>
            <span class="c1"># 目前只有前向钩子有始终调用选项，但也许</span>
            <span class="c1">应该也添加到完整的反向钩子中。</span>
            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子 ID</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局正向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
                <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局前进钩子始终被调用</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">hook_id</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总是调用的钩子</span><span class="p">:</span>  <span class="c1"># type: ignore[possibly-undefined]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>  <span class="c1"># type: ignore[possibly-undefined]</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                            <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</span>
                    <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">警告</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“全局模块的 forward hook，其中 `always_call=True` 导致抛出异常”</span>
                                      <span class="sa">f</span><span class="s2">“在 forward 中抛出另一个错误时被抑制了：”</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                        <span class="k">继续</span>

            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子 ID</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_前向钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
                <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">始终调用的前向钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">hook_id</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">总是调用的钩子</span><span class="p">:</span>  <span class="c1"># type: ignore[possibly-undefined]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">如果</font></font></font></span> <span class="n">hook_id</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_with_kwargs</span><span class="p">:</span>
                            <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>  <span class="c1"># type: ignore[possibly-undefined]</span>
                        <span class="k">否则</span><span class="p">:</span>
                            <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">结果</span><span class="p">)</span>  <span class="c1"># type: ignore[possibly-undefined]</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                            <span class="n">结果</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</span>
                    <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">警告</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块前向钩子 `always_call=True` 抛出异常"</span>
                                      <span class="sa">f</span><span class="s2">“在 forward 中抛出另一个错误时被抑制了：”</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                        <span class="k">继续</span>
            <span class="c1"># 在 try 块中引发的异常</span>
            <span class="k">提升</span>
    <span class="c1"># fmt: on</span>

    <span class="fm">__调用__</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_包装调用实现</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">状态</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制</span><span class="p">()</span>
        <span class="n">状态</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">弹出</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_编译调用实现"</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">状态</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">更新</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态</span><span class="p">)</span>

        <span class="c1"># 支持加载没有以下属性的旧检查点：</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_forward_pre_hooks"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_forward_pre_hooks_with_kwargs"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks_with_kwargs</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_forward_hooks_with_kwargs"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks_with_kwargs</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_forward_hooks_always_called"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">始终调用的前向钩子</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_state_dict_hooks"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict_hooks</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_state_dict_pre_hooks</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict_pre_hooks</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_load_state_dict_pre_hooks</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_加载状态字典后钩子"</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_加载状态字典后钩子</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_非持久缓冲区设置"</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">非持久缓冲区集合</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_is_full_backward_hook"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_full_backward_hook</span> <span class="o">=</span> <span class="kc">无</span>
        <span class="k">如果</font></font></font></span> <span class="s2">"_backward_pre_hooks"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backward_pre_hooks</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>

    <span class="c1">返回类型不应标注为`Any`，否则类型检查</span>
    <span class="c1">在`torch.nn.Module`及其所有子类上大部分功能因此被禁用。参见：</span>
    <span class="c1"># https://github.com/pytorch/pytorch/pull/115074</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联盟</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]：</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_parameters</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="n">参数</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_参数</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">:</span>
                <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_缓冲区"</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="n">_缓冲区</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">:</span>
                <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_模块"</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">:</span>
            <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_模块</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
                <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
        <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">''</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'对象没有此属性'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">名称</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联盟</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模块"</font></font></font></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">移除</font></font></font></span><span class="p">(</span><span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典或集合</span><span class="p">):</span>
            <span class="k">为</font></font></font></span> <span class="n">d</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典或集合</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</span><span class="p">):</span>
                        <span class="k">删除</font></font></font></span> <span class="n">d</span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">丢弃</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_参数</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
            <span class="k">如果</font></font></font></span> <span class="n">params</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</span><span class="p">(</span>
                    <span class="s2">"在调用 Module.__init__() 之前不能分配参数"</span>
                <span class="p">)</span>
            <span class="n">移除</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">字典</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_缓冲区</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">模块</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_非持久缓冲区集合</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">注册参数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">params</span> <span class="ow">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="n">value</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"无法分配"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'作为参数 '</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">' "</span>
                    <span class="s2">"(期望 torch.nn.Parameter 或 None)"</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">注册参数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_模块</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</span><span class="p">(</span>
                        <span class="s2">"在调用 Module.__init__() 之前不能分配模块"</span>
                    <span class="p">)</span>
                <span class="n">移除</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">字典</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">参数</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_缓冲区</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_非持久缓冲区集合</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局模块注册钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
                    <span class="n">输出</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
                    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">输出</span>
                <span class="n">模块</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="n">value</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"无法分配"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'作为子模块'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">' "</span>
                        <span class="s2">'(期望 torch.nn.Module 或 None)'</span>
                    <span class="p">)</span>
                <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局模块注册钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
                    <span class="n">输出</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
                    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输出</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">输出</span>
                <span class="n">模块</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="n">缓冲区</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">)</span>
                <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</span><span class="p">:</span>
                    <span class="k">如果</font></font></font></span> <span class="n">value</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
                        <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"无法分配"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'作为缓冲区'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">' "</span>
                            <span class="s2">'期望为 torch.nn.Buffer、torch.Tensor 或 None'</span>
                        <span class="p">)</span>
                    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</span><span class="p">):</span>
                        <span class="n">持久</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">持久</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非持久缓冲区集合</span>
                    <span class="c1"># === 漏洞 ===</span>
                    <span class="c1"># 这整个块应该是这样的：</span>
                    <span class="c1"># self.register_buffer(name, value, persistent)</span>

                    <span class="c1"># 但为了支持那些（错误地）实现了 register_buffer()方法且</span>
                    <span class="c1"># register_buffer()方法没有"persistent"参数的 nn.Module 的子类</span>
                    <span class="c1"># 参数。只有接受它时才传递，否则假设</span>
                    <span class="c1"># 总是正确的</span>
                    <span class="k">如果</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册缓冲区</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">注册缓冲区</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久性</span><span class="p">)</span>
                    <span class="k">否则</span><span class="p">:</span>
                        <span class="n">符号</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">签名</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册缓冲区</span><span class="p">)</span>
                        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"持久性"</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">注册缓冲区</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久性</span><span class="p">)</span>
                        <span class="k">否则</span><span class="p">:</span>
                            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久性</span><span class="p">:</span>
                                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                                    <span class="s2">"注册一个非持久性缓冲区 "</span>
                                    <span class="s2">"在实现模块子类的模块上 "</span>
                                    <span class="s2">"register_buffer() 不允许使用持久性参数"</span>
                                    <span class="s2">"参数不被允许。"</span>
                                <span class="p">)</span>
                            <span class="c1"># 假设不使用参数的实现具有在参数添加之前的</span>
                            <span class="c1"># 行为：持久性=True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">注册缓冲区</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>
                    <span class="c1"># === HACK END ===</span>
                <span class="k">否则</span><span class="p">:</span>
                    <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">名称</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">:</span>
            <span class="k">删除</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</span><span class="p">:</span>
            <span class="k">删除</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_非持久缓冲区集合</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">丢弃</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
            <span class="k">删除</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="nb">超级</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_state_dict_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">"""注册 :meth:`~torch.nn.Module.state_dict` 方法的后钩子。</span>

<span class="sd">它应该具有以下签名::</span>
<span class="sd">hook(module, state_dict, prefix, local_metadata) -&gt; None 或 state_dict</span>

<span class="sd">已注册的钩子可以就地修改 ``state_dict`` 或返回一个新的。</span>
<span class="sd">如果返回一个新的 ``state_dict``，则只有当它是从调用 :meth:`~nn.Module.state_dict` 的根模块返回时，才会被尊重。</span>
<span class="sd">该模块的 :meth:`~nn.Module.state_dict` 被调用。</span>
<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">"_from_public_api"</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                <span class="s2">"无法注册与之前通过 register_state_dict_post_hook 注册的相同的函数作为状态字典后钩子"</span>
                <span class="s2">"已注册的状态字典后钩子"</span>
            <span class="p">)</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">可移除句柄</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态字典钩子</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">状态字典钩子</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</span>
        <span class="k">返回</span> <span class="n">handle</span>

<div class="viewcode-block" id="Module.register_state_dict_post_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_state_dict_post_hook(self, hook):
r"""注册 :meth:`~torch.nn.Module.state_dict` 方法的后钩子。

应具有以下签名::
hook(module, state_dict, prefix, local_metadata) -&gt; None

注册的钩子可以就地修改 `state_dict`。
"""
在 `_register_state_dict_hook` 中存在一个错误，该错误已在
https://github.com/pytorch/pytorch/issues/117437 中描述，其中返回值
仅在根模块中尊重，但在子模块中不尊重。
在这个公开版本中，我们通过只允许通过钩子修改 state_dict 来解决这个问题。然而，由于通过这两个 API 注册的钩子都将被添加到`_state_dict_hooks`中，因此`_state_dict_hooks`的类型也会发生变化。
然而，由于通过这两个 API 注册的钩子都将被添加到`_state_dict_hooks`中，因此`_state_dict_hooks`的类型也会发生变化。
`_state_dict_hooks`的类型也会发生变化。
由于对其有众多依赖，无法更改，我们标记一个钩子
通过将其上的 `_from_public_api` 设置为注册，通过公共 API 进行注册。
在`state_dict`实现中，如果可调用对象没有这个
# 标志，将保留尊重返回值的老行为
# 对于根模块，否则我们确保钩子返回 None。
hook._from_public_api = True
handle = RemovableHandle(self._state_dict_hooks)
self._state_dict_hooks[handle.id] = hook
返回处理</font></font></font></div>

<div class="viewcode-block" id="Module.register_state_dict_pre_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] def register_state_dict_pre_hook(self, hook):
r"""为 :meth:`~torch.nn.Module.state_dict` 方法注册预钩子。

它应该具有以下签名::
hook(module, prefix, keep_vars) -&gt; None

已注册的钩子可以在调用 ``state_dict`` 之前进行预处理。
调用。
"""
handle = RemovableHandle(self._state_dict_pre_hooks)
self._state_dict_pre_hooks[handle.id] = hook
return handle</font></font></font></div>

    <span class="k">def</span> <span class="nf">保存到状态字典</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">将模块状态保存到`destination`字典中。</span>

<span class="sd">目标字典将包含状态</span>
<span class="sd">模块本身，而不是其子模块。这将在每个</span>
<span class="sd">子模块在 :meth:`~torch.nn.Module.state_dict` 中。</span>

<span class="sd">在罕见情况下，子类可以通过实现类特定行为</span>
<span class="sd">覆盖此方法以使用自定义逻辑。</span>

<span class="sd">        Args:</span>
<span class="sd">目标（字典）：状态将存储在此字典中。</span>
<span class="sd">prefix（字符串）：在此处使用的参数和缓冲区的前缀。</span>
<span class="sd">模块</span>
<span class="sd">"源代码"</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="n">目的地</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保持变量</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_非持久缓冲区集合</span><span class="p">:</span>
                <span class="n">目的地</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保持变量</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="n">额外状态键</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</span> <span class="o">+</span> <span class="n">_EXTRA_STATE_KEY_SUFFIX</span>
        <span class="k">如果</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">类</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取额外状态</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取额外状态</span><span class="p">)</span>
            <span class="ow">是</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取额外状态</span>
        <span class="p">):</span>
            <span class="n">目的地</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取额外状态</span><span class="p">()</span>

    <span class="c1">用户可以向 `state_dict` 传递一个可选的任意可映射对象，在这种情况下，`state_dict` 返回该对象。但如果他们不传递任何内容，则创建并返回一个 `OrderedDict`。</span>
    <span class="c1">但如果他们不传递任何内容，则创建并返回一个 `OrderedDict`。</span>
    <span class="n">目标</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型变量</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"目标"</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">绑定</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">])</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">state_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">目的地</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</span> <span class="o">=</span> <span class="o">...</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">目的地</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">前缀</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]：</span>
        <span class="o">...</span>

    <span class="c1"># TODO: 当向后兼容性允许时，将 `*args` 改为 `*` 并在文档中移除相应的警告。</span>
    <span class="c1"># 同时移除参数解析的逻辑。</span>
<div class="viewcode-block" id="Module.state_dict"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.state_dict">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf">state_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">返回包含模块整个状态的引用字典。</span>

<span class="sd">参数和持久缓冲区（例如运行平均值）均包括在内。</span>
<span class="sd">键对应参数和缓冲区名称。</span>
<span class="sd">设置为 `None` 的参数和缓冲区不包括在内。</span>

<span class="sd">.. 注意::</span>
<span class="sd">返回的对象是一个浅拷贝。它包含引用</span>
<span class="sd">到模块的参数和缓冲区。</span>

<span class="sd">.. 警告::</span>
<span class="sd">当前 `state_dict()` 也接受位置参数</span>
<span class="sd">按照 ``destination``、``prefix`` 和 ``keep_vars`` 的顺序。然而，</span>
<span class="sd">这将被弃用，并且未来版本将强制执行关键字参数。</span>
<span class="sd">请避免使用“destination”参数，因为它不是为最终用户设计的。</span>

<span class="sd">.. 警告::</span>
<span class="sd">请避免使用参数“destination”，因为它不是为最终用户设计的。</span>
<span class="sd">请避免使用参数“destination”，因为它不是为最终用户设计的。</span>

<span class="sd">        Args:</span>
<span class="sd">目的地（dict，可选）：如果提供，模块的状态将为</span>
<span class="sd">更新到字典中，并返回相同的对象。</span>
<span class="sd">否则，将创建并返回一个 `OrderedDict`。</span>
<span class="sd">默认：``无``。</span>
<span class="sd">前缀（str，可选）：添加到参数和缓冲区的前缀</span>
<span class="sd">组成状态字典键的名称。默认值：``''``。</span>
<span class="sd">keep_vars（bool，可选）：默认情况下，返回的状态字典中的 :class:`~torch.Tensor` 被从自动微分中分离出来。如果它的是</span>
<span class="sd">返回的状态字典中的 :class:`~torch.Tensor` 被从自动微分中分离出来。如果它是</span>
<span class="sd">设置为 ``True``，则不会执行分离。</span>
<span class="sd">默认：``False``。</span>

<span class="sd">返回：</span>
<span class="sd">            dict:</span>
<span class="sd">包含整个模块状态的字典</span>

<span class="sd">示例::</span>

<span class="sd">            &gt;&gt;&gt; # xdoctest: +SKIP("undefined vars")</span>
<span class="sd">            &gt;&gt;&gt; module.state_dict().keys()</span>
<span class="sd">['偏见', '权重']</span>

<span class="sd">"源代码"</span>
        <span class="c1"># TODO: 当向后兼容性允许时，移除 `args` 和解析逻辑。</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># 默认情况下忽略 DeprecationWarning</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                <span class="s2">"位置参数正在弃用，请使用关键字参数（kwargs）。请参阅 "</span>
                <span class="s2">"https://pytorch.org/docs/main/generated/torch.nn.Module.html#torch.nn.Module.state_dict"</span>
                <span class="s2">"详情请见。"</span><span class="p">,</span>
                <span class="ne">未来警告</span><span class="p">,</span>
                <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n">destination</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="n">destination</span> <span class="o">=</span> <span class="n">参数</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
                <span class="n">前缀</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保持变量</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
                <span class="n">保持变量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">如果</font></font></font></span> <span class="n">destination</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">有序字典</span><span class="p">()</span>
            <span class="n">目的地</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">()</span>

        <span class="n">本地元数据</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">版本</font></font></font></span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_版本</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_metadata</span><span class="p">):</span>
            <span class="n">目的地</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地元数据</span>

        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_dict_pre_hooks</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
            <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">保存到状态字典</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</span><span class="p">)</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="n">模块</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(</span>
                    <span class="n">目的地</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</span><span class="p">,</span>
                    <span class="n">前缀</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“点”</span><span class="p">,</span>
                    <span class="n">保留变量</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保留变量</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">状态字典钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
            <span class="n">钩子结果</font></font></font></span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地元数据</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="s2">"_from_public_api"</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">):</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="n">destination</span> <span class="o">=</span> <span class="n">钩子结果</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子结果</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">state_dict 后钩必须返回 None</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目的地</span></div>

    <span class="k">def</span> <span class="nf">_register_load_state_dict_pre_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="n">使用模块</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">详细信息请参阅 :meth:`~torch.nn.Module.register_load_state_dict_pre_hook`</span>

<span class="sd">一个细微的区别是，如果将 ``with_module`` 设置为 ``False``，那么</span>
<span class="sd">钩子函数不会将 ``module`` 作为第一个参数，而</span>
<span class="sd">meth:`~torch.nn.Module.register_load_state_dict_pre_hook` 总是接受</span>
<span class="sd">``module`` 作为第一个参数。</span>

<span class="sd">参数：</span>
<span class="sd">钩子（Callable）：在调用之前将被调用的可调用钩子</span>
<span class="sd">加载状态字典。</span>
<span class="sd">with_module (bool, 可选): 是否传递模块</span>
<span class="sd">实例作为第一个参数传递给钩子。</span>
<span class="sd">"源代码"</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">可移除句柄</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span><span class="p">[</span><span class="n">处理</font></font></font></span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">包装钩子</span><span class="p">(</span>
            <span class="n">hook</span><span class="p">,</span> <span class="bp">self</span> <span class="k">如果</font></font></font></span> <span class="n">with_module</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span>
        <span class="p">)</span>
        <span class="k">返回</span> <span class="n">handle</span>

<div class="viewcode-block" id="Module.register_load_state_dict_pre_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def register_load_state_dict_pre_hook(self, hook):
r"""在模块的 :meth:`~nn.Module.load_state_dict` 被调用之前注册一个预钩子。

它应该具有以下签名::
hook(module, state_dict, prefix, local_metadata, strict, missing_keys, unexpected_keys, error_msgs) -&gt; None  # noqa: B950

参数：
钩子（Callable）：在加载状态字典之前将被调用的可调用钩子。
在加载状态字典之前。
"""
return self._register_load_state_dict_pre_hook(hook, with_module=True)</font></font></font></div>

<div class="viewcode-block" id="Module.register_load_state_dict_post_hook"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] def register_load_state_dict_post_hook(self, hook):
r"""注册一个在模块的 :meth:`~nn.Module.load_state_dict` 被调用后运行的钩子。

它应该具有以下签名::
hook(module, incompatible_keys) -&gt; None

``module`` 参数是当前注册此钩子的模块，而 ``incompatible_keys`` 参数是一个包含 ``missing_keys`` 和 ``unexpected_keys`` 属性的 ``NamedTuple``。
``missing_keys`` 和 ``unexpected_keys``。
``missing_keys`` 表示缺少的键。
是一个包含缺失键的 ``str`` 列表
``unexpected_keys`` 是一个包含意外键的 ``str`` 列表

给定的 incompatible_keys 可以根据需要就地修改

注意，当调用 :func:`load_state_dict` 时执行的检查
`strict=True` 受钩子所做的修改影响
`missing_keys` 或 `unexpected_keys`，如预期。向任一集合中添加键将导致在 `strict=True` 时抛出错误，并且
清除所有缺失和意外的键将避免错误。
清除所有缺失和意外的键将避免错误。

返回：
`:class:`torch.utils.hooks.可移除句柄`:
一个可以通过调用来移除已添加钩子的句柄
处理.remove()
"""
handle = RemovableHandle(self._load_state_dict_post_hooks)
self._load_state_dict_post_hooks[handle.id] = hook
return handle</font></font></font></div>

    <span class="k">def</span> <span class="nf">从状态字典加载</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">state_dict</span><span class="p">,</span>
        <span class="n">前缀</span><span class="p">,</span>
        <span class="n">本地元数据</span><span class="p">,</span>
        <span class="n">严格的</span><span class="p">,</span>
        <span class="n">缺少键</span><span class="p">,</span>
        <span class="n">预期之外的键</span><span class="p">,</span>
        <span class="n">错误信息</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">将参数和缓冲区从 :attr:`state_dict` 复制到仅此模块，而不是其子模块。</span>

<span class="sd">这在每次调用子模块时都会被调用。</span>
<span class="sd">在 :meth:`~torch.nn.Module.load_state_dict` 中被调用。为此模块在输入 :attr:`state_dict` 中保存的元数据为 :attr:`local_metadata`。</span>
<span class="sd">模块在输入 :attr:`state_dict` 中的元数据提供为 :attr:`local_metadata`。</span>
<span class="sd">对于没有元数据的 state 字典，:attr:`local_metadata`为空。</span>
<span class="sd">子类可以通过使用实现类特定的向后兼容加载</span>
<span class="sd">本地元数据中的版本号 `local_metadata.get("version", None)`。</span>
<span class="sd">此外，:attr:`local_metadata` 还可以包含键</span>
<span class="sd">`assign_to_params_buffers` 表示是否应该将键分配给状态字典中对应的张量。</span>
<span class="sd">分配给状态字典中对应的张量。</span>

<span class="sd">.. 注意::</span>
<span class="sd">`:attr:`state_dict` 并非与输入的 `:attr:`state_dict` 相同的对象。</span>
<span class="sd">所以 `:attr:`state_dict` 并不等于 `:meth:`~torch.nn.Module.load_state_dict`。</span>
<span class="sd">它可以被修改。</span>

<span class="sd">        Args:</span>
<span class="sd">state_dict（字典）：包含参数和持久缓冲区的字典。</span>
<span class="sd">持久缓冲区。</span>
<span class="sd">prefix（字符串）：在此处使用的参数和缓冲区的前缀。</span>
<span class="sd">模块</span>
<span class="sd">local_metadata (dict): 包含此模块元数据的字典。</span>
<span class="sd">查看</span>
<span class="sd">strict (bool): 是否严格强制要求 :attr:`state_dict` 与 :attr:`prefix` 匹配键名。</span>
<span class="sd">attr:`state_dict` 与 :attr:`prefix` 匹配的键名。</span>
<span class="sd">本模块的参数和缓冲区</span>
<span class="sd">missing_keys（字符串列表）：如果 strict=True，将缺少的键添加到该列表中</span>
<span class="sd">此列表</span>
<span class="sd">unexpected_keys（字符串列表）：如果 strict=True，将意外的键添加到</span>
<span class="sd">列表的关键</span>
<span class="sd">error_msgs（字符串列表）：应将错误消息添加到此列表中，并将一起报告</span>
<span class="sd">，并在</span>
<span class="sd">meth:`~torch.nn.Module.load_state_dict`</span>
<span class="sd">"源代码"</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
            <span class="n">hook</span><span class="p">(</span>
                <span class="n">state_dict</span><span class="p">,</span>
                <span class="n">前缀</span><span class="p">,</span>
                <span class="n">本地元数据</span><span class="p">,</span>
                <span class="n">严格的</span><span class="p">,</span>
                <span class="n">缺少键</span><span class="p">,</span>
                <span class="n">预期之外的键</span><span class="p">,</span>
                <span class="n">错误信息</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">持久缓冲区</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">为</font></font></font></span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">()</span>
            <span class="k">如果</font></font></font></span> <span class="n">k</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">非持久缓冲区集合</span>
        <span class="p">}</span>
        <span class="n">本地名称参数</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span><span class="p">(),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">持久缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">本地状态</font></font></font></span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地名称参数</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">}</span>
        <span class="n">分配给参数缓冲区</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地元数据</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配到参数缓冲区</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">)</span>
        <span class="n">使用交换张量</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未来</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在转换时获取交换模块参数</span><span class="p">()</span>

        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n">local_state</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">前缀</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span>
            <span class="k">如果</font></font></font></span> <span class="n">key</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">state_dict</span><span class="p">:</span>
                <span class="n">输入参数</font></font></font></span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">]</span>
                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">覆盖</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否与张量类似</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="p">):</span>
                    <span class="n">错误信息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'在复制名为 " 的参数时 '</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">", ' "</span>
                        <span class="s2">"期望从检查点接收 torch.Tensor 或类似 Tensor 的对象，但实际接收到了 "</span>
                        <span class="sa">f</span><span class="s2">"接收到的 "</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
                    <span class="k">继续</span>

                <span class="c1"># 这用于避免将未初始化的参数复制到</span>
                <span class="c1">非懒加载模块，因为它们没有进行检查的钩子</span>
                <span class="c1">在这种情况下，当访问 .shape 属性时会出错。</span>
                <span class="n">是懒加载参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n">is_lazy</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">)</span>
                <span class="c1">向后兼容：从 0.3.* 版本加载 1 维张量到 0.4+ 版本</span>
                <span class="k">如果</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">是懒加载参数</span>
                    <span class="ow">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="ow">和</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">):</span>
                    <span class="n">输入参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是懒加载参数</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">形状</font></font></font></span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="c1"># 本地形状应与检查点中的形状匹配</span>
                    <span class="n">错误信息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"大小不匹配，对于"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制形状为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">从检查点开始，</span>
                        <span class="sa">f</span><span class="s2">当前模型中的形状是</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
                    <span class="p">)</span>
                    <span class="k">继续</span>

                <span class="k">如果</span> <span class="p">(</span>
                    <span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否是元数据</span>
                    <span class="ow">和</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否是元数据</span>
                    <span class="ow">和</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配给参数缓冲区</span>
                <span class="p">):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">警告</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"对于"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">从检查点中的非元参数复制到元参数</span>
                        <span class="s2">当前模型中的参数，这是一个空操作。（您是指“）</span>
                        <span class="s2">将 `assign=True` 传递给 `assign` 以将状态字典中的项目分配给它们的</span>
                        <span class="s2">相应模块中的键而不是直接复制它们？</span>
                    <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">与</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不梯度</span><span class="p">():</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用交换张量</span><span class="p">:</span>
                            <span class="n">新输入参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块加载</span><span class="p">(</span>
                                <span class="n">输入参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配给参数缓冲区</span>
                            <span class="p">)</span>
                            <span class="k">如果</font></font></font></span> <span class="nb">id</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">新输入参数</font></font></font></span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</span> <span class="nb">id</span><span class="p">(</span>
                                <span class="n">新输入参数</span>
                            <span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">参数</span><span class="p">):</span>
                                <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                                    <span class="s2">"模块加载返回了 self 或 other，请.detach() "</span>
                                    <span class="s2">"如果返回模块加载中的输入之一的结果"</span>
                                <span class="p">)</span>
                            <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
                                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">新输入参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
                                    <span class="n">新输入参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">(</span>
                                        <span class="n">新输入参数</span><span class="p">,</span>
                                        <span class="n">需要梯度</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="k">否则</span><span class="p">:</span>
                                    <span class="n">新输入参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</span><span class="p">)</span>
                            <span class="n">火炬</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">工具</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">交换张量</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">新输入参数</span><span class="p">)</span>
                            <span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">新输入参数</span>
                        <span class="k">elif</span> <span class="n">分配到参数缓冲区</span><span class="p">:</span>
                            <span class="c1"># 上面的形状检查已经完成</span>
                            <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
                                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">):</span>
                                    <span class="n">输入参数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</font></font></font></span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">(</span>
                                        <span class="n">输入参数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="o">.</span><span class="n">requires_grad</span>
                                    <span class="p">)</span>
                                <span class="k">否则</span><span class="p">:</span>
                                    <span class="n">输入参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">需要梯度</span><span class="p">)</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="p">)</span>
                        <span class="k">否则</span><span class="p">:</span>
                            <span class="n">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制_</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</span><span class="p">)</span>
                <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">作为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">ext: ex</span><span class="p">:</span>
                    <span class="n">行动</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"交换"</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用交换张量</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"复制"</span>
                    <span class="n">错误信息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'当</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">行动</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数名为</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">", ' "</span>
                        <span class="sa">f</span><span class="s2">"在模型中的维度是"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</span>
                        <span class="sa">f</span><span class="s2">"在检查点中的维度是"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">尺寸</font></font></font></span><span class="p">()</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">，"</span>
                        <span class="sa">f</span><span class="s2">"发生异常："</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">ext: ex</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">严格的</span><span class="p">:</span>
                <span class="n">缺少键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">)</span>

        <span class="n">额外状态键</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</span> <span class="o">+</span> <span class="n">_EXTRA_STATE_KEY_SUFFIX</span>
        <span class="k">如果</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">类</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置额外状态</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置额外状态</span><span class="p">)</span>
            <span class="ow">是</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置额外状态</span>
        <span class="p">):</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">state_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">设置额外状态</font></font></font></span><span class="p">(</span><span class="n">state_dict</span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">严格的</span><span class="p">:</span>
                <span class="n">缺少键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">严格的</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">state_dict</span><span class="p">):</span>
            <span class="n">预期之外的键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</span><span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">严格的</span><span class="p">:</span>
            <span class="k">为</font></font></font></span> <span class="n">key</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n">state_dict</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">():</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...开头</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="n">key</span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外状态键</span><span class="p">:</span>
                    <span class="n">输入名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">)</span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“点”</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># 必须是模块如果它有属性</span>
                    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入名称</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入名称</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
                            <span class="n">预期之外的键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">输入名称</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</span> <span class="n">local_state</span><span class="p">:</span>
                        <span class="n">预期之外的键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">)</span>

<div class="viewcode-block" id="Module.load_state_dict"><a class="viewcode-back" href="../../../../generated/torch.nn.Module.html#torch.nn.modules.module.Module.load_state_dict">[文档]</font></font></font></a>    <span class="k">def</span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载状态字典</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">:</span> <span class="n">映射</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">严格的</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">假</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">将参数和缓冲区从 :attr:`state_dict` 复制到本模块及其后代。</span>

<span class="sd">如果 :attr:`strict` 为 ``True``，则</span>
<span class="sd">attr:`state_dict` 的键必须与该模块的 :meth:`~torch.nn.Module.state_dict` 函数返回的键完全匹配。</span>
<span class="sd">如果 :attr:`assign` 为 ``True``，则优化器必须在创建之后。</span>

<span class="sd">.. 警告::</span>
<span class="sd">如果 :attr:`assign` 为 ``True``，则优化器必须在创建之后。</span>
<span class="sd">调用 :attr:`load_state_dict` 方法，除非</span>
<span class="sd">func:`~torch.__future__.get_swap_module_params_on_conversion` 设置为 ``True``。</span>

<span class="sd">        Args:</span>
<span class="sd">state_dict（字典）：包含参数和持久缓冲区的字典。</span>
<span class="sd">持久缓冲区。</span>
<span class="sd">strict (bool, 可选): 是否严格检查 `state_dict` 中的键是否与该模块的 `state_dict` 函数返回的键匹配。默认：`True`</span>
<span class="sd">in :attr:`state_dict` 中的键必须与该模块的 :meth:`~torch.nn.Module.state_dict` 函数返回的键匹配。默认：`True`</span>
<span class="sd">meth:`~torch.nn.Module.state_dict` 函数。默认：`True`</span>
<span class="sd">assign (bool, 可选): 当设置为 `False` 时，不分配张量的属性</span>
<span class="sd">当前模块中保留，而将其设置为“True”则保留</span>
<span class="sd">状态字典中张量的属性。唯一</span>
<span class="sd">异常是 `:class:`~torch.nn.Parameter` 的 `requires_grad` 字段</span>
<span class="sd">对于模块中的值被保留的情况。</span>
<span class="sd">默认：``False``</span>

<span class="sd">返回：</span>
<span class="sd">``NamedTuple``包含`missing_keys`和`unexpected_keys`字段：</span>
<span class="sd">* **missing_keys** 是一个包含任何预期键的字符串列表。</span>
<span class="sd">由该模块预期但未在提供的 ``state_dict`` 中出现的键。</span>
<span class="sd">* **unexpected_keys** 是一个包含未由该模块预期但出现在提供的 ``state_dict`` 中的键的字符串列表。</span>
<span class="sd">由该模块预期但未在提供的 ``state_dict`` 中出现的键。</span>

<span class="sd">注意：</span>
<span class="sd">如果参数或缓冲区注册为“None”，则其对应键</span>
<span class="sd">存在于：attr:`state_dict`，:meth:`load_state_dict` 将引发</span>
<span class="sd">运行时错误。</span>
<span class="sd">"源代码"</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">映射</span><span class="p">):</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">期望 state_dict 是类似字典的，得到</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">。</span>
            <span class="p">)</span>

        <span class="n">缺少键</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">预期之外的键</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">错误信息</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字符串</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># 拷贝状态字典以便 _load_from_state_dict 可以修改它</span>
        <span class="n">元数据</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state_dict</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_metadata</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">)</span>
        <span class="n">状态字典</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有序字典</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="c1"># mypy 并不知道 "_metadata" 存在于状态字典中</span>
            <span class="n">state_dict</span><span class="o">.</span><span class="n">元数据</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型: 忽略[attr-defined]</span>

        <span class="k">def</span> <span class="nf">加载</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地状态字典</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
            <span class="n">本地元数据</font></font></font></span> <span class="o">=</span> <span class="p">{}</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元数据</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="o">-</span><span class="mi">1</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span> <span class="p">{})</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配</span><span class="p">:</span>
                <span class="n">本地元数据</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配到参数缓冲区</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分配</span>
            <span class="n">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">从状态字典加载</span><span class="p">(</span>
                <span class="n">本地状态字典</span><span class="p">,</span>
                <span class="n">前缀</span><span class="p">,</span>
                <span class="n">本地元数据</span><span class="p">,</span>
                <span class="kc">True</span><span class="p">,</span>
                <span class="n">缺少键</span><span class="p">,</span>
                <span class="n">预期之外的键</span><span class="p">,</span>
                <span class="n">错误信息</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">儿童</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">儿童</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="n">子前缀</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span> <span class="o">+</span> <span class="s2">"."</span>
                    <span class="n">子状态字典</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                        <span class="k">为</font></font></font></span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">本地状态字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">()</span>
                        <span class="k">如果</font></font></font></span> <span class="n">k</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...开头</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀子项</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="n">加载</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">儿童</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">子状态字典</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀子项</span><span class="p">)</span>  <span class="c1"># noqa: F821</span>

            <span class="c1"># 注意，钩子可以修改 missing_keys 和 unexpected_keys。</span>
            <span class="n">不兼容的键</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_不兼容键</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期之外的键</span><span class="p">)</span>
            <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">钩子</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载状态字典后钩子</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</span><span class="p">():</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">不兼容的键</span><span class="p">)</span>
                <span class="k">断言</font></font></font></span> <span class="n">out</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">钩子注册到 `register_load_state_dict_post_hook` 后不再使用</span>
                    <span class="s2">预期返回新值，如果需要修改 incompatible_keys</span>
                    <span class="s2">"应该在原地完成。"</span>
                <span class="p">)</span>

        <span class="n">加载</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">)</span>
        <span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载</span>

        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">严格的</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期之外的键</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">错误信息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">插入</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">"state_dict 中存在意外的键："</font></font></font></span><span class="si">{}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</span><span class="p">(</span>
                        <span class="s2">“，”</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“”</font></font></font></span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">''</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">k</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期之外的键</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少键</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">错误信息</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">插入</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">"state_dict 中缺少键："</font></font></font></span><span class="si">{}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</span><span class="p">(</span>
                        <span class="s2">“，”</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“”</font></font></font></span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">''</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">k</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少键</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span>

        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误信息</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">提升</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">运行时错误</span><span class="p">(</span>
                <span class="s2">加载状态字典时出错</font></font></font></span><span class="si">{}</span><span class="s2">:</span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">格式</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">类</font></font></font></span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n\t</span><span class="s2">"</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误信息</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_不兼容键</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缺少键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期之外的键</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">命名成员</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">get_members_fn</span><span class="p">,</span> <span class="n">前缀</font></font></font></span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">递归</font></font></font></span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">删除重复项</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔类型</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">"""帮助产生各种模块的名称 + 成员。"""</span>
        <span class="n">备忘录</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">集合</span><span class="p">()</span>
        <span class="n">模块</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">命名模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">删除重复项</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">删除重复项</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">递归</span>
            <span class="k">否则</font></font></font></span> <span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">前缀</font></font></font></span><span class="p">,</span> <span class="bp">self</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
        <span class="p">)</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块前缀</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">:</span>
            <span class="n">成员</font></font></font></span> <span class="o">=</span> <span class="n">get_members_fn</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span>
            <span class="k">为</font></font></font></span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">会员</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或</font></font></font></span> <span class="n">v</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">描述</span><span class="p">:</span>
                    <span class="k">继续</span>
                <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">删除重复项</span><span class="p">:</span>
                    <span class="n">描述</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块前缀</font></font></font></span> <span class="o">+</span> <span class="p">(</span><span class="s2">"."</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块前缀</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</span> <span class="s2">""</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span>
                <span class="k">产生</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">,</span> <span class="n">v</span>

<div class="viewcode-block" id="Module.parameters"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def parameters(self, recurse: bool = True) -&gt; Iterator[Parameter]:
返回模块参数的迭代器。

这通常传递给优化器。

参数:
递归（布尔值）：如果为 True，则产生此模块的参数
否则，仅返回参数。
是该模块的直接成员。

产生：
参数：模块参数

示例::

&gt;&gt;&gt; # xdoctest: +SKIP("未定义的变量")
&gt;&gt;&gt; for param in model.parameters():
&gt;&gt;&gt;     打印(param 的类型(), param.size())
 (20L,)
 (20L, 1L, 5L, 5L)

"""
for _name, param in self.named_parameters(recurse=recurse):
yield param</font></font></font></div>

<div class="viewcode-block" id="Module.named_parameters"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def named_parameters(
self, prefix: str = "", recurse: bool = True, remove_duplicate: bool = True
) -&gt; Iterator[tuple[str, Parameter]]:
r"""返回模块参数的迭代器，同时返回参数的名称以及参数本身。

参数:
前缀（str）：所有参数名称的前缀。
递归（布尔值）：如果为 True，则产生此模块的参数
否则，仅返回参数。
是该模块的直接成员。
移除重复项（布尔值，可选）：是否移除重复项
结果中的参数。默认为 True。

产出：
(str, 参数): 包含名称和参数的元组

示例::

&gt;&gt;&gt; # xdoctest: +SKIP("未定义的变量")
&gt;&gt;&gt; for name, param in self.named_parameters():
&gt;&gt;&gt; 如果 name 在 ['bias'] 中：
&gt;&gt;&gt; 打印(param.size())

"""
gen = self._named_members(
lambda 模块: 模块._parameters.items(),
prefix=prefix,
recurse=recurse,
remove_duplicate=remove_duplicate,
        )
yield from gen</font></font></font></div>

<div class="viewcode-block" id="Module.buffers"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def buffers(self, recurse: bool = True) -&gt; 迭代器[Tensor]:
r"""返回模块缓冲区的迭代器。

Args:
recurse (bool): 如果为 True，则生成当前模块及其所有子模块的缓冲区。否则，仅生成当前模块的直接成员缓冲区。
和所有子模块的。否则，仅生成当前模块的直接成员缓冲区。
是当前模块的直接成员缓冲区。

产生：
torch.Tensor：模块缓冲区

示例::

&gt;&gt;&gt; # xdoctest：+SKIP("未定义变量")
&gt;&gt;&gt; for buf in model.buffers():
&gt;&gt;&gt;     打印(buf 的类型, buf 的大小())
 (20L,)
 (20L, 1L, 5L, 5L)

"""
对于 _, buf in self.named_buffers(recurse=recurse):
yield buf</font></font></font></div>

<div class="viewcode-block" id="Module.named_buffers"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def named_buffers(
self, 前缀: str = "", 递归: bool = True, 删除重复: bool = True
) -&gt; 迭代器[tuple[str, Tensor]]:
r"""返回模块缓冲区的迭代器，同时返回缓冲区的名称以及缓冲区本身。

参数:
前缀（str）：所有缓冲区名称的前缀。
递归（bool，可选）：如果为 True，则产生此模块的缓冲区
否则，仅返回缓冲区。
是该模块的直接成员。默认为 True。
remove_duplicate (bool, 可选): 是否在结果中移除重复的缓冲区。默认为 True。

Yields:
(str, torch.Tensor): 包含名称和缓冲区的元组

示例::

&gt;&gt;&gt; # xdoctest: +SKIP("undefined vars")
&gt;&gt;&gt; for name, buf in self.named_buffers():
&gt;&gt;&gt;     if name in ['running_var']:
&gt;&gt;&gt;         print(buf.size())

"""
gen = self._named_members(
lambda 模块: 模块._buffers.items(),
prefix=prefix,
recurse=recurse,
remove_duplicate=remove_duplicate,
        )
yield from gen</font></font></font></div>

<div class="viewcode-block" id="Module.children"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def children(self) -&gt; 迭代器["模块"]:
r"""返回一个立即子模块的迭代器。

Yields:
模块：一个子模块
"""
for _name, module in self.named_children():
yield module</font></font></font></div>

<div class="viewcode-block" id="Module.named_children"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def named_children(self) -&gt; Iterator[tuple[str, "Module"]]:
r"""返回一个遍历直接子模块的迭代器，同时提供模块名称及其本身。

Yields:
(str, Module): 包含名称和子模块的元组

示例::

&gt;&gt;&gt; # xdoctest: +SKIP("未定义的变量")
&gt;&gt;&gt; for name, module in model.named_children():
&gt;&gt;&gt;     if name in ['conv4', 'conv5']:
&gt;&gt;&gt; 打印(module)

"""
memo = set()
for name, module in self._modules.items():
如果模块不为空且模块不在 memo 中
将模块添加到 memo 中
生成 name 和 module</font></font></font></div>

<div class="viewcode-block" id="Module.modules"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def modules(self) -&gt; 迭代器["Module"]:
r"""遍历网络中所有模块。

Yields:
Module: 网络中的一个模块

注意：
重复模块只返回一次。在下文中
示例，`l` 将只返回一次。

示例：

&gt;&gt;&gt; l = nn.Linear(2, 2)
&gt;&gt;&gt; net = nn.Sequential(l, l)
&gt;&gt;&gt; for idx, m in enumerate(net.modules()):
...     打印(idx, '-&gt;', m)

0 -&gt; 顺序(
(0): 线性层(in_features=2, out_features=2, bias=True)
(1): 线性层(in_features=2, out_features=2, bias=True)
            )
1 -&gt; 线性层(in_features=2, out_features=2, bias=True)

"""
for _, module in self.named_modules():
yield module</font></font></font></div>

<div class="viewcode-block" id="Module.named_modules"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def named_modules(
self,
memo: Optional[set["Module"]] = None,
prefix: str = "",
remove_duplicate: 布尔 = True,
    ):
返回网络中所有模块的迭代器，同时返回模块的名称以及模块本身。

Args:
memo: 存储已添加到结果中的模块集合的备忘录
prefix: 将添加到模块名称的前缀
remove_duplicate: 是否在结果中删除重复的模块实例
或否

产生：
（str，模块）：名称和模块的元组

注意：
重复的模块只返回一次。在以下
示例，``l`` 只会返回一次。

示例::

&gt;&gt;&gt; l = nn.Linear(2, 2)
&gt;&gt;&gt; net = nn.Sequential(l, l)
&gt;&gt;&gt; for idx, m in enumerate(net.named_modules()):
...     打印(idx, '-&gt;', m)

0 -&gt; ('', Sequential(
(0): Linear(in_features=2, out_features=2, bias=True)
(1): 线性(in_features=2, out_features=2, bias=True)
            ))
1 -&gt; ('0', 线性(in_features=2, out_features=2, bias=True))

"""
如果 memo 为 None：
memo = set()
如果 self 不在 memo 中：
如果 remove_duplicate:
self.memo.add()
yield 前缀, self
for name, module in self._modules.items():
if module is None:
继续执行
模块前缀 = prefix + ("." if prefix else "") + name
yield from module.named_modules(
memo, 模块前缀, 删除重复项
                )</font></font></font></div>

<div class="viewcode-block" id="Module.train"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def train(self: T, mode: bool = True) -&gt; T:
r"""将模块设置为训练模式。

这只对某些模块有效。有关特定模块在训练/评估模式下的行为详情，请参阅相关文档。
particular modules for details of their behaviors in training/evaluation
模式，即它们是否受影响，例如：:class:`Dropout`，:class:`BatchNorm`，
等。

Args:
mode (bool): 是否设置训练模式（``True``）或评估模式
mode（``False``）。默认：``True``。

返回：
模块：self
"""
如果不是 bool 类型：
则抛出 ValueError 异常：“期望训练模式为布尔值”。
self.training = mode
for module in self.children():
module.train(mode)
返回 self</font></font></font></div>

<div class="viewcode-block" id="Module.eval"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def eval(self: T) -&gt; T:
r"""将模块设置为评估模式。

这仅对某些模块有影响。请参阅文档。
特定模块在训练/评估中的行为细节
模式，即它们是否受到影响，例如：:class:`Dropout`，:class:`BatchNorm`
等等。

这与:meth:`self.train(False) `等效。

请参阅:ref:`locally-disable-grad-doc`，以比较它与.eval()以及可能与之混淆的几个类似机制。
`.eval()`和可能与其混淆的几个类似机制。

返回：
模块：self
"""
返回 self.train(False)</font></font></font></div>

<div class="viewcode-block" id="Module.requires_grad_"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def requires_grad_(self: T, requires_grad: bool = True) -&gt; T:
r"如果自动微分应该记录此模块中参数的操作，则更改此设置。"

此方法设置参数的 :attr:`requires_grad` 属性
改变位置。

此方法对于冻结模块的一部分以进行微调很有帮助
或单独训练模型的部分（例如，GAN 训练）。

请参阅：ref:`locally-disable-grad-doc` 了解其与 `.requires_grad_()` 以及可能与之混淆的几个类似机制的对比。
`.requires_grad_()` 和几个可能与其混淆的类似机制。

参数：
requires_grad (bool): 是否应该记录此模块中参数的操作。默认：``True``。
参数在此模块中。默认：``True``。

返回值：
模块：self
"""
for p in self.parameters():
p.requires_grad_(requires_grad)
return self</font></font></font></div>

<div class="viewcode-block" id="Module.zero_grad"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def zero_grad(self, set_to_none: bool = True) -&gt; None:
重置所有模型参数的梯度。

更多上下文请参阅 :class:`torch.optim.Optimizer` 下的类似函数。

参数：
将梯度设置为 None（而不是设置为 0）。
详细信息请参阅：:meth:`torch.optim.Optimizer.zero_grad`。
"""
如果 getattr(self, "_is_replica", False)：
warnings.warn(
从使用 nn.DataParallel()创建的模块中调用.zero_grad()没有任何效果。
参数是从原始模块中复制的（以可微分的方式）。
这意味着它们不是 autograd 的叶子节点，因此不会累积梯度。
如果你在前向方法中需要梯度，请考虑使用 autograd.grad。
            )

for p in self.parameters():
如果 p.grad 不是 None：
如果设置 None
p.grad = None
else:
如果 p.grad.grad_fn 不是 None
p.grad.detach_()
else:
p.grad.requires_grad_(False)
p.grad.zero_()</font></font></font></div>

<div class="viewcode-block" id="Module.share_memory"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def share_memory(self: T) -&gt; T:
r"""参见 :meth:`torch.Tensor.share_memory_`。”
return self._apply(lambda t: t.share_memory_())</font></font></font></div>

    <span class="k">def</span> <span class="nf">_获取名称</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</span><span class="o">.</span><span class="vm">__name__</span>

<div class="viewcode-block" id="Module.extra_repr"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def extra_repr(self) -&gt; str:
返回模块的额外表示。

打印自定义额外信息，您应该重新实现
此方法应用于您的模块。单行和多行均可。
字符串是可接受的。
"""
返回 ""</font></font></font></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">我们将额外的 repr 视为子模块，每行一个项目</span>
        <span class="n">额外行</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">额外表示</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外表示</span><span class="p">()</span>
        <span class="c1"># 空字符串将被分割成列表 ['']</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外表示</span><span class="p">:</span>
            <span class="n">额外行</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外表示</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">子行</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">为</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="n">mod_str</span> <span class="o">=</span> <span class="nb">表示</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span>
            <span class="n">mod_str</span> <span class="o">=</span> <span class="n">_addindent</span><span class="p">(</span><span class="n">mod_str</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">子行</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">追加</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“（”</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">"): "</span> <span class="o">+</span> <span class="n">mod_str</span><span class="p">)</span>
        <span class="n">行</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外行</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">子行</span>

        <span class="n">主字符串</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取名称</font></font></font></span><span class="p">()</span> <span class="o">+</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“（”</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">行</span><span class="p">:</span>
            <span class="c1"># 简单的一行信息，大多数内置模块都会使用</span>
            <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">长度</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外行</font></font></font></span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">和</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">子行</span><span class="p">:</span>
                <span class="n">主字符串</font></font></font></span> <span class="o">+=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">额外行</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">否则</span><span class="p">:</span>
                <span class="n">主字符串</font></font></font></span> <span class="o">+=</span> <span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</font></font></font></span><span class="s2">  "</span> <span class="o">+</span> <span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</font></font></font></span><span class="s2">  "</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加入</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">行</font></font></font></span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：\n</span><span class="s2">"</span>

        <span class="n">主字符串</font></font></font></span> <span class="o">+=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">）"</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">主字符串</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">模块属性</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">列表</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">())</span>
        <span class="n">参数</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">())</span>
        <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">())</span>
        <span class="n">缓冲区</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">())</span>
        <span class="n">键</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块属性</font></font></font></span> <span class="o">+</span> <span class="n">attrs</span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">缓冲区</span>

        <span class="c1"># 删除非法 Python 变量名的属性</span>
        <span class="n">键</font></font></font></span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">为</font></font></font></span> <span class="n">key</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>

        <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">排序</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_为数据并行复制</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">复制品</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">复制品</font></font></font></span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制</span><span class="p">()</span>

        <span class="c1"># 复制品本身没有参数，复制品引用原始</span>
        <span class="c1">模块。</span>
        <span class="n">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_缓冲区</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制</span><span class="p">()</span>
        <span class="n">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制</span><span class="p">()</span>
        <span class="n">复制品</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_是副本</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型：忽略[赋值]</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">复制品</span>

<div class="viewcode-block" id="Module.compile"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def 编译(self, *args, **kwargs):
"""
使用 :func:`torch.compile` 编译此模块的前向。

此模块的 `__call__` 方法已编译，所有参数都原样传递给 :func:`torch.compile`。
有关此函数参数的详细信息，请参阅 :func:`torch.compile`。

请参阅 :func:`torch.compile` 了解此函数的参数详情。
"""
self._compiled_call_impl = torch.compile(self._call_impl, *args, **kwargs)</font></font></font></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>© 版权所有 PyTorch 贡献者。</p>
  </div>
    
      <div>使用 Sphinx 构建，并使用 Read the Docs 提供的主题。</div>
     

</footer>

          </div>
<script>

var match = window.location.href.match(/\/_[a-zA-Z0-9_]*.html|_dynamo/gi);
var url = window.location.href.lastIndexOf(match[match.length-1]);

if (url)
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-exclamation-circle" aria-hidden="true">&nbsp</i> This page describes an internal API which is not intended to be used outside of the PyTorch codebase and can be modified or removed without notice.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="../../../../_static/clipboard.min.js"></script>
         <script src="../../../../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script="" type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0">


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>文档</h2>
          <p>查看 PyTorch 的全面开发者文档</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">查看文档</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>教程</h2>
          <p>深入了解初学者和高级开发者的教程</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">查看教程</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>资源</h2>
          <p>查找开发资源，获取您的疑问解答</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">查看资源</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">开始使用</a></li>
            <li><a href="https://pytorch.org/features">功能</a></li>
            <li><a href="https://pytorch.org/ecosystem">生态系统</a></li>
            <li><a href="https://pytorch.org/blog/">博客</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">贡献</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">资源</a></li>
            <li><a href="https://pytorch.org/tutorials">教程</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">文档</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">讨论</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github 问题</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">品牌指南</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">保持更新</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">推特</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">领英</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch 播客</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">苹果</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">谷歌</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">亚马逊</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">条款</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">隐私</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© 版权所有 Linux 基金会。PyTorch 基金会是 Linux 基金会的一个项目。有关 PyTorch 基金会的网站使用条款、商标政策以及其他适用政策，请参阅 www.linuxfoundation.org/policies/。PyTorch 基金会支持 PyTorch 开源项目，该项目已被确立为 LF Projects, LLC 的 PyTorch 项目系列。有关适用于 PyTorch 项目系列 LF Projects, LLC 的政策，请参阅 www.lfprojects.org/policies/。</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">为了分析流量并优化您的体验，我们在本网站上使用 cookies。通过点击或导航，您同意允许我们使用 cookies。作为本网站的当前维护者，适用 Facebook 的 Cookies 政策。了解更多信息，包括关于可用控制的信息：Cookies 政策。</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg" width="16" height="16">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>学习</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/get-started">开始使用</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials">教程</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/basics/intro.html">学习基础知识</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/recipes/recipes_index.html">PyTorch 食谱</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/introyt.html">PyTorch 入门 - YouTube 系列</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>生态系统</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/ecosystem">工具</a>
             </li>
             <li>
               <a href="https://pytorch.org/#community-module">社区</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">论坛</a>
             </li>
             <li>
               <a href="https://pytorch.org/resources">开发者资源</a>
             </li>
             <li>
               <a href="https://pytorch.org/ecosystem/contributor-awards-2023">贡献者奖项 - 2024</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>边缘</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/edge">关于 PyTorch Edge</a>
             </li>
             
             <li>
               <a href="https://pytorch.org/executorch-overview">ExecuTorch</a>
             </li>
             <li>
               <a href="https://pytorch.org/executorch/stable/index.html">ExecuTorch 文档</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>文档</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/pytorch-domains">PyTorch 领域</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>博客 &amp; 新闻</a>
          </li>
            
           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/blog/">PyTorch 博客</a>
            </li>
            <li>
              <a href="https://pytorch.org/community-blog">社区博客</a>
            </li>

            <li>
              <a href="https://pytorch.org/videos">视频</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">社区故事</a>
            </li>
            <li>
              <a href="https://pytorch.org/events">活动</a>
            </li>
            <li>
               <a href="https://pytorch.org/newsletter">通讯</a>
             </li>
          </ul>
          
          <li class="resources-mobile-menu-title">
            <a>关于</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/foundation">PyTorch 基金会</a>
            </li>
            <li>
              <a href="https://pytorch.org/governing-board">管理委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/credits">云信用计划</a>
            </li>
            <li>
               <a href="https://pytorch.org/tac">技术咨询委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/staff">员工</a>
            </li>
            <li>
               <a href="https://pytorch.org/contact-us">联系我们</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

</body></html>