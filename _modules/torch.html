<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>torch — PyTorch main documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://maskerprc.github.io/docs/stable/_modules/torch.html">
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css">
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css">
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css">
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="../_static/katex-math.css" type="text/css">
  <link rel="stylesheet" href="../_static/sphinx-dropdown.css" type="text/css">
  <link rel="stylesheet" href="../_static/panels-bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="../_static/css/jit.css" type="text/css">
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css">
    <link rel="index" title="Index" href="../genindex.html">
    <link rel="search" title="Search" href="../search.html">

<!--
  Search engines should not index the main version of documentation.
  Stable documentation are built without release == 'main'.
-->
<meta name="robots" content="noindex">


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head><body class="pytorch-body"><div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://maskerprc.github.io/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">学习</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/get-started">
                  <span class="dropdown-title">开始使用</span>
                  <p>在本地运行 PyTorch 或快速开始使用支持的云平台之一</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/tutorials">
                  <span class="dropdown-title">教程</span><p></p>
                  <p>PyTorch 教程中的新内容</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/tutorials/beginner/basics/intro.html">
                  <span class="dropdown-title">学习基础知识</span><p></p>
                  <p>熟悉 PyTorch 概念和模块</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/tutorials/recipes/recipes_index.html">
                  <span class="dropdown-title">PyTorch 烹饪技巧</span><p></p>
                  <p>精简型、可直接部署的 PyTorch 代码示例</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/tutorials/beginner/introyt.html">
                  <span class="dropdown-title">PyTorch 入门 - YouTube 系列</span><p></p>
                  <p>通过我们引人入胜的 YouTube 教程系列掌握 PyTorch 基础知识</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">生态系统</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/ecosystem">
                  <span class="dropdown-title">工具</span><p></p>
                  <p>了解 PyTorch 生态系统中的工具和框架</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/#community-module">
                  <span class="dropdown-title">社区</span>
                  <p>加入 PyTorch 开发者社区，贡献、学习并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">论坛</span>
                  <p>讨论 PyTorch 代码、问题、安装、研究的地方</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/resources">
                  <span class="dropdown-title">开发者资源</span>
                  <p>查找资源并解答问题</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/ecosystem/contributor-awards-2024">
                  <span class="dropdown-title">2024 年度贡献者奖项</span><p></p>
                  <p>本届 PyTorch 会议揭晓获奖者</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/edge">
                  <span class="dropdown-title">关于 PyTorch Edge</span><p></p>
                  <p>为边缘设备构建创新和隐私感知的 AI 体验</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/executorch-overview">
                  <span class="dropdown-title">ExecuTorch</span><p></p>
                  <p>针对移动和边缘设备实现设备端推理能力的端到端解决方案</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/executorch/stable/index.html">
                  <span class="dropdown-title">ExecuTorch 文档</span><p></p>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">文档</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span><p></p>
                  <p>探索文档以获取如何使用 PyTorch 的全面指南</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/pytorch-domains">
                  <span class="dropdown-title">PyTorch 领域</span><p></p>
                  <p>阅读 PyTorch 领域的文档以了解更多关于特定领域的库</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">博客与新闻</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/blog/">
                  <span class="dropdown-title">PyTorch 博客</span><p></p>
                  <p>跟上最新的技术新闻和动态</p>
                </a>
                 <a class="nav-dropdown-item" href="https://maskerprc.github.io/community-blog">
                  <span class="dropdown-title">社区博客</span><p></p>
                  <p>PyTorch 生态系统故事</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/videos">
                  <span class="dropdown-title">视频</span><p></p>
                  <p>了解最新的 PyTorch 教程、新内容等</p>
                </a><a class="nav-dropdown-item" href="https://maskerprc.github.io/community-stories">
                  <span class="dropdown-title">社区故事</span><p></p>
                  <p>了解我们的社区如何使用 PyTorch 解决真实、日常的机器学习问题</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/events">
                  <span class="dropdown-title">活动</span><p></p>
                  <p>查找活动、网络研讨会和播客</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/newsletter">
                  <span class="dropdown-title">通讯</span><p></p>
                  <p>保持最新更新</p>
                </a>
            </div>
          </div></li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">关于</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/foundation">
                  <span class="dropdown-title">PyTorch 基金会</span><p></p>
                  <p>了解更多关于 PyTorch 基金会的信息</p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/governing-board">
                  <span class="dropdown-title">管理委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/credits">
                  <span class="dropdown-title">云信用计划</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/tac">
                  <span class="dropdown-title">技术顾问委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/staff">
                  <span class="dropdown-title">员工</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://maskerprc.github.io/contact-us">
                  <span class="dropdown-title">联系我们</span><p></p>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="https://maskerprc.github.io/join" data-cta="join">成为会员</a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>



   

    

    <div class="table-of-contents-link-wrapper">
      <span>目录</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="https://maskerprc.github.io/docs/versions.html">主页 (2.7.0+cpu ) ▼</a>
    </div>
    <div id="searchBox">
    <div class="searchbox" id="googleSearchBox">
      <script async="" src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>
      <div class="gcse-search"></div>
    </div>
    <div id="sphinxSearchBox" style="display: none;">
      <div role="search">
        <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
          <input type="text" name="q" placeholder="Search Docs">
          <input type="hidden" name="check_keywords" value="yes">
          <input type="hidden" name="area" value="default">
        </form>
      </div>
    </div>
  </div>
  <form id="searchForm">
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="google" checked="">Google 搜索</label>
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="sphinx">经典搜索</label>
  </form>

  <script>
     document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('searchForm');
      const googleSearchBox = document.getElementById('googleSearchBox');
      const sphinxSearchBox = document.getElementById('sphinxSearchBox');
      // Function to toggle search box visibility
      function toggleSearchBox(searchType) {
        googleSearchBox.style.display = searchType === 'google' ? 'block' : 'none';
        sphinxSearchBox.style.display = searchType === 'sphinx' ? 'block' : 'none';
      }
      // Determine the default search type
      let defaultSearchType;
      const currentUrl = window.location.href;
      if (currentUrl.startsWith('https://maskerprc.github.io/docs/stable')) {
        // For the stable documentation, default to Google
        defaultSearchType = localStorage.getItem('searchType') || 'google';
      } else {
        // For any other version, including docs-preview, default to Sphinx
        defaultSearchType = 'sphinx';
      }
      // Set the default search type
      document.querySelector(`input[name="searchType"][value="${defaultSearchType}"]`).checked = true;
      toggleSearchBox(defaultSearchType);
      // Event listener for changes in search type
      searchForm.addEventListener('change', function(event) {
        const selectedSearchType = event.target.value;
        localStorage.setItem('searchType', selectedSearchType);
        toggleSearchBox(selectedSearchType);
      });
      // Set placeholder text for Google search box
      window.onload = function() {
        var placeholderText = "Search Docs";
        var googleSearchboxText = document.querySelector("#gsc-i-id1");
        if (googleSearchboxText) {
          googleSearchboxText.placeholder = placeholderText;
          googleSearchboxText.style.fontFamily = 'FreightSans';
          googleSearchboxText.style.fontSize = "1.2rem";
          googleSearchboxText.style.color = '#262626';
        }
      };
    });
  </script>

          </div>

          

<div>
  <a style="color:#F05732" href="https://maskerprc.github.io/docs/stable/_modules/torch.html">您正在查看不稳定开发者预览文档。请点击此处查看最新稳定版本的文档。</a>
</div>


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">社区</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/build_ci_governance.html">PyTorch 治理 | 构建 + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contribution_guide.html">PyTorch 贡献指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/design.html">PyTorch 设计哲学</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/governance.html">PyTorch 治理 | 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/persons_of_interest.html">PyTorch 治理 | 维护者</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者笔记</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/amp_examples.html">自动混合精度示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/autograd.html">Autograd 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/broadcasting.html">广播语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/cpu_threading_torchscript_inference.html">CPU 线程和 TorchScript 推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/cuda.html">CUDA 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/custom_operators.html">PyTorch 自定义操作着陆页面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/ddp.html">分布式数据并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/extending.html">扩展 PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/extending.func.html">扩展 torch.func 与 autograd.Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/fsdp.html">FSDP 笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/get_start_xpu.html">在英特尔 GPU 上入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/gradcheck.html">毕业审核力学</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/hip.html">HIP (ROCm) 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/large_scale_deployments.html">大规模部署功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/libtorch_stable_abi.html">LibTorch 稳定 ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/modules.html">模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/mps.html">MPS 后端</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/multiprocessing.html">多进程最佳实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/numerical_accuracy.html">数值精度</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/randomness.html">可复现性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/serialization.html">序列化语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/windows.html">Windows 常见问题解答</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语言绑定</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy.html">torch::deploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor_attributes.html">Tensor 属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensor_view.html">张量视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accelerator.html">torch 加速器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu.html">torch.cpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch_cuda_memory.html">理解 CUDA 内存使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch_cuda_memory.html#generating-a-snapshot">生成快照</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch_cuda_memory.html#using-the-visualizer">使用可视化器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch_cuda_memory.html#snapshot-api-reference">快照 API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mps.html">torch.mps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xpu.html">torch.xpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mtia.html">torch.mtia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mtia.memory.html">torch.mtia.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../meta.html">元设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export.html">torch.export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.tensor.html">torch.distributed.tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.fsdp.fully_shard.html">torch.distributed.fsdp.fully_shard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.tensor.parallel.html">torch.distributed.tensor.parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.pipelining.html">torch.distributed.pipelining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributed.checkpoint.html">torch.distributed.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch.compiler.html">torch.compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="../func.html">torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fx.experimental.html">torch.fx.experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub.html">torch.hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../signal.html">torch.signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.attention.html">torch.nn.attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../complex_numbers.html">复数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ddp_comm_hooks.html">DDP 通信钩子</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quantization.html">量化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc.html">分布式 RPC 框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../masked.html">torch.masked</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="../size.html">torch.Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage.html">torch 存储</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">torch.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deterministic.html">torch.utils.deterministic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jit_utils.html">torch.utils.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_tracker.html">torch.utils.module_tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../type_info.html">类型信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="../named_tensor.html">命名张量</a></li>
<li class="toctree-l1"><a class="reference internal" href="../name_inference.html">命名张量操作覆盖率</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_mod.html">torch.__config__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../future_mod.html">torch.__future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">torch._logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torch_environment_variables.html">火炬环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">图书馆</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/torchrec">火炬推荐</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/xla/">PyTorch 在 XLA 设备上</a></li>
<li class="toctree-l1"><a class="reference external" href="https://maskerprc.github.io/ao">torchao</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        文档 &gt;</li>

        
          <li>模块代码 &gt;</li>
        
      <li>火炬</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">快捷键</div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>PyTorch 源代码</font></font></font></h1><div class="highlight"><pre><span></span><span class="sd"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">""</span>
<span class="sd">torch 包包含多维张量的数据结构</span>
<span class="sd">并在这些张量上定义了数学运算。</span>
<span class="sd">此外，它还提供了许多用于高效序列化的实用工具。</span>
<span class="sd">张量、任意类型以及其他有用工具。</span>

<span class="sd">它有一个 CUDA 对应版本，允许您在具有计算能力&gt;=3.0 的 NVIDIA GPU 上运行张量计算。</span>
<span class="sd">在 NVIDIA GPU 上运行，计算能力需大于等于 3.0。</span>
<span class="sd">""</span>

<span class="c1"># mypy: 允许未类型化定义</span>

<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内置函数</span>
<span class="kn">导入</span> <span class="nn">ctypes</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入库</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作系统</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">文本换行</span>
<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线程</span>
<span class="kn">from</span> <span class="nn">打字</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="p">(</span>
    <span class="n">任何</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">,</span>
    <span class="n">可调用</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">,</span>
    <span class="n">获取源</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取原始</span><span class="p">,</span>
    <span class="n">可选</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</span><span class="p">,</span>
    <span class="n">超载</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">超载_</span><span class="p">,</span>
    <span class="n">类型检查</span><span class="p">,</span>
    <span class="n">类型变量</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_类型变量</span><span class="p">,</span>
    <span class="n">联合</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数规范</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_参数规范</span>


<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.类型</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">沉浸式类型</span>


<span class="c1"># multipy/deploy 在导入 torch 之前设置此导入，这是最重要的</span>
<span class="c1">可靠的方法来检测我们是否在部署中运行。</span>
<span class="c1"># https://github.com/pytorch/multipy/blob/d60f34ad38c371e441fe7ffdb77a3c3dda5a5d19/multipy/runtime/interpreter/interpreter_impl.cpp#L134-L137</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_运行时使用部署</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2">"torch._meta_registrations"</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</span>


<span class="kn">from</span> <span class="nn">torch._utils</span> <span class="kn">导入</span> <span class="p">(</span>
    <span class="n">功能化同步</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">同步_</span><span class="p">,</span>
    <span class="n">导入点名称</span><span class="p">,</span>
    <span class="n">类属性</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">torch._utils_internal</span> <span class="kn">导入</span> <span class="p">(</span>
    <span class="n">获取文件路径</span><span class="p">,</span>
    <span class="n">准备多进程环境</span><span class="p">,</span>
    <span class="n">使用全局依赖项</span><span class="p">,</span>
    <span class="n">使用 libtorch 的 RTLD_GLOBAL</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># TODO(torch_deploy) 在 fbcode 构建中找出如何冻结 version.py</span>
<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_运行时使用部署</span><span class="p">():</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="s2">"torch-deploy-1.8"</span>
    <span class="c1"># TODO: 在部署类型扩展更新到 4.10+后删除这个丑陋的解决方案</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
        <span class="kn">导入</span> <span class="nn">typing_extensions</span>

        <span class="n">_类型是</span> <span class="o">=</span> <span class="n">typing_extensions</span><span class="o">.</span><span class="n">TypeGuard</span>
        <span class="n">typing_extensions</span><span class="o">.</span><span class="n">类型是</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_类型是</span>
<span class="k">否则</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型是</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_类型是</span>

    <span class="kn">from</span> <span class="nn">torch.torch_version</span> <span class="kn">导入</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">__version__</span>

<span class="n">全部</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"布尔存储"</span><span class="p">,</span>
    <span class="s2">布尔张量</span><span class="p">,</span>
    <span class="s2">字节存储</span><span class="p">,</span>
    <span class="s2">字节张量</span><span class="p">,</span>
    <span class="s2">字符存储</span><span class="p">,</span>
    <span class="s2">"Char 张量"</span><span class="p">,</span>
    <span class="s2">"双精度存储"</span><span class="p">,</span>
    <span class="s2">"双精度张量"</span><span class="p">,</span>
    <span class="s2">"浮点存储"</span><span class="p">,</span>
    <span class="s2">浮点张量</span><span class="p">,</span>
    <span class="s2">梯度缩放器</span><span class="p">,</span>
    <span class="s2">整数存储</span><span class="p">,</span>
    <span class="s2">整数张量</span><span class="p">,</span>
    <span class="s2">长存储</span><span class="p">,</span>
    <span class="s2">长张量</span><span class="p">,</span>
    <span class="s2">短存储</span><span class="p">,</span>
    <span class="s2">短张量</span><span class="p">,</span>
    <span class="s2">"符号布尔"</span><span class="p">,</span>
    <span class="s2">"SymFloat"</span><span class="p">,</span>
    <span class="s2">"符号整数"</span><span class="p">,</span>
    <span class="s2">"张量"</span><span class="p">,</span>
    <span class="s2">"类型存储"</span><span class="p">,</span>
    <span class="s2">"无类型存储"</span><span class="p">,</span>
    <span class="s2">"是否启用了确定性算法"</span><span class="p">,</span>
    <span class="s2">"自动转换"</span><span class="p">,</span>
    <span class="s2">"块"</span><span class="p">,</span>
    <span class="s2">"编译"</span><span class="p">,</span>
    <span class="s2">"条件"</span><span class="p">,</span>
    <span class="s2">"启用梯度"</span><span class="p">,</span>
    <span class="s2">"导出"</span><span class="p">,</span>
    <span class="s2">"获取默认设备"</span><span class="p">,</span>
    <span class="s2">"获取确定性调试模式"</span><span class="p">,</span>
    <span class="s2">"获取设备模块"</span><span class="p">,</span>
    <span class="s2">"获取 float32 矩阵乘法精度"</span><span class="p">,</span>
    <span class="s2">"获取随机数生成器状态"</span><span class="p">,</span>
    <span class="s2">"推理模式"</span><span class="p">,</span>
    <span class="s2">"初始种子"</span><span class="p">,</span>
    <span class="s2">"是否仅警告确定算法启用"</span><span class="p">,</span>
    <span class="s2">"是否存储"</span><span class="p">,</span>
    <span class="s2">"是否是张量"</span><span class="p">,</span>
    <span class="s2">"是否总是启用警告"</span><span class="p">,</span>
    <span class="s2">载入</span><span class="p">,</span>
    <span class="s2">lobpcg</span><span class="p">,</span>
    <span class="s2">"手动播种"</span><span class="p">,</span>
    <span class="s2">矩阵乘法</span><span class="p">,</span>
    <span class="s2">"关闭梯度"</span><span class="p">,</span>
    <span class="s2">随机</span><span class="p">,</span>
    <span class="s2">"randn"</span><span class="p">,</span>
    <span class="s2">"save"</span><span class="p">,</span>
    <span class="s2">种子</span><span class="p">,</span>
    <span class="s2">"set_default_device"</span><span class="p">,</span>
    <span class="s2">"set_default_tensor_type"</span><span class="p">,</span>
    <span class="s2">设置确定性调试模式</span><span class="p">,</span>
    <span class="s2">设置 float32 矩阵乘法精度</span><span class="p">,</span>
    <span class="s2">设置打印选项</span><span class="p">,</span>
    <span class="s2">"设置随机数生成器状态"</span><span class="p">,</span>
    <span class="s2">设置总是警告</span><span class="p">,</span>
    <span class="s2">"拆分"</span><span class="p">,</span>
    <span class="s2">"堆栈"</span><span class="p">,</span>
    <span class="s2">"符号浮点"</span><span class="p">,</span>
    <span class="s2">"符号新鲜大小"</span><span class="p">,</span>
    <span class="s2">"对称整数"</span><span class="p">,</span>
    <span class="s2">"对称迭代"</span><span class="p">,</span>
    <span class="s2">"对称最大值"</span><span class="p">,</span>
    <span class="s2">"对称最小值"</span><span class="p">,</span>
    <span class="s2">"sym_not"</span><span class="p">,</span>
    <span class="s2">"sym_sum"</span><span class="p">,</span>
    <span class="s2">"typename"</span><span class="p">,</span>
    <span class="s2">"unravel_index"</span><span class="p">,</span>
    <span class="s2">使用确定性算法</span><span class="p">,</span>
    <span class="s2">vmap</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># 请保持此列表排序</span>
<span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全部</font></font></font></span> <span class="o">==</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">排序</span><span class="p">(</span><span class="n">__all__</span><span class="p">)</span>

<span class="c1">################################################################################</span>
<span class="c1"># 加载扩展模块</span>
<span class="c1">################################################################################</span>

<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">win32</span><span class="p">:</span>

    <span class="k">定义</font></font></font></span> <span class="nf">_load_dll_libraries</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="kn">导入</span> <span class="nn">sysconfig</span>

        <span class="kn">from</span> <span class="nn">torch 版本</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">cuda</span> <span class="k">as</span> <span class="n">cuda_version</span>

        <span class="n">程序文件路径</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取环境变量</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">程序文件</font></font></font></span><span class="p">,</span> <span class="sa">r</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">C:\程序文件</span><span class="p">)</span>
        <span class="n">py_dll_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n">exec_prefix</span><span class="p">,</span> <span class="s2">"Library"</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bin</span><span class="p">)</span>
        <span class="n">th_dll_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录名</font></font></font></span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</span><span class="p">)</span>
        <span class="n">使用基本路径</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</span><span class="p">(</span>
            <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s2">用户库</font></font></font></span><span class="p">),</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二进制文件</span>
        <span class="p">)</span>

        <span class="c1">当用户创建一个继承基本环境的虚拟环境时，</span>
        <span class="c1">我们需要将相应的库目录添加到</span>
        <span class="c1">DLL 搜索目录中。否则，它将依赖于`PATH`，</span>
        <span class="c1">这取决于用户设置。</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n">exec_prefix</span> <span class="o">!=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</span><span class="o">.</span><span class="n">base_exec_prefix</span><span class="p">:</span>
            <span class="n">base_py_dll_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n">base_exec_prefix</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">图书馆</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bin</span><span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">base_py_dll_path</span> <span class="o">=</span> <span class="s2">请提供需要翻译的文本</span>

        <span class="n">dll_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">p</span>
            <span class="k">对于</font></font></font></span> <span class="n">p</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="p">(</span><span class="n">th_dll_path</span><span class="p">,</span> <span class="n">py_dll_path</span><span class="p">,</span> <span class="n">base_py_dll_path</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用基本路径</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存在</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任何</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存在</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">nvToolsExt64_1.dll</font></font></font></span><span class="p">))</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对于</font></font></font></span> <span class="n">p</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="n">dll_paths</span>
        <span class="p">):</span>
            <span class="n">nvtoolsext_dll_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">获取环境变量</span><span class="p">(</span>
                    <span class="s2">"NVTOOLSEXT_PATH"</span><span class="p">,</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">文件路径</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">英伟达公司</span><span class="p">,</span> <span class="s2">"NvToolsExt"</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="s2">bin</span><span class="p">,</span>
                <span class="s2">"x64"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n">nvtoolsext_dll_path</span> <span class="o">=</span> <span class="s2">请提供需要翻译的文本</span>

        <span class="k">如果</font></font></font></span> <span class="n">cuda_version</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">所有</span><span class="p">(</span>
            <span class="ow">not</span> <span class="n">球</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cudart64*.dll</font></font></font></span><span class="p">))</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对于</font></font></font></span> <span class="n">p</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="n">dll_paths</span>
        <span class="p">):</span>
            <span class="n">cuda_version_1</span> <span class="o">=</span> <span class="n">cuda 版本</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替换</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“。”</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“下划线”</span><span class="p">)</span>
            <span class="n">cuda_path_var</span> <span class="o">=</span> <span class="s2">“CUDA_PATH_V”</span> <span class="o">+</span> <span class="n">cuda_version_1</span>
            <span class="n">默认路径</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</span><span class="p">(</span>
                <span class="n">文件路径</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"NVIDIA GPU 计算工具包"</font></font></font></span><span class="p">,</span> <span class="s2">"CUDA"</span><span class="p">,</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"v"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda 版本</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
            <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda_path
CUDA 路径</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取环境变量</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda 路径变量</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">默认路径</font></font></font></span><span class="p">),</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bin</span><span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda_path
CUDA 路径</font></font></font></span> <span class="o">=</span> <span class="s2">请提供需要翻译的文本</span>

        <span class="n">dll_paths</span><span class="o">.</span><span class="n">扩展</span><span class="p">(</span>
            <span class="n">p</span> <span class="k">对于</font></font></font></span> <span class="n">p</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">nvtoolsext_dll 路径</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda 路径</font></font></font></span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存在</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">核心库 32</font></font></font></span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinDLL</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">kernel32.dll</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用最后错误</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">使用加载库标志</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n">kernel32</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加 DLL 目录</span><span class="p">)</span>
        <span class="n">前错误模式</font></font></font></span> <span class="o">=</span> <span class="n">kernel32</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置错误模式</font></font></font></span><span class="p">(</span><span class="mh"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">1</span><span class="p">)</span>

        <span class="n">kernel32</span><span class="o">.</span><span class="n">LoadLibraryW</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
        <span class="k">如果</span> <span class="n">with_load_library_flags</span><span class="p">:</span>
            <span class="n">kernel32</span><span class="o">.</span><span class="n">LoadLibraryExW</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>

        <span class="k">对于</font></font></font></span> <span class="n">dll_path</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="n">dll_paths</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">添加 DLL 目录</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">DLL 路径</span><span class="p">)</span>

        <span class="k">尝试</span><span class="p">:</span>
            <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">vcruntime140.dll</span><span class="p">)</span>
            <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">msvcp140.dll</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">机器</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">ARM64</span><span class="p">:</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">vcruntime140_1.dll</span><span class="p">)</span>
        <span class="k">除了</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="nb">打印</span><span class="p">(</span>
                <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
<span class="w">                    </span><span class="sd">""</span>
<span class="sd">微软 Visual C++ redistributable 未安装，这可能导致 DLL 加载失败。</span>
<span class="sd">它可以从 https://aka.ms/vs/16/release/vc_redist.x64.exe 下载</span>
<span class="sd">                    """</span>
                <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">动态链接库</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</span><span class="p">(</span><span class="n">th_dll_path</span><span class="p">,</span> <span class="s2">"*.dll"</span><span class="p">))</span>
        <span class="n">path_patched</span> <span class="o">=</span> <span class="kc">假</span>
        <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态链接库</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态链接库</span><span class="p">:</span>
            <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">假</span>
            <span class="k">如果</span> <span class="n">with_load_library_flags</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">kernel32</span><span class="o">.</span><span class="n">LoadLibraryExW</span><span class="p">(</span><span class="n">动态链接库</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="mh"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">4352</span><span class="p">)</span>
                <span class="n">最后错误</font></font></font></span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取最后错误</span><span class="p">()</span>
                <span class="k">如果</font></font></font></span> <span class="n">res</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最后错误</span> <span class="o">!=</span> <span class="mi">126</span><span class="p">:</span>
                    <span class="n">错误</font></font></font></span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Win 错误</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最后错误</span><span class="p">)</span>
                    <span class="n">错误</span><span class="o">.</span><span class="n">strerror</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'错误加载 "'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态链接库</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'或其依赖项之一。'</span>
                    <span class="p">)</span>
                    <span class="k">抛出</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span>
                <span class="k">elif</span> <span class="n">res</span> <span class="ow">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="n">is_loaded</span> <span class="o">=</span> <span class="kc">真实</span>
            <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">已加载</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径已修复</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">环境</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">环境变量 PATH</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分号</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">dll_paths</span> <span class="o">+</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">环境</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">环境变量 PATH</span><span class="p">]])</span>
                    <span class="n">path_patched</span> <span class="o">=</span> <span class="kc">真实</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">kernel32</span><span class="o">.</span><span class="n">LoadLibraryW</span><span class="p">(</span><span class="n">动态链接库</span><span class="p">)</span>
                <span class="k">如果</font></font></font></span> <span class="n">res</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                    <span class="n">错误</font></font></font></span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Win 错误</font></font></font></span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取最后错误</span><span class="p">())</span>
                    <span class="n">错误</span><span class="o">.</span><span class="n">strerror</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'错误加载 "'</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态链接库</font></font></font></span><span class="si">}</span><span class="s1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'或其依赖项之一。'</span>
                    <span class="p">)</span>
                    <span class="k">抛出</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span>

        <span class="n">kernel32</span><span class="o">.</span><span class="n">设置错误模式</span><span class="p">(</span><span class="n">prev_error_mode</span><span class="p">)</span>

    <span class="n">_load_dll_libraries</span><span class="p">()</span>
    <span class="k">删除</span> <span class="n">_load_dll_libraries</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取 CUDA 依赖路径</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</font></font></font></span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="c1"># 库可以位于 path/nvidia/lib_folder/lib 或 path/lib_folder/lib</span>
    <span class="n">nvidia 库路径</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">英伟达</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">库路径</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">球</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</span><span class="p">))</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">nvidia 库路径</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库路径</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预加载 CUDA 依赖</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</font></font></font></span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
<span class="w">    </span><span class="sd">预加载 CUDA 依赖，如果否则找不到的话。</span>
    <span class="c1">只有在默认路径解析失败的情况下才应在 Linux 上调用。</span>
    <span class="k">断言</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="s2">"Linux"</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"仅在 Linux 上调用"</span>

    <span class="n">库路径</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</span>
    <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</span><span class="p">:</span>
        <span class="n">候选库路径</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取 CUDA 依赖路径</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">候选库路径</span><span class="p">:</span>
            <span class="n">库路径</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">候选库路径</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">断开</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库路径</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">在系统路径中未找到</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">库路径</span><span class="p">)</span>


<span class="c1"># 参见全局依赖项说明</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载全局依赖</font></font></font></span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_运行时使用部署</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Windows</span><span class="p">:</span>
        <span class="k">返回</span>

    <span class="c1"># 根据平台确定文件扩展名</span>
    <span class="n">lib_ext</span> <span class="o">=</span> <span class="s2">".dylib"</span> <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">达尔文</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">否则</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.so</span>
    <span class="n">库名</font></font></font></span> <span class="o">=</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libtorch 全局依赖</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库扩展</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">这里</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">绝对路径</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">全局依赖库路径</font></font></font></span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">这里</font></font></font></span><span class="p">),</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</span><span class="p">)</span>

    <span class="k">尝试</span><span class="p">:</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">全局依赖库路径</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>
        <span class="c1">解决 cusparse 和 cudnn 中 slim-wheel CUDA 依赖性错误，通过预加载 nvjitlink</span>
        <span class="c1"># 和 nvrtc。在 CUDA-12.4+ 中，cusparse 依赖于 nvjitlink，但没有 rpath 时</span>
        <span class="c1">作为轮子发货，导致操作系统选择了错误的/较旧的 nvjitlink 库版本</span>
        <span class="c1">如果已定义 `LD_LIBRARY_PATH`，请参阅 https://github.com/pytorch/pytorch/issues/138460</span>
        <span class="c1">在 cudnn 中存在类似问题，动态加载 nvrtc 时，不了解其相对路径。</span>
        <span class="c1">请参阅 https://github.com/pytorch/pytorch/issues/145580</span>
        <span class="k">尝试</span><span class="p">:</span>
            <span class="k">替换为</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">打开</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">/proc/self/maps</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">地图</font></font></font></span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">阅读</span><span class="p">()</span>
            <span class="c1"># libtorch_global_deps.so 总是依赖于 cudart，检查是否通过 wheel 安装</span>
            <span class="k">如果</font></font></font></span> <span class="s2">"nvidia/cuda_runtime/lib/libcudart.so"</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_地图</span><span class="p">:</span>
                <span class="k">返回</span>
            <span class="c1"># 如果满足上述所有条件，则预加载 nvrtc 和 nvjitlink</span>
            <span class="c1"># 请注意，对于 CUDA-11.8，顺序很重要，因为其中不存在 nvjitlink</span>
            <span class="n">预加载 CUDA 依赖</span><span class="p">(</span><span class="s2">"cuda_nvrtc"</span><span class="p">,</span> <span class="s2">"libnvrtc.so.*[0-9]"</span><span class="p">)</span>
            <span class="n">预加载 CUDA 依赖</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">nvjitlink</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libnvJitLink.so.*[0-9]</span><span class="p">)</span>
        <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</span><span class="p">:</span>
            <span class="k">通过</span>

    <span class="k">除了</font></font></font></span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
        <span class="c1"># 只会发生在带有 cuda 库作为 PYPI 依赖的轮子上</span>
        <span class="c1"># 因为 PyTorch 不是纯库，而是 nvidia-*-cu12</span>
        <span class="kn">from</span> <span class="nn">torch 版本</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">cuda</span> <span class="k">as</span> <span class="n">cuda_version</span>

        <span class="n">cuda_libs</span><span class="p">:</span> <span class="nb">字典</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">cublas</font></font></font></span><span class="p">:</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libcublas.so.*[0-9]</span><span class="p">,</span>
            <span class="s2">cudnn</font></font></font></span><span class="p">:</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libcudnn.so.*[0-9]</span><span class="p">,</span>
            <span class="s2">"cuda_nvrtc"</span><span class="p">:</span> <span class="s2">"libnvrtc.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"cuda_runtime"</span><span class="p">:</span> <span class="s2">"libcudart.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"cuda_cupti"</span><span class="p">:</span> <span class="s2">"libcupti.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"cufft"</span><span class="p">:</span> <span class="s2">"libcufft.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"curand"</span><span class="p">:</span> <span class="s2">"libcurand.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">nvjitlink</font></font></font></span><span class="p">:</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libnvJitLink.so.*[0-9]</span><span class="p">,</span>
            <span class="s2">"cusparse"</span><span class="p">:</span> <span class="s2">"libcusparse.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"cusparselt"</span><span class="p">:</span> <span class="s2">"libcusparseLt.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"cusolver"</span><span class="p">:</span> <span class="s2">"libcusparse.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"nccl"</span><span class="p">:</span> <span class="s2">"libnccl.so.*[0-9]"</span><span class="p">,</span>
            <span class="s2">"nvtx"</span><span class="p">:</span> <span class="s2">"libnvToolsExt.so.*[0-9]"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># cufiile 仅在 cuda 12+ 上可用</span>
        <span class="c1"># TODO: 一旦 CUDA 11.8 二进制文件被弃用，请删除</span>
        <span class="k">如果</font></font></font></span> <span class="n">cuda_version</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">版本号</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuda 版本</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“。”</span><span class="p">)</span>
            <span class="n">主版本</font></font></font></span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">版本号</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># type: ignore[operator]</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">主翻译</font></font></font></span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">cuda_libs</span><span class="p">[</span><span class="s2">cufile</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">libcufile.so.*[0-9]</span>

        <span class="n">是否为 CUDA 库错误</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">库</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n">cuda_libs</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">值</font></font></font></span><span class="p">()</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分割</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“。”</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</font></font></font></span><span class="mi">0</span><span class="p">]</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="k">如果</span> <span class="ow">not</span> <span class="n">is_cuda_lib_err</span><span class="p">:</span>
            <span class="k">抛出</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span>
        <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n">cuda_libs</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="n">预加载 CUDA 依赖</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库文件夹</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库名</span><span class="p">)</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="n">全局依赖库路径</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>


<span class="k">如果</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用 libtorch 全局 RTLD</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取环境变量</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬使用全局 RTLD</font></font></font></span><span class="p">))</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</span> <span class="p">(</span>
    <span class="n">_运行时使用部署</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</font></font></font></span><span class="p">()</span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Windows</span>
<span class="p">):</span>
    <span class="c1">用笨方法来做。你可能想用 RTLD_GLOBAL 加载 libtorch。</span>
    <span class="c1"># 很少情况下：</span>
    <span class="c1">#</span>
    <span class="c1">你在一个构建环境（例如，fbcode）中</span>
    <span class="c1">但是 libtorch_global_deps 不可用，你仍然需要</span>
    <span class="c1">将 mkl 链接到 RTLD_GLOBAL，否则它将无法工作。</span>
    <span class="c1">。</span>
    <span class="c1">#</span>
    <span class="c1">在尝试在 UBSAN 下运行 PyTorch 时，你需要确保只加载一个 libtorch 副本，以便 vptr 检查能够正常工作</span>
    <span class="c1">如果你使用此设置，你必须验证所有库</span>
    <span class="c1">都已正确加载</span>
    <span class="c1">#</span>
    <span class="c1">如果您使用此设置，您必须验证所有库</span>
    <span class="c1"># 你始终如一地使用相同的 libstdc++，或者你可能会有</span>
    <span class="c1"># 神秘的段错误。</span>
    <span class="c1">#</span>
    <span class="n">旧旗帜</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</span><span class="o">.</span><span class="n">getdlopenflags</span><span class="p">()</span>
    <span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置动态链接库标志</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">RTLD_LAZY</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">torch._C</span> <span class="kn">导入</span> <span class="o">*</span>  <span class="c1"># noqa: F403</span>

    <span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置动态链接库标志</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧旗帜</span><span class="p">)</span>
    <span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">旧旗帜</span>

<span class="k">否则</span><span class="p">:</span>
    <span class="c1"># 简单方法。你大多数时候都想要这样做，因为它将防止</span>
    <span class="c1">C++从 libtorch 中覆盖了来自其他库的 C++符号</span>
    <span class="c1"># 库，导致神秘的段错误。</span>
    <span class="c1">#</span>
    <span class="c1">如果在一个没有 libtorch_global_deps 可用的环境中构建</span>
    <span class="c1"># 类似于 fbsource 的部分，但 RTLD_GLOBAL 导致段错误时，您将</span>
    <span class="c1"># want USE_RTLD_GLOBAL_WITH_LIBTORCH = False and USE_GLOBAL_DEPS = False</span>
    <span class="c1">#</span>
    <span class="c1"># 参见全局依赖项说明</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用全局依赖项</span><span class="p">:</span>
        <span class="n">加载全局依赖</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">torch._C</span> <span class="kn">导入</span> <span class="o">*</span>  <span class="c1"># noqa: F403</span>


<div class="viewcode-block" id="SymInt"><a class="viewcode-back" href="../torch.html#torch.SymInt">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</span> <span class="nc">SymInt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">像一个 int（包括魔术方法），但将所有操作重定向到</span>
<span class="sd">包装的节点。这特别用于符号记录操作</span>
<span class="sd">在符号形状工作流程中。</span>
<span class="sd">    """</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__init__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="p">):</span>
        <span class="c1"># 此字段必须命名为节点；C++ 绑定代码假定此</span>
        <span class="c1">类有一个名为 node 的字段，用于存储 SymNode</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="bp">self</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__int__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__索引__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">()</span>

    <span class="c1">torch.fx.experimental.sym_node 安装的魔法方法</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__round__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>
        <span class="k">返回</span> <span class="bp">self</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n">__float_truediv__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实除法</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">反真实除法</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n">__rfloat_truediv__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__rint_truediv__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向下取整</font></font></font></span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span> <span class="o">/</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">))</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__int_floordiv__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向下取整</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span> <span class="o">/</span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">)))</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__rint_floordiv__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="c1"># nb: 复杂的无法正确处理，哈哈，太困难了</span>
    <span class="c1"># 负底数和积分浮点需要区分语义，</span>
    <span class="c1"># 总是返回复数。哈哈，假装这个问题</span>
    <span class="c1"># 不存在</span>
    <span class="k">定义</font></font></font></span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="c1"># 守卫！这个守卫是必要的，因为我们需要知道它</span>
        <span class="c1"># 以确定这个操作的输出类型</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__pow_by_natural__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="c1">幸运的是，当指数为负数时，Python 会将其提升为双精度浮点数，然后执行 float pow:</span>
            <span class="c1"># to doubles and does a float pow:</span>
            <span class="c1">#</span>
            <span class="c1">#   如果 (Py_SIZE(b) &lt; 0 且 c 为 NULL) {</span>
            <span class="c1">#       /* 如果指数为负且没有模数：</span>
            <span class="c1">#              返回一个浮点数。这之所以可行，是因为我们知道</span>
            <span class="c1">#              这将调用 float_pow()，它将转换其</span>
            <span class="c1">#              双重参数传递。*/</span>
            <span class="c1">#       Py_DECREF(a);</span>
            <span class="c1">#       Py_DECREF(b);</span>
            <span class="c1">#       return PyFloat_Type.tp_as_number-&gt;nb_power(v, w, x);</span>
            <span class="c1">#   }</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">如果</font></font></font></span> <span class="bp">self</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</font></font></font></span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 自身为指数</span>
            <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__rpow_by_natural__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="fm">__rpow__</span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__等于__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__le__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__add__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">矢量乘</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">:</span> <span class="s2">"IntLikeType"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__pow_by_natural__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__rpow_by_natural__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">真实除法</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__rint_truediv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__int_floordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__rint_floordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_max__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_min__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_float__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">:</span> <span class="s2">"IntLikeType"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">:</span> <span class="s2">"IntLikeType"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__and__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__or__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="o">.</span><span class="n">_graph_repr</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="nf">_sympy_</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">表达式</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__哈希__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否嵌套整型</span><span class="p">():</span>
            <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">哈希</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌套整型</span><span class="p">())</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="c1"># 我们可以支持常量 SymInts，但现在不这么做</span>
            <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"不可哈希的类型：非嵌套的 SymInt"</span><span class="p">)</span>
            <span class="c1"># TODO: 强制特化</span>
            <span class="c1">因为这里的 TypeError 是承载性的，所以无法完成</span>
            <span class="c1">用于 einops</span>
            <span class="c1">https://github.com/arogozhnikov/einops/blob/6181e1e95dc58c00a3143c1726da1c6ee0463164/einops/einops.py#L237</span>
            <span class="c1">返回 hash(builtins.int(self))</span>

<div class="viewcode-block" id="SymInt.as_integer_ratio"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def as_integer_ratio(self) -&gt; tuple["SymInt", builtins.int]:
"""将此整数表示为精确的整数比"""
return self, 1</font></font></font></div>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">比特长度</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>
        <span class="c1"># TODO: 这里可以采用更宽松的保护措施，其中保护到</span>
        <span class="c1"># 允许所有导致相同位数的整数数量</span>
        <span class="c1"># 长度。我们还可以专门为 Sympy 创建一个函数</span>
        <span class="c1">计算这个量并用符号表示。</span>
        <span class="k">返回</font></font></font></span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">比特长度</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动词变位</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号整数"</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span></div>


<div class="viewcode-block" id="SymFloat"><a class="viewcode-back" href="../torch.html#torch.SymFloat">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</span> <span class="nc">SymFloat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">类似于浮点数（包括魔术方法），但将所有操作重定向到</span>
<span class="sd">包装的节点。这特别用于符号记录操作</span>
<span class="sd">在符号形状工作流程中。</span>
<span class="sd">    """</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__init__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="p">):</span>
        <span class="c1"># 此字段必须命名为节点；C++ 绑定代码假定此</span>
        <span class="c1">类有一个名为 node 的字段，用于存储 SymNode</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__float_truediv__</span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">反真实除法</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__rfloat_truediv__</span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向下取整</font></font></font></span><span class="p">(</span><span class="bp">self</span> <span class="o">/</span> <span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)))</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="k">返回</font></font></font></span> <span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">向下取整</font></font></font></span><span class="p">(</span><span class="n">sym_float</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">/</span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔_</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">守护浮点</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">符号幂不适用于负底数，这是为了避免</span>
    <span class="c1">可能的复杂输出</span>
    <span class="k">定义</font></font></font></span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="n">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_检查</font></font></font></span><span class="p">(</span><span class="bp">self</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__float_pow__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">,</span> <span class="n">SymFloat</span><span class="p">)):</span>
            <span class="k">返回</span> <span class="bp">NotImplemented</span>
        <span class="n">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_检查</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">__rfloat_pow__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span>

    <span class="c1">torch.fx.experimental.sym_node 安装的魔法方法</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__等于__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__le__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__float_pow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__rfloat_pow__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__float_truediv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__rfloat_truediv__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"SymFloat"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">截断</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_max__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_min__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_int__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

<div class="viewcode-block" id="SymFloat.is_integer"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def 是整数(self):
"""返回 True 如果浮点数是整数。"""
raise TypeError("类型存根未覆盖")</font></font></font></div>

<div class="viewcode-block" id="SymFloat.as_integer_ratio"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] def as_integer_ratio(self) -&gt; tuple[builtins.int, builtins.int]:
将此浮点数表示为精确的整数比
return builtins.float(self).as_integer_ratio()</font></font></font></div>

    <span class="k">定义</font></font></font></span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="o">.</span><span class="n">_graph_repr</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="nf">_sympy_</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">表达式</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__哈希__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">哈希</font></font></font></span><span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">))</span>

<div class="viewcode-block" id="SymFloat.conjugate"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def conjugate(self) -&gt; "SymFloat": 
翻译：[文档]    def conjugate(self) -&gt; "对称浮点数":
返回浮点数的复共轭。
返回 self</font></font></font></div>

<div class="viewcode-block" id="SymFloat.hex"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]    def hex(self) -&gt; str:
返回浮点数的十六进制表示。
返回 self.node.guard_float("", 0).hex()</font></font></font></div></div>


<div class="viewcode-block" id="SymBool"><a class="viewcode-back" href="../torch.html#torch.SymBool">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</font></font></font></span> <span class="nc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号布尔值</span><span class="p">:</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">就像布尔值（包括魔术方法），但将所有操作重定向到</span>
<span class="sd">包装的节点。这特别用于符号记录操作</span>
<span class="sd">在符号形状工作流程中。</span>

<span class="sd">与常规布尔值不同，常规布尔运算符将强制执行额外的守卫</span>
<span class="sd">使用位运算符来处理此问题。</span>
<span class="sd">    """</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__init__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="p">):</span>
        <span class="c1"># 此字段必须命名为节点；C++ 绑定代码假定此</span>
        <span class="c1">类有一个名为 node 的字段，用于存储 SymNode</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔_</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__int__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔_</span><span class="p">())</span>

    <span class="c1">torch.fx.experimental.sym_node 安装的魔法方法</span>
    <span class="k">定义</font></font></font></span> <span class="fm">__and__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号布尔"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__or__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号布尔"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="c1">我们非常谨慎地定义 __sym_not__，而不是其他许多</span>
    <span class="c1">可能的替代方案：</span>
    <span class="c1">#</span>
    <span class="c1">- 我们不重载 __not__，因为这并不是真正的魔法</span>
    <span class="c1">方法；你不能覆盖非内置方法的含义</span>
    <span class="c1">Python。我们使用名称'sym_not'来明确指出，在用户代码中不能使用内置的 not 或 operator.not_或 operator.__not__，否则会触发这个魔法方法；你必须使用我们自定义的 sym_not 运算符。</span>
    <span class="c1">我们没有重写__invert__方法，因为 SymBool 是</span>
    <span class="c1">我们必须使用我们自定义的 sym_not 运算符。</span>
    <span class="c1">#</span>
    <span class="c1">我们没有重写__invert__方法，因为 SymBool 是</span>
    <span class="c1">#     在期望布尔值的情况下，可以使用。然而，</span>
    <span class="c1">#     按位非~a 对布尔值做错了事（因为</span>
    <span class="c1">#     bool 是 int 的子类，所以~1 = -2，这不是假的。）</span>
    <span class="c1">#     这将是一个巨大的陷阱，所以我们通过定义</span>
    <span class="c1">我们自己的操作符。注意，位与或操作符的行为正确，</span>
    <span class="c1">因此我们在这里重用传统的操作符以提高可读性。</span>
    <span class="c1">#</span>
    <span class="k">定义</font></font></font></span> <span class="nf">__sym_not__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"符号布尔"</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf">__sym_ite__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">,</span> <span class="n">then_val</span><span class="p">,</span> <span class="n">else_val</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__等于__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"类型存根未覆盖"</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</span><span class="o">.</span><span class="n">_graph_repr</span><span class="p">()</span>

    <span class="k">定义</font></font></font></span> <span class="nf">_sympy_</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">表达式</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__哈希__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否为常量</span><span class="p">():</span>
            <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">哈希</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">节点</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔_</span><span class="p">())</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="c1">强制特化</span>
            <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">哈希</font></font></font></span><span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">))</span></div>


<div class="viewcode-block" id="sym_not"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_not(a):
r"""SymInt 感知的逻辑否定工具。

Args:
a (SymBool 或 bool): 要取反的对象
"""
导入 sympy

如果 overrides.has_torch_function_unary(a):
返回 overrides.handle_torch_function(sym_not, (a,), a)
if hasattr(a, "__sym_not__"):
return a.__sym_not__()
if isinstance(a, sympy.Basic):
return ~a  # type: ignore[operator]
返回非 a</font></font></font></div>


<div class="viewcode-block" id="sym_float"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_float(a):
r"""SymInt 感知的浮点转换实用工具。

参数：
一个（SymInt、SymFloat 或对象）：要转换的对象
"""
如果 overrides.has_torch_function_unary(a):
返回 overrides.handle_torch_function(sym_float, (a,), a)
如果 isinstance(a, SymFloat):
返回 a
elif hasattr(a, "__sym_float__"):
返回 a.__sym_float__()
返回 builtins.float(a)  # type: ignore[operator]</font></font></font></div>


<div class="viewcode-block" id="sym_int"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_int(a):
r"""SymInt 感知的整型转换实用工具。

Args:
a (SymInt, SymFloat 或对象): 要转换的对象
"""
如果 overrides 具有针对 a 的 torch 函数
返回 overrides 处理 torch 函数的结果 (sym_int, (a,), a)
如果 a 是 SymInt 类型
返回一个
如果 a 是 SymFloat 类型：
返回 math.trunc(a)的整数部分
返回 builtins.int(a)（忽略操作符错误）  # type: ignore[operator]</font></font></font></div>


<div class="viewcode-block" id="sym_max"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_max(a, b):
"""
SymInt 感知的 max 实用工具，避免在 a &lt; b 时分支。
与内置的 max()不同，此函数仅适用于 int/float，并且始终
如果任何参数是浮点数，则将其提升为浮点数（与内置的 max 函数不同，后者
会忠实地保留输入参数的类型）。
"""
如果 overrides.has_torch_function((a, b)):
return overrides.handle_torch_function(sym_max, (a, b), a, b)
if isinstance(a, (SymInt, SymFloat)):
return a.__sym_max__(b)
elif isinstance(b, (SymInt, SymFloat)):
由于促销语义，此运算符是交换律的：
max(1, 1.0) === max(1.0, 1) === 1.0
return b.__sym_max__(a)
# TODO: 可能也可以让 bool 工作，只是懒惰

all_types, float_types = __all_and_float_types__()

assert isinstance(a, all_types), type(a)
assert isinstance(b, all_types), type(b)
if isinstance(a, float_types) or isinstance(b, float_types):
return builtins.float(builtins.max(a, b))  # 忽略[调用重载]
else:
return builtins.max(a, b)  # 忽略[调用重载]</font></font></font></div>


<span class="k">定义</font></font></font></span> <span class="nf">__all_and_float_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]]</span>
    <span class="k">尝试</span><span class="p">:</span>
        <span class="kn">导入</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

        <span class="n">所有类型</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">numpy</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">整数</span><span class="p">,</span>
            <span class="n">numpy</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点</span><span class="p">,</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">浮点类型</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">numpy</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块未找到错误</span><span class="p">:</span>
        <span class="n">所有类型</span> <span class="o">=</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">浮点类型</span> <span class="o">=</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">,)</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">所有类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">浮点类型</span>


<div class="viewcode-block" id="sym_min"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_min(a, b):
"""SymInt 感知的 min()实用工具。"""
if overrides.has_torch_function((a, b)):
return overrides.handle_torch_function(sym_min, (a, b), a, b)
如果 a 是(SymInt, SymFloat)类型：
返回 a.__sym_min__(b)
elif b 是(SymInt, SymFloat)类型：
返回 b.__sym_min__(a)

all_types, float_types = __all_and_float_types__()

assert isinstance(a, all_types), type(a)
assert isinstance(b, all_types), type(b)
if isinstance(a, float_types) or isinstance(b, float_types):
return builtins.float(builtins.min(a, b))  # 忽略[调用重载]
else:
return builtins.min(a, b)  # 忽略[调用重载]</font></font></font></div>


<div class="viewcode-block" id="sym_sum"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_sum(args):
""
多元加法，对于长列表来说比迭代二进制加法计算更快。
仅对整数执行特殊操作。
""
if overrides.has_torch_function(args):
return overrides.handle_torch_function(sym_sum, args, args)

found = None
for a in args:
如果不是 isinstance(a, (SymInt, builtins.int)) 类型：
返回 builtins.sum(args)
如果 isinstance(a, SymInt) 类型：
found = a.node
如果找到为 None：
返回内置函数 sum(args)

从 torch.fx.experimental.sym_node 导入 to_node, wrap_node

返回 wrap_node(found.sym_sum(tuple(to_node(found, a) for a in args)))</font></font></font></div>


<span class="c1">math.sqrt、math.sin、math.cos 等函数的替换</span>
<span class="k">定义</font></font></font></span> <span class="nf">_get_sym_math_fn</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">):</span>
    <span class="k">定义</span> <span class="nf">fn</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">覆盖</span><span class="o">.</span><span class="n">has_torch_function_unary</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">覆盖</span><span class="o">.</span><span class="n">handle_torch_function</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">如果</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">SymInt</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">PyTorch</span><span class="o">.</span><span class="n">sym_float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"__sym_"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__</span><span class="p">):</span>
            <span class="k">返回</font></font></font></span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"__sym_"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__</span><span class="p">)()</span>
        <span class="k">返回</font></font></font></span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数学</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">返回</span> <span class="n">fn</span>


<span class="n">函数名</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__sym_name__</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">请提供需要翻译的文本</span>
<span class="k">对于</font></font></font></span> <span class="n">__name</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="p">(</span>
    <span class="s2">平方根</span><span class="p">,</span>
    <span class="s2">余弦</span><span class="p">,</span>
    <span class="s2">余弦</span><span class="p">,</span>
    <span class="s2">正弦</span><span class="p">,</span>
    <span class="s2">双曲正弦</span><span class="p">,</span>
    <span class="s2">正切</span><span class="p">,</span>
    <span class="s2">双曲正切</span><span class="p">,</span>
    <span class="s2">反正弦</span><span class="p">,</span>
    <span class="s2">反余弦</span><span class="p">,</span>
    <span class="s2">反正切</span><span class="p">,</span>
    <span class="s2">"以 2 为底的对数"</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">__sym_name__</font></font></font></span> <span class="o">=</span> <span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_sym_"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">__fn</span> <span class="o">=</span> <span class="n">_get_sym_math_fn</span><span class="p">(</span><span class="n">名称</span><span class="p">)</span>
    <span class="n">函数名</font></font></font></span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数名</font></font></font></span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__sym_name__</span>
    <span class="nb">全局变量</font></font></font></span><span class="p">()[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号名</span><span class="p">]</span> <span class="o">=</span> <span class="n">__fn</span>


<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数名</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号名</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取符号数学函数</span>

<span class="c1">添加临时快捷方式</span>
<span class="n">sym_sqrt</span> <span class="o">=</span> <span class="nb">全局变量</font></font></font></span><span class="p">()[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_sym_sqrt</span><span class="p">]</span>
<span class="n">__all__</span><span class="o">.</span><span class="n">添加</span><span class="p">(</span><span class="s2">"sym_sqrt"</span><span class="p">)</span>


<div class="viewcode-block" id="sym_ite"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_ite(b, t, f):
if overrides.has_torch_function((b, t, f)):
return overrides.handle_torch_function(sym_ite, (b, t, f), b, t, f)
assert isinstance(b, (SymBool, builtins.bool)) and type(t) == type(f)
if isinstance(b, SymBool):
return b.__sym_ite__(t, f)
return t if b else f</font></font></font></div>


<span class="c1">从一个（可能未包装的整数）表达式创建一个全新的未包装整数。</span>
<div class="viewcode-block" id="sym_fresh_size"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def sym_fresh_size(expr):
return torch.tensor(expr).item()</font></font></font></div>


<span class="c1">检查是否可以加载 C 扩展，如果不能，请提供一些可能问题的指导。</span>
<span class="c1">关于问题的可能原因。</span>
<span class="k">尝试</span><span class="p">:</span>
    <span class="c1">（任意选择）_initExtension 作为哨兵。</span>
    <span class="kn">from</span> <span class="nn">torch._C</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">初始化扩展</span>
<span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入错误</span><span class="p">:</span>
    <span class="kn">导入</span> <span class="nn">torch._C</span> <span class="k">as</span> <span class="nn">_C_for_compiled_check</span>

    <span class="c1">仅 Python 3.7 及以上版本中的__file__检查才有效。</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译检查的_C_函数</font></font></font></span><span class="o">.</span><span class="vm">__file__</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入错误</span><span class="p">(</span>
            <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
<span class="w">                </span><span class="sd">""</span>
<span class="sd">加载 PyTorch C 扩展失败：</span>
<span class="sd">看起来 PyTorch 已加载了`torch/_C`文件夹</span>
<span class="sd">而不是预期在`torch._C`命名空间中的 C 扩展</span>
<span class="sd">这在使用`install`工作流程时可能发生</span>
<span class="sd">例如</span>
<span class="sd">                        $ python setup.py install &amp;&amp; python -c "import torch"</span>

<span class="sd">这个错误通常可以通过使用 `develop` 工作流程来解决</span>
<span class="sd">$ python setup.py develop &amp;&amp; python -c "import torch"  # 这应该会成功</span>
<span class="sd">或者通过从不同的目录运行 Python 来解决</span>
<span class="sd">                """</span>
            <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="kc">无。</span>
    <span class="k">抛出</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果 __file__ 不为 None，原因未知，因此只需重新抛出。</span>

<span class="c1">torch._C 子模块已经通过 `from torch._C import *` 在上面加载。</span>
<span class="c1">为了满足代码检查工具，请显式引用 _C 子模块。</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">_C</span> <span class="k">as</span> <span class="n">_C</span>


<span class="n">名称</font></font></font></span><span class="p">,</span> <span class="n">__obj</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</span>
<span class="k">对于</font></font></font></span> <span class="n">__name</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录</span><span class="p">(</span><span class="n">_C</span><span class="p">):</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...结尾</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">基础</span><span class="p">):</span>
        <span class="n">__all__</span><span class="o">.</span><span class="n">添加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
        <span class="n">__obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_C</span><span class="p">,</span> <span class="n">名称</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">(</span><span class="n">__obj</span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否为类</span><span class="p">(</span><span class="n">__obj</span><span class="p">):</span>
            <span class="k">如果</span> <span class="n">__obj</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">!=</span> <span class="vm">__name__</span><span class="p">:</span>  <span class="c1"># "torch"</span>
                <span class="c1"># TODO: fix their module from C++ side</span>
                <span class="k">如果</font></font></font></span> <span class="n">__name</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="p">{</span>
                    <span class="s2">禁用 TorchFunction 子类</span><span class="p">,</span>
                    <span class="s2">禁用 TorchFunction</span><span class="p">,</span>
                    <span class="s2">生成器</span><span class="p">,</span>
                <span class="p">}:</span>
                    <span class="n">__obj</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="vm">__name__</span>  <span class="c1"># "torch"</span>
    <span class="k">elif</span> <span class="n">__name</span> <span class="o">==</span> <span class="s2">"TensorBase"</span><span class="p">:</span>
        <span class="c1"># issue 109438 / pr 109940. 防止 TensorBase 被复制到 torch。</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">[</span><span class="vm">__name__</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>

<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">,</span> <span class="n">__obj</span>

<span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="c1"># issue 38137 和 Python issue 43367。C 扩展的子模块</span>
    <span class="c1">非标准，并且这些子模块的属性无法被序列化</span>
    <span class="c1"># pickle 期望能够将它们导入为 "from _C.sub import attr"</span>
    <span class="c1"># 失败：_C 不是一个包</span>
    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入扩展到系统模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">描述</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">备忘录</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">备忘录</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置</span><span class="p">()</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">描述</span><span class="p">:</span>
            <span class="k">返回</span>
        <span class="n">描述</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">添加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span>
        <span class="n">模块名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
            <span class="n">成员</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
            <span class="n">成员名称</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"__名称__"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否为模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员名称</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...开头</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块名称</span><span class="p">):</span>
                <span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员名称</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员</span><span class="p">)</span>
                <span class="c1"># 递归处理子模块（例如，`_C._dynamo.eval_frame`）</span>
                <span class="n">导入扩展到系统模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">成员</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">描述</span><span class="p">)</span>

    <span class="n">导入扩展到系统模块</span><span class="p">(</span><span class="n">_C</span><span class="p">)</span>
    <span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_导入扩展到 sys_modules</span>

<span class="c1">################################################################################</span>
<span class="c1"># 定义基本工具</span>
<span class="c1">################################################################################</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型名</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">对象类型的字符串表示。</span>

<span class="sd">此函数返回对象类型的完全限定字符串表示。</span>
<span class="sd">参数：</span>
<span class="sd">obj（对象）：表示类型的对象</span>
<span class="sd">返回值：</span>
<span class="sd">str：对象 `o` 的类型</span>
<span class="sd">示例：</span>
<span class="sd">        &gt;&gt;&gt; x = torch.tensor([1, 2, 3])</span>
<span class="sd">        &gt;&gt;&gt; torch.typename(x)</span>
<span class="sd">        'torch.LongTensor'</span>
<span class="sd">        &gt;&gt;&gt; torch.typename(torch.nn.Parameter)</span>
<span class="sd">torch.nn.parameter.Parameter</span>
<span class="sd">    """</span>
    <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span><span class="p">()</span>

    <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="p">,</span> <span class="s2">"__module__"</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">请提供需要翻译的文本</span>
    <span class="n">qualname</span> <span class="o">=</span> <span class="s2">请提供需要翻译的文本</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</span><span class="p">,</span> <span class="s2">"__qualname__"</span><span class="p">):</span>
        <span class="n">qualname</span> <span class="o">=</span> <span class="n">对象</span><span class="o">.</span><span class="vm">__qualname__</span>
    <span class="k">elif</span> <span class="nb">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"__名称__"</span><span class="p">):</span>
        <span class="n">qualname</span> <span class="o">=</span> <span class="n">对象</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">否则</span><span class="p">:</span>
        <span class="n">模块</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对象</font></font></font></span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</font></font></font></span><span class="o">.</span><span class="vm">__module__</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">请提供需要翻译的文本</span>
        <span class="n">qualname</span> <span class="o">=</span> <span class="n">对象</font></font></font></span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类</span><span class="o">.</span><span class="vm">__qualname__</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="p">{</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">内建函数</span><span class="p">}:</span>
        <span class="k">返回</span> <span class="n">qualname</span>
    <span class="k">返回</font></font></font></span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">qualname</span><span class="si">}</span><span class="s2">"</span>


<div class="viewcode-block" id="is_tensor"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def is_tensor(obj: _Any, /) -&gt; _TypeIs["torch.Tensor"]:
r"""返回 True 如果 `obj` 是 PyTorch 张量。"""

注意这个函数只是简单地执行 `isinstance(obj, Tensor)`。
使用这个 `isinstance` 检查更适合与 mypy 进行类型检查，
并且更加明确 - 因此建议使用它而不是 `is_tensor`。
``。

Args:
obj (对象): 待测试的对象
示例::

&gt;&gt;&gt; x = torch.tensor([1, 2, 3])
&gt;&gt;&gt; torch.is_tensor(x)
True

"""
return isinstance(obj, torch.Tensor)</font></font></font></div>


<div class="viewcode-block" id="is_storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def is_storage(obj: _Any, /) -&gt; _TypeIs[_Union["TypedStorage", "UntypedStorage"]]:
r"""判断`obj`是否为 PyTorch 存储对象。

Args:
obj (对象): 要测试的对象
"``"
返回对象的类型是否在_storage_classes 中</font></font></font></div>


<span class="n">_全局设备上下文</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线程</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>


<div class="viewcode-block" id="get_default_device"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def get_default_device() -&gt; "torch.device":
r"""获取默认要在 ``device`` 上分配的 ``torch.Tensor``"""
global _GLOBAL_DEVICE_CONTEXT

如果 hasattr(_GLOBAL_DEVICE_CONTEXT, "device_context"):
device = _GLOBAL_DEVICE_CONTEXT.device_context.device
如果 device.index 不是 None:
返回 device
否则：
# TODO: 调用与 get_device_index() 方法对应的
每个设备类型
返回 torch.tensor([]).device
else:
返回 torch.device("cpu")</font></font></font></div>


<div class="viewcode-block" id="set_default_device"><a class="viewcode-back" href="../generated/torch.set_default_device.html#torch.set_default_device">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</span> <span class="nf">set_default_device</span><span class="p">(</span>
    <span class="n">设备</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch.device</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">无</span><span class="p">:</span>
<span class="w">    </span><span class="sd">设置默认的 ``torch.Tensor`` 在 ``device`` 上分配。</span>
<span class="sd">不影响使用显式调用的工厂函数调用</span>
<span class="sd">设备参数。工厂调用将像对待</span>
<span class="sd">将 ``device`` 作为参数传递。</span>

<span class="sd">只需临时更改默认设备，而不是全局设置，请使用 `with torch.device(device):`。</span>
<span class="sd">默认设备最初是 `cpu`。如果您要将默认张量设备设置为另一个设备（例如，`cuda`）而没有设备索引，张量</span>

<span class="sd">将默认张量设备设置为另一个设备（例如，`cuda`）而没有设备索引，张量</span>
<span class="sd">将默认张量设备设置为另一个设备（例如，`cuda`）而没有设备索引，张量</span>
<span class="sd">将分配给当前设备上的设备类型</span>
<span class="sd">即使在调用 :func:`torch.cuda.set_device` 之后</span>

<span class="sd">..警告：</span>

<span class="sd">此函数会对每个 Python 调用产生轻微的性能开销</span>
<span class="sd">调用 torch API（不仅仅是工厂函数）。如果这</span>
<span class="sd">造成了您的问题，请评论</span>
<span class="sd">        https://github.com/pytorch/pytorch/issues/92701</span>

<span class="sd">.. 注意：</span>

<span class="sd">这不会影响创建与输入共享相同内存的张量的函数，例如：</span>
<span class="sd">`torch.from_numpy` 和 `torch.frombuffer`</span>

<span class="sd">参数：</span>
<span class="sd">device (设备或字符串): 设置为默认的设备</span>

<span class="sd">示例::</span>

<span class="sd">&gt;&gt;&gt; # xdoctest: +SKIP("需要 cuda，改变全局状态")</span>
<span class="sd">        &gt;&gt;&gt; torch.get_default_device()</span>
<span class="sd">        device(type='cpu')</span>
<span class="sd">&gt;&gt;&gt; torch.set_default_device('cuda')  # 当前设备是 0</span>
<span class="sd">        &gt;&gt;&gt; torch.get_default_device()</span>
<span class="sd">        device(type='cuda', index=0)</span>
<span class="sd">        &gt;&gt;&gt; torch.set_default_device('cuda')</span>
<span class="sd">&gt;&gt;&gt; torch.cuda.set_device('cuda:1')  # 当前设备为 1</span>
<span class="sd">        &gt;&gt;&gt; torch.get_default_device()</span>
<span class="sd">        device(type='cuda', index=1)</span>
<span class="sd">        &gt;&gt;&gt; torch.set_default_device('cuda:1')</span>
<span class="sd">        &gt;&gt;&gt; torch.get_default_device()</span>
<span class="sd">        device(type='cuda', index=1)</span>

<span class="sd">    """</span>
    <span class="k">全局</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_全局设备上下文</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局设备上下文</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</span><span class="p">):</span>
        <span class="n">设备上下文</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全局设备上下文</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="n">设备上下文</font></font></font></span><span class="o">.</span><span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__退出__</font></font></font></span><span class="p">(</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">设备上下文</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</span>
    <span class="k">否则</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">torch.utils._device</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</span>

        <span class="n">设备上下文</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</span><span class="p">)</span>
        <span class="n">设备上下文</font></font></font></span><span class="o">.</span><span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__进入__</span><span class="p">()</span>
    <span class="n">全局设备上下文</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备上下文</span></div>


<div class="viewcode-block" id="set_default_tensor_type"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def set_default_tensor_type(t: _Union[type["torch.Tensor"], str], /) -&gt; None:
r"""
..警告::

该函数自 PyTorch 2.1 版本开始已弃用，请使用:func:`torch.set_default_dtype()`和
func:`torch.set_default_device()`作为替代方案。

将默认的`torch.Tensor`类型设置为浮点张量类型
``t``. 此类型也将用作默认浮点类型。
在 :func:`torch.tensor` 中进行类型推断。

默认浮点张量类型最初为 ``torch.FloatTensor``。

参数：
t (类型或字符串)：浮点张量类型或其名称

示例::

&gt;&gt;&gt; # xdoctest: +SKIP("其他测试可能已更改默认类型。我们能重置它吗？")
&gt;&gt;&gt; torch.tensor([1.2, 3]).dtype    # 初始默认浮点类型为 torch.float32
torch.float32
&gt;&gt;&gt; torch.set_default_tensor_type(torch.DoubleTensor)
&gt;&gt;&gt; torch.tensor([1.2, 3]).dtype    # 创建一个新的浮点数张量
torch.float64

"""
如果 isinstance(t, str):
t = _import_dotted_name(t)
_C._set_default_tensor_type(t)</font></font></font></div>


<div class="viewcode-block" id="set_default_dtype"><a class="viewcode-back" href="../generated/torch.set_default_dtype.html#torch.set_default_dtype">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置默认数据类型</font></font></font></span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch 数据类型</font></font></font></span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">""</span>

<span class="sd">设置默认浮点数据类型为：attr:`d`。支持浮点数据类型</span>
<span class="sd">输入。其他数据类型会导致 torch 抛出异常。</span>

<span class="sd">当 PyTorch 初始化时，其默认浮点数据类型是 torch.float32，</span>
<span class="sd">set_default_dtype(torch.float64)的目的是为了方便 NumPy-like</span>
<span class="sd">类型推断。默认浮点数据类型用于：</span>

<span class="sd">1. 默认复杂数据类型隐式确定。当默认浮点类型为 float16 时，</span>
<span class="sd">默认复杂数据类型为 complex32。对于 float32，默认复杂数据类型为 complex64。</span>
<span class="sd">对于 float64，则为 complex128。对于 bfloat16，将引发异常，因为没有对应的复杂数据类型。</span>
<span class="sd">对于 bfloat16 没有对应的复杂数据类型。</span>
<span class="sd">2. 推断使用 Python 浮点数或复数 Python 构建的张量的 dtype</span>
<span class="sd">数字。以下为示例。</span>
<span class="sd">3. 确定布尔和整数张量之间类型提升的结果</span>
<span class="sd">Python 浮点数和复数 Python 数。</span>

<span class="sd">参数：</span>
<span class="sd">d (：class:`torch.dtype`): 设置默认的浮点数据类型。</span>

<span class="sd">示例：</span>
<span class="sd">&gt;&gt;&gt; # xdoctest: +SKIP("其他测试可能已更改默认类型。我们能重置它吗？")</span>
<span class="sd">&gt;&gt;&gt; # 浮点数的初始默认值是 torch.float32</span>
<span class="sd">&gt;&gt;&gt; # Python 浮点数被解释为 float32</span>
<span class="sd">        &gt;&gt;&gt; torch.tensor([1.2, 3]).dtype</span>
<span class="sd">        torch.float32</span>
<span class="sd">&gt;&gt;&gt; # 浮点数默认为 torch.complex64</span>
<span class="sd">&gt;&gt;&gt; # 复数 Python 数字被解释为 complex64</span>
<span class="sd">        &gt;&gt;&gt; torch.tensor([1.2, 3j]).dtype</span>
<span class="sd">        torch.complex64</span>

<span class="sd">        &gt;&gt;&gt; torch.set_default_dtype(torch.float64)</span>
<span class="sd">&gt;&gt;&gt; # Python 浮点数现在被解释为 float64</span>
<span class="sd">&gt;&gt;&gt; torch.tensor([1.2, 3]).dtype  # 一个新的浮点张量</span>
<span class="sd">        torch.float64</span>
<span class="sd">&gt;&gt;&gt; # 复杂的 Python 数字现在被解释为 complex128</span>
<span class="sd">&gt;&gt;&gt; torch.tensor([1.2, 3j]).dtype  # 一个新的复数张量</span>
<span class="sd">        torch.complex128</span>

<span class="sd">        &gt;&gt;&gt; torch.set_default_dtype(torch.float16)</span>
<span class="sd">&gt;&gt;&gt; # Python 浮点数现在被解释为 float16</span>
<span class="sd">&gt;&gt;&gt; torch.tensor([1.2, 3]).dtype  # 一个新的浮点张量</span>
<span class="sd">        torch.float16</span>
<span class="sd">&gt;&gt;&gt; # 复杂的 Python 数字现在被解释为 complex128</span>
<span class="sd">&gt;&gt;&gt; torch.tensor([1.2, 3j]).dtype  # 一个新的复数张量</span>
<span class="sd">        torch.complex32</span>

<span class="sd">    """</span>
    <span class="n">_C</span><span class="o">.</span><span class="n">_set_default_dtype</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="use_deterministic_algorithms"><a class="viewcode-back" href="../generated/torch.use_deterministic_algorithms.html#torch.use_deterministic_algorithms">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">使用确定性算法</span><span class="p">(</span>
    <span class="n">模式</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">仅警告</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">无</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">设置 PyTorch 操作是否必须使用“确定性”算法。也就是说，给定相同的输入，在相同的软件和硬件上运行时，总是产生相同输出的算法。</span>
<span class="sd">当启用时，操作将使用可用的确定性算法。</span>
<span class="sd">当启用时，操作将使用可用的确定性算法。</span>
<span class="sd">当启用时，操作将使用可用的确定性算法。</span>
<span class="sd">如果只有非确定性算法可用，它们将抛出</span>
<span class="sd">class:`RuntimeError` 异常。</span>

<span class="sd">.. note:: 仅此设置并不总是足以使应用程序可重复。</span>
<span class="sd">请参阅 :ref:`可重复性` 获取更多信息。</span>

<span class="sd">.. note:: `torch.set_deterministic_debug_mode` 提供了一种替代方案</span>
<span class="sd">界面为此功能。</span>

<span class="sd">以下通常是不可预测的操作将起作用</span>
<span class="sd">确定性翻译时 ``mode=True``：</span>

<span class="sd">当在 CUDA 张量上调用 * :class:`torch.nn.Conv1d`</span>
<span class="sd">当在 CUDA 张量上调用 * :class:`torch.nn.Conv2d`</span>
<span class="sd">当在 CUDA 张量上调用 * :class:`torch.nn.Conv3d`</span>
<span class="sd">当在 CUDA 张量上调用 * :class:`torch.nn.ConvTranspose1d`</span>
<span class="sd">当在 CUDA 张量上调用时，* :class:`torch.nn.ConvTranspose2d`</span>
<span class="sd">当在 CUDA 张量上调用时，* :class:`torch.nn.ConvTranspose3d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.ReplicationPad2d`</span>
<span class="sd">当在稀疏-稠密 CUDA 张量上调用时，* :func:`torch.bmm`</span>
<span class="sd">当尝试对 CPU 张量进行微分时，* :func:`torch.Tensor.__getitem__`</span>
<span class="sd">并且索引是一个张量列表</span>
<span class="sd">* :func:`torch.Tensor.index_put` 使用 `accumulate=False`</span>
<span class="sd">* :func:`torch.Tensor.index_put` 使用 `accumulate=True` 当在 CPU 上调用时</span>
<span class="sd">张量</span>
<span class="sd">当在 CPU 上调用时，使用 `accumulate=True` 的 `* :func:`torch.Tensor.put_`</span>
<span class="sd">张量</span>
<span class="sd">当在 CUDA 张量上调用时，使用 `* :func:`torch.Tensor.scatter_add_`</span>
<span class="sd">* 当在需要梯度的 CUDA 张量上调用 :func:`torch.gather`</span>
<span class="sd">* 当在 CUDA 张量上调用 :func:`torch.index_add`</span>
<span class="sd">* 在尝试对 CUDA 张量进行微分时调用 :func:`torch.index_select`</span>
<span class="sd">* 在尝试对 CUDA 张量进行微分时调用 :func:`torch.repeat_interleave`</span>
<span class="sd">当在 CPU 或 CUDA 张量上调用时，* :func:`torch.Tensor.index_copy`</span>
<span class="sd">当`src`类型为 Tensor 且在 CUDA 张量上调用时，* :func:`torch.Tensor.scatter`</span>
<span class="sd">当`reduce='sum'`或`reduce='mean'`且在 CUDA 张量上调用时，* :func:`torch.Tensor.scatter_reduce`</span>

<span class="sd">以下通常非确定性的操作将抛出</span>
<span class="sd">当 `mode=True` 时抛出 `RuntimeError` 异常：</span>

<span class="sd">* 在尝试对 CUDA 张量进行微分时，使用 `torch.nn.AvgPool3d`：</span>
<span class="sd">* 在尝试对 CUDA 张量进行微分时，使用 `torch.nn.AdaptiveAvgPool2d`：</span>
<span class="sd">* 在尝试对 CUDA 张量进行微分时，使用 `torch.nn.AdaptiveAvgPool3d`：</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.MaxPool3d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.AdaptiveMaxPool2d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.FractionalMaxPool2d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.FractionalMaxPool3d`</span>
<span class="sd">        * :class:`torch.nn.MaxUnpool1d`</span>
<span class="sd">        * :class:`torch.nn.MaxUnpool2d`</span>
<span class="sd">        * :class:`torch.nn.MaxUnpool3d`</span>
<span class="sd">* :func:`torch.nn.functional.interpolate` 当尝试对 CUDA 张量进行微分时</span>
<span class="sd">使用以下任一模式之一：</span>

<span class="sd">- ``线性``</span>
<span class="sd">- ``双线性``</span>
<span class="sd">- ``双三次``</span>
<span class="sd">三线性</span>

<span class="sd">当尝试对 CUDA 张量进行微分时，使用 :class:`torch.nn.ReflectionPad1d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，使用 :class:`torch.nn.ReflectionPad2d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，使用 :class:`torch.nn.ReflectionPad3d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.ReplicationPad1d`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.ReplicationPad3d`</span>
<span class="sd">当调用 CUDA 张量时，* :class:`torch.nn.NLLLoss`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.CTCLoss`</span>
<span class="sd">当尝试对 CUDA 张量进行微分时，* :class:`torch.nn.EmbeddingBag`</span>
<span class="sd">``mode='max'`'</span>
<span class="sd">* :func:`torch.Tensor.put_` 当 `accumulate=False`</span>
<span class="sd">* :func:`torch.Tensor.put_` 当 `accumulate=True` 并在 CUDA 张量上调用</span>
<span class="sd">当在 CUDA 张量上调用 * :func:`torch.histc`</span>
<span class="sd">当在 CUDA 张量上调用 * :func:`torch.bincount` 并提供 `weights`</span>
<span class="sd">给定张量</span>
<span class="sd">当在 CUDA 张量上调用 * :func:`torch.kthvalue`</span>
<span class="sd">* :func:`torch.median` 在对 CUDA 张量调用时输出索引</span>
<span class="sd">* :func:`torch.nn.functional.grid_sample` 在尝试对 CUDA 张量求导时</span>
<span class="sd">* :func:`torch.cumsum` 在对 CUDA 张量调用时，当数据类型为浮点型或复数时</span>
<span class="sd">* :func:`torch.Tensor.scatter_reduce` 当 `reduce='prod'` 并在 CUDA 张量上调用时</span>
<span class="sd">* :func:`torch.Tensor.resize_` 当与量化张量一起调用时</span>

<span class="sd">此外，几个操作会在此设置时填充未初始化的内存</span>
<span class="sd">已开启并当</span>
<span class="sd">torch.utils.deterministic.fill_uninitialized_memory 已开启。</span>
<span class="sd">请参阅该属性的文档以获取更多信息。</span>

<span class="sd">如果 CUDA 版本为 10.2 或更高，则有一些 CUDA 操作是非确定性的，</span>
<span class="sd">除非设置了环境变量`CUBLAS_WORKSPACE_CONFIG=:4096:8`或`CUBLAS_WORKSPACE_CONFIG=:16:8`。</span>
<span class="sd">请参阅 CUDA 文档以获取更多信息。</span>
<span class="sd">详情: ``_</span>
<span class="sd">如果这些环境变量配置中有一个未设置，则抛出 :class:`RuntimeError` 异常</span>
<span class="sd">当使用 CUDA 张量调用时，将从中提升：</span>

<span class="sd">        * :func:`torch.mm`</span>
<span class="sd">        * :func:`torch.mv`</span>
<span class="sd">        * :func:`torch.bmm`</span>

<span class="sd">注意确定性操作的性能通常比非确定性操作差。</span>
<span class="sd">非确定性操作。</span>

<span class="sd">.. 注意：</span>

<span class="sd">此标志无法检测或防止非确定性行为</span>
<span class="sd">通过在具有内部内存的张量上调用原地操作</span>
<span class="sd">重叠或通过将这样的张量作为：attr:`out`参数提供</span>
<span class="sd">操作。在这些情况下，可能非确定性的多次写入可能针对</span>
<span class="sd">单个内存位置，且写入顺序无法保证。</span>

<span class="sd">参数：</span>
<span class="sd">mode (:class:`bool`): 如果为 True，则可能产生非确定性</span>
<span class="sd">将操作切换为确定性算法或抛出运行时错误。</span>
<span class="sd">如果为 False，允许非确定性操作。</span>

<span class="sd">关键字参数：</span>
<span class="sd">warn_only（:class:`bool`，可选）：如果为 True，则不执行不正确的操作。</span>
<span class="sd">具有确定性实现的将抛出警告而不是错误。</span>
<span class="sd">默认值：``False``</span>

<span class="sd">示例::</span>

<span class="sd">        &gt;&gt;&gt; # xdoctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; torch.use_deterministic_algorithms(True)</span>

<span class="sd"># 前向模式非确定性错误</span>
<span class="sd">        &gt;&gt;&gt; torch.randn(10, device='cuda').kthvalue(1)</span>
<span class="sd">        ...</span>
<span class="sd">RuntimeError: kthvalue CUDA 没有确定性实现...</span>

<span class="sd"># 向后模式非确定性错误</span>
<span class="sd">        &gt;&gt;&gt; torch.nn.AvgPool3d(1)(torch.randn(3, 4, 5, 6, requires_grad=True).cuda()).sum().backward()</span>
<span class="sd">        ...</span>
<span class="sd">运行时错误：avg_pool3d_backward_cuda 没有确定性实现...</span>
<span class="sd">    """</span>
    <span class="n">_C</span><span class="o">.</span><span class="n">_set_deterministic_algorithms</span><span class="p">(</span><span class="n">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">仅警告</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">仅警告</span><span class="p">)</span></div>


<div class="viewcode-block" id="are_deterministic_algorithms_enabled"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def are_deterministic_algorithms_enabled() -&gt; builtins.bool:
r"""返回全局确定性标志是否开启。请参阅
`torch.use_deterministic_algorithms`函数文档，更多详情请参阅。
"""
返回 `_C._get_deterministic_algorithms()`</font></font></font></div>


<div class="viewcode-block" id="is_deterministic_algorithms_warn_only_enabled"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def is_deterministic_algorithms_warn_only_enabled() -&gt; builtins.bool:
返回全局确定性标志设置为仅警告时的 True。
请参阅 :func:`torch.use_deterministic_algorithms` 文档以获取更多详细信息。
详细信息。
"""
返回 _C._get_deterministic_algorithms_warn_only()</font></font></font></div>


<div class="viewcode-block" id="set_deterministic_debug_mode"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def set_deterministic_debug_mode(debug_mode: _Union[builtins.int, str]) -&gt; None:
r"""设置确定性操作的调试模式。

.. note:: 这是另一个接口，用于
:func:`torch.use_deterministic_algorithms`。请参阅该函数的
文档中关于受影响操作的详细信息。

参数:
debug_mode(str or int): 如果为 "default" 或 0，则不报错或警告
非确定操作。如果为"warn"或 1，则警告
非确定操作。如果为"error"或 2，则错误
非确定操作。
"""

# 注意：这里使用 builtins.int 是因为此作用域中的 int 解析为内置类型
# to 火炬.int
如果 debug_mode 不是内置的 int 或 str 类型
引发 TypeError("debug_mode 必须是 str 或 int，但得到{type(debug_mode)}")

if isinstance(debug_mode, str):
if debug_mode == "default":
debug_mode = 0
elif debug_mode == "warn":
debug_mode = 1
elif debug_mode == "error":
debug_mode = 2
else:
raise RuntimeError(
"无效的 debug_mode 值，期望的是 `default`，`warn`，`error` 之一，但得到的是 {debug_mode}"
f"`warn`，`error` 之一，但得到的是 {debug_mode}"
            )

if debug_mode == 0:
_C._set_deterministic_algorithms(False)
elif debug_mode == 1:
_C._set_deterministic_algorithms(True, warn_only=True)
elif 调试模式 == 2:
_C._set_deterministic_algorithms(True)
else:
raise RuntimeError(
无效的 debug_mode 值，预期为 0、1 或 2，但得到 {debug_mode}
        )</font></font></font></div>


<div class="viewcode-block" id="get_deterministic_debug_mode"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def get_deterministic_debug_mode() -&gt; builtins.int:
返回当前 debug 模式的值，用于确定性
操作。请参阅：func:`torch.set_deterministic_debug_mode`
查阅更多详细信息。
"""

如果 _C._get_deterministic_algorithms():
如果_C_._get_deterministic_algorithms_warn_only()():
返回 1
否则：
返回 2
else:
return 0</font></font></font></div>


<div class="viewcode-block" id="get_float32_matmul_precision"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def get_float32_matmul_precision() -&gt; str:
r"""返回当前 float32 矩阵乘法精度的值。请参阅
`torch.set_float32_matmul_precision` 文档中了解更多详情。
"""
返回 _C._get_float32_matmul_precision()</font></font></font></div>


<div class="viewcode-block" id="set_float32_matmul_precision"><a class="viewcode-back" href="../generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf">set_float32_matmul_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">设置浮点 32 矩阵乘法的内部精度。</span>

<span class="sd">在较低的精度下运行浮点 32 矩阵乘法可能会显著提高性能，</span>
<span class="sd">在某些程序中，精度的损失可能影响微乎其微。</span>

<span class="sd">支持三种设置：</span>

<span class="sd">最高，float32 矩阵乘法使用 float32 数据类型（24 尾数）</span>
<span class="sd">位（其中 23 位显式存储）用于内部计算。</span>
<span class="sd">* "高"，float32 矩阵乘法要么使用 TensorFloat32 数据类型（10</span>
<span class="sd">显式存储的尾数位（或将每个 float32 数字视为两个 bfloat16 数字之和）</span>
<span class="sd">（大约 16 位尾数位，其中 14 位显式存储），如果提供了适当的快速矩阵乘法算法。否则，float32 矩阵乘法将按“最高精度”计算</span>
<span class="sd">。如果没有这些算法，则 float32 矩阵乘法将按“最高精度”计算</span>
<span class="sd">。有关 bfloat16 的更多信息，请参阅下文</span>
<span class="sd">方法。</span>
<span class="sd">* "medium", float32 矩阵乘法使用 bfloat16 数据类型（8 位尾数）</span>
<span class="sd">7 位显式存储的比特位（用于内部计算），如果有一个快速的矩阵乘法算法</span>
<span class="sd">使用该数据类型内部可用。否则 float32</span>
<span class="sd">矩阵乘法在精度为“高”的情况下进行计算。</span>

<span class="sd">当使用“高”精度时，float32 乘法可能会使用基于 bfloat16 的算法</span>
<span class="sd">该算法比简单地截断到一些较小的数尾数位（例如，TensorFloat32 的 10 位，bfloat16 显式存储的 7 位）更复杂</span>
<span class="sd">。请参阅 [Henry2019]_ 获取完整信息</span>
<span class="sd">该算法的描述。在此简要说明，第一步是实现</span>
<span class="sd">我们可以将单个 float32 浮点数完美编码为三个 bfloat16 数的和（因为 float32 有 23 位尾数位，而 bfloat16 有 7 位显式存储，两者都有相同数量的指数位）。这意味着两个 float32 数的乘积可以</span>
<span class="sd">因为 float32 有 23 位尾数位，而 bfloat16 有 7 位显式存储，两者都有相同数量的指数位）。这意味着两个 float32 数的乘积可以</span>
<span class="sd">因为 float32 有 23 位尾数位，而 bfloat16 有 7 位显式存储，两者都有相同数量的指数位）。这意味着两个 float32 数的乘积可以</span>
<span class="sd">bfloat16 数字的九个乘积之和给出。然后我们可以进行交易</span>
<span class="sd">通过降低一些产品的精度来提高速度。"高"精度算法</span>
<span class="sd">专门只保留三个最重要的产品，从而方便地排除了</span>
<span class="sd">所有涉及任一输入的最后 8 位尾数的所有产品。这意味着</span>
<span class="sd">我们可以将我们的输入表示为两个 bfloat16 数字的和，而不是三个。</span>
<span class="sd">因为 bfloat16 融合乘加（FMA）指令通常比 10 倍快</span>
<span class="sd">float32 ones，使用 bfloat16 进行三次乘法和两次加法会更快</span>
<span class="sd">精度比用 float32 精度进行一次乘法操作要高。</span>

<span class="sd">    .. [Henry2019] http://arxiv.org/abs/1904.06376</span>

<span class="sd">.. 注意：</span>

<span class="sd">这不会改变 float32 矩阵乘法的输出数据类型</span>
<span class="sd">它控制矩阵乘法内部计算如何执行。</span>

<span class="sd">.. 注意：</span>

<span class="sd">这不会改变卷积操作的精度。其他标志，例如 `torch.backends.cudnn.allow_tf32`，可能控制卷积操作的精度。</span>
<span class="sd">例如，`torch.backends.cudnn.allow_tf32`，可能控制卷积操作的精度。</span>
<span class="sd">操作。</span>

<span class="sd">.. 注意：</span>

<span class="sd">此标志目前仅影响一种本地设备类型：CUDA。</span>
<span class="sd">如果设置为“高”或“中”，则将使用 TensorFloat32 数据类型</span>
<span class="sd">在计算 float32 矩阵乘法时使用，相当于设置</span>
<span class="sd">`torch.backends.cuda.matmul.allow_tf32 = True`. 当选择“最高”（默认）</span>
<span class="sd">如果设置，则内部计算使用 float32 数据类型，相当于设置`torch.backends.cuda.matmul.allow_tf32 = False`。</span>
<span class="sd">相当于设置`torch.backends.cuda.matmul.allow_tf32 = False`。</span>

<span class="sd">参数：</span>
<span class="sd">precision(str): 可以设置为 "最高"（默认）、"高" 或 "中等"（见上文）。</span>

<span class="sd">    """</span>
    <span class="n">_C</span><span class="o">.</span><span class="n">_set_float32_matmul_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_warn_always"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def set_warn_always(b: builtins.bool, /) -&gt; None:
r"""当此标志为 False（默认）时，一些 PyTorch 警告可能只
在每个进程中出现一次。这有助于避免过多的警告信息。
将其设置为 True 会导致这些警告始终出现，这可能会
帮助调试时很有用。

Args:
b (:class:`bool`): 如果为 True，强制警告始终被发出
如果为 False，设置为默认行为
"""
_C._set_warnAlways(b)</font></font></font></div>


<div class="viewcode-block" id="is_warn_always_enabled"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def is_warn_always_enabled() -&gt; builtins.bool:
r"""返回全局 warn_always 标志是否开启。请参阅
`torch.set_warn_always`函数文档，更多详情请参阅。
"""
返回 _C._get_warnAlways()</font></font></font></div>


<span class="c1">################################################################################</span>
<span class="c1">定义错误检查函数</span>
<span class="c1">################################################################################</span>

<span class="c1">这些错误检查函数必须与它们的 C++版本保持一致</span>
<span class="c1">它们的 C++等价函数将在适当位置提及</span>


<span class="k">定义</span> <span class="nf">_check_with</span><span class="p">(</span>
    <span class="n">错误类型</span><span class="p">,</span>
    <span class="n">条件</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号布尔值</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="n">消息</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[]</font></font></font></span> <span class="nb">str</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
<span class="p">):</span>  <span class="c1"># noqa: F811</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="p">(</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号布尔值</span><span class="p">)):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"cond 必须是布尔值，但得到了</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">torch.fx.experimental.symbolic_shapes</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期为真</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">预期为真</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</span><span class="p">):</span>
        <span class="k">返回</span>

    <span class="c1"># 错误类型必须是 Exception 的子类，而不是 Warning 的子类</span>
    <span class="k">断言</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">派生类</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误类型</font></font></font></span><span class="p">,</span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="ow">not</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">派生类</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误类型</font></font></font></span><span class="p">,</span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">消息评估</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">预期条件为 True，但得到 False。（这个错误是否可能是...）</span>
            <span class="s2">消息可以改进吗？如果可以，请提交一个增强请求</span>
            <span class="s2">到 PyTorch。)</span>
        <span class="p">)</span>

    <span class="k">否则</span><span class="p">:</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">):</span>
            <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"消息必须是一个可调用的"</span><span class="p">)</span>

        <span class="n">消息评估</font></font></font></span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">())</span>

    <span class="k">抛出</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息评估</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_检查</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：``RuntimeError``</span>

<span class="sd">C++ 等价函数：``TORCH_CHECK``</span>

<span class="sd">参数：</span>
<span class="sd">cond (:class:`bool`): 如果为 False，则抛出错误</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_with</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查是否为大小</font></font></font></span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>
<span class="w">    </span><span class="sd">检查给定的整数是否为有效大小（即非负）。</span>
<span class="sd">应该使用这个而不是 `_check(i &gt;= 0)`，因为它可以防止通过选择进入替代语义来处理值 0 和 1 的 `GuardOnDataDependentSymNode` 异常。</span>
<span class="sd">为 `guard_size_oblivious` 测试选择替代语义，这些测试将值 0 和 1 视为特殊情况，从而防止 `GuardOnDataDependentSymNode` 异常。</span>
<span class="sd">为 `guard_size_oblivious` 测试选择替代语义，这些测试将值 0 和 1 视为特殊情况。</span>
<span class="sd">等价于所有其他值。</span>

<span class="sd">当 max 不为 None 时，这指定了一个上限，等价于</span>
<span class="sd">``_check(i &lt;= max)``。这个上限也受到交替语义的影响：</span>
<span class="sd">在``guard_size_oblivious``测试中，我们假设有一个常数上限</span>
<span class="sd">与所有其他值等效处理。符号最大边界尚未支持。</span>
<span class="sd">不支持。</span>

<span class="sd">注意：不要在-1 大小有效（表示从上下文中推断大小，或者应该回绕或截断）的上下文中使用此功能。</span>
<span class="sd">或者如果你应该包装或截断的情况下使用。</span>
<span class="sd">仅在此唯一有效值为货真价实的尺寸时使用。</span>
<span class="sd">    """</span>
    <span class="c1">这负责 expect_true</span>
    <span class="n">_检查</font></font></font></span><span class="p">(</span><span class="n">i</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</font></font></font></span> <span class="mi">0</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">torch.fx.experimental.symbolic_shapes</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">建议大小</span>

    <span class="n">建议大小</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">_检查</font></font></font></span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">torch.fx.experimental.symbolic_shapes</span> <span class="kn">导入</span> <span class="n">_advise_is_bounded</span>

        <span class="n">建议是有界限的</font></font></font></span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查索引</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：``IndexError``</span>

<span class="sd">C++等效：`TORCH_CHECK_INDEX`</span>

<span class="sd">参数：</span>
<span class="sd">cond (:class:`bool`): 如果为 False，则抛出错误</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_with</span><span class="p">(</span><span class="ne">索引错误</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">检查值</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：`ValueError`</span>

<span class="sd">C++ 等价：``TORCH_CHECK_VALUE``</span>

<span class="sd">参数：</span>
<span class="sd">cond (:class:`bool`): 如果为 False，则抛出错误</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_with</span><span class="p">(</span><span class="ne">值错误</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_检查类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：``TypeError``</span>

<span class="sd">C++等效：``TORCH_CHECK_TYPE``</span>

<span class="sd">参数：</span>
<span class="sd">cond (:class:`bool`): 如果为 False，则抛出错误</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_with</span><span class="p">(</span><span class="ne">类型错误</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_未实现检查</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：`NotImplementedError`</span>

<span class="sd">C++ 等价：`TORCH_CHECK_NOT_IMPLEMENTED`</span>

<span class="sd">参数：</span>
<span class="sd">cond (:class:`bool`): 如果为 False，则抛出错误</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_with</span><span class="p">(</span><span class="ne">不支持的操作异常</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="k">定义</font></font></font></span> <span class="nf">_check_tensor_all_with</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n">is_tensor</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"条件必须是一个张量，但得到了"</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"cond tensor 必须具有 dtype torch.bool 类型，但得到了</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">_check_with</span><span class="p">(</span><span class="n">错误类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全部为真</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</font></font></font></span><span class="p">(),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>


<span class="c1"># C++ 等价: `TORCH_CHECK_TENSOR_ALL`</span>
<span class="k">定义</font></font></font></span> <span class="nf">_check_tensor_all</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</font></font></font></span><span class="o">=</span><span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">):</span>  <span class="c1"># noqa: F811</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">抛出包含可选消息的错误，如果指定的条件</span>
<span class="sd">是错误的。</span>

<span class="sd">错误类型：``RuntimeError``</span>

<span class="sd">C++ 等价：``TORCH_CHECK_TENSOR_ALL``</span>

<span class="sd">参数：</span>
<span class="sd">        cond (:class:`torch.Tensor`): Tensor of dtype ``torch.bool``. If any</span>
<span class="sd">element is ``False``，throw error</span>

<span class="sd">message (Callable, 可选): 可调用对象，返回字符串或</span>
<span class="sd">具有用于错误信息的 ``__str__()`` 方法的对象</span>
<span class="sd">默认值：``None``</span>
<span class="sd">    """</span>
    <span class="n">_check_tensor_all_with</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">消息</span><span class="p">)</span>


<span class="c1">################################################################################</span>
<span class="c1"># 定义数值常量</span>
<span class="c1">################################################################################</span>

<span class="c1"># 对于 Python 数组 API（https://data-apis.org/array-api/latest/API_specification/constants.html）和</span>
<span class="c1"># NumPy 一致性（https://numpy.org/devdocs/reference/constants.html）</span>
<span class="kn">from</span> <span class="nn">数学</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">e</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无穷</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">纳尼</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">圆周率</span>


<span class="n">新轴</font></font></font></span><span class="p">:</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</span>

<span class="n">__all__</span><span class="o">.</span><span class="n">扩展</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="s2">"e"</span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"π"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"非数字"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"无穷大"</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"新轴"</span><span class="p">])</span>

<span class="c1">################################################################################</span>
<span class="c1"># 定义存储和张量类</span>
<span class="c1">################################################################################</span>

<span class="kn">from</span> <span class="nn">torch._tensor</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">张量</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="c1">需要在定义 torch.Tensor 之后才能避免循环依赖</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存储</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存储</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>
<span class="kn">from</span> <span class="nn">torch.storage</span> <span class="kn">导入</span> <span class="p">(</span>
    <span class="n">_LegacyStorage</span><span class="p">,</span>
    <span class="n">_StorageBase</span><span class="p">,</span>
    <span class="n">警告：类型化存储移除</span><span class="p">,</span>
    <span class="n">类型化存储</span><span class="p">,</span>
    <span class="n">未类型化存储</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># 备注：不应添加新的 Storage 类。当添加新</span>
<span class="c1"># dtype，直接使用 torch.storage.TypedStorage。</span>
<div class="viewcode-block" id="ByteStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]类 ByteStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="ByteStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span></div>


<div class="viewcode-block" id="DoubleStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class DoubleStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="DoubleStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">double</span></div>


<div class="viewcode-block" id="FloatStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class FloatStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="FloatStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">float</span></div>


<div class="viewcode-block" id="HalfStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class HalfStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="HalfStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">half</span></div>


<div class="viewcode-block" id="LongStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class LongStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="LongStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">@classproperty def _dtype(self): return torch.long

类属性 _dtype(self): 返回 torch.long</font></font></font></div>


<div class="viewcode-block" id="IntStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class IntStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="IntStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">int</span></div>


<div class="viewcode-block" id="ShortStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class ShortStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="ShortStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">short</span></div>


<div class="viewcode-block" id="CharStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class CharStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="CharStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">int8</span></div>


<div class="viewcode-block" id="BoolStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class BoolStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="BoolStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span></div>


<div class="viewcode-block" id="BFloat16Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class BFloat16Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="BFloat16Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span></div>


<div class="viewcode-block" id="ComplexDoubleStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class ComplexDoubleStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="ComplexDoubleStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cdouble</span></div>


<div class="viewcode-block" id="ComplexFloatStorage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class ComplexFloatStorage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="ComplexFloatStorage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cfloat</span></div>


<div class="viewcode-block" id="QUInt8Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class QUInt8Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="QUInt8Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">quint8</span></div>


<div class="viewcode-block" id="QInt8Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class QInt8Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="QInt8Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">qint8</span></div>


<div class="viewcode-block" id="QInt32Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class QInt32Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="QInt32Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">qint32</span></div>


<div class="viewcode-block" id="QUInt4x2Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class QUInt4x2Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="QUInt4x2Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">quint4x2</span></div>


<div class="viewcode-block" id="QUInt2x4Storage"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]class QUInt2x4Storage(_LegacyStorage):
</font></font></font><div class="viewcode-block" id="QUInt2x4Storage.dtype"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档] @类属性
def dtype(self):
_warn_typed_storage_removal(stacklevel=3)
return self._dtype</font></font></font></div>

    <span class="nd">@classproperty</span>
    <span class="k">def</span> <span class="nf">_dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">quint2x4</span></div>


<span class="n">_storage_classes</span><span class="p">:</span> <span class="nb">设置</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型化存储</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未类型化存储</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">未类型化存储</span><span class="p">,</span>
    <span class="n">双倍存储</span><span class="p">,</span>
    <span class="n">浮点存储</span><span class="p">,</span>
    <span class="n">长存储</span><span class="p">,</span>
    <span class="n">整数存储</span><span class="p">,</span>
    <span class="n">短存储</span><span class="p">,</span>
    <span class="n">字符存储</span><span class="p">,</span>
    <span class="n">字节存储</span><span class="p">,</span>
    <span class="n">半字节存储</span><span class="p">,</span>
    <span class="n">布尔存储</span><span class="p">,</span>
    <span class="n">有符号无符号 8 位整数存储</span><span class="p">,</span>
    <span class="n">QInt8 存储</span><span class="p">,</span>
    <span class="n">QInt32 存储</span><span class="p">,</span>
    <span class="n">BFloat16 存储</span><span class="p">,</span>
    <span class="n">ComplexFloat 存储</span><span class="p">,</span>
    <span class="n">复杂双存储</span><span class="p">,</span>
    <span class="n">Q 无符号 4x2 存储</span><span class="p">,</span>
    <span class="n">Q 无符号 2x4 存储</span><span class="p">,</span>
    <span class="n">类型化存储</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">通过调用 initialize_python_bindings 初始化_tensor_classes 集合。</span>
<span class="n">_tensor_classes</span><span class="p">:</span> <span class="nb">设置</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch.Tensor</font></font></font></span><span class="p">]]</span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置</span><span class="p">()</span>

<span class="c1"># 如果您编辑了这些导入，请同时更新 torch/__init__.py.in</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自动混合精度</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">随机</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">序列化</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">序列化</span>
<span class="kn">from</span> <span class="nn">torch._tensor_str</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置打印选项</span>
<span class="kn">from</span> <span class="nn">torch.amp</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自动播</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">梯度缩放器</span>
<span class="kn">from</span> <span class="nn">torch.random</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取随机数生成器状态</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">初始种子</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">手动播种</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">种子</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置随机数生成器状态</span>
<span class="kn">from</span> <span class="nn">torch 序列化</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">保存</span>


<span class="c1">################################################################################</span>
<span class="c1">初始化扩展</span>
<span class="c1">################################################################################</span>


<span class="c1">共享内存管理器需要知道管理器可执行文件的准确位置</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_管理器路径</span><span class="p">():</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_运行时使用部署</font></font></font></span><span class="p">()</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">平台</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统</font></font></font></span><span class="p">()</span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">Windows</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="sa">b</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">请提供需要翻译的文本</span>
    <span class="n">路径</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取文件路径</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">bin</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch_shm_manager</span><span class="p">)</span>
    <span class="n">准备多进程环境</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取文件路径</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">torch</span><span class="p">))</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">存在</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无法找到 torch_shm_manager</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</span><span class="p">)</span>
    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">路径</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编码</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">utf-8</span><span class="p">)</span>


<span class="n">_C</span><span class="o">.</span><span class="n">_初始化扩展</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_管理器路径</span><span class="p">())</span>

<span class="k">删除</span> <span class="n">_manager_path</span>

<span class="c1"># 满足类型检查器：它无法处理直接设置全局变量。</span>
<span class="c1"># 注意，以这种方式重新导出时，我们会看到“太多”的函数；</span>
<span class="c1">这不是解决问题的好方法。也许，尝试重新设计 VariableFunctions</span>
<span class="c1">以便这个导入足够好</span>
<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="c1"># 从 _VariableFunctions 中拉取的一些类型签名与此处冲突</span>
    <span class="c1">已导入签名。目前这些冲突被忽略；详情见</span>
    <span class="c1">PR #43339。</span>
    <span class="kn">from</span> <span class="nn">torch._C._VariableFunctions</span> <span class="kn">导入</span> <span class="o">*</span>  <span class="c1"># type: ignore[assignment, misc] # noqa: F403</span>

    <span class="c1"># 修复 segment_reduce 透明度</span>
    <span class="n">_segment_reduce</span> <span class="o">=</span> <span class="n">段落减少</span>
    <span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">段落减少</span>  <span class="c1"># noqa: F821</span>

<span class="c1"># 不应在 `torch` 命名空间中公开的操作，</span>
<span class="c1">主要为辅助操作。</span>
<span class="n">私有操作</font></font></font></span> <span class="o">=</span> <span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">唯一维度</span><span class="p">,)</span>

<span class="n">名称</font></font></font></span><span class="p">,</span> <span class="n">__obj</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入文本翻译为简体中文为：""</font></font></font></span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</span>
<span class="k">对于</font></font></font></span> <span class="n">__name</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录</font></font></font></span><span class="p">(</span><span class="n">_C</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_变量函数</span><span class="p">):</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...开头</font></font></font></span><span class="p">(</span><span class="s2">"__"</span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n">__name</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</span> <span class="n">PRIVATE_OPS</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">__obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_C</span><span class="o">.</span><span class="n">_变量函数</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
    <span class="n">__obj</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="vm">__name__</span>  <span class="c1"># "torch"</span>
    <span class="c1">隐藏不应公开的一些 API</span>
    <span class="k">如果</span> <span class="n">__name</span> <span class="o">==</span> <span class="s2">"segment_reduce"</span><span class="p">:</span>
        <span class="c1"># TODO: 一旦通过未记录的 FC 窗口，删除下面的行</span>
        <span class="nb">全局变量</font></font></font></span><span class="p">()[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span> <span class="o">=</span> <span class="n">__obj</span>
        <span class="n">__name</span> <span class="o">=</span> <span class="s2">_</span> <span class="o">+</span> <span class="n">__name</span>
    <span class="nb">全局变量</font></font></font></span><span class="p">()[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">]</span> <span class="o">=</span> <span class="n">__obj</span>
    <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以...开头</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“下划线”</span><span class="p">):</span>
        <span class="n">__all__</span><span class="o">.</span><span class="n">添加</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>

<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">,</span> <span class="n">__obj</span>

<span class="c1">################################################################################</span>
<span class="c1">将 torch.dtype 实例添加到公共 API 中</span>
<span class="c1">################################################################################</span>

<span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</span>


<span class="n">__all__</span><span class="o">.</span><span class="n">扩展</span><span class="p">(</span>
    <span class="n">名称</font></font></font></span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">目录</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="p">)</span> <span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="p">),</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">################################################################################</span>
<span class="c1">导入 TorchDynamo 的延迟 API 以避免循环依赖</span>
<span class="c1">################################################################################</span>

<span class="c1">需要在 from torch.functional import *之前，以避免循环依赖</span>
<span class="kn">from</span> <span class="nn">torch._compile</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">禁用 dynamo</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="c1">################################################################################</span>
<span class="c1"># 导入在 Python 中定义的接口函数</span>
<span class="c1">################################################################################</span>

<span class="c1"># 需要放在上面的 ATen 绑定之后，这样我们才能从 Python 端覆盖</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">_VF</span> <span class="k">as</span> <span class="n">_VF</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">功能性</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">功能性</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>
<span class="kn">from</span> <span class="nn">torch.functional</span> <span class="kn">导入</font></font></font></span> <span class="o">*</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过 # noqa: F403</span>

<span class="c1">################################################################################</span>
<span class="c1"># 删除不必要的成员</span>
<span class="c1">################################################################################</span>

<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_存储基类</span>
<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_遗留存储</span>

<span class="c1">################################################################################</span>
<span class="c1"># 定义 _assert</span>
<span class="c1">################################################################################</span>


<span class="c1"># 需要放在子模块导入之前以避免循环依赖</span>
<div class="viewcode-block" id="_assert"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def _assert(condition, message):
r"""Python 的 assert 的包装器，具有符号可追踪性。"""
if type(condition) is not torch.Tensor and overrides.has_torch_function(
(condition,)
    ):
return overrides.handle_torch_function(
_assert, (condition,), condition, message
        )
断言条件，信息</font></font></font></div>


<span class="c1">################################################################################</span>
<span class="c1">导入最常见的子包</span>
<span class="c1">################################################################################</span>

<span class="c1">使用冗余形式，以便类型检查器知道这些是公共 API 的一部分</span>
<span class="c1">“常规”导入行仅用于在运行时向导入模块的成员添加对其他用户的副作用</span>
<span class="c1">仅为了向导入模块的成员添加对其他用户的副作用</span>

<span class="c1">在导入 torch.nn 之前需要放置</span>
<span class="kn">from</span> <span class="nn">torch 自动微分</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="p">(</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>
    <span class="n">enable_grad</span> <span class="k">as</span> <span class="n">启用梯度</span><span class="p">,</span>
    <span class="n">推理模式</span> <span class="k">as</span> <span class="n">inference_mode</span><span class="p">,</span>
    <span class="n">no_grad</span> <span class="k">as</span> <span class="n">不梯度</span><span class="p">,</span>
    <span class="n">设置梯度启用</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设置梯度启用</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="p">(</span>
    <span class="n">配置</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span><span class="p">,</span>
    <span class="n">未来</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">未来</span><span class="p">,</span>
    <span class="n">等待</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">等待</span><span class="p">,</span>
    <span class="n">加速器</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加速器</span><span class="p">,</span>
    <span class="n">自动微分</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">自动微分</span><span class="p">,</span>
    <span class="n">后端</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">,</span>
    <span class="n">cpu</span> <span class="k">as</span> <span class="n">cpu</span><span class="p">,</span>
    <span class="n">cuda</span> <span class="k">as</span> <span class="n">cuda</span><span class="p">,</span>
    <span class="n">分布式</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分布式</span><span class="p">,</span>
    <span class="n">分布</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分布式</span><span class="p">,</span>
    <span class="n">快速傅里叶变换</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">快速傅里叶变换</span><span class="p">,</span>
    <span class="n">期货</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">期货</span><span class="p">,</span>
    <span class="n">花市</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">花市</span><span class="p">,</span>
    <span class="n">算子</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">算子</span><span class="p">,</span>
    <span class="n">线性代数</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">线性代数</span><span class="p">,</span>
    <span class="n">会员</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">会员</span><span class="p">,</span>
    <span class="n">管理培训师</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">管理培训师</span><span class="p">,</span>
    <span class="n">多进程</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">多进程</span><span class="p">,</span>
    <span class="n">嵌套</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">嵌套</span><span class="p">,</span>
    <span class="n">神经网络</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">神经网络</span><span class="p">,</span>
    <span class="n">优化</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">优化</span><span class="p">,</span>
    <span class="n">覆盖规则</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">覆盖</span><span class="p">,</span>
    <span class="n">分析器</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分析器</span><span class="p">,</span>
    <span class="n">稀疏的</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">稀疏</span><span class="p">,</span>
    <span class="n">特别</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">特别</span><span class="p">,</span>
    <span class="n">测试</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">测试</span><span class="p">,</span>
    <span class="n">类型</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span><span class="p">,</span>
    <span class="n">工具</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">工具</span><span class="p">,</span>
    <span class="n">xpu</span> <span class="k">as</span> <span class="n">xpu</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">torch.signal</span> <span class="kn">导入</span> <span class="n">windows</span> <span class="k">as</span> <span class="n">windows</span>


<span class="c1"># 量化、稀疏、AO 等应最后导入，因为它们没有</span>
<span class="c1"># 预期依赖于它们。</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">ao</span> <span class="k">as</span> <span class="n">ao</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="c1"># nn.quant* 依赖于 ao -- 因此应在那些之后</span>
<span class="kn">导入</span> <span class="nn">torch.nn.intrinsic</span>
<span class="kn">导入</span> <span class="nn">torch.nn.qat</span>
<span class="kn">导入</span> <span class="nn">torch.nn.quantizable</span>
<span class="kn">导入</span> <span class="nn">torch.nn.quantized</span>


<span class="n">_C</span><span class="o">.</span><span class="n">_init_names</span><span class="p">(</span><span class="nb">列表</span><span class="p">(</span><span class="n">_storage_classes</span><span class="p">))</span>

<span class="c1">将文档字符串附加到 torch 和 tensor 函数</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">_size_docs</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_存储文档</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_tensor 文档</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_torch 文档</span>


<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_torch 文档</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_tensor 文档</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_存储文档</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_文档大小</span>


<div class="viewcode-block" id="compiled_with_cxx11_abi"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def 使用_cxx11_abi 编译() -&gt; builtins.bool:
r"""返回 PyTorch 是否使用 _GLIBCXX_USE_CXX11_ABI=1 进行编译"""
return _C._GLIBCXX_USE_CXX11_ABI</font></font></font></div>


<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作</span>


<span class="c1">导入 "namespace" 的 ops 和 classes</span>
<span class="kn">from</span> <span class="nn">torch._ops</span> <span class="kn">导入</font></font></font></span> <span class="n">ops</span> <span class="k">as</span> <span class="n">ops</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>
<span class="kn">from</span> <span class="nn">torch._classes</span> <span class="kn">导入</font></font></font></span> <span class="n">classes</span> <span class="k">as</span> <span class="n">classes</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.ops"</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作</span><span class="p">)</span>
<span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">.类"</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类别</span><span class="p">)</span>

<span class="c1"># 量化依赖于 torch.fx 和 torch.ops</span>
<span class="c1"># 导入量化</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">量化</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">量化</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="c1"># 导入准随机采样器</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">近似随机</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">近似随机</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># usort: 跳过</span>

<span class="c1"># 如果您看到这个，这意味着这个调用点没有检查</span>
<span class="c1"># 内存格式是否可以保留，并且已切换到旧默认值</span>
<span class="c1">连续行为</span>
<span class="n">旧连续格式</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连续格式</font></font></font></span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">由 _C._initExtension() 定义</span>

<span class="c1">注册 fork 处理程序以初始化子进程中的 OpenMP（参见 gh-28389）</span>
<span class="kn">from</span> <span class="nn">torch.multiprocessing._atfork</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">fork 之后注册</span>


<span class="n">注册 fork 之后</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取线程数</span><span class="p">)</span>
<span class="k">删除</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">fork 之后注册</span>

<span class="c1"># 导入需要完全导入 torch 的工具（用于应用</span>
<span class="c1"># torch.jit.script 作为装饰器，例如）：</span>
<span class="kn">from</span> <span class="nn">torch._lobpcg</span> <span class="kn">导入</span> <span class="n">lobpcg</span> <span class="k">as</span> <span class="n">lobpcg</span>


<span class="c1">这些之前已在 native_functions.yaml 中定义并出现</span>
<span class="c1">torch 命名空间，但我们将它们移动到 c10 调度以方便自定义</span>
<span class="c1">类使用。我们在这里添加这些行以保持向后兼容性。</span>
<span class="n">量化 LSTM</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作</font></font></font></span><span class="o">.</span><span class="n">aten</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">量化 LSTM</span>
<span class="n">量化 GRU</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作</font></font></font></span><span class="o">.</span><span class="n">aten</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">量化 GRU</span>

<span class="c1"># 导入实验性掩码操作支持。详见</span>
<span class="c1"># [RFC-0016](https://github.com/pytorch/rfcs/pull/27) 了解更多</span>
<span class="c1">信息</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">隐藏</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">隐藏</span>

<span class="c1"># 移除带有移除错误信息的操作</span>
<span class="kn">from</span> <span class="nn">torch._linalg_utils</span> <span class="kn">导入</font></font></font></span> <span class="p">(</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型：忽略[杂项]</span>
    <span class="n">_symeig</span> <span class="k">as</span> <span class="n">特征值</span><span class="p">,</span>
    <span class="n">特征向量</span><span class="p">,</span>
    <span class="n">最小二乘法</span><span class="p">,</span>
    <span class="n">矩阵秩</span><span class="p">,</span>
    <span class="n">求解</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">torch.utils.dlpack</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">从 dlpack 转换</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">转换为 dlpack</span>


<span class="k">类</span> <span class="nc">_TorchCompileInductorWrapper</span><span class="p">:</span>
    <span class="n">编译器名称</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"电感器"</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__init__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">torch._inductor.编译器二分器</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器二分器</span>

        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用模式</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">)</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用选项</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</span><span class="p">)</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用选项</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器二分器</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取配置更改</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">电感器</span><span class="p">))</span>

        <span class="k">如果</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">triton.cuDAG 图</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">环境</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"禁用 CUPTI 懒加载初始化"</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">1</span>
            <span class="c1"># FIXME: CUDA 图形与 CUPTI 清理工作不兼容。</span>
            <span class="c1">#   1) 在清理工作后第一次懒加载 CUPTI 重新初始化时崩溃（CUDA 11）</span>
            <span class="c1">#   2) 在清理工作后第二次非懒加载 CUPTI 重新初始化时崩溃（CUDA 12）</span>
            <span class="c1"># 解决方案：当使用 CUDA 图形时，关闭 CUPTI 清理工作。</span>
            <span class="n">os</span><span class="o">.</span><span class="n">环境</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"CUPTI 解构"</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"零"</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__等于__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">返回</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">其他</span><span class="p">,</span> <span class="n">_TorchCompileInductorWrapper</span><span class="p">)</span>
            <span class="ow">以及</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span>
            <span class="ow">以及</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span>
        <span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用模式</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">)]</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">默认</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">torch._inductor</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列出模式选项</span>

            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用选项</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列出模式选项</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">))</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应用选项</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]]：</span>
        <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</span><span class="p">:</span>
            <span class="k">返回</span>

        <span class="kn">from</span> <span class="nn">torch._inductor</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span>

        <span class="n">当前配置</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">任意</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取配置副本</span><span class="p">()</span>

        <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="p">,</span> <span class="n">val</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">项目</span><span class="p">():</span>
            <span class="n">属性名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替换</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">破折号</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“下划线”</span><span class="p">)</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性名称</font></font></font></span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">当前配置</span><span class="p">:</span>
                <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">意外优化选项</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">逗号，已知选项为</font></font></font></span><span class="si">{</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">列表</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">当前配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
            <span class="n">属性类型</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性名称</font></font></font></span><span class="p">)</span>  <span class="c1"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "># 类型：忽略[已定义]</span>
            <span class="c1"># 可变通用的类型不支持 isinstance，因此跳过类型检查</span>
            <span class="c1"># 检查。似乎没有好的方法来检查成员资格而不使用</span>
            <span class="c1"># 第三方库。</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_获取原始</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性类型</font></font></font></span><span class="p">)</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性类型</span><span class="p">):</span>
                    <span class="n">值类型字符串</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="n">预期类型字符串</font></font></font></span> <span class="o">=</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">当前配置</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性名称</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"意外的属性类型</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">键</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">，获得</font></font></font></span><span class="si">{</span><span class="n">val_type_str</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">应该是</span><span class="si">{</span><span class="n">expected_type_str</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性名称</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__调用__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型_</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入_</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">torch._inductor.compile_fx</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译_fx</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译_fx</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型_</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入_</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置修补</font></font></font></span><span class="o">=</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取编译器配置</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">torch._inductor.compile_fx</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取修补后的配置字典</span>

        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取修补后的配置字典</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置修补</font></font></font></span><span class="o">=</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重置</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">torch._inductor</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</span>

        <span class="k">如果</font></font></font></span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">triton.cudagraphs</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">或者</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三叉戟</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">cuDAG 图</span><span class="p">:</span>
            <span class="k">如果</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">配置</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">triton.cuDAG 图</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">torch._inductor.cudagraph_trees</span> <span class="kn">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重置_cudagraph_trees</span>

                <span class="n">重置_cudagraph_trees</span><span class="p">()</span>


<span class="k">类</span> <span class="nc">_TorchCompileWrapper</span><span class="p">:</span>
    <span class="k">定义</font></font></font></span> <span class="fm">__init__</span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">torch._dynamo.backends.registry</span> <span class="kn">导入</span> <span class="n">lookup_backend</span>

        <span class="k">如果</font></font></font></span> <span class="nb">isinstance</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span>
        <span class="k">elif</span> <span class="nb">有属性</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"__名称__"</span><span class="p">):</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器名称</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">否则</span><span class="p">:</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器名称</font></font></font></span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">)</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span>
        <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">查找后端</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">)</span>
        <span class="bp">我</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">仅传递非空参数</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="o">!=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">默认</span><span class="p">:</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键字参数</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</span><span class="p">:</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键字参数</font></font></font></span><span class="p">[</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__等于__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="p">):</span>
        <span class="k">返回</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">其他</span><span class="p">,</span> <span class="n">_TorchCompileWrapper</span><span class="p">)</span>
            <span class="ow">以及</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</span>
            <span class="ow">以及</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n">kwargs</span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</span><span class="o">.</span><span class="n">kwargs</span>
            <span class="ow">以及</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</font></font></font></span> <span class="o">==</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">其他</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span>
        <span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="fm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__调用__</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型_</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入_</span><span class="p">):</span>
        <span class="k">返回</font></font></font></span> <span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型_</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入_</font></font></font></span><span class="p">,</span> <span class="o">**</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">关键字参数</span><span class="p">)</span>

    <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重置</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</span><span class="p">):</span>
        <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="bp"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</font></font></font></span><span class="p">,</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重置</span><span class="p">):</span>
            <span class="bp">我</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器函数</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">重置</span><span class="p">()</span>


<span class="n">输入 T</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">参数规范</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"_输入 T"</span><span class="p">)</span>
<span class="n">返回 T</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_类型变量</span><span class="p">(</span><span class="s2">"_RetT"</span><span class="p">)</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译</span><span class="p">(</span>
    <span class="n">模型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">全图</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">动态</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">后端</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">电感器</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">选项</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">禁用</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span> <span class="o">...</span>


<span class="nd">@_overload</span>
<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译</span><span class="p">(</span>
    <span class="n">模型</font></font></font></span><span class="p">:</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</font></font></font></span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">全图</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">动态</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">后端</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">电感器</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">选项</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">禁用</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p">]],</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]]</span> <span class="o">...</span>


<div class="viewcode-block" id="compile"><a class="viewcode-back" href="../generated/torch.compile.html#torch.compile">[文档]</font></font></font></a><span class="k"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译</span><span class="p">(</span>
    <span class="n">模型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">全图</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">动态</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">后端</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">电感器</span><span class="p">,</span>
    <span class="n">模式</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">选项</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">联合</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="n">禁用</font></font></font></span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">布尔值</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">联合</span><span class="p">[</span>
    <span class="n">可调用</font></font></font></span><span class="p">[[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p">]],</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</span><span class="p">]],</span>
    <span class="n">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
<span class="p">]</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">使用 TorchDynamo 和指定的后端优化给定的模型/函数。</span>
<span class="sd">如果您正在编译一个 :class:`torch.nn.Module`，您还可以使用 :meth:`torch.nn.Module.compile`。</span>
<span class="sd">在不改变其结构的情况下就地编译模块。</span>

<span class="sd">具体来说，对于编译区域内的每一帧执行，我们将尝试</span>
<span class="sd">编译它并将编译结果缓存到代码对象中供将来使用</span>
<span class="sd">使用。单个帧可能被编译多次，如果之前已编译</span>
<span class="sd">结果不适用于后续调用（这被称为“守卫”）</span>
<span class="sd">失败)，您可以使用 TORCH_LOGS=guards 来调试这些情况。</span>
<span class="sd">多个编译结果可以与一个帧关联</span>
<span class="sd">torch._dynamo.config.recompile_limit，默认为 8；在哪个</span>
<span class="sd">我们将回退到急切模式。注意，编译缓存是按</span>
<span class="sd">*代码对象*，而非框架；如果您动态创建多个副本，</span>
<span class="sd">函数，它们将共享相同的代码缓存。</span>

<span class="sd">参数：</span>
<span class="sd">模型（Callable）：用于优化的模块/函数</span>
<span class="sd">fullgraph（布尔值）：如果为 False（默认），torch.compile 将尝试发现可编译的区域</span>
<span class="sd">在它将优化的函数中。如果为 True，则我们要求整个函数</span>
<span class="sd">可捕捉成一个单一图。如果这不可能（即存在图断裂），</span>
<span class="sd">则会引发错误。</span>
<span class="sd">动态（bool 或 None）：使用动态形状跟踪。当此值为 True 时，我们将提前尝试</span>
<span class="sd">生成尽可能动态的内核，以避免在重新编译时</span>
<span class="sd">尺寸发生变化。这不一定总是有效，因为某些操作/优化可能不会</span>
<span class="sd">强制专业化；使用 TORCH_LOGS=dynamic 来调试过度专业化。</span>
<span class="sd">当此值为 False 时，我们永远不会生成动态内核，我们总是专业化。</span>
<span class="sd">默认情况下（None），我们会自动检测是否发生了动态性，并编译更</span>
<span class="sd">重新编译时的动态内核。</span>
<span class="sd">backend (str 或 Callable)：要使用的后端。</span>

<span class="sd">- "电感器" 是默认的后端，它在性能和开销之间取得了良好的平衡。</span>

<span class="sd">- 非实验性树内后端可以通过 `torch._dynamo.list_backends()` 查看</span>

<span class="sd">- 实验性或调试树内后端可以通过 `torch._dynamo.list_backends(None)` 查看</span>

<span class="sd">- 要注册树外自定义后端：</span>
<span class="sd">          https://maskerprc.github.io/docs/main/torch.compiler_custom_backends.html#registering-custom-backends</span>
<span class="sd">模式 (str): 可以是 "default", "reduce-overhead", "max-autotune" 或 "max-autotune-no-cudagraphs"</span>

<span class="sd">- “default” 是默认模式，它在性能和开销之间取得了良好的平衡</span>

<span class="sd">- “reduce-overhead” 是一种减少 Python 使用 CUDA 图形开销的模式</span>
<span class="sd">- 对于小批量来说很有用。减少开销可能会以增加内存使用为代价</span>
<span class="sd">- 因为我们将缓存调用所需的工作空间内存，所以可能会增加内存使用</span>
<span class="sd">不必在后续运行中重新分配它。减少开销并不保证</span>
<span class="sd">以工作；今天，我们只为不改变输入的 CUDA 图减少开销。</span>
<span class="sd">还有一些情况下 CUDA 图不适用；使用 TORCH_LOG=perf_hints 进行调试。</span>
<span class="sd">。</span>

<span class="sd">- "max-autotune" 是一种利用 Triton 或模板矩阵乘法的模式</span>
<span class="sd">在支持的设备和基于 Triton 的 GPU 卷积上。</span>
<span class="sd">默认情况下，在 GPU 上启用 CUDA 图。</span>

<span class="sd">- "max-autotune-no-cudagraphs" 是一种类似于 "max-autotune" 的模式，但没有 CUDA 图表</span>

<span class="sd">- 要查看每个模式设置的精确配置，可以调用 `torch._inductor.list_mode_options()`</span>

<span class="sd">options (dict): 要传递给后端的选项字典。一些值得尝试的选项包括</span>

<span class="sd">- `epilogue_fusion`，它将点操作融合到模板中。需要同时设置 `max_autotune`</span>

<span class="sd">- `max_autotune`，它将进行性能分析以选择最佳的矩阵乘法配置</span>

<span class="sd">- `fallback_random`，在调试准确性问题时很有用</span>

<span class="sd">- `shape_padding`，用于填充矩阵形状，以便更好地在 GPU 上对齐负载，特别是对于张量核心</span>

<span class="sd">- `triton.cudagraphs`，将减少 Python 与 CUDA 图的开销</span>

<span class="sd">- `trace.enabled`，这是最有用的调试标志之一，可以打开</span>

<span class="sd">- `trace.graph_diagram` 将显示融合后的图形</span>

<span class="sd">- 对于电感器，您可以通过调用 `torch._inductor.list_options()` 来查看它支持的全部配置列表</span>
<span class="sd">disable (bool): 将 torch.compile() 转换为无操作以进行测试</span>

<span class="sd">示例::</span>

<span class="sd">        @torch.compile(options={"triton.cudagraphs": True}, fullgraph=True)</span>
<span class="sd">        def foo(x):</span>
<span class="sd">            return torch.sin(x) + torch.cos(x)</span>

<span class="sd">    """</span>
    <span class="kn">导入</span> <span class="nn">sysconfig</span>

    <span class="n">_C</span><span class="o">.</span><span class="n">_log_api_usage_once</span><span class="p">(</span><span class="s2">torch.compile</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</font></font></font></span><span class="o">.</span><span class="n">version_info</span> <span class="o"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">≥</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span>
        <span class="k">抛出</font></font></font></span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"torch.compile 不支持 Python 3.14+"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_var</span><span class="p">(</span><span class="s2">"禁用 Py_GIL"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">"不支持在禁用 GIL 的 Python 上使用 torch.compile"</span>
        <span class="p">)</span>

    <span class="c1"># 装饰器模式</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>

        <span class="k">定义</font></font></font></span> <span class="nf">fn</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">输入 T</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回 T</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</span>
            <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模型</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
                <span class="k">抛出</font></font></font></span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"模型不能为空"</span><span class="p">)</span>
            <span class="k">返回</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译</span><span class="p">(</span>
                <span class="n">模型</span><span class="p">,</span>
                <span class="n">全图</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全图</span><span class="p">,</span>
                <span class="n">动态</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">,</span>
                <span class="n">后端</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">,</span>
                <span class="n">模式</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</span><span class="p">,</span>
                <span class="n">选项</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</span><span class="p">,</span>
                <span class="n">禁用</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">禁用</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">返回</span> <span class="n">fn</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">"可以指定模式或选项，但不能同时指定两者。"</span>
        <span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无。</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">以及</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
        <span class="n">模式</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">"默认"</span>

    <span class="kn">from</span> <span class="nn">torch._inductor.编译器二分器</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器二分器</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二分查找后端</font></font></font></span> <span class="o">:=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器二分器</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取后端</span><span class="p">():</span>
        <span class="n">后端</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">二分查找后端</span>

    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">电感器</span><span class="p">:</span>
        <span class="n">后端</font></font></font></span> <span class="o">=</span> <span class="n">_TorchCompileInductorWrapper</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">)</span>
    <span class="k">否则</span><span class="p">:</span>
        <span class="n">后端</font></font></font></span> <span class="o">=</span> <span class="n">_TorchCompileWrapper</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">选项</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">)</span>

    <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n">_dynamo</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">优化</span><span class="p">(</span>
        <span class="n">后端</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</span><span class="p">,</span>
        <span class="n">无 Python</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">全图</span><span class="p">,</span>
        <span class="n">动态</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">动态</span><span class="p">,</span>
        <span class="n">禁用</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">禁用</span><span class="p">,</span>
    <span class="p">)(</span><span class="n">模型</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]</span></div>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册设备模块</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">注册特定 :attr:`设备类型` 的外部运行时模块</span>
<span class="sd">支持由 torch 提供。</span>

<span class="sd">在正确注册`:attr:`module`之后，用户可以引用</span>
<span class="sd">外部运行时模块作为 torch 的一部分，使用属性 torch.xxx 进行引用。</span>
<span class="sd">    """</span>
    <span class="c1">确保 device_type 代表 torch 支持的设备类型。</span>
    <span class="n">设备类型</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</font></font></font></span><span class="p">)</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>
    <span class="k">如果</font></font></font></span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">有属性</font></font></font></span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</span><span class="p">):</span>
        <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"运行时模块的 '"</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> 已经被注册了 </span>
            <span class="sa">f</span><span class="s2">"注册在 '"</font></font></font></span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</font></font></font></span><span class="p">)</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  "> </span>
        <span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">设备类型</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span><span class="p">)</span>
    <span class="n">火炬模块名称</font></font></font></span> <span class="o">=</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“。”</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">连接</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="vm">__name__</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备类型</span><span class="p">])</span>
    <span class="n">系统模块</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</font></font></font></span><span class="p">[</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬模块名称</font></font></font></span><span class="p">]</span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">模块</span>


<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="p">(</span>
    <span class="n">导出</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导出</span><span class="p">,</span>
    <span class="n">函数</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">函数</span><span class="p">,</span>
    <span class="n">库</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">图书馆</span><span class="p">,</span>
    <span class="n">返回类型</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">返回类型</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">torch._高阶操作</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n">cond</span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">条件</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">while 循环</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">while 循环</span>
<span class="kn">from</span> <span class="nn">torch.func</span> <span class="kn">导入</span> <span class="n">vmap</span> <span class="k">as</span> <span class="n">vmap</span>


<span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_元注册</span>

<span class="c1"># 启用 CUDA 检查器</span>
<span class="k">如果</font></font></font></span> <span class="s2">"TORCH_CUDA_SANITIZER"</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">环境</span><span class="p">:</span>
    <span class="kn">导入</span> <span class="nn">torch.cuda._sanitizer</span> <span class="k">as</span> <span class="nn">csan</span>

    <span class="n">csan</span><span class="o">.</span><span class="n">enable_cuda_sanitizer</span><span class="p">()</span>

<span class="c1">在 SymInt 和 SymFloat 上填充魔法方法</span>
<span class="kn">导入</span> <span class="nn">torch.fx.experimental.sym_node</span>
<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">fx</span> <span class="k">as</span> <span class="n">fx</span>


<span class="c1"># 注册 MPS 特定分解</span>
<span class="n">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">会员</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_初始化</span><span class="p">()</span>

<span class="k">如果</font></font></font></span> <span class="ow">not</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_运行时使用部署</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">编译器</span>

    <span class="k">类</font></font></font></span> <span class="nc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">三叉戟库</span><span class="p">:</span>
        <span class="n">库</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">图书馆</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">库</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">triton</span><span class="p">,</span> <span class="s2">"DEF"</span><span class="p">)</span>
        <span class="n">操作表</font></font></font></span><span class="p">:</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">字典</font></font></font></span><span class="p">[</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">元组</font></font></font></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">]</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可调用</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nd">@classmethod</span>
        <span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">注册操作</font></font></font></span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">完整模式</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 实现</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分发键</span><span class="p">):</span>
            <span class="k">如果</font></font></font></span> <span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分发键</font></font></font></span><span class="p">)</span> <span class="ow">not</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="bp">cls</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作表</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">库</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">定义</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">完整模式</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">库</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">实现</font></font></font></span><span class="p">(</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">triton::</font></font></font></span> <span class="o">+</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 实现</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分发键</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">操作表</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分发键</span><span class="p">)]</span> <span class="o">=</span> <span class="n">op_impl</span>

            <span class="k">返回</font></font></font></span> <span class="bp">cls</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">操作表</font></font></font></span><span class="p"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">[</font></font></font></span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">op 键</font></font></font></span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">分发键</span><span class="p">)]</span>


<span class="c1"># 已废弃属性</span>
<span class="n">_已废弃属性</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"具有_mps"</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">会员</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否构建</span><span class="p">,</span>
    <span class="s2">has_cuda</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否构建</span><span class="p">,</span>
    <span class="s2">具有 cudnn</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否可用</span><span class="p">,</span>
    <span class="s2">支持 mkldnn</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端</font></font></font></span><span class="o">.</span><span class="n">mkldnn</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是否可用</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">类型检查</span><span class="p">:</span>
    <span class="c1"># 在类型检查期间导入以下模块以启用代码智能功能，</span>
    <span class="c1"># 例如在 pylance 等工具中的自动补全，即使这些模块没有明确地</span>
    <span class="c1"># imported in user code.</span>
    <span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="p">(</span>
        <span class="n">_dynamo</span> <span class="k">as</span> <span class="n">_dynamo</span><span class="p">,</span>
        <span class="n">_inductor</span> <span class="k">as</span> <span class="n">电磁感抗</span><span class="p">,</span>
        <span class="n">子类</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">子类</span><span class="p">,</span>
        <span class="n">onnx</span> <span class="k">as</span> <span class="n">onnx</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">否则</span><span class="p">:</span>
    <span class="n">_lazy_modules</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">_dynamo</span><span class="p">,</span>
        <span class="s2">_inductor</span><span class="p">,</span>
        <span class="s2">导出</span><span class="p">,</span>
        <span class="c1"># ONNX 必须在导入_dynamo, _ops, _subclasses, fx, func 和 jit 之后</span>
        <span class="s2">onnx</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">定义</font></font></font></span> <span class="fm">__getattr__</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">):</span>
        <span class="c1">已弃用属性</span>
        <span class="n">替代方案</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_已弃用属性</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="p">)</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替代方案</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</font></font></font></span> <span class="ow">not</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">:</span>
            <span class="kn">导入</font></font></font></span> <span class="nn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span>

            <span class="n">警告</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">警告</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">''</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">'已弃用，请使用 '</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替换</font></font></font></span><span class="o">.</span><span class="vm"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">__模块__</font></font></font></span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替换</font></font></font></span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">（）''</span><span class="p">,</span>
                <span class="n">栈级别</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">替换</span><span class="p">()</span>

        <span class="c1">懒加载模块</span>
        <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_懒加载模块</span><span class="p">:</span>
            <span class="k">返回</font></font></font></span> <span class="n">importlib</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入模块</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“。”</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>

        <span class="k">抛出</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">属性错误</font></font></font></span><span class="p">(</span><span class="sa">f</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“模块”</font></font></font></span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“没有属性”</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">姓名</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">“”</span><span class="p">)</span>


<div class="viewcode-block" id="get_device_module"><font class=" " lang="zh-CN"><br hidden=""><font class="    "><font class="  ">[文档]def get_device_module(device: _Optional[_Union[torch.device, str]] = None):
"""
返回与指定设备关联的模块（例如，torch.device('cuda')，"mtia:0"，"xpu"，...）。
如果未指定设备，则返回当前加速器或不存在时返回 CPU 的模块。
"""
如果 device 是 torch.device 类型：
device_module_name = device.type
elif isinstance(device, str):
device_module_name = torch.device(device).type
elif device is None:
# 使用默认加速器类型。如果没有可用的加速器，它将自动返回 CPU 设备。
device_module_name = torch._C._get_accelerator().type
else:
raise RuntimeError(
f"设备'{device}'的值无效，预期 torch.device、str 或 None"
        )
device_module = getattr(torch, device_module_name, None)
if device_module is None:
raise RuntimeError(
f"设备 '{device_module_name}' 未注册为 'torch.{device_module_name}' 的对应模块。"
        )
返回设备模块</font></font></font></div>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">限制为大小</span><span class="p">(</span>
    <span class="n">符号</span><span class="p">,</span>
    <span class="nb">最小值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
    <span class="nb">最大值</font></font></font></span><span class="p">:</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">可选</font></font></font></span><span class="p">[</span><span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">无</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">这表示给定的整数具有大小属性，可以在任何需要大小的上下文中使用。</span>
<span class="sd">您通常会在从张量中读取整数时使用它，例如 max.item() 或 lengths.tolist()。</span>
<span class="sd">然后需要将这些断言用作张量构造函数。将这些断言提供给 PyTorch 可以帮助在导出时解决 GuardOnDataDependentSymNode 错误，因为我们无法对未备份的 SymInts 进行保护。</span>
<span class="sd">导出时出现 GuardOnDataDependentSymNode 错误，因为我们无法在未备份的 SymInts 上进行保护。</span>

<span class="sd">在某些情况下，此函数在框架中具有不寻常的语义。</span>
<span class="sd">在代码中，我们将这个整型视为 &gt;= 2（当我们执行一个大小无关的守卫时）。</span>
<span class="sd">这使得在大小上下文中使用无背存储的整型更加方便，</span>
<span class="sd">因为我们经常尝试在大小为零/一时进行守卫。</span>
<span class="sd">（例如，在计算张量的连续性或测试广播是否可以发生时），这不会在未备份的 SymInts 上工作。</span>
<span class="sd">然而，如果我们保守地假设大小不是零/一，我们最终会得到一个即使大小是零/一也能正常工作的图。</span>
<span class="sd">然而，如果我们保守地假设大小不是零/一，我们最终会得到一个即使大小是零/一也能正常工作的图。</span>
<span class="sd">然而，如果我们保守地假设大小不是零/一，我们最终会得到一个即使大小是零/一也能正常工作的图。</span>

<span class="sd">更多详情请参阅 https://docs.google.com/document/d/1HSuTTVvYH1pTew89Rtpeu84Ht3nQEFTYhAX3Ypa_xJs/edit</span>
<span class="sd">    ```</span>
<span class="sd">    """</span>
    <span class="n">PyTorch</font></font></font></span><span class="o">.</span><span class="n">sym_constrain_range_for_size</span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">符号</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小值</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最小值</font></font></font></span><span class="p">,</span> <span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</font></font></font></span><span class="o">=</span><span class="nb"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">最大值</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">火炬</font></font></font></span> <span class="kn"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">导入</span> <span class="n">_logging</span>


<span class="n">_日志记录</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_初始化日志</span><span class="p">()</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">_导入设备后端</span><span class="p">():</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">利用 Python 插件机制加载树外设备扩展。</span>
<span class="sd">请参阅此 RFC：https://github.com/pytorch/pytorch/issues/122468</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">importlib.metadata</span> <span class="kn">导入</span> <span class="n">entry_points</span>

    <span class="n">group_name</span> <span class="o">=</span> <span class="s2">torch 后端</span>
    <span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">系统模块</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">后端扩展</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">入口点</font></font></font></span><span class="p">()</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">群组名称</span><span class="p">,</span> <span class="p">())</span>
    <span class="k">否则</span><span class="p">:</span>
        <span class="n">后端扩展</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">入口点</font></font></font></span><span class="p">(</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">组</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">群组名称</span><span class="p">)</span>

    <span class="k">对于</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端扩展</font></font></font></span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">进入</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端扩展</span><span class="p">:</span>
        <span class="k">尝试</span><span class="p">:</span>
            <span class="c1">加载扩展</span>
            <span class="n">入口</font></font></font></span> <span class="o">=</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端扩展</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">加载</span><span class="p">()</span>
            <span class="c1">调用入口点</span>
            <span class="n">入口</span><span class="p">()</span>
        <span class="k">除了</font></font></font></span> <span class="ne"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">异常</font></font></font></span> <span class="k">as</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">错误</span><span class="p">:</span>
            <span class="k">抛出</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"加载后端扩展失败："</font></font></font></span><span class="si">{</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">后端扩展</font></font></font></span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">名称</font></font></font></span><span class="si">}</span><span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">. </span>
                <span class="sa">f</span><span class="s2">"您可以通过设置 TORCH_DEVICE_BACKEND_AUTOLOAD=0 来禁用扩展自动加载。"</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">错误</span>


<span class="k">定义</font></font></font></span> <span class="nf"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备后端自动加载已启用</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">是否启用了自动加载树外设备扩展。</span>
<span class="sd">该开关取决于环境变量的值。</span>
<span class="sd">`TORCH_DEVICE_BACKEND_AUTOLOAD`</span>

<span class="sd">返回值：</span>
<span class="sd">bool：是否启用自动加载扩展。默认启用。</span>

<span class="sd">示例：</span>
<span class="sd">        &gt;&gt;&gt; torch._is_device_backend_autoload_enabled()</span>
<span class="sd">        True</span>
<span class="sd">    """</span>
    <span class="c1">默认启用</span>
    <span class="k">返回</font></font></font></span> <span class="n">os</span><span class="o">.</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">获取环境变量</font></font></font></span><span class="p">(</span><span class="s2">"TORCH_DEVICE_BACKEND_AUTOLOAD"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">)</span> <span class="o">==</span> <span class="s2"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">1</span>


<span class="k">定义</span> <span class="nf">_as_tensor_fullprec</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">""</span>
<span class="sd">与 torch.as_tensor 类似，但给定 Python 数据类型时，它会保持</span>
<span class="sd">全精度。用于 Dynamo 的调用约定。</span>
<span class="sd">    """</span>
    <span class="n">ty</span> <span class="o">=</span> <span class="nb">类型</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">如果</font></font></font></span> <span class="n">ty</span> <span class="ow"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">是</span> <span class="n">builtins</span><span class="o">.</span><span class="n">float</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ty</span> <span class="ow">是</span> <span class="n">builtins</span><span class="o">.</span><span class="n">int</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</font></font></font></span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">数据类型</font></font></font></span><span class="o">=</span><span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">PyTorch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="k">否则</span><span class="p">:</span>
        <span class="k">返回</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">火炬</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="c1">`_import_device_backends` 应该放在最后，以确保</span>
<span class="c1"># 本模块中可能被其他所有函数访问的</span>
<span class="c1">自动加载的后端被定义</span>
<span class="k">如果</font></font></font></span> <span class="n"><font class=" " lang="zh-CN"><br hidden=""><font class="   "><font class="  ">设备后端自动加载已启用</span><span class="p">():</span>
    <span class="n">_导入设备后端</span><span class="p">()</span>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>© 版权所有 PyTorch 贡献者。</p>
  </div>
    
      <div>使用 Sphinx 构建，并使用 Read the Docs 提供的主题。</div>
     

</footer>

          </div>
<script>

var match = window.location.href.match(/\/_[a-zA-Z0-9_]*.html|_dynamo/gi);
var url = window.location.href.lastIndexOf(match[match.length-1]);

if (url)
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-exclamation-circle" aria-hidden="true">&nbsp</i> This page describes an internal API which is not intended to be used outside of the PyTorch codebase and can be modified or removed without notice.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              
            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/clipboard.min.js"></script>
         <script src="../_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script="" type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0">


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>文档</h2>
          <p>PyTorch 的全面开发者文档</p>
          <a class="with-right-arrow" href="https://maskerprc.github.io/docs/stable/index.html">查看文档</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>教程</h2>
          <p>深入了解初学者和高级开发者的教程</p>
          <a class="with-right-arrow" href="https://maskerprc.github.io/tutorials">查看教程</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>资源</h2>
          <p>查找开发资源，获取您的疑问解答</p>
          <a class="with-right-arrow" href="https://maskerprc.github.io/resources">查看资源</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://maskerprc.github.io/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://maskerprc.github.io/">PyTorch</a></li>
            <li><a href="https://maskerprc.github.io/get-started">开始使用</a></li>
            <li><a href="https://maskerprc.github.io/features">功能</a></li>
            <li><a href="https://maskerprc.github.io/ecosystem">生态系统</a></li>
            <li><a href="https://maskerprc.github.io/blog/">博客</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">贡献</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://maskerprc.github.io/resources">资源</a></li>
            <li><a href="https://maskerprc.github.io/tutorials">教程</a></li>
            <li><a href="https://maskerprc.github.io/docs/stable/index.html">文档</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">讨论</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github 问题</a></li>
            <li><a href="https://maskerprc.github.io/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">品牌指南</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">保持更新</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">脸书</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">推特</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">领英</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch 播客</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">苹果</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">谷歌</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">亚马逊</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">条款</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">隐私</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© 版权所有 Linux 基金会。PyTorch 基金会是 Linux 基金会的一个项目。有关 PyTorch 基金会的网站使用条款、商标政策以及其他适用政策，请参阅 www.linuxfoundation.org/policies/。PyTorch 基金会支持 PyTorch 开源项目，该项目已被确立为 LF Projects, LLC 的 PyTorch 项目系列。有关适用于 PyTorch 项目系列 LF Projects, LLC 的政策，请参阅 www.lfprojects.org/policies/。</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">为了分析流量并优化您的体验，我们在本网站上使用 cookies。通过点击或导航，您同意允许我们使用 cookies。作为本网站的当前维护者，适用 Facebook 的 Cookies 政策。了解更多信息，包括关于可用控制的信息：Cookies 政策。</p>
    <img class="close-button" src="../_static/images/pytorch-x.svg" width="16" height="16">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://maskerprc.github.io/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>学习</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://maskerprc.github.io/get-started">开始使用</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/tutorials">教程</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/tutorials/beginner/basics/intro.html">学习基础知识</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/tutorials/recipes/recipes_index.html">PyTorch 食谱</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/tutorials/beginner/introyt.html">PyTorch 入门 - YouTube 系列</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>生态系统</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://maskerprc.github.io/ecosystem">工具</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/#community-module">社区</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">论坛</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/resources">开发者资源</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/ecosystem/contributor-awards-2023">贡献者奖项 - 2024</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Edge</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://maskerprc.github.io/edge">关于 PyTorch Edge</a>
             </li>
             
             <li>
               <a href="https://maskerprc.github.io/executorch-overview">执行火炬</a>
             </li>
             <li>
               <a href="https://maskerprc.github.io/executorch/stable/index.html">ExecuTorch 文档</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>文档</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://maskerprc.github.io/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://maskerprc.github.io/pytorch-domains">PyTorch 领域</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>博客 &amp; 新闻</a>
          </li>
            
           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://maskerprc.github.io/blog/">PyTorch 博客</a>
            </li>
            <li>
              <a href="https://maskerprc.github.io/community-blog">社区博客</a>
            </li>

            <li>
              <a href="https://maskerprc.github.io/videos">视频</a>
            </li>

            <li>
              <a href="https://maskerprc.github.io/community-stories">社区故事</a>
            </li>
            <li>
              <a href="https://maskerprc.github.io/events">活动</a>
            </li>
            <li>
               <a href="https://maskerprc.github.io/newsletter">新闻简报</a>
             </li>
          </ul>
          
          <li class="resources-mobile-menu-title">
            <a>关于</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://maskerprc.github.io/foundation">PyTorch 基金会</a>
            </li>
            <li>
              <a href="https://maskerprc.github.io/governing-board">治理委员会</a>
            </li>
            <li>
               <a href="https://maskerprc.github.io/credits">云信用计划</a>
            </li>
            <li>
               <a href="https://maskerprc.github.io/tac">技术咨询委员会</a>
            </li>
            <li>
               <a href="https://maskerprc.github.io/staff">员工</a>
            </li>
            <li>
               <a href="https://maskerprc.github.io/contact-us">联系我们</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

</body></html>