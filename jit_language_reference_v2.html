<!DOCTYPE html>
<html lang="zh_CN">
<head>
  <meta charset="UTF-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TorchScript Language Reference — PyTorch main documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/jit_language_reference_v2.html">
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css">
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="_static/pygments.css" type="text/css">
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css">
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" type="text/css">
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css">
  <link rel="stylesheet" href="_static/sphinx-dropdown.css" type="text/css">
  <link rel="stylesheet" href="_static/panels-bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="_static/css/jit.css" type="text/css">
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css">
    <link rel="index" title="Index" href="genindex.html">
    <link rel="search" title="Search" href="search.html">
    <link rel="next" title="torch.jit.script" href="generated/torch.jit.script.html">
    <link rel="prev" title="TorchScript Language Reference" href="jit_language_reference.html">

<!--
  Search engines should not index the main version of documentation.
  Stable documentation are built without release == 'main'.
-->
<meta name="robots" content="noindex">


  <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T8XT4PS');</script>
    <!-- End Google Tag Manager -->
  


  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head><body class="pytorch-body"><div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>

          <li class="main-menu-item">
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">学习</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/get-started">
                  <span class="dropdown-title">开始使用</span>
                  <p>在本地运行 PyTorch 或快速开始使用支持的云平台之一</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials">
                  <span class="dropdown-title">教程</span><p></p>
                  <p>PyTorch 教程中的新内容</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/basics/intro.html">
                  <span class="dropdown-title">学习基础知识</span><p></p>
                  <p>熟悉 PyTorch 的概念和模块</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/recipes/recipes_index.html">
                  <span class="dropdown-title">PyTorch 食谱</span><p></p>
                  <p>精简版、可直接部署的 PyTorch 代码示例</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/introyt.html">
                  <span class="dropdown-title">PyTorch 入门 - YouTube 系列</span><p></p>
                  <p>通过我们引人入胜的 YouTube 教程系列掌握 PyTorch 基础知识</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">生态系统</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class="dropdown-title">工具</span><p></p>
                  <p>了解 PyTorch 生态系统中的工具和框架</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">社区</span>
                  <p>加入 PyTorch 开发者社区，贡献、学习并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">论坛</span>
                  <p>讨论 PyTorch 代码、问题、安装、研究的地方</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">开发者资源</span>
                  <p>查找资源并获得问题解答</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem/contributor-awards-2024">
                  <span class="dropdown-title">贡献者奖项 - 2024</span><p></p>
                  <p>本届 PyTorch 会议揭晓获奖者</p>
                </a>
              </div>
            </div>
          </li>

          <li>
          <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">
                Edge
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/edge">
                  <span class="dropdown-title">关于 PyTorch Edge</span><p></p>
                  <p>为边缘设备构建创新和隐私感知的 AI 体验</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch-overview">
                  <span class="dropdown-title">ExecuTorch</span><p></p>
                  <p>基于移动和边缘设备的端到端推理能力解决方案</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/executorch/stable/index.html">
                  <span class="dropdown-title">ExecuTorch 文档</span><p></p>
                </a>
              </div>
            </div>  
          </li>

          <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">文档</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span><p></p>
                  <p>探索文档以获取全面指导，了解如何使用 PyTorch</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/pytorch-domains">
                  <span class="dropdown-title">PyTorch 领域</span><p></p>
                  <p>阅读 PyTorch 领域的文档，了解更多关于特定领域库的信息</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">博客与新闻</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/blog/">
                  <span class="dropdown-title">PyTorch 博客</span><p></p>
                  <p>捕捉最新的技术新闻和事件</p>
                </a>
                 <a class="nav-dropdown-item" href="https://pytorch.org/community-blog">
                  <span class="dropdown-title">社区博客</span><p></p>
                  <p>PyTorch 生态系统故事</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/videos">
                  <span class="dropdown-title">视频</span><p></p>
                  <p>了解最新的 PyTorch 教程、新内容等</p>
                </a><a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                  <span class="dropdown-title">社区故事</span><p></p>
                  <p>学习如何我们的社区使用 PyTorch 解决真实、日常的机器学习问题</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/events">
                  <span class="dropdown-title">活动</span><p></p>
                  <p>查找活动、网络研讨会和播客</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/newsletter">
                  <span class="dropdown-title">通讯</span><p></p>
                  <p>跟踪最新更新</p>
                </a>
            </div>
          </div></li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="with-down-arrow">关于</a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                  <span class="dropdown-title">PyTorch 基金会</span><p></p>
                  <p>了解更多关于 PyTorch 基金会的信息</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/governing-board">
                  <span class="dropdown-title">管理委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/credits">
                  <span class="dropdown-title">云信用计划</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/tac">
                  <span class="dropdown-title">技术顾问委员会</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/staff">
                  <span class="dropdown-title">员工</span><p></p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/contact-us">
                  <span class="dropdown-title">联系我们</span><p></p>
                </a>
              </div>
            </div>
          </li>

          <li class="main-menu-item">
            <div class="no-dropdown">
              <a href="https://pytorch.org/join" data-cta="join">成为会员</a>
            </div>
          </li>
          <li>
           <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="github-icon">
             </a>
           </div>
          </li>
          <!--- TODO: This block adds the search icon to the nav bar. We will enable it later. 
          <li>
            <div class="main-menu-item">
             <a href="https://github.com/pytorch/pytorch" class="search-icon">
             </a>
            </div>
          </li>
          --->
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>



   

    

    <div class="table-of-contents-link-wrapper">
      <span>目录</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href="https://pytorch.org/docs/versions.html">主程序 (2.7.0+cpu ) ▼</a>
    </div>
    <div id="searchBox">
    <div class="searchbox" id="googleSearchBox">
      <script async="" src="https://cse.google.com/cse.js?cx=e65585f8c3ea1440e"></script>
      <div class="gcse-search"></div>
    </div>
    <div id="sphinxSearchBox" style="display: none;">
      <div role="search">
        <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
          <input type="text" name="q" placeholder="Search Docs">
          <input type="hidden" name="check_keywords" value="yes">
          <input type="hidden" name="area" value="default">
        </form>
      </div>
    </div>
  </div>
  <form id="searchForm">
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="google" checked="">谷歌搜索</label>
    <label style="margin-bottom: 1rem">
      <input type="radio" name="searchType" value="sphinx">经典搜索</label>
  </form>

  <script>
     document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('searchForm');
      const googleSearchBox = document.getElementById('googleSearchBox');
      const sphinxSearchBox = document.getElementById('sphinxSearchBox');
      // Function to toggle search box visibility
      function toggleSearchBox(searchType) {
        googleSearchBox.style.display = searchType === 'google' ? 'block' : 'none';
        sphinxSearchBox.style.display = searchType === 'sphinx' ? 'block' : 'none';
      }
      // Determine the default search type
      let defaultSearchType;
      const currentUrl = window.location.href;
      if (currentUrl.startsWith('https://pytorch.org/docs/stable')) {
        // For the stable documentation, default to Google
        defaultSearchType = localStorage.getItem('searchType') || 'google';
      } else {
        // For any other version, including docs-preview, default to Sphinx
        defaultSearchType = 'sphinx';
      }
      // Set the default search type
      document.querySelector(`input[name="searchType"][value="${defaultSearchType}"]`).checked = true;
      toggleSearchBox(defaultSearchType);
      // Event listener for changes in search type
      searchForm.addEventListener('change', function(event) {
        const selectedSearchType = event.target.value;
        localStorage.setItem('searchType', selectedSearchType);
        toggleSearchBox(selectedSearchType);
      });
      // Set placeholder text for Google search box
      window.onload = function() {
        var placeholderText = "Search Docs";
        var googleSearchboxText = document.querySelector("#gsc-i-id1");
        if (googleSearchboxText) {
          googleSearchboxText.placeholder = placeholderText;
          googleSearchboxText.style.fontFamily = 'FreightSans';
          googleSearchboxText.style.fontSize = "1.2rem";
          googleSearchboxText.style.color = '#262626';
        }
      };
    });
  </script>

          </div>

          

<div>
  <a style="color:#F05732" href="https://pytorch.org/docs/stable/jit_language_reference_v2.html">您正在查看不稳定开发者预览文档。请点击此处查看最新稳定版本的文档。</a>
</div>


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">社区</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/build_ci_governance.html">PyTorch 治理 | 构建 + CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch 贡献指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/design.html">PyTorch 设计哲学</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch 治理 | 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch 治理 | 维护者</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发者笔记</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/amp_examples.html">自动混合精度示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">广播语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU 多线程和 TorchScript 推理</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA 语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/custom_operators.html">PyTorch 自定义算子页面</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/ddp.html">分布式数据并行</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">扩展 PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.func.html">使用 autograd.Function 扩展 torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">常见问题解答</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/fsdp.html">FSDP 笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/get_start_xpu.html">在 Intel GPU 上入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/gradcheck.html">Gradcheck 机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/hip.html">HIP (ROCm)语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">大规模部署功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/libtorch_stable_abi.html">LibTorch 稳定 ABI</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/modules.html">模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/mps.html">MPS 后端</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">多进程最佳实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/numerical_accuracy.html">数值精度</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">可重现性</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">序列化语义</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows 常见问题解答</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">语言绑定</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">torch::deploy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">张量属性</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_view.html">张量视图</a></li>
<li class="toctree-l1"><a class="reference internal" href="amp.html">torch.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">torch.library</a></li>
<li class="toctree-l1"><a class="reference internal" href="accelerator.html">torch.accelerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpu.html">torch.cpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_cuda_memory.html">理解 CUDA 内存使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_cuda_memory.html#generating-a-snapshot">生成快照</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_cuda_memory.html#using-the-visualizer">使用可视化工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_cuda_memory.html#snapshot-api-reference">快照 API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="mps.html">torch.mps</a></li>
<li class="toctree-l1"><a class="reference internal" href="xpu.html">torch.xpu</a></li>
<li class="toctree-l1"><a class="reference internal" href="mtia.html">torch.mtia</a></li>
<li class="toctree-l1"><a class="reference internal" href="mtia.memory.html">torch.mtia.memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="meta.html">元设备</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="export.html">torch.export</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.tensor.html">torch.distributed.tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.algorithms.join.html">torch.distributed.algorithms.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.elastic.html">torch.distributed.elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="fsdp.html">torch.distributed.fsdp</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.fsdp.fully_shard.html">torch.distributed.fsdp.fully_shard</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.tensor.parallel.html">torch.distributed.tensor.parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.pipelining.html">torch.distributed.pipelining</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.checkpoint.html">torch.distributed.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.compiler.html">torch.compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="func.html">torch.func</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.experimental.html">torch.fx.experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitor.html">torch.monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal.html">torch.signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">torch.package</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.attention.html">torch.nn.attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_numbers.html">复数</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_comm_hooks.html">DDP 通信钩子</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">量化</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">分布式 RPC 框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="masked.html">torch.masked</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested.html">torch.nested</a></li>
<li class="toctree-l1"><a class="reference internal" href="size.html">torch.Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">torch.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">torch.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="deterministic.html">torch.utils.deterministic</a></li>
<li class="toctree-l1"><a class="reference internal" href="jit_utils.html">torch.utils.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="module_tracker.html">torch.utils.module_tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">类型信息</a></li>
<li class="toctree-l1"><a class="reference internal" href="named_tensor.html">命名张量</a></li>
<li class="toctree-l1"><a class="reference internal" href="name_inference.html">命名张量操作覆盖率</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_mod.html">torch.__config__</a></li>
<li class="toctree-l1"><a class="reference internal" href="future_mod.html">torch.__future__</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">torch._logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch_environment_variables.html">火炬环境变量</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">库</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/data">TorchData</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/torchrec">火炬推荐</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/xla/">PyTorch 在 XLA 设备上</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/ao">torchao</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        文档 &gt;</li>

        
          <li><a href="jit.html">TorchScript</a> &gt;</li>
        
      <li>TorchScript 语言参考</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/jit_language_reference_v2.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg" width="16" height="16"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">快捷键</div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        

          <!-- Google Tag Manager (noscript) -->
          <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8XT4PS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
          <!-- End Google Tag Manager (noscript) -->
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <section id="torchscript-language-reference">
<span id="language-reference-v2"></span><h1>TorchScript 语言参考手册</h1>
<p>本参考手册描述了 TorchScript 语言的语法和核心语义。TorchScript 是 Python 语言的一个静态类型子集。本文件解释了 TorchScript 中支持的 Python 特性以及该语言与常规 Python 的差异。本参考手册未提及的 Python 特性不属于 TorchScript。TorchScript 专注于 Python 中用于表示 PyTorch 神经网络模型的特性。</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#terminology" id="id7">术语</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id8">类型系统</a></p></li>
<li><p><a class="reference internal" href="#type-annotation" id="id9">类型注解</a></p></li>
<li><p><a class="reference internal" href="#expressions" id="id10">表达式</a></p></li>
<li><p><a class="reference internal" href="#simple-statements" id="id11">简单语句</a></p></li>
<li><p><a class="reference internal" href="#compound-statements" id="id12">复合语句</a></p></li>
<li><p><a class="reference internal" href="#python-values" id="id13">Python 值</a></p></li>
<li><p><a class="reference internal" href="#torch-apis" id="id14">torch.* API</a></p></li>
</ul>
</nav>
<section id="terminology">
<span id="type-system"></span><h2>术语 §</h2>
<p>本文档使用了以下术语：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>模式</p></th>
<th class="head"><p>笔记</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">::=</span></code></p></td>
<td><p>表示给定的符号被定义为。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">"</span> <span class="pre">"</span></code></p></td>
<td><p>代表语法中作为一部分的实关键词和分隔符。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">A</span> <span class="pre">|</span> <span class="pre">B</span></code></p></td>
<td><p>表示 A 或 B。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">(</span> <span class="pre">)</span></code></p></td>
<td><p>表示分组</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">[]</span></code></p></td>
<td><p>表示可选</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">A+</span></code></p></td>
<td><p>表示至少重复一次的术语 A 的正则表达式</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">A*</span></code></p></td>
<td><p>表示零次或多次重复的术语 A 的正则表达式</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id1">
<h2>类型系统 ¶</h2>
<p>TorchScript 是 Python 的静态类型子集。与完整的 Python 语言相比，TorchScript 的最大区别是它只支持用于表达神经网络模型所需的一小部分类型。</p>
<section id="torchscript-types">
<h3>TorchScript 类型 ¶</h3>
<p>TorchScript 类型系统由以下定义的 <code class="docutils literal "><span class="pre">TSType</span></code> 和 <code class="docutils literal "><span class="pre">TSModuleType</span></code> 组成。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSAllType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span>    <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>
</pre></div>
</div>
<p>表示大多数可组合且可用于 TorchScript 类型注解的 TorchScript 类型。 <code class="docutils literal "><span class="pre">TSType</span></code> 指的是以下任何一种：</p>
<ul class="simple">
<li><p>元类型，例如， <code class="docutils literal "><span class="pre">Any</span></code> </p></li>
<li><p>基本类型，例如， <code class="docutils literal "><span class="pre">int</span></code> ， <code class="docutils literal "><span class="pre">float</span></code> ，和 <code class="docutils literal "><span class="pre">str</span></code> </p></li>
<li><p>结构化类型，例如， <code class="docutils literal "><span class="pre">Optional[int]</span></code> 或 <code class="docutils literal "><span class="pre">List[MyClass]</span></code> </p></li>
<li><p>常量类型（Python 类），例如： <code class="docutils literal "><span class="pre">MyClass</span></code> （用户定义的）， <code class="docutils literal "><span class="pre">torch.tensor</span></code> （内置的）</p></li>
</ul>
<p> <code class="docutils literal "><span class="pre">TSModuleType</span></code> 代表 <code class="docutils literal "><span class="pre">torch.nn.Module</span></code> 及其子类。由于其类型模式部分从对象实例和部分从类定义中推断，因此它与 <code class="docutils literal "><span class="pre">TSType</span></code> 处理方式不同。 <code class="docutils literal "><span class="pre">TSModuleType</span></code> 的实例可能不遵循相同的静态类型模式。 <code class="docutils literal "><span class="pre">TSModuleType</span></code> 不能用作 TorchScript 类型注解，也不能与 <code class="docutils literal "><span class="pre">TSType</span></code> 组合以考虑类型安全性。</p>
</section>
<section id="meta-types">
<h3>元类型</h3>
<p>元类型非常抽象，它们更像类型约束而不是具体类型。目前 TorchScript 定义了一个元类型 <code class="docutils literal "><span class="pre">Any</span></code> ，它代表任何 TorchScript 类型。</p>
<section id="any-type">
<h4> <code class="docutils literal "><span class="pre">Any</span></code> 类型 ¶</h4>
<p>The <code class="docutils literal "><span class="pre">Any</span></code> 类型表示任何 TorchScript 类型。 <code class="docutils literal "><span class="pre">Any</span></code> 指定没有类型约束，因此没有在 <code class="docutils literal "><span class="pre">Any</span></code> 上进行类型检查。因此，它可以绑定到任何 Python 或 TorchScript 数据类型（例如 <code class="docutils literal "><span class="pre">int</span></code> ，TorchScript <code class="docutils literal "><span class="pre">tuple</span></code> ，或任何未脚本化的任意 Python 类）。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSMetaType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"Any"</span>
</pre></div>
</div>
<p>其中：</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">Any</span></code> 是来自 typing 模块的 Python 类名。因此，要使用 <code class="docutils literal "><span class="pre">Any</span></code> 类型，您必须从 <code class="docutils literal "><span class="pre">typing</span></code> 导入它（例如 <code class="docutils literal "><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Any</span></code> ）。</p></li>
<li><p>由于 <code class="docutils literal "><span class="pre">Any</span></code> 可以表示任何 TorchScript 类型，因此可以在 <code class="docutils literal "><span class="pre">Any</span></code> 上操作此类型值的操作符集合受到限制。</p></li>
</ul>
</section>
<section id="operators-supported-for-any-type">
<h4>支持的 <code class="docutils literal "><span class="pre">Any</span></code> 类型操作符</h4>
<ul class="simple">
<li><p>将数据赋值给 <code class="docutils literal "><span class="pre">Any</span></code> 类型。</p></li>
<li><p>绑定到 <code class="docutils literal "><span class="pre">Any</span></code> 类型的参数或返回值。</p></li>
<li><p> <code class="docutils literal "><span class="pre">x</span> <span class="pre">is</span></code> ， <code class="docutils literal "><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span></code> 为 <code class="docutils literal "><span class="pre">x</span></code> 类型。</p></li>
<li><p> <code class="docutils literal "><span class="pre">isinstance(x,</span> <span class="pre">Type)</span></code> ，其中 <code class="docutils literal "><span class="pre">x</span></code> 为 <code class="docutils literal "><span class="pre">Any</span></code> 类型。</p></li>
<li><p> <code class="docutils literal "><span class="pre">Any</span></code> 类型的数据可打印。</p></li>
<li><p>如果数据是相同类型 <code class="docutils literal "><span class="pre">T</span></code> 的值列表且 <code class="docutils literal "><span class="pre">T</span></code> 支持比较运算符，则 <code class="docutils literal "><span class="pre">List[Any]</span></code> 类型的数据可能是可排序的。</p></li>
</ul>
<p><strong>与 Python 相比</strong></p>
<p>在 TorchScript 类型系统中， <code class="docutils literal "><span class="pre">Any</span></code> 是约束最少的类型。从这个意义上讲，它与 Python 中的 <code class="docutils literal "><span class="pre">Object</span></code> 类非常相似。然而， <code class="docutils literal "><span class="pre">Any</span></code> 只支持 <code class="docutils literal "><span class="pre">Object</span></code> 支持的子集运算符和方法。</p>
</section>
<section id="design-notes">
<h4>设计笔记</h4>
<p>当我们为 PyTorch 模块编写脚本时，可能会遇到不参与脚本执行的数据。尽管如此，这些数据必须由类型模式进行描述。在脚本上下文中描述未使用的数据的静态类型不仅麻烦，还可能导致不必要的脚本失败。 <code class="docutils literal "><span class="pre">Any</span></code> 的引入是为了描述数据类型，在编译过程中不需要精确的静态类型。</p>
<p><strong>示例 1</strong></p>
<p>本示例说明了如何使用 <code class="docutils literal "><span class="pre">Any</span></code> 允许元组的第二个参数为任何类型。这是因为 <code class="docutils literal "><span class="pre">x[1]</span></code> 不参与任何需要知道其确切类型的计算。</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">inc_first_element</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc_first_element</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,(</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">))))</span>
</pre></div>
</div>
<p>上面的示例生成了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>(2, 2.0)
(2, (100, 200))
</pre></div>
</div>
<p>元组的第二个元素为 <code class="docutils literal "><span class="pre">Any</span></code> 类型，因此可以绑定到多种类型。例如， <code class="docutils literal "><span class="pre">(1,</span> <span class="pre">2.0)</span></code> 将浮点类型绑定到 <code class="docutils literal "><span class="pre">Any</span></code> ，如 <code class="docutils literal "><span class="pre">Tuple[int,</span> <span class="pre">Any]</span></code> 所示，而在第二次调用中， <code class="docutils literal "><span class="pre">(1,</span> <span class="pre">(100,</span> <span class="pre">200))</span></code> 将元组绑定到 <code class="docutils literal "><span class="pre">Any</span></code> 。</p>
<p><strong>示例 2</strong></p>
<p>本示例说明了我们如何使用 <code class="docutils literal "><span class="pre">isinstance</span></code> 来动态检查标注为 <code class="docutils literal "><span class="pre">Any</span></code> 类型的数据类型：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Any</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">))</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">))</span>
</pre></div>
</div>
<p>上面的示例生成了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span> 1
 1
[ CPUFloatType{2} ]
True
</pre></div>
</div>
</section>
</section>
<section id="primitive-types">
<h3>基本类型 －</h3>
<p>原始的 TorchScript 类型是表示单一类型值的类型，并与其预定义的类型名称相对应。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"int"</span> <span class="o">|</span> <span class="s2">"float"</span> <span class="o">|</span> <span class="s2">"double"</span> <span class="o">|</span> <span class="s2">"complex"</span> <span class="o">|</span> <span class="s2">"bool"</span> <span class="o">|</span> <span class="s2">"str"</span> <span class="o">|</span> <span class="s2">"None"</span>
</pre></div>
</div>
</section>
<section id="structural-types">
<h3>结构化类型</h3>
<p>结构化类型是指没有用户定义名称的结构化定义的类型（与命名类型不同），例如 <code class="docutils literal "><span class="pre">Future[int]</span></code> 。结构化类型可以与任何 <code class="docutils literal "><span class="pre">TSType</span></code> 组合。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSStructuralType</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span>
                    <span class="n">TSOptional</span> <span class="o">|</span> <span class="n">TSUnion</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span> <span class="o">|</span> <span class="n">TSAwait</span>

<span class="n">TSTuple</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"Tuple"</span> <span class="s2">"["</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSNamedTuple</span>     <span class="p">:</span><span class="o">:=</span> <span class="s2">"namedtuple"</span> <span class="s2">"("</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">")"</span>
<span class="n">TSList</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">"List"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSOptional</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">"Optional"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSUnion</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"Union"</span> <span class="s2">"["</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSFuture</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">"Future"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSRRef</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">"RRef"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSAwait</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"Await"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSDict</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">"Dict"</span> <span class="s2">"["</span> <span class="n">KeyType</span> <span class="s2">","</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">KeyType</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"str"</span> <span class="o">|</span> <span class="s2">"int"</span> <span class="o">|</span> <span class="s2">"float"</span> <span class="o">|</span> <span class="s2">"bool"</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">"Any"</span>
</pre></div>
</div>
<p>位置：</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">Tuple</span></code> ， <code class="docutils literal "><span class="pre">List</span></code> ， <code class="docutils literal "><span class="pre">Optional</span></code> ， <code class="docutils literal "><span class="pre">Union</span></code> ， <code class="docutils literal "><span class="pre">Future</span></code> ， <code class="docutils literal "><span class="pre">Dict</span></code> 代表在模块 <code class="docutils literal "><span class="pre">typing</span></code> 中定义的 Python 类型类名。要使用这些类型名称，您必须从 <code class="docutils literal "><span class="pre">typing</span></code> 导入它们（例如， <code class="docutils literal "><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple</span></code> ）。</p></li>
<li><p> <code class="docutils literal "><span class="pre">namedtuple</span></code> 代表 Python 类 <code class="docutils literal "><span class="pre">collections.namedtuple</span></code> 或 <code class="docutils literal "><span class="pre">typing.NamedTuple</span></code> 。</p></li>
<li><p> <code class="docutils literal "><span class="pre">Future</span></code> 和 <code class="docutils literal "><span class="pre">RRef</span></code> 代表 Python 类 <code class="docutils literal "><span class="pre">torch.futures</span></code> 和 <code class="docutils literal "><span class="pre">torch.distributed.rpc</span></code> 。</p></li>
<li><p> <code class="docutils literal "><span class="pre">Await</span></code> 代表 Python 类 <code class="docutils literal "><span class="pre">torch._awaits._Await</span></code> </p></li>
</ul>
<p><strong>与 Python 相比</strong></p>
<p>除了与 TorchScript 类型可组合外，这些 TorchScript 结构类型通常支持其 Python 对应操作符和方法的一个公共子集。</p>
<p><strong>示例 1</strong></p>
<p>本示例使用 <code class="docutils literal "><span class="pre">typing.NamedTuple</span></code> 语法定义元组：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">MyTuple</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">first</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">second</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">MyTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">MyTuple</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scripted_inc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">,</span> <span class="n">scripted_inc</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
<p>上述示例生成了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>TorchScript: (2, 3)
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>本示例使用 <code class="docutils literal "><span class="pre">collections.namedtuple</span></code> 语法来定义元组：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">_AnnotatedNamedTuple</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">'_NamedTupleAnnotated'</span><span class="p">,</span> <span class="p">[(</span><span class="s1">'first'</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="s1">'second'</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<span class="n">_UnannotatedNamedTuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'_NamedTupleAnnotated'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'first'</span><span class="p">,</span> <span class="s1">'second'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">_AnnotatedNamedTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inc</span><span class="p">(</span><span class="n">_UnannotatedNamedTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>上述示例生成了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>(2, 3)
</pre></div>
</div>
<p><strong>示例 3</strong></p>
<p>本示例说明了注释结构类型时常见的错误，即没有从 <code class="docutils literal "><span class="pre">typing</span></code> 模块导入复合类型类：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># ERROR: Tuple not recognized because not imported from typing</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>运行上述代码会导致以下脚本错误：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">"test-tuple.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">'Tuple'</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
<p>解决方法是向代码开头添加行 <code class="docutils literal "><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple</span></code> 。</p>
</section>
<section id="nominal-types">
<h3>名义类型 ¶</h3>
<p>名义 TorchScript 类型是 Python 类。这些类型被称为名义类型，因为它们使用自定义名称声明，并且通过类名进行比较。名义类进一步分为以下几类：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSNominalType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
</pre></div>
</div>
<p>其中， <code class="docutils literal "><span class="pre">TSCustomClass</span></code> 和 <code class="docutils literal "><span class="pre">TSEnum</span></code> 必须可编译为 TorchScript 中间表示（IR）。这是由类型检查器强制执行的。</p>
</section>
<section id="built-in-class">
<h3>内置类 ¶</h3>
<p>内置名义类型是 Python 类，其语义被构建到 TorchScript 系统中（例如，张量类型）。TorchScript 定义了这些内置名义类型的语义，通常只支持其 Python 类定义中方法或属性的一个子集。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSBuiltinClass</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">"torch.device"</span> <span class="o">|</span> <span class="s2">"torch.Stream"</span> <span class="o">|</span> <span class="s2">"torch.dtype"</span> <span class="o">|</span>
                   <span class="s2">"torch.nn.ModuleList"</span> <span class="o">|</span> <span class="s2">"torch.nn.ModuleDict"</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">"torch.Tensor"</span> <span class="o">|</span> <span class="s2">"common.SubTensor"</span> <span class="o">|</span> <span class="s2">"common.SubWithTorchFunction"</span> <span class="o">|</span>
                   <span class="s2">"torch.nn.parameter.Parameter"</span> <span class="o">|</span> <span class="ow">and</span> <span class="n">subclasses</span> <span class="n">of</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</pre></div>
</div>
<section id="special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">
<h4>关于 torch.nn.ModuleList 和 torch.nn.ModuleDict 的特殊说明</h4>
<p>虽然 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 和 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 在 Python 中被定义为列表和字典，但在 TorchScript 中它们的行为更像元组：</p>
<ul class="simple">
<li><p>在 TorchScript 中， <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 或 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 的实例是不可变的。</p></li>
<li><p>代码遍历 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 或 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 将被完全展开，以便 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 或 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 的元素或键可以属于 <code class="docutils literal "><span class="pre">torch.nn.Module</span></code> 的不同子类。</p></li>
</ul>
<p><strong>示例</strong></p>
<p>以下示例突出了几个内置 Torchscript 类的使用（ <code class="docutils literal "><span class="pre">torch.*</span></code> ）：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">))</span>

<span class="n">script_g</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">script_g</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-class">
<h3>自定义类 ¶</h3>
<p>与内置类不同，自定义类的语义由用户定义，整个类定义必须可编译为 TorchScript IR，并受 TorchScript 类型检查规则的约束。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSClassDef</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span> <span class="s2">"@torch.jit.script"</span> <span class="p">]</span>
                 <span class="s2">"class"</span> <span class="n">ClassName</span> <span class="p">[</span> <span class="s2">"(object)"</span> <span class="p">]</span>  <span class="s2">":"</span>
                    <span class="n">MethodDefinition</span> <span class="o">|</span>
                <span class="p">[</span> <span class="s2">"@torch.jit.ignore"</span> <span class="p">]</span> <span class="o">|</span> <span class="p">[</span> <span class="s2">"@torch.jit.unused"</span> <span class="p">]</span>
                    <span class="n">MethodDefinition</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p>类必须是新式类。Python 3 只支持新式类。在 Python 2.x 中，新式类通过从 object 继承来指定。</p></li>
<li><p>实例数据属性是静态类型的，并且实例属性必须在 <code class="docutils literal "><span class="pre">__init__()</span></code> 方法内部的赋值语句中声明。</p></li>
<li><p>不支持方法重载（即不能有多个具有相同方法名的函数）。</p></li>
<li><p>必须可编译为 TorchScript IR 并遵循 TorchScript 的类型检查规则（即所有方法都必须是有效的 TorchScript 函数，类属性定义也必须是有效的 TorchScript 语句）。</p></li>
<li><p>可以使用 <code class="docutils literal "><span class="pre">torch.jit.ignore</span></code> 和 <code class="docutils literal "><span class="pre">torch.jit.unused</span></code> 来忽略不完全支持 torchscript 或应该被编译器忽略的方法或函数。</p></li>
</ul>
<p><strong>与 Python 相比</strong></p>
<p>与其 Python 对应物相比，TorchScript 自定义类相当有限。Torchscript 自定义类：</p>
<ul class="simple">
<li><p>不支持类属性。</p></li>
<li><p>除了接口类型或对象的子类化外，不支持子类化。</p></li>
<li><p>不支持方法重载。</p></li>
<li><p>必须在 <code class="docutils literal "><span class="pre">__init__()</span></code> 中初始化所有实例属性；这是因为 TorchScript 通过在 <code class="docutils literal "><span class="pre">__init__()</span></code> 中推断属性类型来构建类的静态模式。</p></li>
<li><p>必须只包含满足 TorchScript 类型检查规则且可编译为 TorchScript IR 的方法。</p></li>
</ul>
<p><strong>示例 1</strong></p>
<p>如果 Python 类使用 <code class="docutils literal "><span class="pre">@torch.jit.script</span></code> 进行注解，则可以在 TorchScript 中使用，类似于声明 TorchScript 函数的方式：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">val</span>
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>TorchScript 自定义类类型必须通过在 <code class="docutils literal "><span class="pre">__init__()</span></code> 中赋值“声明”所有实例属性。如果一个实例属性在 <code class="docutils literal "><span class="pre">__init__()</span></code> 中没有定义但在类的其他方法中被访问，则该类无法编译为 TorchScript 类，如下例所示：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># ERROR: self.x is not defined in __init__</span>
<span class="k">def</span> <span class="nf">assign_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>该类将无法编译并报出以下错误：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span>RuntimeError:
Tried to set nonexistent attribute: x. Did you forget to initialize it in __init__()?:
def assign_x(self):
    self.x = torch.rand(2, 3)
    ~~~~~~~~~~~~~~~~~~~~~~~~ &lt;--- HERE
</pre></div>
</div>
<p><strong>示例 3</strong></p>
<p>在本例中，一个 TorchScript 自定义类定义了一个不允许的类变量名：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"MyClass"</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">MyClass</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>导致以下编译时错误：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span>RuntimeError:
'__torch__.MyClass' object has no attribute or method 'name'. Did you forget to initialize an attribute in __init__()?:
    File "test-class2.py", line 10
def fn(a: MyClass):
    return a.name
        ~~~~~~ &lt;--- HERE
</pre></div>
</div>
</section>
<section id="enum-type">
<h3>枚举类型 ¶</h3>
<p>与自定义类类似，枚举类型的语义由用户定义，整个类定义必须可编译为 TorchScript IR，并遵守 TorchScript 类型检查规则。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSEnumDef</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"class"</span> <span class="n">Identifier</span> <span class="s2">"(enum.Enum | TSEnumType)"</span> <span class="s2">":"</span>
               <span class="p">(</span> <span class="n">MemberIdentifier</span> <span class="s2">"="</span> <span class="n">Value</span> <span class="p">)</span><span class="o">+</span>
               <span class="p">(</span> <span class="n">MethodDefinition</span> <span class="p">)</span><span class="o">*</span>
</pre></div>
</div>
<p>位置：</p>
<ul class="simple">
<li><p>值必须是类型为 <code class="docutils literal "><span class="pre">int</span></code> 、 <code class="docutils literal "><span class="pre">float</span></code> 或 <code class="docutils literal "><span class="pre">str</span></code> 的 TorchScript 文字面量，并且必须是相同的 TorchScript 类型。</p></li>
<li><p> <code class="docutils literal "><span class="pre">TSEnumType</span></code> 是 TorchScript 枚举类型的名称。类似于 Python 枚举，TorchScript 允许受限的 <code class="docutils literal "><span class="pre">Enum</span></code> 子类化，即，如果枚举没有定义任何成员，则允许子类化枚举。</p></li>
</ul>
<p><strong>与 Python 相比</strong></p>
<ul class="simple">
<li><p>TorchScript 仅支持 <code class="docutils literal "><span class="pre">enum.Enum</span></code> 。它不支持其他变体，如 <code class="docutils literal "><span class="pre">enum.IntEnum</span></code> 、 <code class="docutils literal "><span class="pre">enum.Flag</span></code> 、 <code class="docutils literal "><span class="pre">enum.IntFlag</span></code> 和 <code class="docutils literal "><span class="pre">enum.auto</span></code> 。</p></li>
<li><p>TorchScript 枚举成员的值必须是同一类型，并且只能是 <code class="docutils literal "><span class="pre">int</span></code> 、 <code class="docutils literal "><span class="pre">float</span></code> 或 <code class="docutils literal "><span class="pre">str</span></code> 类型，而 Python 枚举成员可以是任何类型。</p></li>
<li><p>包含方法的枚举在 TorchScript 中会被忽略。</p></li>
</ul>
<p><strong>示例 1</strong></p>
<p>以下示例定义了一个类 <code class="docutils literal "><span class="pre">Color</span></code> 为 <code class="docutils literal "><span class="pre">Enum</span></code> 类型：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Eager: "</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript: "</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>以下示例展示了受限枚举子类化的情况，其中 <code class="docutils literal "><span class="pre">BaseColor</span></code> 没有定义任何成员，因此可以被 <code class="docutils literal "><span class="pre">Color</span></code> 子类化：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">BaseColor</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">BaseColor</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript: "</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Eager: "</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="torchscript-module-class">
<h3>TorchScript 模块类</h3>
<p> <code class="docutils literal "><span class="pre">TSModuleType</span></code> 是一种特殊类类型，它从在 TorchScript 外部创建的对象实例推断而来。 <code class="docutils literal "><span class="pre">TSModuleType</span></code> 由对象实例的 Python 类命名。Python 类的 <code class="docutils literal "><span class="pre">__init__()</span></code> 方法不被视为 TorchScript 方法，因此它不需要遵守 TorchScript 的类型检查规则。</p>
<p>模块实例类的类型模式直接从实例对象（在 TorchScript 作用域外创建）构建，而不是从类似于自定义类的 <code class="docutils literal "><span class="pre">__init__()</span></code> 推断。可能存在两个相同实例类类型的对象遵循不同的类型模式。</p>
<p>在这种意义上， <code class="docutils literal "><span class="pre">TSModuleType</span></code> 并非真正的静态类型。因此，出于类型安全考虑， <code class="docutils literal "><span class="pre">TSModuleType</span></code> 不能用于 TorchScript 类型注解，也不能与 <code class="docutils literal "><span class="pre">TSType</span></code> 组合。</p>
</section>
<section id="module-instance-class">
<h3>模块实例类</h3>
<p>TorchScript 模块类型表示用户定义的 PyTorch 模块实例的类型模式。在脚本化 PyTorch 模块时，模块对象始终在 TorchScript 之外创建（即作为参数传递给 <code class="docutils literal "><span class="pre">forward</span></code> ）。Python 模块类被视为模块实例类，因此 Python 模块类的 <code class="docutils literal "><span class="pre">__init__()</span></code> 方法不受 TorchScript 的类型检查规则约束。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSModuleType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"class"</span> <span class="n">Identifier</span> <span class="s2">"(torch.nn.Module)"</span> <span class="s2">":"</span>
                    <span class="n">ClassBodyDefinition</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">forward()</span></code> 和其他使用 <code class="docutils literal "><span class="pre">@torch.jit.export</span></code> 装饰的方法必须可编译为 TorchScript IR，并受 TorchScript 的类型检查规则约束。</p></li>
</ul>
<p>与自定义类不同，只有模块类型的前向方法和其他使用 <code class="docutils literal "><span class="pre">@torch.jit.export</span></code> 装饰的方法需要可编译。最值得注意的是， <code class="docutils literal "><span class="pre">__init__()</span></code> 不被视为 TorchScript 方法。因此，模块类型构造函数不能在 TorchScript 的作用域内调用。相反，TorchScript 模块对象总是在外部构建并传递给 <code class="docutils literal "><span class="pre">torch.jit.script(ModuleObj)</span></code> 。</p>
<p><strong>示例 1</strong></p>
<p>本例展示了模块类型的一些功能：</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">TestModule</span></code> 实例是在 TorchScript 作用域之外创建的（即在调用 <code class="docutils literal "><span class="pre">torch.jit.script</span></code> 之前）。</p></li>
<li><p> <code class="docutils literal "><span class="pre">__init__()</span></code> 不是一个 TorchScript 方法，因此不需要进行注解，可以包含任意 Python 代码。此外，实例类的 <code class="docutils literal "><span class="pre">__init__()</span></code> 方法不能在 TorchScript 代码中调用。因为 <code class="docutils literal "><span class="pre">TestModule</span></code> 实例是在 Python 中实例化的，在这个例子中， <code class="docutils literal "><span class="pre">TestModule(2.0)</span></code> 和 <code class="docutils literal "><span class="pre">TestModule(2)</span></code> 创建了具有不同数据属性类型的两个实例。 <code class="docutils literal "><span class="pre">self.x</span></code> 对于 <code class="docutils literal "><span class="pre">TestModule(2.0)</span></code> 是 <code class="docutils literal "><span class="pre">float</span></code> 类型，而 <code class="docutils literal "><span class="pre">self.y</span></code> 对于 <code class="docutils literal "><span class="pre">TestModule(2.0)</span></code> 是 <code class="docutils literal "><span class="pre">int</span></code> 类型。</p></li>
<li><p>TorchScript 会自动编译通过 <code class="docutils literal "><span class="pre">@torch.jit.export</span></code> 或 <code class="docutils literal "><span class="pre">forward()</span></code> 方法注解的方法调用的其他方法（例如 <code class="docutils literal "><span class="pre">mul()</span></code> ）。</p></li>
<li><p>火炬脚本程序的入口点可以是模块类型的 <code class="docutils literal "><span class="pre">forward()</span></code> ，或者被标注为 <code class="docutils literal "><span class="pre">torch.jit.script</span></code> 的函数，或者被标注为 <code class="docutils literal "><span class="pre">torch.jit.export</span></code> 的方法。</p></li>
</ul>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">inc</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"First instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Second instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
<p>上面的示例生成了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>First instance: 4
Second instance: tensor([4., 4., 4., 4., 4.])
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>以下示例展示了模块类型的不正确使用。具体来说，这个示例在 TorchScript 的作用域内调用了 <code class="docutils literal "><span class="pre">TestModule</span></code> 的构造函数。</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">v</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
    <span class="k">def</span> <span class="nf">doSomething</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># error: should not invoke the constructor of module type</span>
        <span class="n">myModel</span> <span class="o">=</span> <span class="n">TestModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">myModel</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="c1"># m = torch.jit.script(MyModel(2)) # Results in below RuntimeError</span>
<span class="c1"># RuntimeError: Could not get name of python class object</span>
</pre></div>
</div>
</section>
</section>
<section id="type-annotation">
<span id="id2"></span><h2>类型注解 ¶</h2>
<p>由于 TorchScript 是静态类型的，程序员需要在 TorchScript 代码的战略点上注解类型，以确保每个局部变量或实例数据属性都有静态类型，每个函数和方法都有静态类型的签名。</p>
<section id="when-to-annotate-types">
<h3>何时进行类型注解 ¶</h3>
<p>通常情况下，只有在静态类型无法自动推断的地方才需要类型注解（例如，参数或有时方法或函数的返回类型）。局部变量和数据属性的类型通常可以从它们的赋值语句中自动推断。有时推断的类型可能过于严格，例如，通过赋值推断为 <code class="docutils literal "><span class="pre">x</span></code> ，而实际上使用的是 <code class="docutils literal "><span class="pre">NoneType</span></code> ，而 <code class="docutils literal "><span class="pre">x</span> <span class="pre">=</span> <span class="pre">None</span></code> 是作为 <code class="docutils literal "><span class="pre">x</span></code> 使用的。在这种情况下，可能需要类型注解来覆盖自动推断，例如， <code class="docutils literal "><span class="pre">Optional</span></code> 。请注意，即使可以自动推断类型，也可以安全地对局部变量或数据属性进行类型注解。注解的类型必须与 TorchScript 的类型检查一致。</p>
<p>当参数、局部变量或数据属性未进行类型注解且其类型无法自动推断时，TorchScript 会将其默认类型假设为 <code class="docutils literal "><span class="pre">TensorType</span></code> 、 <code class="docutils literal "><span class="pre">List[TensorType]</span></code> 或 <code class="docutils literal "><span class="pre">Dict[str,</span> <span class="pre">TensorType]</span></code> 。</p>
</section>
<section id="annotate-function-signature">
<h3>注释函数签名</h3>
<p>由于参数可能无法从函数体（包括函数和方法）中自动推断，因此它们需要类型注解。否则，它们会假设默认类型 <code class="docutils literal "><span class="pre">TensorType</span></code> 。</p>
<p>TorchScript 支持两种方法签名和函数签名类型注解的风格：</p>
<ul class="simple">
<li><p>Python3 风格的注解直接在签名上标注类型。因此，允许单独的参数不进行注解（其类型将为默认类型 <code class="docutils literal "><span class="pre">TensorType</span></code> ），或者允许返回类型不进行注解（其类型将自动推断）。</p></li>
</ul>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">Python3Annotation</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"def"</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">"("</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">")"</span> <span class="p">]</span> <span class="p">[</span><span class="n">ReturnAnnot</span><span class="p">]</span> <span class="s2">":"</span>
                            <span class="n">FuncOrMethodBody</span>
<span class="n">ParamAnnot</span>        <span class="p">:</span><span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">":"</span> <span class="n">TSType</span> <span class="p">]</span> <span class="s2">","</span>
<span class="n">ReturnAnnot</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">"-&gt;"</span> <span class="n">TSType</span>
</pre></div>
</div>
<p>注意，在使用 Python3 风格时，类型 <code class="docutils literal "><span class="pre">self</span></code> 将自动推断，不应进行注解。</p>
<ul class="simple">
<li><p>Mypy 风格将类型注解作为注释直接标注在函数/方法声明下方。在 Mypy 风格中，由于参数名称不出现在注解中，所有参数都必须进行注解。</p></li>
</ul>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">MyPyAnnotation</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"# type:"</span> <span class="s2">"("</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">")"</span> <span class="p">[</span> <span class="n">ReturnAnnot</span> <span class="p">]</span>
<span class="n">ParamAnnot</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="s2">","</span>
<span class="n">ReturnAnnot</span>    <span class="p">:</span><span class="o">:=</span> <span class="s2">"-&gt;"</span> <span class="n">TSType</span>
</pre></div>
</div>
<p><strong>示例 1</strong></p>
<p>在本例中：</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">a</span></code> 未进行标注，默认为 <code class="docutils literal "><span class="pre">TensorType</span></code> 的类型。</p></li>
<li><p> <code class="docutils literal "><span class="pre">b</span></code> 被标注为 <code class="docutils literal "><span class="pre">int</span></code> 类型。</p></li>
<li><p>返回类型未进行标注，自动推断为返回值的类型 <code class="docutils literal "><span class="pre">TensorType</span></code> （基于返回值的类型）。</p></li>
</ul>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>以下示例使用 Mypy 风格的注解。请注意，即使某些参数或返回值假设默认类型，也必须对它们进行注解。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># type: (torch.Tensor, int) → torch.Tensor</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="annotate-variables-and-data-attributes">
<h3>注释变量和数据属性</h3>
<p>通常，数据属性的类型（包括类和实例数据属性）和局部变量可以从赋值语句中自动推断。有时，如果变量或属性与不同类型的值相关联（例如，作为 <code class="docutils literal "><span class="pre">None</span></code> 或 <code class="docutils literal "><span class="pre">TensorType</span></code> ），则可能需要显式地将其注释为更宽泛的类型，如 <code class="docutils literal "><span class="pre">Optional[int]</span></code> 或 <code class="docutils literal "><span class="pre">Any</span></code> 。</p>
<section id="local-variables">
<h4>本地变量 ¶</h4>
<p>本地变量可以根据 Python3 类型模块的注解规则进行注解，即</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">LocalVarAnnotation</span> <span class="p">:</span><span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span><span class="s2">":"</span> <span class="n">TSType</span><span class="p">]</span> <span class="s2">"="</span> <span class="n">Expr</span>
</pre></div>
</div>
<p>通常，本地变量的类型可以自动推断。然而，在某些情况下，您可能需要为可能关联不同具体类型的本地变量注解多类型。典型的多类型包括 <code class="docutils literal "><span class="pre">Optional[T]</span></code> 和 <code class="docutils literal "><span class="pre">Any</span></code> 。</p>
<p><strong>示例</strong></p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">setVal</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">setVal</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="instance-data-attributes">
<h4>实例数据属性 ¶</h4>
<p>对于 <code class="docutils literal "><span class="pre">ModuleType</span></code> 类，实例数据属性可以根据 Python3 类型注解模块的注解规则进行注解。实例数据属性可以通过 <code class="docutils literal "><span class="pre">Final</span></code> （可选）注解为最终属性。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="s2">"class"</span> <span class="n">ClassIdentifier</span> <span class="s2">"(torch.nn.Module):"</span>
<span class="n">InstanceAttrIdentifier</span> <span class="s2">":"</span> <span class="p">[</span><span class="s2">"Final("</span><span class="p">]</span> <span class="n">TSType</span> <span class="p">[</span><span class="s2">")"</span><span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>位置：</p>
<ul class="simple">
<li><p> <code class="docutils literal "><span class="pre">InstanceAttrIdentifier</span></code> 是一个实例属性的名称。</p></li>
<li><p> <code class="docutils literal "><span class="pre">Final</span></code> 表示该属性不能在 <code class="docutils literal "><span class="pre">__init__</span></code> 之外重新赋值或在子类中重写。</p></li>
</ul>
<p><strong>示例</strong></p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">offset_</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offset_</span> <span class="o">=</span> <span class="n">offset</span>

<span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="type-annotation-apis">
<h3>类型注解 API ¶</h3>
<section id="torch-jit-annotate-t-expr">
<h4><code class="docutils literal "><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code><a class="headerlink" href="#torch-jit-annotate-t-expr" title="Permalink to this heading">¶</a></h4>
<p>此 API 将类型 <code class="docutils literal "><span class="pre">T</span></code> 标注到表达式 <code class="docutils literal "><span class="pre">expr</span></code> 。这通常用于表达式的默认类型不是程序员所期望的类型时。例如，空列表（字典）的默认类型为 <code class="docutils literal "><span class="pre">List[TensorType]</span></code> （ <code class="docutils literal "><span class="pre">Dict[TensorType,</span> <span class="pre">TensorType]</span></code> ），但有时可能用于初始化其他类型的列表。另一个常见用例是标注 <code class="docutils literal "><span class="pre">tensor.tolist()</span></code> 的返回类型。请注意，它不能用于标注__init__中模块属性的类型； <code class="docutils literal "><span class="pre">torch.jit.Attribute</span></code> 应用于此。</p>
<p><strong>示例</strong></p>
<p>在此示例中， <code class="docutils literal "><span class="pre">[]</span></code> 通过 <code class="docutils literal "><span class="pre">torch.jit.annotate</span></code> 声明为整数列表（而不是假设 <code class="docutils literal "><span class="pre">[]</span></code> 为 <code class="docutils literal "><span class="pre">List[TensorType]</span></code> 的默认类型）：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">[]),</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Eager:"</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>更多信息请参阅 <code class="xref py py-meth docutils literal "><span class="pre">torch.jit.annotate()</span></code> 。</p>
</section>
</section>
<section id="type-annotation-appendix">
<h3>类型注解附录 ¶</h3>
<section id="torchscript-type-system-definition">
<h4>火炬脚本类型系统定义</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">TSAllType</span>       <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span>          <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>

<span class="n">TSMetaType</span>      <span class="p">:</span><span class="o">:=</span> <span class="s2">"Any"</span>
<span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"int"</span> <span class="o">|</span> <span class="s2">"float"</span> <span class="o">|</span> <span class="s2">"double"</span> <span class="o">|</span> <span class="s2">"complex"</span> <span class="o">|</span> <span class="s2">"bool"</span> <span class="o">|</span> <span class="s2">"str"</span> <span class="o">|</span> <span class="s2">"None"</span>

<span class="n">TSStructuralType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span> <span class="n">TSOptional</span> <span class="o">|</span>
                     <span class="n">TSUnion</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span> <span class="o">|</span> <span class="n">TSAwait</span>
<span class="n">TSTuple</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">"Tuple"</span> <span class="s2">"["</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSNamedTuple</span>    <span class="p">:</span><span class="o">:=</span> <span class="s2">"namedtuple"</span> <span class="s2">"("</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">")"</span>
<span class="n">TSList</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"List"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSOptional</span>      <span class="p">:</span><span class="o">:=</span> <span class="s2">"Optional"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSUnion</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">"Union"</span> <span class="s2">"["</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSFuture</span>        <span class="p">:</span><span class="o">:=</span> <span class="s2">"Future"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSRRef</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"RRef"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSAwait</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">"Await"</span> <span class="s2">"["</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">TSDict</span>          <span class="p">:</span><span class="o">:=</span> <span class="s2">"Dict"</span> <span class="s2">"["</span> <span class="n">KeyType</span> <span class="s2">","</span> <span class="n">TSType</span> <span class="s2">"]"</span>
<span class="n">KeyType</span>         <span class="p">:</span><span class="o">:=</span> <span class="s2">"str"</span> <span class="o">|</span> <span class="s2">"int"</span> <span class="o">|</span> <span class="s2">"float"</span> <span class="o">|</span> <span class="s2">"bool"</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">"Any"</span>

<span class="n">TSNominalType</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
<span class="n">TSBuiltinClass</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">"torch.device"</span> <span class="o">|</span> <span class="s2">"torch.stream"</span><span class="o">|</span>
                    <span class="s2">"torch.dtype"</span> <span class="o">|</span> <span class="s2">"torch.nn.ModuleList"</span> <span class="o">|</span>
                    <span class="s2">"torch.nn.ModuleDict"</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span>        <span class="p">:</span><span class="o">:=</span> <span class="s2">"torch.tensor"</span> <span class="ow">and</span> <span class="n">subclasses</span>
</pre></div>
</div>
</section>
<section id="unsupported-typing-constructs">
<h4>不支持的类型构造</h4>
<p>火炬脚本不支持 Python3 类型模块的所有特性和类型。本文档未明确指定的类型模块功能均不支持。下表总结了在火炬脚本中不受支持或受限制支持的 <code class="docutils literal "><span class="pre">typing</span></code> 构造。</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>项目</p></td>
<td><p>描述</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">typing.Any</span></code></p></td>
<td><p>开发中</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">typing.NoReturn</span></code></p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">typing.Callable</span></code></p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">typing.Literal</span></code></p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">typing.ClassVar</span></code></p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">typing.Final</span></code></p></td>
<td><p>支持模块属性、类属性和注解，但不支持函数。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">typing.AnyStr</span></code></p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">typing.overload</span></code></p></td>
<td><p>开发中</p></td>
</tr>
<tr class="row-even"><td><p>类型别名</p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-odd"><td><p>命名类型</p></td>
<td><p>开发中</p></td>
</tr>
<tr class="row-even"><td><p>结构化类型</p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-odd"><td><p>新类型</p></td>
<td><p>不支持</p></td>
</tr>
<tr class="row-even"><td><p>泛型</p></td>
<td><p>不支持</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="expressions">
<span id="id4"></span><h2>表达式 ¶</h2>
<p>以下部分描述了在 TorchScript 中受支持的表达式语法。它模仿了 Python 语言参考中的表达式章节。</p>
<section id="arithmetic-conversions">
<h3>算术转换 §</h3>
<p>在 TorchScript 中执行了许多隐式类型转换：</p>
<ul class="simple">
<li><p>当一个具有 <code class="docutils literal "><span class="pre">float</span></code> 或 <code class="docutils literal "><span class="pre">int</span></code> 数据类型的 <code class="docutils literal "><span class="pre">Tensor</span></code> 可以隐式转换为 <code class="docutils literal "><span class="pre">FloatType</span></code> 或 <code class="docutils literal "><span class="pre">IntType</span></code> 实例，前提是它的大小为 0，没有将 <code class="docutils literal "><span class="pre">require_grad</span></code> 设置为 <code class="docutils literal "><span class="pre">True</span></code> ，并且不会需要缩窄。</p></li>
<li><p> <code class="docutils literal "><span class="pre">StringType</span></code> 的实例可以隐式转换为 <code class="docutils literal "><span class="pre">DeviceType</span></code> 。</p></li>
<li><p>上述两个要点中的隐式转换规则可以应用于 <code class="docutils literal "><span class="pre">TupleType</span></code> 的实例，以生成包含适当类型实例的 <code class="docutils literal "><span class="pre">ListType</span></code> 。</p></li>
</ul>
<p>可以使用接受原始数据类型作为参数的 <code class="docutils literal "><span class="pre">float</span></code> 、 <code class="docutils literal "><span class="pre">int</span></code> 、 <code class="docutils literal "><span class="pre">bool</span></code> 和 <code class="docutils literal "><span class="pre">str</span></code> 内置函数显式调用转换，如果用户定义的类型实现了 <code class="docutils literal "><span class="pre">__bool__</span></code> 、 <code class="docutils literal "><span class="pre">__str__</span></code> 等，则也可以接受。</p>
</section>
<section id="atoms">
<h3>原子</h3>
<p>原子是表达式的最基本元素。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">atom</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span> <span class="o">|</span> <span class="n">literal</span> <span class="o">|</span> <span class="n">enclosure</span>
<span class="n">enclosure</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">parenth_form</span> <span class="o">|</span> <span class="n">list_display</span> <span class="o">|</span> <span class="n">dict_display</span>
</pre></div>
</div>
<section id="identifiers">
<h4>标识符 ¶</h4>
<p>规定 TorchScript 中合法标识符的规则与它们的 Python 对应物相同。</p>
</section>
<section id="literals">
<h4>文字常量 ¶</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">literal</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">stringliteral</span> <span class="o">|</span> <span class="n">integer</span> <span class="o">|</span> <span class="n">floatnumber</span>
</pre></div>
</div>
<p>文字常量的评估会产生具有特定值的适当类型的对象（对于浮点数，根据需要应用近似值）。文字常量是不可变的，对相同文字常量的多次评估可能获得相同的对象或具有相同值的独立对象。字符串文字、整数和浮点数字的表示方式与它们的 Python 对应物相同。</p>
</section>
<section id="parenthesized-forms">
<h4>括号形式 ¶</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">parenth_form</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">'('</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s1">')'</span>
</pre></div>
</div>
<p>括号表达式列表返回表达式列表的结果。如果列表中至少有一个逗号，则返回 <code class="docutils literal "><span class="pre">Tuple</span></code> ；否则，返回表达式列表内的单个表达式。一对空括号返回一个空的 <code class="docutils literal "><span class="pre">Tuple</span></code> 对象（ <code class="docutils literal "><span class="pre">Tuple[]</span></code> ）。</p>
</section>
<section id="list-and-dictionary-displays">
<h4>列表和字典显示 ¶</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">list_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="n">comp_for</span>
<span class="n">comp_for</span>           <span class="p">:</span><span class="o">:=</span>  <span class="s1">'for'</span> <span class="n">target_list</span> <span class="s1">'in'</span> <span class="n">or_expr</span>
<span class="n">list_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">'['</span> <span class="p">[</span><span class="n">expression_list</span> <span class="o">|</span> <span class="n">list_comprehension</span><span class="p">]</span> <span class="s1">']'</span>
<span class="n">dict_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">'{'</span> <span class="p">[</span><span class="n">key_datum_list</span> <span class="o">|</span> <span class="n">dict_comprehension</span><span class="p">]</span> <span class="s1">'}'</span>
<span class="n">key_datum_list</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="p">(</span><span class="s1">','</span> <span class="n">key_datum</span><span class="p">)</span><span class="o">*</span>
<span class="n">key_datum</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="s1">':'</span> <span class="n">expression</span>
<span class="n">dict_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="n">comp_for</span>
</pre></div>
</div>
<p>列表和字典可以通过明确列出容器内容或通过提供一组循环指令来计算它们的方式（即推导式）来构建。推导式在语义上等同于使用 for 循环并将元素追加到正在进行的列表中。推导式隐式地创建自己的作用域，以确保目标列表的项不会泄漏到外部作用域。如果容器项明确列出，则表达式列表中的表达式按从左到右的顺序评估。如果在具有 <code class="docutils literal "><span class="pre">key_datum_list</span></code> 的 <code class="docutils literal "><span class="pre">dict_display</span></code> 中重复键，则结果字典使用使用重复键的列表中右侧数据点的值。</p>
</section>
</section>
<section id="primaries">
<h3>基础</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">primary</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">atom</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span> <span class="o">|</span> <span class="n">slicing</span> <span class="o">|</span> <span class="n">call</span>
</pre></div>
</div>
<section id="attribute-references">
<h4>属性引用</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">attributeref</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">'.'</span> <span class="n">identifier</span>
</pre></div>
</div>
<p> <code class="docutils literal "><span class="pre">primary</span></code> 必须评估为一个支持具有名为 <code class="docutils literal "><span class="pre">identifier</span></code> 的属性引用的类型对象。</p>
</section>
<section id="subscriptions">
<h4>订阅</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">subscription</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">'['</span> <span class="n">expression_list</span> <span class="s1">']'</span>
</pre></div>
</div>
<p> <code class="docutils literal "><span class="pre">primary</span></code> 必须评估为一个支持订阅的对象。</p>
<ul class="simple">
<li><p>如果主操作数是 <code class="docutils literal "><span class="pre">List</span></code> 、 <code class="docutils literal "><span class="pre">Tuple</span></code> 或 <code class="docutils literal "><span class="pre">str</span></code> ，表达式列表必须评估为整数或切片。</p></li>
<li><p>如果主操作数是 <code class="docutils literal "><span class="pre">Dict</span></code> ，表达式列表必须评估为与 <code class="docutils literal "><span class="pre">Dict</span></code> 的键类型相同的对象。</p></li>
<li><p>如果主操作数是 <code class="docutils literal "><span class="pre">ModuleList</span></code> ，表达式列表必须是一个 <code class="docutils literal "><span class="pre">integer</span></code> 文本字面量。</p></li>
<li><p>如果主操作数是 <code class="docutils literal "><span class="pre">ModuleDict</span></code> ，则表达式必须是 <code class="docutils literal "><span class="pre">stringliteral</span></code> 。</p></li>
</ul>
</section>
<section id="slicings">
<h4>切片操作</h4>
<p>切片操作从 <code class="docutils literal "><span class="pre">str</span></code> 、 <code class="docutils literal "><span class="pre">Tuple</span></code> 、 <code class="docutils literal "><span class="pre">List</span></code> 或 <code class="docutils literal "><span class="pre">Tensor</span></code> 中选择一系列项。切片可以作为赋值或 <code class="docutils literal "><span class="pre">del</span></code> 语句中的表达式或目标使用。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">slicing</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">'['</span> <span class="n">slice_list</span> <span class="s1">']'</span>
<span class="n">slice_list</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">slice_item</span> <span class="p">(</span><span class="s1">','</span> <span class="n">slice_item</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">','</span><span class="p">]</span>
<span class="n">slice_item</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="o">|</span> <span class="n">proper_slice</span>
<span class="n">proper_slice</span> <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="s1">':'</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">[</span><span class="s1">':'</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>包含多个切片项的切片只能与评估为 <code class="docutils literal "><span class="pre">Tensor</span></code> 类型对象的初值一起使用。</p>
</section>
<section id="calls">
<h4>呼叫</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">call</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">'('</span> <span class="n">argument_list</span> <span class="s1">')'</span>
<span class="n">argument_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">args</span> <span class="p">[</span><span class="s1">','</span> <span class="n">kwargs</span><span class="p">]</span> <span class="o">|</span> <span class="n">kwargs</span>
<span class="n">args</span>          <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">arg</span> <span class="p">(</span><span class="s1">','</span> <span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwargs</span>        <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">kwarg</span> <span class="p">(</span><span class="s1">','</span> <span class="n">kwarg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwarg</span>         <span class="p">:</span><span class="o">:=</span>  <span class="n">arg</span> <span class="s1">'='</span> <span class="n">expression</span>
<span class="n">arg</span>           <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span>
</pre></div>
</div>
<p> <code class="docutils literal "><span class="pre">primary</span></code> 必须解糖或评估为可调用对象。所有参数表达式在尝试调用之前都会被评估。</p>
</section>
</section>
<section id="power-operator">
<h3>幂运算符</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">power</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="p">[</span><span class="s1">'**'</span> <span class="n">u_expr</span><span class="p">]</span>
</pre></div>
</div>
<p>幂运算符与内置的 pow 函数（不支持）具有相同的语义；它计算其左操作数乘以其右操作数的幂。它比左边的单目运算符绑定得更紧密，但比右边的单目运算符绑定得松；即 <code class="docutils literal "><span class="pre">-2</span> <span class="pre">**</span> <span class="pre">-3</span> <span class="pre">==</span> <span class="pre">-(2</span> <span class="pre">**</span> <span class="pre">(-3))</span></code> 。左操作数和右操作数可以是 <code class="docutils literal "><span class="pre">int</span></code> ， <code class="docutils literal "><span class="pre">float</span></code> 或 <code class="docutils literal "><span class="pre">Tensor</span></code> 。在标量与张量/张量与标量幂运算的情况下，标量会被广播，而张量与张量幂运算则是逐元素进行的，不进行广播。</p>
</section>
<section id="unary-and-arithmetic-bitwise-operations">
<h3>一元和算术位运算 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">u_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">power</span> <span class="o">|</span> <span class="s1">'-'</span> <span class="n">power</span> <span class="o">|</span> <span class="s1">'~'</span> <span class="n">power</span>
</pre></div>
</div>
<p>一元 <code class="docutils literal "><span class="pre">-</span></code> 运算符返回其参数的否定。一元 <code class="docutils literal "><span class="pre">~</span></code> 运算符返回其参数的位反转。 <code class="docutils literal "><span class="pre">-</span></code> 可以与 <code class="docutils literal "><span class="pre">int</span></code> 和 <code class="docutils literal "><span class="pre">float</span></code> 的 <code class="docutils literal "><span class="pre">int</span></code> 、 <code class="docutils literal "><span class="pre">float</span></code> 和 <code class="docutils literal "><span class="pre">Tensor</span></code> 使用。 <code class="docutils literal "><span class="pre">~</span></code> 只能与 <code class="docutils literal "><span class="pre">int</span></code> 的 <code class="docutils literal "><span class="pre">int</span></code> 和 <code class="docutils literal "><span class="pre">Tensor</span></code> 使用。</p>
</section>
<section id="binary-arithmetic-operations">
<h3>二元算术运算 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">m_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">'*'</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">'@'</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">'//'</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">'/'</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">'%'</span> <span class="n">u_expr</span>
<span class="n">a_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">'+'</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">'-'</span> <span class="n">m_expr</span>
</pre></div>
</div>
<p>二元算术运算符可以作用于 <code class="docutils literal "><span class="pre">Tensor</span></code> 、 <code class="docutils literal "><span class="pre">int</span></code> 和 <code class="docutils literal "><span class="pre">float</span></code> 。对于张量-张量运算，两个参数必须具有相同的形状。对于标量-张量或张量-标量运算，标量通常广播到张量的尺寸。除法运算只能接受标量作为其右侧参数，不支持广播。 <code class="docutils literal "><span class="pre">@</span></code> 运算符用于矩阵乘法，并且只作用于 <code class="docutils literal "><span class="pre">Tensor</span></code> 参数。乘法运算符（ <code class="docutils literal "><span class="pre">*</span></code> ）可以用列表和整数一起使用，以得到重复一定次数的原始列表的结果。</p>
</section>
<section id="shifting-operations">
<h3>调整操作 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">shift_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">a_expr</span> <span class="o">|</span> <span class="n">shift_expr</span> <span class="p">(</span> <span class="s1">'&lt;&lt;'</span> <span class="o">|</span> <span class="s1">'&gt;&gt;'</span> <span class="p">)</span> <span class="n">a_expr</span>
</pre></div>
</div>
<p>这些运算符接受两个 <code class="docutils literal "><span class="pre">int</span></code> 参数，两个 <code class="docutils literal "><span class="pre">Tensor</span></code> 参数，或者一个 <code class="docutils literal "><span class="pre">Tensor</span></code> 参数和一个 <code class="docutils literal "><span class="pre">int</span></code> 或 <code class="docutils literal "><span class="pre">float</span></code> 参数。在所有情况下，右移 <code class="docutils literal "><span class="pre">n</span></code> 定义为向下取整除以 <code class="docutils literal "><span class="pre">pow(2,</span> <span class="pre">n)</span></code> ，而左移 <code class="docutils literal "><span class="pre">n</span></code> 定义为乘以 <code class="docutils literal "><span class="pre">pow(2,</span> <span class="pre">n)</span></code> 。当两个参数都是 <code class="docutils literal "><span class="pre">Tensors</span></code> 时，它们必须具有相同的形状。当一个参数是标量，另一个是 <code class="docutils literal "><span class="pre">Tensor</span></code> 时，标量将逻辑上广播以匹配 <code class="docutils literal "><span class="pre">Tensor</span></code> 的大小。</p>
</section>
<section id="binary-bitwise-operations">
<h3>二进制位运算 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">and_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">shift_expr</span> <span class="o">|</span> <span class="n">and_expr</span> <span class="s1">'&amp;'</span> <span class="n">shift_expr</span>
<span class="n">xor_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">and_expr</span> <span class="o">|</span> <span class="n">xor_expr</span> <span class="s1">'^'</span> <span class="n">and_expr</span>
<span class="n">or_expr</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">xor_expr</span> <span class="o">|</span> <span class="n">or_expr</span> <span class="s1">'|'</span> <span class="n">xor_expr</span>
</pre></div>
</div>
<p> <code class="docutils literal "><span class="pre">&amp;</span></code> 运算符计算其参数的按位与， <code class="docutils literal "><span class="pre">^</span></code> 按位异或， <code class="docutils literal "><span class="pre">|</span></code> 按位或。两个操作数必须是 <code class="docutils literal "><span class="pre">int</span></code> 或 <code class="docutils literal "><span class="pre">Tensor</span></code> ，或者左操作数必须是 <code class="docutils literal "><span class="pre">Tensor</span></code> ，而右操作数必须是 <code class="docutils literal "><span class="pre">int</span></code> 。当两个操作数都是 <code class="docutils literal "><span class="pre">Tensor</span></code> 时，它们必须具有相同的形状。当右操作数是 <code class="docutils literal "><span class="pre">int</span></code> ，而左操作数是 <code class="docutils literal "><span class="pre">Tensor</span></code> 时，右操作数将逻辑上广播以匹配 <code class="docutils literal "><span class="pre">Tensor</span></code> 的形状。</p>
</section>
<section id="comparisons">
<h3>比较运算符</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">comparison</span>    <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">(</span><span class="n">comp_operator</span> <span class="n">or_expr</span><span class="p">)</span><span class="o">*</span>
<span class="n">comp_operator</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">'&lt;'</span> <span class="o">|</span> <span class="s1">'&gt;'</span> <span class="o">|</span> <span class="s1">'=='</span> <span class="o">|</span> <span class="s1">'&gt;='</span> <span class="o">|</span> <span class="s1">'&lt;='</span> <span class="o">|</span> <span class="s1">'!='</span> <span class="o">|</span> <span class="s1">'is'</span> <span class="p">[</span><span class="s1">'not'</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="s1">'not'</span><span class="p">]</span> <span class="s1">'in'</span>
</pre></div>
</div>
<p>比较运算符返回一个布尔值（ <code class="docutils literal "><span class="pre">True</span></code> 或 <code class="docutils literal "><span class="pre">False</span></code> ），如果其中一个操作数是 <code class="docutils literal "><span class="pre">Tensor</span></code> ，则返回一个布尔 <code class="docutils literal "><span class="pre">Tensor</span></code> 。只要比较运算符不返回包含多个元素的布尔 <code class="docutils literal "><span class="pre">Tensors</span></code> ，就可以任意地链式调用比较运算符。 <code class="docutils literal "><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">...</span></code> 等价于 <code class="docutils literal "><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">and</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">and</span> <span class="pre">...</span></code> 。</p>
<section id="value-comparisons">
<h4>值比较</h4>
<p>运算符 <code class="docutils literal "><span class="pre">&lt;</span></code> 、 <code class="docutils literal "><span class="pre">&gt;</span></code> 、 <code class="docutils literal "><span class="pre">==</span></code> 、 <code class="docutils literal "><span class="pre">&gt;=</span></code> 、 <code class="docutils literal "><span class="pre">&lt;=</span></code> 和 <code class="docutils literal "><span class="pre">!=</span></code> 比较两个对象的价值。两个对象通常需要是同一类型，除非在对象之间存在隐式类型转换。如果用户定义的类型上定义了丰富的比较方法（例如， <code class="docutils literal "><span class="pre">__lt__</span></code> ），则可以比较用户定义的类型。内置类型比较与 Python 的工作方式类似：</p>
<ul class="simple">
<li><p>数字是按数学方式比较的。</p></li>
<li><p>字符串是按字典顺序比较的。</p></li>
<li><p> <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">tuples</span></code> 和 <code class="docutils literal "><span class="pre">dicts</span></code> 只能与其他相同类型的 <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">tuples</span></code> 和 <code class="docutils literal "><span class="pre">dicts</span></code> 比较，并且使用对应元素的比较运算符进行比较。</p></li>
</ul>
</section>
<section id="membership-test-operations">
<h4>成员资格测试操作 §</h4>
<p>操作符 <code class="docutils literal "><span class="pre">in</span></code> 和 <code class="docutils literal "><span class="pre">not</span> <span class="pre">in</span></code> 用于测试成员资格。 <code class="docutils literal "><span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code> 如果 <code class="docutils literal "><span class="pre">x</span></code> 是 <code class="docutils literal "><span class="pre">s</span></code> 的成员，则评估为 <code class="docutils literal "><span class="pre">True</span></code> ，否则为 <code class="docutils literal "><span class="pre">False</span></code> 。 <code class="docutils literal "><span class="pre">x</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">s</span></code> 等价于 <code class="docutils literal "><span class="pre">not</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code> 。此操作符支持 <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">dicts</span></code> 和 <code class="docutils literal "><span class="pre">tuples</span></code> ，并且如果用户定义的类型实现了 <code class="docutils literal "><span class="pre">__contains__</span></code> 方法，也可以使用。</p>
</section>
<section id="identity-comparisons">
<h4>身份比较</h4>
<p>对于除 <code class="docutils literal "><span class="pre">int</span></code> 、 <code class="docutils literal "><span class="pre">double</span></code> 、 <code class="docutils literal "><span class="pre">bool</span></code> 和 <code class="docutils literal "><span class="pre">torch.device</span></code> 之外的所有类型，操作符 <code class="docutils literal "><span class="pre">is</span></code> 和 <code class="docutils literal "><span class="pre">is</span> <span class="pre">not</span></code> 测试对象的身份； <code class="docutils literal "><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code> 是 <code class="docutils literal "><span class="pre">True</span></code> 当且仅当 <code class="docutils literal "><span class="pre">x</span></code> 和 <code class="docutils literal "><span class="pre">y</span></code> 是相同的对象。对于其他所有类型， <code class="docutils literal "><span class="pre">is</span></code> 等价于使用 <code class="docutils literal "><span class="pre">==</span></code> 比较它们。 <code class="docutils literal "><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">y</span></code> 产生 <code class="docutils literal "><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code> 的逆。</p>
</section>
</section>
<section id="boolean-operations">
<h3>布尔运算</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">or_test</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">and_test</span> <span class="o">|</span> <span class="n">or_test</span> <span class="s1">'or'</span> <span class="n">and_test</span>
<span class="n">and_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">not_test</span> <span class="o">|</span> <span class="n">and_test</span> <span class="s1">'and'</span> <span class="n">not_test</span>
<span class="n">not_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">'bool'</span> <span class="s1">'('</span> <span class="n">or_expr</span> <span class="s1">')'</span> <span class="o">|</span> <span class="n">comparison</span> <span class="o">|</span> <span class="s1">'not'</span> <span class="n">not_test</span>
</pre></div>
</div>
<p>用户定义的对象可以通过实现一个 <code class="docutils literal "><span class="pre">__bool__</span></code> 方法来自定义其转换为 <code class="docutils literal "><span class="pre">bool</span></code> 。操作符 <code class="docutils literal "><span class="pre">not</span></code> 如果其操作数为假，则产生 <code class="docutils literal "><span class="pre">True</span></code> ，否则产生 <code class="docutils literal "><span class="pre">False</span></code> 。表达式 <code class="docutils literal "><span class="pre">x</span></code> 和 <code class="docutils literal "><span class="pre">y</span></code> 首先评估 <code class="docutils literal "><span class="pre">x</span></code> ；如果是 <code class="docutils literal "><span class="pre">False</span></code> ，则返回其值（ <code class="docutils literal "><span class="pre">False</span></code> ）；否则，评估 <code class="docutils literal "><span class="pre">y</span></code> 并返回其值（ <code class="docutils literal "><span class="pre">False</span></code> 或 <code class="docutils literal "><span class="pre">True</span></code> ）。表达式 <code class="docutils literal "><span class="pre">x</span></code> 或 <code class="docutils literal "><span class="pre">y</span></code> 首先评估 <code class="docutils literal "><span class="pre">x</span></code> ；如果是 <code class="docutils literal "><span class="pre">True</span></code> ，则返回其值（ <code class="docutils literal "><span class="pre">True</span></code> ）；否则，评估 <code class="docutils literal "><span class="pre">y</span></code> 并返回其值（ <code class="docutils literal "><span class="pre">False</span></code> 或 <code class="docutils literal "><span class="pre">True</span></code> ）。</p>
</section>
<section id="conditional-expressions">
<h3>条件表达式</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">conditional_expression</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">[</span><span class="s1">'if'</span> <span class="n">or_test</span> <span class="s1">'else'</span> <span class="n">conditional_expression</span><span class="p">]</span>
 <span class="n">expression</span>            <span class="p">:</span><span class="o">:=</span>  <span class="n">conditional_expression</span>
</pre></div>
</div>
<p>表达式 <code class="docutils literal "><span class="pre">x</span> <span class="pre">if</span> <span class="pre">c</span> <span class="pre">else</span> <span class="pre">y</span></code> 首先评估条件 <code class="docutils literal "><span class="pre">c</span></code> ，而不是 x。如果 <code class="docutils literal "><span class="pre">c</span></code> 是 <code class="docutils literal "><span class="pre">True</span></code> ，则评估 <code class="docutils literal "><span class="pre">x</span></code> 并返回其值；否则，评估 <code class="docutils literal "><span class="pre">y</span></code> 并返回其值。与 if 语句一样， <code class="docutils literal "><span class="pre">x</span></code> 和 <code class="docutils literal "><span class="pre">y</span></code> 必须评估为相同类型的值。</p>
</section>
<section id="expression-lists">
<h3>表达式列表</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">expression_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="p">(</span><span class="s1">','</span> <span class="n">expression</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">','</span><span class="p">]</span>
<span class="n">starred_item</span>    <span class="p">:</span><span class="o">:=</span>  <span class="s1">'*'</span> <span class="n">primary</span>
</pre></div>
</div>
<p>星号项只能出现在赋值语句的左侧，例如 <code class="docutils literal "><span class="pre">a,</span> <span class="pre">*b,</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">...</span></code> 。</p>
</section>
</section>
<section id="simple-statements">
<h2>简单语句</h2>
<p>以下部分描述了在 TorchScript 中支持的简单语句的语法。它模仿了 Python 语言参考中的简单语句章节。</p>
<section id="expression-statements">
<h3>表达式语句 §</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">expression_stmt</span>    <span class="p">:</span><span class="o">:=</span>  <span class="n">starred_expression</span>
<span class="n">starred_expression</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="o">|</span> <span class="p">(</span><span class="n">starred_item</span> <span class="s2">","</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="n">starred_item</span><span class="p">]</span>
<span class="n">starred_item</span>       <span class="p">:</span><span class="o">:=</span>  <span class="n">assignment_expression</span> <span class="o">|</span> <span class="s2">"*"</span> <span class="n">or_expr</span>
</pre></div>
</div>
</section>
<section id="assignment-statements">
<h3>赋值语句 §</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">assignment_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="p">(</span><span class="n">target_list</span> <span class="s2">"="</span><span class="p">)</span><span class="o">+</span> <span class="p">(</span><span class="n">starred_expression</span><span class="p">)</span>
<span class="n">target_list</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">target</span> <span class="p">(</span><span class="s2">","</span> <span class="n">target</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">","</span><span class="p">]</span>
<span class="n">target</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span>
                     <span class="o">|</span> <span class="s2">"("</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">")"</span>
                     <span class="o">|</span> <span class="s2">"["</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">"]"</span>
                     <span class="o">|</span> <span class="n">attributeref</span>
                     <span class="o">|</span> <span class="n">subscription</span>
                     <span class="o">|</span> <span class="n">slicing</span>
                     <span class="o">|</span> <span class="s2">"*"</span> <span class="n">target</span>
</pre></div>
</div>
</section>
<section id="augmented-assignment-statements">
<h3>增量赋值语句 §</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">augmented_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">augtarget</span> <span class="n">augop</span> <span class="p">(</span><span class="n">expression_list</span><span class="p">)</span>
<span class="n">augtarget</span>                 <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span>
<span class="n">augop</span>                     <span class="p">:</span><span class="o">:=</span> <span class="s2">"+="</span> <span class="o">|</span> <span class="s2">"-="</span> <span class="o">|</span> <span class="s2">"*="</span> <span class="o">|</span> <span class="s2">"/="</span> <span class="o">|</span> <span class="s2">"//="</span> <span class="o">|</span> <span class="s2">"%="</span> <span class="o">|</span>
                              <span class="s2">"**="</span><span class="o">|</span> <span class="s2">"&gt;&gt;="</span> <span class="o">|</span> <span class="s2">"&lt;&lt;="</span> <span class="o">|</span> <span class="s2">"&amp;="</span> <span class="o">|</span> <span class="s2">"^="</span> <span class="o">|</span> <span class="s2">"|="</span>
</pre></div>
</div>
</section>
<section id="annotated-assignment-statements">
<h3>注解的赋值语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">annotated_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">augtarget</span> <span class="s2">":"</span> <span class="n">expression</span>
                              <span class="p">[</span><span class="s2">"="</span> <span class="p">(</span><span class="n">starred_expression</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="the-raise-statement">
<h3> <code class="docutils literal "><span class="pre">raise</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">raise_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"raise"</span> <span class="p">[</span><span class="n">expression</span> <span class="p">[</span><span class="s2">"from"</span> <span class="n">expression</span><span class="p">]]</span>
</pre></div>
</div>
<p>在 TorchScript 中，抛出语句不支持 <code class="docutils literal "><span class="pre">try\except\finally</span></code> 。</p>
</section>
<section id="the-assert-statement">
<h3> <code class="docutils literal "><span class="pre">assert</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">assert_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"assert"</span> <span class="n">expression</span> <span class="p">[</span><span class="s2">","</span> <span class="n">expression</span><span class="p">]</span>
</pre></div>
</div>
<p>TorchScript 中的断言语句不支持 <code class="docutils literal "><span class="pre">try\except\finally</span></code> 。</p>
</section>
<section id="the-return-statement">
<h3> <code class="docutils literal "><span class="pre">return</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">return_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"return"</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span>
</pre></div>
</div>
<p>TorchScript 中的返回语句不支持 <code class="docutils literal "><span class="pre">try\except\finally</span></code> 。</p>
</section>
<section id="the-del-statement">
<h3> <code class="docutils literal "><span class="pre">del</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">del_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"del"</span> <span class="n">target_list</span>
</pre></div>
</div>
</section>
<section id="the-pass-statement">
<h3>第 0#声明句</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">pass_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"pass"</span>
</pre></div>
</div>
</section>
<section id="the-print-statement">
<h3>第 0#声明句</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">print_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"print"</span> <span class="s2">"("</span> <span class="n">expression</span>  <span class="p">[,</span> <span class="n">expression</span><span class="p">]</span> <span class="p">[</span><span class="o">.</span><span class="n">format</span><span class="p">{</span><span class="n">expression_list</span><span class="p">}]</span> <span class="s2">")"</span>
</pre></div>
</div>
</section>
<section id="the-break-statement">
<h3>第 0#声明句</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">break_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"break"</span>
</pre></div>
</div>
</section>
<section id="the-continue-statement">
<h3>第 0#声明句：</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">continue_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"continue"</span>
</pre></div>
</div>
</section>
</section>
<section id="compound-statements">
<h2>复合语句 §</h2>
<p>以下部分描述了 TorchScript 支持的复合语句的语法。本节还突出了 Torchscript 与常规 Python 语句的区别。它模仿了 Python 语言参考中的复合语句章节。</p>
<section id="the-if-statement">
<h3> <code class="docutils literal "><span class="pre">if</span></code> 语句 §</h3>
<p>Torchscript 支持基本的 <code class="docutils literal "><span class="pre">if/else</span></code> 和三元 <code class="docutils literal "><span class="pre">if/else</span></code> 。</p>
<section id="basic-if-else-statement">
<h4>基本语句①</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">if_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">"if"</span> <span class="n">assignment_expression</span> <span class="s2">":"</span> <span class="n">suite</span>
            <span class="p">(</span><span class="s2">"elif"</span> <span class="n">assignment_expression</span> <span class="s2">":"</span> <span class="n">suite</span><span class="p">)</span>
            <span class="p">[</span><span class="s2">"else"</span> <span class="s2">":"</span> <span class="n">suite</span><span class="p">]</span>
</pre></div>
</div>
<p>语句①可以重复任意次数，但必须在语句①之前。</p>
</section>
<section id="ternary-if-else-statement">
<h4>三元语句①</h4>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">if_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="k">return</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s2">"if"</span> <span class="n">assignment_expression</span> <span class="s2">"else"</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>示例 1</strong></p>
<p>一个具有 1 维的 <code class="docutils literal "><span class="pre">tensor</span></code> 被提升为 <code class="docutils literal "><span class="pre">bool</span></code> ：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">:</span> <span class="c1"># The tensor gets promoted to bool</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>上面的例子产生了以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>True
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>具有多维的 <code class="docutils literal "><span class="pre">tensor</span></code> 不会被提升为 <code class="docutils literal "><span class="pre">bool</span></code> ：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Multi dimensional Tensors error out.</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Tensor is available"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Tensor is available"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">())</span>
</pre></div>
</div>
<p>运行上述代码将得到以下结果 <code class="docutils literal "><span class="pre">RuntimeError</span></code> 。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">The</span> <span class="n">following</span> <span class="n">operation</span> <span class="n">failed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">TorchScript</span> <span class="n">interpreter</span><span class="o">.</span>
<span class="n">Traceback</span> <span class="n">of</span> <span class="n">TorchScript</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
       <span class="o">~~~~~~~~~~~~</span> <span class="o">&lt;---</span> <span class="n">HERE</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Tensor is available"</span><span class="p">)</span>
<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Boolean</span> <span class="n">value</span> <span class="n">of</span> <span class="n">Tensor</span> <span class="k">with</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">ambiguous</span>
</pre></div>
</div>
<p>如果一个条件变量被标注为 <code class="docutils literal "><span class="pre">final</span></code> ，则根据条件变量的评估结果，将评估真或假的分支。</p>
<p><strong>示例 3</strong></p>
<p>在本例中，仅评估 True 分支，因为 <code class="docutils literal "><span class="pre">a</span></code> 被标注为 <code class="docutils literal "><span class="pre">final</span></code> 并设置为 <code class="docutils literal "><span class="pre">True</span></code> ：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">a</span> <span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">final</span><span class="p">[</span><span class="n">Bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">if</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
</section>
</section>
<section id="the-while-statement">
<h3> <code class="docutils literal "><span class="pre">while</span></code> 声明 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">while_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"while"</span> <span class="n">assignment_expression</span> <span class="s2">":"</span> <span class="n">suite</span>
</pre></div>
</div>
<p>在 Torchscript 中不支持 while…else 语句。这会导致出现一个 <code class="docutils literal "><span class="pre">RuntimeError</span></code> 。</p>
</section>
<section id="the-for-in-statement">
<h3> <code class="docutils literal "><span class="pre">for-in</span></code> 声明 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">for_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"for"</span> <span class="n">target_list</span> <span class="s2">"in"</span> <span class="n">expression_list</span> <span class="s2">":"</span> <span class="n">suite</span>
              <span class="p">[</span><span class="s2">"else"</span> <span class="s2">":"</span> <span class="n">suite</span><span class="p">]</span>
</pre></div>
</div>
<p>在 Torchscript 中不支持 <code class="docutils literal "><span class="pre">for...else</span></code> 语句。这会导致出现一个 <code class="docutils literal "><span class="pre">RuntimeError</span></code> 。</p>
<p><strong>示例 1</strong></p>
<p>对于元组中的循环：这些循环会展开，为元组的每个成员生成一个体。该体必须对每个成员进行类型检查。</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fn</span><span class="p">()</span>
</pre></div>
</div>
<p>上面的示例将产生以下输出：</p>
<div class="highlight-none "><div class="highlight"><pre><span></span>3
 1
 1
 1
 1
[ CPUFloatType{4} ]
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>列表中的循环：对于 <code class="docutils literal "><span class="pre">nn.ModuleList</span></code> 的循环会在编译时展开循环体，每个模块列表的成员都会执行一次。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SubModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">+</span> <span class="nb">input</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mods</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">SubModule</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">module</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">MyModule</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="the-with-statement">
<h3> <code class="docutils literal "><span class="pre">with</span></code> 语句</h3>
<p> <code class="docutils literal "><span class="pre">with</span></code> 语句用于将代码块执行封装在由上下文管理器定义的方法中。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">with_stmt</span> <span class="p">:</span><span class="o">:=</span>  <span class="s2">"with"</span> <span class="n">with_item</span> <span class="p">(</span><span class="s2">","</span> <span class="n">with_item</span><span class="p">)</span> <span class="s2">":"</span> <span class="n">suite</span>
<span class="n">with_item</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="p">[</span><span class="s2">"as"</span> <span class="n">target</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>如果在 <code class="docutils literal "><span class="pre">with</span></code> 语句中包含了目标，上下文管理器的 <code class="docutils literal "><span class="pre">__enter__()</span></code> 的返回值将被分配给它。与 Python 不同，如果异常导致代码块退出，其类型、值和跟踪信息不会被作为参数传递给 <code class="docutils literal "><span class="pre">__exit__()</span></code> 。提供了三个 <code class="docutils literal "><span class="pre">None</span></code> 参数。</p></li>
<li><p> <code class="docutils literal "><span class="pre">try</span></code> 、 <code class="docutils literal "><span class="pre">except</span></code> 和 <code class="docutils literal "><span class="pre">finally</span></code> 语句不支持在 <code class="docutils literal "><span class="pre">with</span></code> 块内部。</p></li>
<li><p>在 <code class="docutils literal "><span class="pre">with</span></code> 块内抛出的异常无法被抑制。</p></li>
</ul>
</section>
<section id="the-tuple-statement">
<h3> <code class="docutils literal "><span class="pre">tuple</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">tuple_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">iterables</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>TorchScript 中的可迭代类型包括 <code class="docutils literal "><span class="pre">Tensors</span></code> 、 <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">tuples</span></code> 、 <code class="docutils literal "><span class="pre">dictionaries</span></code> 、 <code class="docutils literal "><span class="pre">strings</span></code> 、 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 和 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 。</p></li>
<li><p>您无法通过这个内置函数将列表转换为元组。</p></li>
</ul>
<p>将所有输出解包到元组中，由以下内容涵盖：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">abc</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="c1"># Function that returns a tuple</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="the-getattr-statement">
<h3> <code class="docutils literal "><span class="pre">getattr</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">getattr_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">[,</span> <span class="n">default</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>属性名称必须是字面字符串。</p></li>
<li><p>支持模块类型对象（例如，torch._C）。</p></li>
<li><p>不支持自定义类对象（例如，torch.classes.*）。</p></li>
</ul>
</section>
<section id="the-hasattr-statement">
<h3> <code class="docutils literal "><span class="pre">hasattr</span></code> 声明 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">hasattr_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>属性名称必须是字面字符串。</p></li>
<li><p>支持模块类型对象（例如，torch._C）。</p></li>
<li><p>不支持自定义类对象（例如，torch.classes.*）。</p></li>
</ul>
</section>
<section id="the-zip-statement">
<h3> <code class="docutils literal "><span class="pre">zip</span></code> 声明</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">zip_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iterable1</span><span class="p">,</span> <span class="n">iterable2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>参数必须是可迭代对象。</p></li>
<li><p>支持相同外部容器类型但长度不同的两个可迭代对象。</p></li>
</ul>
<p><strong>示例 1</strong></p>
<p>两个可迭代对象必须是同一容器类型：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># List</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># List</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># works</span>
</pre></div>
</div>
<p><strong>示例 2</strong></p>
<p>这个例子失败，因为可迭代对象是不同容器类型：</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># Tuple</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># List</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># Runtime error</span>
</pre></div>
</div>
<p>运行上述代码将产生以下 <code class="docutils literal "><span class="pre">RuntimeError</span></code> 。</p>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">iterate</span> <span class="n">over</span> <span class="n">a</span> <span class="n">module</span> <span class="nb">list</span> <span class="ow">or</span>
    <span class="nb">tuple</span> <span class="k">with</span> <span class="n">a</span> <span class="n">value</span> <span class="n">that</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">a</span> <span class="n">statically</span> <span class="n">determinable</span> <span class="n">length</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>示例 3</strong></p>
<p>支持相同容器类型但数据类型不同的两个可迭代对象：</p>
<div class="highlight-python3 "><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># Works</span>
</pre></div>
</div>
<p>TorchScript 中的可迭代类型包括 <code class="docutils literal "><span class="pre">Tensors</span></code> 、 <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">tuples</span></code> 、 <code class="docutils literal "><span class="pre">dictionaries</span></code> 、 <code class="docutils literal "><span class="pre">strings</span></code> 、 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 和 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 。</p>
</section>
<section id="the-enumerate-statement">
<h3> <code class="docutils literal "><span class="pre">enumerate</span></code> 语句 ¶</h3>
<div class="highlight-default "><div class="highlight"><pre><span></span><span class="n">enumerate_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">iterable</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>参数必须是可迭代的。</p></li>
<li><p>TorchScript 中的可迭代类型包括 <code class="docutils literal "><span class="pre">Tensors</span></code> 、 <code class="docutils literal "><span class="pre">lists</span></code> 、 <code class="docutils literal "><span class="pre">tuples</span></code> 、 <code class="docutils literal "><span class="pre">dictionaries</span></code> 、 <code class="docutils literal "><span class="pre">strings</span></code> 、 <code class="docutils literal "><span class="pre">torch.nn.ModuleList</span></code> 和 <code class="docutils literal "><span class="pre">torch.nn.ModuleDict</span></code> 。</p></li>
</ul>
</section>
</section>
<section id="python-values">
<span id="python-values-torch-script"></span><h2>Python 值 ¶</h2>
<section id="resolution-rules">
<span id="python-builtin-functions-values-resolution"></span><h3>解析规则 ¶</h3>
<p>当给定一个 Python 值时，TorchScript 会尝试以下五种方式来解析它：</p>
<ul class="simple">
<li><dl class="simple">
<dt>可编译的 Python 实现：</dt><dd><ul>
<li><p>当一个 Python 值由一个可以被 TorchScript 编译的 Python 实现支持时，TorchScript 会编译并使用其底层的 Python 实现。</p></li>
<li><p>示例： <code class="docutils literal "><span class="pre">torch.jit.Attribute</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Op Python 包装器：</dt><dd><ul>
<li><p>当一个 Python 值是原生 PyTorch 操作的包装器时，TorchScript 会发出相应的操作符。</p></li>
<li><p>示例： <code class="docutils literal "><span class="pre">torch.jit._logging.add_stat_value</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Python 对象身份匹配：</dt><dd><ul>
<li><p>对于 TorchScript 支持的有限集的 <code class="docutils literal "><span class="pre">torch.*</span></code> API 调用（以 Python 值的形式），TorchScript 会尝试将 Python 值与集合中的每个项目进行匹配。</p></li>
<li><p>匹配成功时，TorchScript 会生成一个相应的 <code class="docutils literal "><span class="pre">SugaredValue</span></code> 实例，该实例包含这些值的降级逻辑。</p></li>
<li><p>示例： <code class="docutils literal "><span class="pre">torch.jit.isinstance()</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>名称匹配：</dt><dd><ul>
<li><p>对于 Python 内置函数和常量，TorchScript 通过名称识别它们，并创建相应的 <code class="docutils literal "><span class="pre">SugaredValue</span></code> 实例以实现其功能。</p></li>
<li><p>示例： <code class="docutils literal "><span class="pre">all()</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>值快照：</dt><dd><ul>
<li><p>对于来自未识别模块的 Python 值，TorchScript 会尝试对该值进行快照并将其转换为图中的常量，该图是正在编译的函数或方法。</p></li>
<li><p>示例： <code class="docutils literal "><span class="pre">math.pi</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="python-built-in-functions-support">
<span id="python-builtin-functions-support"></span><h3>Python 内置函数支持 ¶</h3>
<table class="docutils align-default" id="id5">
<caption>对 Python 内置函数的 TorchScript 支持 ¶</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>内置函数</p></th>
<th class="head"><p>支持级别</p></th>
<th class="head"><p>笔记</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">abs()</span></code></p></td>
<td><p>部分支持</p></td>
<td><p>仅支持 <code class="docutils literal "><span class="pre">Tensor</span></code> / <code class="docutils literal "><span class="pre">Int</span></code> / <code class="docutils literal "><span class="pre">Float</span></code> 类型输入。 | 不遵循 <code class="docutils literal "><span class="pre">__abs__</span></code> 覆盖。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">all()</span></code></p></td>
<td><p>完整</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">any()</span></code></p></td>
<td><p>完整</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">ascii()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">bin()</span></code></p></td>
<td><p>部分支持</p></td>
<td><p>仅支持 <code class="docutils literal "><span class="pre">Int</span></code> 类型输入。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">bool()</span></code></p></td>
<td><p>部分支持</p></td>
<td><p>仅支持 <code class="docutils literal "><span class="pre">Tensor</span></code> / <code class="docutils literal "><span class="pre">Int</span></code> / <code class="docutils literal "><span class="pre">Float</span></code> 类型输入。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">breakpoint()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">bytearray()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">bytes()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">callable()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">chr()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>仅支持 ASCII 字符集。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">classmethod()</span></code></p></td>
<td><p>完整翻译</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">compile()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">complex()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">delattr()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">dict()</span></code></p></td>
<td><p>全</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">dir()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">divmod()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">enumerate()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">eval()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">exec()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">filter()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">float()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>不遵守 <code class="docutils literal "><span class="pre">__index__</span></code> 覆盖。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">format()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>不支持手动索引指定。|不支持格式类型修饰符。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">frozenset()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">getattr()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>属性名称必须是字符串字面量。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">globals()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">hasattr()</span></code></p></td>
<td><p>部分内容</p></td>
<td><p>属性名称必须是字符串字面量。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">hash()</span></code></p></td>
<td><p>全部</p></td>
<td><p> <code class="docutils literal "><span class="pre">Tensor</span></code> 的哈希基于身份而非数值。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">hex()</span></code></p></td>
<td><p>部分支持</p></td>
<td><p>仅支持 <code class="docutils literal "><span class="pre">Int</span></code> 类型输入。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">id()</span></code></p></td>
<td><p>全部</p></td>
<td><p>仅支持 <code class="docutils literal "><span class="pre">Int</span></code> 类型输入。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">input()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">int()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>不支持 <code class="docutils literal "><span class="pre">base</span></code> 参数。|不尊重 <code class="docutils literal "><span class="pre">__index__</span></code> 覆盖。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">isinstance()</span></code></p></td>
<td><p>完整翻译</p></td>
<td><p>提供与容器类型等检查时的更好支持。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">issubclass()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">iter()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">len()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">list()</span></code></p></td>
<td><p>全面</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">ord()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>仅支持 ASCII 字符集。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">pow()</span></code></p></td>
<td><p>完整翻译</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">print()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p> <code class="docutils literal "><span class="pre">separate</span></code> 、 <code class="docutils literal "><span class="pre">end</span></code> 和 <code class="docutils literal "><span class="pre">file</span></code> 参数不受支持。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">property()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">range()</span></code></p></td>
<td><p>完整</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">repr()</span></code></p></td>
<td><p>None</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">reversed()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">round()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>不支持该参数。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">set()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">setattr()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">slice()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">sorted()</span></code></p></td>
<td><p>部分翻译</p></td>
<td><p>不支持该参数。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">staticmethod()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">str()</span></code></p></td>
<td><p>部分支持</p></td>
<td><p>不支持 <code class="docutils literal "><span class="pre">encoding</span></code> 和 <code class="docutils literal "><span class="pre">errors</span></code> 参数。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">sum()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">super()</span></code></p></td>
<td><p>部分内容</p></td>
<td><p>只能在 <code class="docutils literal "><span class="pre">nn.Module</span></code> 的 <code class="docutils literal "><span class="pre">__init__</span></code> 方法中使用。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">type()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">vars()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">zip()</span></code></p></td>
<td><p>全部</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">__import__()</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="python-built-in-values-support">
<span id="python-builtin-values-support"></span><h3>Python 内置值支持 ¶</h3>
<table class="docutils align-default" id="id6">
<caption>对 Python 内置值的 TorchScript 支持 ¶</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>内置值</p></th>
<th class="head"><p>支持级别</p></th>
<th class="head"><p>笔记</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">False</span></code></p></td>
<td><p>完全</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">True</span></code></p></td>
<td><p>完全</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">None</span></code></p></td>
<td><p>完整</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal "><span class="pre">NotImplemented</span></code></p></td>
<td><p>无</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal "><span class="pre">Ellipsis</span></code></p></td>
<td><p>完整</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="torch-apis">
<span id="torch-apis-in-torchscript"></span><h2>torch.* API ¶</h2>
<section id="remote-procedure-calls">
<span id="torch-apis-in-torchscript-rpc"></span><h3>远程过程调用</h3>
<p>TorchScript 支持 RPC API 的子集，该 API 支持在指定的远程工作者上运行函数，而不是本地运行。</p>
<p>具体来说，以下 API 完全支持：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.distributed.rpc.rpc_sync()</span></code></dt><dd><ul>
<li><p> <code class="docutils literal "><span class="pre">rpc_sync()</span></code> 对远程工作者运行函数的阻塞式 RPC 调用。RPC 消息在 Python 代码执行并行发送和接收。</p></li>
<li><p>更多关于其使用方法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">rpc_sync()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.distributed.rpc.rpc_async()</span></code></dt><dd><ul>
<li><p> <code class="docutils literal "><span class="pre">rpc_async()</span></code> 向远程工作进程执行非阻塞 RPC 调用以运行函数。RPC 消息在 Python 代码执行并行发送和接收。</p></li>
<li><p>更多关于其使用方法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">rpc_async()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.distributed.rpc.remote()</span></code></dt><dd><ul>
<li><p> <code class="docutils literal "><span class="pre">remote.()</span></code> 在工作进程中执行远程调用并返回一个远程引用 <code class="docutils literal "><span class="pre">RRef</span></code> 。</p></li>
<li><p>更多关于其用法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">remote()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="asynchronous-execution">
<span id="torch-apis-in-torchscript-async"></span><h3>异步执行 ¶</h3>
<p>TorchScript 允许您创建异步计算任务，以更好地利用计算资源。这是通过支持一系列仅在 TorchScript 中可用的 API 来实现的：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.fork()</span></code></dt><dd><ul>
<li><p>创建一个执行 func 并引用此执行结果的值的异步任务。Fork 将立即返回。</p></li>
<li><p>相当于 <code class="docutils literal "><span class="pre">torch.jit._fork()</span></code> ，仅为了向后兼容而保留。</p></li>
<li><p>更多关于其用法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">fork()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.wait()</span></code></dt><dd><ul>
<li><p>强制完成一个 <code class="docutils literal "><span class="pre">torch.jit.Future[T]</span></code> 异步任务，返回任务的结果。</p></li>
<li><p>相当于 <code class="docutils literal "><span class="pre">torch.jit._wait()</span></code> ，仅为了向后兼容而保留。</p></li>
<li><p>更多关于其用法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">wait()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="type-annotations">
<span id="torch-apis-in-torchscript-annotation"></span><h3>类型注解 ¶</h3>
<p>TorchScript 是静态类型的。它提供并支持一组工具来帮助注解变量和属性：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.annotate()</span></code></dt><dd><ul>
<li><p>为 TorchScript 提供类型提示，在 Python 3 风格的类型提示不适用的情况下。</p></li>
<li><p>一个常见的例子是为类似 <code class="docutils literal "><span class="pre">[]</span></code> 的表达式标注类型。 <code class="docutils literal "><span class="pre">[]</span></code> 默认被视为 <code class="docutils literal "><span class="pre">List[torch.Tensor]</span></code> 。当需要不同的类型时，可以使用此代码来提示 TorchScript： <code class="docutils literal "><span class="pre">torch.jit.annotate(List[int],</span> <span class="pre">[])</span></code> 。</p></li>
<li><p>更多详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">annotate()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.Attribute</span></code></dt><dd><ul>
<li><p>常见用例包括为 <code class="docutils literal "><span class="pre">torch.nn.Module</span></code> 属性提供类型提示。因为它们的 <code class="docutils literal "><span class="pre">__init__</span></code> 方法不会被 TorchScript 解析，所以在模块的 <code class="docutils literal "><span class="pre">__init__</span></code> 方法中应使用 <code class="docutils literal "><span class="pre">torch.jit.Attribute</span></code> 代替 <code class="docutils literal "><span class="pre">torch.jit.annotate</span></code> 。</p></li>
<li><p>更多详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">Attribute()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.Final</span></code></dt><dd><ul>
<li><p>Python 的别名。 <code class="docutils literal "><span class="pre">torch.jit.Final</span></code> 仅保留为向后兼容。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="meta-programming">
<span id="torch-apis-in-torchscript-meta-programming"></span><h3>元编程 ¶</h3>
<p>TorchScript 提供了一套元编程的实用工具：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.is_scripting()</span></code></dt><dd><ul>
<li><p>返回一个布尔值，指示当前程序是否由 <code class="docutils literal "><span class="pre">torch.jit.script</span></code> 编译。</p></li>
<li><p>当用于 <code class="docutils literal "><span class="pre">assert</span></code> 或 <code class="docutils literal "><span class="pre">if</span></code> 语句时， <code class="docutils literal "><span class="pre">torch.jit.is_scripting()</span></code> 评估为 <code class="docutils literal "><span class="pre">False</span></code> 的作用域或分支不会被编译。</p></li>
<li><p>其值可以在编译时静态评估，因此通常用于 <code class="docutils literal "><span class="pre">if</span></code> 语句以阻止 TorchScript 编译其中一个分支。</p></li>
<li><p>更多详细信息及示例可在 <code class="xref py py-meth docutils literal "><span class="pre">is_scripting()</span></code> 查找</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.is_tracing()</span></code></dt><dd><ul>
<li><p>返回一个布尔值，指示当前程序是否被 <code class="docutils literal "><span class="pre">torch.jit.trace</span></code> / <code class="docutils literal "><span class="pre">torch.jit.trace_module</span></code> 跟踪。</p></li>
<li><p>更多详细信息请参阅 <code class="xref py py-meth docutils literal "><span class="pre">is_tracing()</span></code> </p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">@torch.jit.ignore</span></code></dt><dd><ul>
<li><p>此装饰器指示编译器忽略函数或方法，并将其保留为 Python 函数。</p></li>
<li><p>这允许您在模型中留下尚未与 TorchScript 兼容的代码。</p></li>
<li><p>如果从 TorchScript 调用由 <code class="docutils literal "><span class="pre">@torch.jit.ignore</span></code> 装饰的函数，则忽略的函数将调用 Python 解释器来处理调用。</p></li>
<li><p>无法导出具有忽略函数的模型。</p></li>
<li><p>更多信息和示例可以在 <code class="xref py py-meth docutils literal "><span class="pre">ignore()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">@torch.jit.unused</span></code></dt><dd><ul>
<li><p>此装饰器指示编译器忽略函数或方法，并用抛出异常来替换。</p></li>
<li><p>这允许您在模型中留下尚未与 TorchScript 兼容的代码，同时仍然导出模型。</p></li>
<li><p>如果从 TorchScript 调用由 <code class="docutils literal "><span class="pre">@torch.jit.unused</span></code> 装饰的函数，将引发运行时错误。</p></li>
<li><p>更多信息和示例可以在 <code class="xref py py-meth docutils literal "><span class="pre">unused()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="type-refinement">
<span id="torch-apis-in-torchscript-type-refinement"></span><h3>类型细化 ¶</h3>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal "><span class="pre">torch.jit.isinstance()</span></code></dt><dd><ul>
<li><p>返回一个布尔值，表示变量是否为指定的类型。</p></li>
<li><p>更多关于其用法和示例的详细信息可以在 <code class="xref py py-meth docutils literal "><span class="pre">isinstance()</span></code> 中找到。</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
</section>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        下一个 <img height="16" width="16" class="next-page" src="_static/images/chevron-right-orange.svg"> <img height="16" width="16" class="previous-page" src="_static/images/chevron-right-orange.svg"> 上一个
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>© 版权所有 PyTorch 贡献者。</p>
  </div>
    
      <div>使用 Sphinx 构建，主题由 Read the Docs 提供。</div>
     

</footer>

          </div>
<script>

var match = window.location.href.match(/\/_[a-zA-Z0-9_]*.html|_dynamo/gi);
var url = window.location.href.lastIndexOf(match[match.length-1]);

if (url)
  {
    var div = '<div class="admonition note"><p class="admonition-title">Note</p><p><i class="fa fa-exclamation-circle" aria-hidden="true">&nbsp</i> This page describes an internal API which is not intended to be used outside of the PyTorch codebase and can be modified or removed without notice.</p></div>'
    document.getElementById("pytorch-article").insertAdjacentHTML('afterBegin', div)
  }
</script>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">TorchScript 语言参考</a><ul>
<li><a class="reference internal" href="#terminology">术语</a></li>
<li><a class="reference internal" href="#id1">类型系统</a><ul>
<li><a class="reference internal" href="#torchscript-types">TorchScript 类型</a></li>
<li><a class="reference internal" href="#meta-types">元类型</a><ul>
<li><a class="reference internal" href="#any-type">类型</a></li>
<li><a class="reference internal" href="#operators-supported-for-any-type">支持的运算符类型</a></li>
<li><a class="reference internal" href="#design-notes">设计说明</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primitive-types">基本类型</a></li>
<li><a class="reference internal" href="#structural-types">结构化类型</a></li>
<li><a class="reference internal" href="#nominal-types">名词类型</a></li>
<li><a class="reference internal" href="#built-in-class">内置类</a><ul>
<li><a class="reference internal" href="#special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">关于 torch.nn.ModuleList 和 torch.nn.ModuleDict 的特殊说明</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-class">自定义类</a></li>
<li><a class="reference internal" href="#enum-type">枚举类型</a></li>
<li><a class="reference internal" href="#torchscript-module-class">TorchScript 模块类</a></li>
<li><a class="reference internal" href="#module-instance-class">模块实例类</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation">类型注解</a><ul>
<li><a class="reference internal" href="#when-to-annotate-types">何时进行类型注解</a></li>
<li><a class="reference internal" href="#annotate-function-signature">注解函数签名</a></li>
<li><a class="reference internal" href="#annotate-variables-and-data-attributes">注解变量和数据属性</a><ul>
<li><a class="reference internal" href="#local-variables">本地变量</a></li>
<li><a class="reference internal" href="#instance-data-attributes">实例数据属性</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation-apis">类型注解 API</a><ul>
<li><a class="reference internal" href="#torch-jit-annotate-t-expr"><code class="docutils literal "><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation-appendix">类型注解附录</a><ul>
<li><a class="reference internal" href="#torchscript-type-system-definition">火炬脚本类型系统定义</a></li>
<li><a class="reference internal" href="#unsupported-typing-constructs">不支持的类型构造</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#expressions">表达式</a><ul>
<li><a class="reference internal" href="#arithmetic-conversions">算术转换</a></li>
<li><a class="reference internal" href="#atoms">原子</a><ul>
<li><a class="reference internal" href="#identifiers">标识符</a></li>
<li><a class="reference internal" href="#literals">文字</a></li>
<li><a class="reference internal" href="#parenthesized-forms">括号形式</a></li>
<li><a class="reference internal" href="#list-and-dictionary-displays">列表和字典显示</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primaries">基本类型</a><ul>
<li><a class="reference internal" href="#attribute-references">属性引用</a></li>
<li><a class="reference internal" href="#subscriptions">订阅</a></li>
<li><a class="reference internal" href="#slicings">切片</a></li>
<li><a class="reference internal" href="#calls">调用</a></li>
</ul>
</li>
<li><a class="reference internal" href="#power-operator">功率运算符</a></li>
<li><a class="reference internal" href="#unary-and-arithmetic-bitwise-operations">一元和算术位运算</a></li>
<li><a class="reference internal" href="#binary-arithmetic-operations">二进制算术运算</a></li>
<li><a class="reference internal" href="#shifting-operations">移位操作</a></li>
<li><a class="reference internal" href="#binary-bitwise-operations">二进制位运算</a></li>
<li><a class="reference internal" href="#comparisons">比较操作</a><ul>
<li><a class="reference internal" href="#value-comparisons">值比较</a></li>
<li><a class="reference internal" href="#membership-test-operations">成员测试操作</a></li>
<li><a class="reference internal" href="#identity-comparisons">身份比较</a></li>
</ul>
</li>
<li><a class="reference internal" href="#boolean-operations">布尔运算</a></li>
<li><a class="reference internal" href="#conditional-expressions">条件表达式</a></li>
<li><a class="reference internal" href="#expression-lists">表达式列表</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simple-statements">简单语句</a><ul>
<li><a class="reference internal" href="#expression-statements">表达式语句</a></li>
<li><a class="reference internal" href="#assignment-statements">赋值语句</a></li>
<li><a class="reference internal" href="#augmented-assignment-statements">增强赋值语句</a></li>
<li><a class="reference internal" href="#annotated-assignment-statements">注释赋值语句</a></li>
<li><a class="reference internal" href="#the-raise-statement"> <code class="docutils literal "><span class="pre">raise</span></code> 语句</a></li>
<li><a class="reference internal" href="#the-assert-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-return-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-del-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-pass-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-print-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-break-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-continue-statement">第 0#声明：</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compound-statements">复合语句</a><ul>
<li><a class="reference internal" href="#the-if-statement">第 0#陈述</a><ul>
<li><a class="reference internal" href="#basic-if-else-statement">基本第 0#陈述</a></li>
<li><a class="reference internal" href="#ternary-if-else-statement">三元第 0#陈述</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-while-statement">第 0#陈述</a></li>
<li><a class="reference internal" href="#the-for-in-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-with-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-tuple-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-getattr-statement">第 0#声明</a></li>
<li><a class="reference internal" href="#the-hasattr-statement"> <code class="docutils literal "><span class="pre">hasattr</span></code> 声明</a></li>
<li><a class="reference internal" href="#the-zip-statement"> <code class="docutils literal "><span class="pre">zip</span></code> 声明</a></li>
<li><a class="reference internal" href="#the-enumerate-statement"> <code class="docutils literal "><span class="pre">enumerate</span></code> 声明</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-values">Python 值</a><ul>
<li><a class="reference internal" href="#resolution-rules">分辨率规则</a></li>
<li><a class="reference internal" href="#python-built-in-functions-support">Python 内置函数支持</a></li>
<li><a class="reference internal" href="#python-built-in-values-support">Python 内置值支持</a></li>
</ul>
</li>
<li><a class="reference internal" href="#torch-apis">torch.* API</a><ul>
<li><a class="reference internal" href="#remote-procedure-calls">远程过程调用</a></li>
<li><a class="reference internal" href="#asynchronous-execution">异步执行</a></li>
<li><a class="reference internal" href="#type-annotations">类型注解</a></li>
<li><a class="reference internal" href="#meta-programming">元编程</a></li>
<li><a class="reference internal" href="#type-refinement">类型细化</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/clipboard.min.js"></script>
         <script src="_static/copybutton.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script="" type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0">


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>文档</h2>
          <p>PyTorch 开发者文档全面访问</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">查看文档</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>教程</h2>
          <p>获取初学者和高级开发者的深入教程</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">查看教程</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>资源</h2>
          <p>查找开发资源并获得您的疑问解答</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">查看资源</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">开始使用</a></li>
            <li><a href="https://pytorch.org/features">功能</a></li>
            <li><a href="https://pytorch.org/ecosystem">生态系统</a></li>
            <li><a href="https://pytorch.org/blog/">博客</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">贡献</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">资源</a></li>
            <li><a href="https://pytorch.org/tutorials">教程</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">文档</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">讨论</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">GitHub 问题和任务</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">品牌指南</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">保持更新</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">推特</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">领英</a></li>
          </ul>  
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch 播客</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">苹果</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">谷歌</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">亚马逊</a></li>
          </ul>
         </div>
        </div>
        
        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">条款</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">隐私</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p>© 版权所有 Linux 基金会。PyTorch 基金会是 Linux 基金会的一个项目。有关本网站的使用条款、商标政策以及其他适用于 PyTorch 基金会的政策，请参阅 www.linuxfoundation.org/policies/。PyTorch 基金会支持 PyTorch 开源项目，该项目已被确立为 LF Projects, LLC 的 PyTorch 项目系列。有关适用于 PyTorch 项目系列 LF Projects, LLC 的政策，请参阅 www.lfprojects.org/policies/。</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">为分析流量并优化您的体验，我们在本网站上提供 cookies。通过点击或导航，您同意允许我们使用 cookies。作为本站点的当前维护者，Facebook 的 Cookies 政策适用。了解更多信息，包括可用的控制选项：Cookies 政策。</p>
    <img class="close-button" src="_static/images/pytorch-x.svg" width="16" height="16">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>学习</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/get-started">开始学习</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials">教程</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/basics/intro.html">学习基础知识</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/recipes/recipes_index.html">PyTorch 菜谱</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/introyt.html">PyTorch 入门 - YouTube 系列</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>生态系统</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/ecosystem">工具</a>
             </li>
             <li>
               <a href="https://pytorch.org/#community-module">社区</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">论坛</a>
             </li>
             <li>
               <a href="https://pytorch.org/resources">开发者资源</a>
             </li>
             <li>
               <a href="https://pytorch.org/ecosystem/contributor-awards-2023">贡献者奖项 - 2024</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Edge</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/edge">关于 PyTorch Edge</a>
             </li>
             
             <li>
               <a href="https://pytorch.org/executorch-overview">ExecuTorch</a>
             </li>
             <li>
               <a href="https://pytorch.org/executorch/stable/index.html">ExecuTorch 文档</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>文档</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/pytorch-domains">PyTorch 领域</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>博客 &amp; 新闻</a>
          </li>
            
           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/blog/">PyTorch 博客</a>
            </li>
            <li>
              <a href="https://pytorch.org/community-blog">社区博客</a>
            </li>

            <li>
              <a href="https://pytorch.org/videos">视频</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">社区故事</a>
            </li>
            <li>
              <a href="https://pytorch.org/events">活动</a>
            </li>
            <li>
               <a href="https://pytorch.org/newsletter">通讯</a>
             </li>
          </ul>
          
          <li class="resources-mobile-menu-title">
            <a>关于</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/foundation">PyTorch 基金会</a>
            </li>
            <li>
              <a href="https://pytorch.org/governing-board">治理委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/credits">云信用计划</a>
            </li>
            <li>
               <a href="https://pytorch.org/tac">技术顾问委员会</a>
            </li>
            <li>
               <a href="https://pytorch.org/staff">员工</a>
            </li>
            <li>
               <a href="https://pytorch.org/contact-us">联系我们</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>

</body></html>